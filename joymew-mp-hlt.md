This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.

# File Summary

## Purpose
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A header with the file path (## File: path/to/file)
  b. The full contents of the file in a code block

## Usage Guidelines
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: package.json, app.json, app.js, utils/qiniu/index.js, utils/browseRecord.js, utils/date.js, utils/index.js, utils/request.js, utils/storage.js, utils/tween.js, pages, packageB, packageA, libs, components, api
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)

# Directory Structure
```
api/comment/comment.js
api/comment/draw.js
api/feedback/feedback.js
api/gift.js
api/guessHb/guessHb.js
api/hbkdRecharge/hbkdRecharge.js
api/index/index.js
api/kbx/kbx.js
api/login.js
api/nyn/nyn.js
api/pay.js
api/recharge/recharge.js
api/system.js
api/weddingMan/index.js
api/zfdm/zfdm.js
api/zyz/zyz.js
api/zyzSmall.js
app.js
app.json
components/authDialog/authDialog.js
components/authDialog/authDialog.json
components/authDialog/authDialog.wxml
components/authDialog/authDialog.wxss
components/authDialog/cropper/cropper.js
components/authDialog/cropper/cropper.json
components/authDialog/cropper/cropper.wxml
components/authDialog/cropper/cropper.wxss
components/feedbackEntry/feedbackEntry.js
components/feedbackEntry/feedbackEntry.json
components/feedbackEntry/feedbackEntry.wxml
components/feedbackEntry/feedbackEntry.wxss
components/image-cropper/image-cropper.js
components/image-cropper/image-cropper.json
components/image-cropper/image-cropper.wxml
components/image-cropper/image-cropper.wxss
components/privacyAuthorize/privacyAuthorize.js
components/privacyAuthorize/privacyAuthorize.json
components/privacyAuthorize/privacyAuthorize.wxml
components/privacyAuthorize/privacyAuthorize.wxss
components/rateStar/rateStar.js
components/rateStar/rateStar.json
components/rateStar/rateStar.wxml
components/rateStar/rateStar.wxss
components/sign/sign.js
components/sign/sign.json
components/sign/sign.wxml
components/sign/sign.wxss
components/signCustom/signCustom.js
components/signCustom/signCustom.json
components/signCustom/signCustom.wxml
components/signCustom/signCustom.wxss
components/signLz/signLz.js
components/signLz/signLz.json
components/signLz/signLz.wxml
components/signLz/signLz.wxss
components/signYj/signYj.js
components/signYj/signYj.json
components/signYj/signYj.wxml
components/signYj/signYj.wxss
libs/svgaplayer.weapp.js
package.json
packageA/api/hbkdRecharge.js
packageA/api/recharge.js
packageA/pages/hbkdRecharge/hbkdRecharge.js
packageA/pages/hbkdRecharge/hbkdRecharge.json
packageA/pages/hbkdRecharge/hbkdRecharge.wxml
packageA/pages/hbkdRecharge/hbkdRecharge.wxss
packageA/pages/hbkdRecharge/styles/commonMode.wxss
packageA/pages/hbkdRecharge/styles/templateMode.wxss
packageA/pages/hbkdRecharge/styles/zshlMode.wxss
packageB/api/photoWall.js
packageB/pages/photoWallIndex/photoWallIndex.js
packageB/pages/photoWallIndex/photoWallIndex.json
packageB/pages/photoWallIndex/photoWallIndex.wxml
packageB/pages/photoWallIndex/photoWallIndex.wxss
packageB/pages/photoWallUpload/photoWallUpload.js
packageB/pages/photoWallUpload/photoWallUpload.json
packageB/pages/photoWallUpload/photoWallUpload.wxml
packageB/pages/photoWallUpload/photoWallUpload.wxss
pages/ad/ad.js
pages/ad/ad.json
pages/ad/ad.less
pages/ad/ad.wxml
pages/ad/ad.wxss
pages/agreement/agreement.js
pages/agreement/agreement.json
pages/agreement/agreement.wxml
pages/agreement/agreement.wxss
pages/debug/debug.js
pages/debug/debug.json
pages/debug/debug.scss
pages/debug/debug.wxml
pages/estimate/components/danmu/danmu.js
pages/estimate/components/danmu/danmu.json
pages/estimate/components/danmu/danmu.wxml
pages/estimate/components/danmu/danmu.wxss
pages/estimate/components/etTabBar/etTabBar.js
pages/estimate/components/etTabBar/etTabBar.json
pages/estimate/components/etTabBar/etTabBar.wxml
pages/estimate/components/etTabBar/etTabBar.wxss
pages/estimate/components/hostEstimate/hostEstimate.js
pages/estimate/components/hostEstimate/hostEstimate.json
pages/estimate/components/hostEstimate/hostEstimate.wxml
pages/estimate/components/hostEstimate/hostEstimate.wxss
pages/estimate/components/hostEstimate/item.wxss
pages/estimate/components/hotelEstimate/hotelEstimate.js
pages/estimate/components/hotelEstimate/hotelEstimate.json
pages/estimate/components/hotelEstimate/hotelEstimate.wxml
pages/estimate/components/hotelEstimate/hotelEstimate.wxss
pages/estimate/components/replyInput/replyInput.js
pages/estimate/components/replyInput/replyInput.json
pages/estimate/components/replyInput/replyInput.wxml
pages/estimate/components/replyInput/replyInput.wxss
pages/estimate/draw/draw.js
pages/estimate/draw/draw.json
pages/estimate/draw/draw.wxml
pages/estimate/draw/draw.wxss
pages/estimate/draw/drawPage/drawPage.js
pages/estimate/draw/drawPage/drawPage.json
pages/estimate/draw/drawPage/drawPage.wxml
pages/estimate/draw/drawPage/drawPage.wxss
pages/estimate/estimate.js
pages/estimate/estimate.json
pages/estimate/estimate.wxml
pages/estimate/host/components/cases/cases.js
pages/estimate/host/components/cases/cases.json
pages/estimate/host/components/cases/cases.wxml
pages/estimate/host/components/cases/cases.wxss
pages/estimate/host/components/ReserveBtn/ReserveBtn.js
pages/estimate/host/components/ReserveBtn/ReserveBtn.json
pages/estimate/host/components/ReserveBtn/ReserveBtn.wxml
pages/estimate/host/components/ReserveBtn/ReserveBtn.wxss
pages/estimate/host/components/ReserveBtn/ReverseBtn.less
pages/estimate/host/components/ReserveBtn/ReverseBtn.min.wxss
pages/estimate/host/components/ReverseBox/ReverseBox.js
pages/estimate/host/components/ReverseBox/ReverseBox.json
pages/estimate/host/components/ReverseBox/ReverseBox.less
pages/estimate/host/components/ReverseBox/ReverseBox.min.wxss
pages/estimate/host/components/ReverseBox/ReverseBox.wxml
pages/estimate/host/components/ReverseBox/ReverseBox.wxss
pages/estimate/host/host.js
pages/estimate/host/host.json
pages/estimate/host/host.wxml
pages/estimate/host/host.wxss
pages/estimate/hotel/hotel.js
pages/estimate/hotel/hotel.json
pages/estimate/hotel/hotel.wxml
pages/estimate/hotel/hotel.wxss
pages/estimate/review/imgPreview/imgPreview.js
pages/estimate/review/imgPreview/imgPreview.json
pages/estimate/review/imgPreview/imgPreview.wxml
pages/estimate/review/imgPreview/imgPreview.wxss
pages/estimate/review/rankInfo/rankInfo.js
pages/estimate/review/rankInfo/rankInfo.json
pages/estimate/review/rankInfo/rankInfo.wxml
pages/estimate/review/rankInfo/rankInfo.wxss
pages/estimate/review/review.js
pages/estimate/review/review.json
pages/estimate/review/review.wxml
pages/estimate/review/review.wxss
pages/estimate/review/reviewItem/reviewItem.js
pages/estimate/review/reviewItem/reviewItem.json
pages/estimate/review/reviewItem/reviewItem.wxml
pages/estimate/review/reviewItem/reviewItem.wxss
pages/feedback/feedback.js
pages/feedback/feedback.json
pages/feedback/feedback.wxml
pages/feedback/feedback.wxss
pages/guessHb/guessHb.js
pages/guessHb/guessHb.json
pages/guessHb/guessHb.wxml
pages/guessHb/guessHb.wxss
pages/hbkdRecharge/hbkdRecharge.js
pages/hbkdRecharge/hbkdRecharge.json
pages/hbkdRecharge/hbkdRecharge.wxml
pages/hbkdRecharge/hbkdRecharge.wxss
pages/hbWall/hbWall.js
pages/hbWall/hbWall.json
pages/hbWall/hbWall.wxml
pages/hbWall/hbWall.wxss
pages/hotelReserve/couponDetail/couponDetail.js
pages/hotelReserve/couponDetail/couponDetail.json
pages/hotelReserve/couponDetail/couponDetail.wxml
pages/hotelReserve/couponDetail/couponDetail.wxss
pages/hotelReserve/hotelDetail/hotelDetail.js
pages/hotelReserve/hotelDetail/hotelDetail.json
pages/hotelReserve/hotelDetail/hotelDetail.wxml
pages/hotelReserve/hotelDetail/hotelDetail.wxss
pages/hotelReserve/hotelReserve.js
pages/hotelReserve/hotelReserve.json
pages/hotelReserve/hotelReserve.wxml
pages/hotelReserve/hotelReserve.wxss
pages/hotelReserve/menuDetail/menuDetail.js
pages/hotelReserve/menuDetail/menuDetail.json
pages/hotelReserve/menuDetail/menuDetail.wxml
pages/hotelReserve/menuDetail/menuDetail.wxss
pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.js
pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.json
pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.wxml
pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.wxss
pages/hotelReserve/myPreferential/myPreferential.js
pages/hotelReserve/myPreferential/myPreferential.json
pages/hotelReserve/myPreferential/myPreferential.wxml
pages/hotelReserve/myPreferential/myPreferential.wxss
pages/hotelReserve/packageDetail/packageDetail.js
pages/hotelReserve/packageDetail/packageDetail.json
pages/hotelReserve/packageDetail/packageDetail.wxml
pages/hotelReserve/packageDetail/packageDetail.wxss
pages/hotelReserve/preferentialDetail/preferentialDetail.js
pages/hotelReserve/preferentialDetail/preferentialDetail.json
pages/hotelReserve/preferentialDetail/preferentialDetail.wxml
pages/hotelReserve/preferentialDetail/preferentialDetail.wxss
pages/index/index.js
pages/index/index.json
pages/index/index.wxml
pages/index/index.wxss
pages/joymewIndex/joymewIndex.js
pages/joymewIndex/joymewIndex.json
pages/joymewIndex/joymewIndex.wxml
pages/joymewIndex/joymewIndex.wxss
pages/joymewIndexDz/components/avatarGet/avatarGet.js
pages/joymewIndexDz/components/avatarGet/avatarGet.json
pages/joymewIndexDz/components/avatarGet/avatarGet.wxml
pages/joymewIndexDz/components/avatarGet/avatarGet.wxss
pages/joymewIndexDz/components/phoneGet/phoneGet.js
pages/joymewIndexDz/components/phoneGet/phoneGet.json
pages/joymewIndexDz/components/phoneGet/phoneGet.wxml
pages/joymewIndexDz/components/phoneGet/phoneGet.wxss
pages/joymewIndexDz/joymewIndexDz.js
pages/joymewIndexDz/joymewIndexDz.json
pages/joymewIndexDz/joymewIndexDz.wxml
pages/joymewIndexDz/joymewIndexDz.wxss
pages/kbx/kbx.js
pages/kbx/kbx.json
pages/kbx/kbx.wxml
pages/kbx/kbx.wxss
pages/live/live.js
pages/live/live.json
pages/live/live.wxml
pages/live/live.wxss
pages/luckyWheel/luckyWheel.js
pages/luckyWheel/luckyWheel.json
pages/luckyWheel/luckyWheel.wxml
pages/luckyWheel/luckyWheel.wxss
pages/luckyWheel/luckyWheelMain/luckyWheelMain.js
pages/luckyWheel/luckyWheelMain/luckyWheelMain.json
pages/luckyWheel/luckyWheelMain/luckyWheelMain.less
pages/luckyWheel/luckyWheelMain/luckyWheelMain.wxml
pages/luckyWheel/luckyWheelMain/luckyWheelMain.wxss
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.js
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.json
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.wxml
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.wxss
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.js
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.json
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.wxml
pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.wxss
pages/luckyWheel/prizeSheet/prizeSheet.js
pages/luckyWheel/prizeSheet/prizeSheet.json
pages/luckyWheel/prizeSheet/prizeSheet.wxml
pages/luckyWheel/prizeSheet/prizeSheet.wxss
pages/luckyWheel/wait/wait.js
pages/luckyWheel/wait/wait.json
pages/luckyWheel/wait/wait.wxml
pages/luckyWheel/wait/wait.wxss
pages/nyn/nyn.js
pages/nyn/nyn.json
pages/nyn/nyn.wxml
pages/nyn/nyn.wxss
pages/pay/pay.js
pages/pay/pay.json
pages/pay/pay.wxml
pages/photographerWall/photographerWall.js
pages/photographerWall/photographerWall.json
pages/photographerWall/photographerWall.wxml
pages/photographerWall/photographerWall.wxss
pages/photoWall/photoWall.js
pages/photoWall/photoWall.json
pages/photoWall/photoWall.wxml
pages/photoWall/photoWall.wxss
pages/recharge/recharge.js
pages/recharge/recharge.json
pages/recharge/recharge.wxml
pages/recharge/recharge.wxss
pages/recharge2/recharge2.js
pages/recharge2/recharge2.json
pages/recharge2/recharge2.wxml
pages/recharge2/recharge2.wxss
pages/test/index/index.js
pages/test/index/index.json
pages/test/index/index.wxml
pages/test/index/index.wxss
pages/test/login/login.js
pages/test/login/login.json
pages/test/login/login.wxml
pages/test/login/login.wxss
pages/test/pay/pay.js
pages/test/pay/pay.json
pages/test/pay/pay.wxml
pages/test/pay/pay.wxss
pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.js
pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.json
pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.scss
pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.wxml
pages/winningRecord/components/notWonYetPopup/notWonYetPopup.js
pages/winningRecord/components/notWonYetPopup/notWonYetPopup.json
pages/winningRecord/components/notWonYetPopup/notWonYetPopup.scss
pages/winningRecord/components/notWonYetPopup/notWonYetPopup.wxml
pages/winningRecord/components/winnerListPopup/winnerListPopup.js
pages/winningRecord/components/winnerListPopup/winnerListPopup.json
pages/winningRecord/components/winnerListPopup/winnerListPopup.scss
pages/winningRecord/components/winnerListPopup/winnerListPopup.wxml
pages/winningRecord/winningRecord.js
pages/winningRecord/winningRecord.json
pages/winningRecord/winningRecord.scss
pages/winningRecord/winningRecord.wxml
pages/zfdm/zfdm.js
pages/zfdm/zfdm.json
pages/zfdm/zfdm.wxml
pages/zfdm/zfdm.wxss
pages/zyz/zyz.js
pages/zyz/zyz.json
pages/zyz/zyz.wxml
pages/zyz/zyz.wxss
utils/browseRecord.js
utils/date.js
utils/index.js
utils/qiniu/index.js
utils/request.js
utils/storage.js
utils/tween.js
```

# Files

## File: api/zyzSmall.js
````javascript
import { request } from '../utils/request'
import { reqWxPay } from "./pay";

/**
 *获取奖池金额
 */
export function reqGetPoolMoney() {
    return request('jianLai/luckyDbList6', 'GET', {
        splid: wx.getStorageSync('liveId'),
        cancelLoading: true,
    });
}
/**
 * 获取转一转相关信息
 */
export function reqGetZyzInfo() {
    return request('jianLai/getLuckyId6', 'GET', {
        splid: wx.getStorageSync('liveId')
    });
}
/**
 * 获取转一转排行榜列表
 */
export function reqGetZyzRank() {
    return request('jianLai/luckyDbRank6', 'GET', {
        splid: wx.getStorageSync('liveId'),
    });
}

/**
 * 转一转充值
 * dzp_kind:'2' 幸运小转盘独有参数
 */
export async function reqZyzRecharge({ userId, openId, dzp_kind }) {
    const tmpParam = { splid: wx.getStorageSync('liveId'), giftId: 'one', USER_ID: userId, openid: openId};
    if (dzp_kind) {
        tmpParam.dzp_kind = dzp_kind;
    }
    const res = await request('hmWxmoney/chongzhiNyn', 'POST', tmpParam, {
        needAppId: true,
    });
    return reqWxPay(res);
}
/**
 * 开始转一转
 * turnId 轮次id 表示第几轮 dzp_kind:'2' 幸运小转盘独有参数
 */
export function reqStartZyz({ turnId, dzp_kind }) {
    const tmpParam = { splid: wx.getStorageSync('liveId'), id: turnId };
    if (dzp_kind) {
        tmpParam.dzp_kind = dzp_kind;
    }

    return request('jianLai/luckyDb6', 'POST', tmpParam);
}
/**
 * 转一转发送中奖信息
 */
export function reqSendPrizeInfo({gold,remainCoin, turnId}) {
    return request('jianLai/luoXuanWan6', 'POST', {
        type: '2',
        gold,
        balance: remainCoin,
        splid: wx.getStorageSync('liveId'),
        id: turnId,
    });
}
/**
 * 发送广播
 */
export function reqSendBroadCast({c}) {
    return request('sendMsgController/duxin6', 'POST', {
        splid: wx.getStorageSync('liveId'),
        ykq_info: c
    });
}
````

## File: packageA/api/hbkdRecharge.js
````javascript
import { request } from "../../utils/request";
import { reqWxPay } from "../../api/pay";

/** 红包口袋充值排行榜列表
 * @param {string} splid 活动id
 */
export const reqGetHbkdRankList = (splid) => {
  return request("hbkd/shenLuoTianZheng6", "POST", {
    splid,
  });
};

/** 充值红包口袋
 * @param {string} splid 活动id
 */
export const reqRechargeHbkd = async ({ splid, total, userId, openId }) => {
  const res = await request(
    "hmWxmoney/chongZhiRedB",
    "POST",
    {
      splid,
      totalfee: total,
      USER_ID: userId,
      openid: openId,
    },
    {
      needAppId: true,
      cancelLoading: true,
    }
  );
  return reqWxPay(res);
};
````

## File: packageA/api/recharge.js
````javascript
import { request } from '../../utils/request'
import { reqWxPay } from '../../api/pay'

/**
 * 获取发礼物排行榜
 */
export function reqGetGiftRankList(splid) {
    return request('hmGiftController/findGiftRankList6', 'GET', {
        splid,
    });
}

/**
 * 充值喵钻
 */
export async function reqDiamondRecharge({total, userId,openId}) {
    const res =  await request('hmWxmoney/chongzhiMiao', 'POST', {
        total,
        userId,
        openid: openId,
    },{
        needAppId: true,
        cancelLoading: true,
    });
    return reqWxPay(res);
}

/**
 * 修改个人信息
 */
export function reqEditUserInfo({wx_name = '', avator = '', table_number = '', position = '', type = '', splid = ''}) {
    return request('hmGiftController/editUserInfo', 'POST', {
        wx_name,
        avator,
        table_number,
        position,
        type,
        splid,
    });
}

/**
 * 获取男女方发送礼物排行榜
 */
export function reqGetRoleGiftRankList(splid) {
    return request('hmGiftController/findGiftRankList7', 'GET', {
        splid,
    });
}


/**
 * 获取个人信息
 */
export function reqGetUserInfo() {
  return request('wxScan/getUserBaseInfo', 'GET', {});
}
````

## File: packageA/pages/hbkdRecharge/hbkdRecharge.js
````javascript
import {
  reqGetHbkdRankList,
  reqRechargeHbkd
} from "../../api/hbkdRecharge";
import {
  reqSendGiftBroadCast
} from "../../../api/gift";
import {
  timeoutTask
} from "../../../utils/index";

const app = getApp();

// const MODENAMES = ['templateMode', 'commonMode', 'zshlMode'];
Page({
  data: {
    templateMode: false, // 是模板模式吗?
    modeName: '', // 模式名称 取值 templateMode、commonMode、zshlMode
    inputVisible: false, // 显示输入框吗?
    isFocus: false, // 输入框是否聚焦?
    remainMoneyVisible: true, // 显示剩余金额吗?
    remainMoney: 0, // 剩余金额
    /**
     * 红包口袋充值列表
     * [{
     *   value, 取值为“数字字符串”或者custom
     *   name, 取值为字符串
     * }]
     */
    hbkdRechargeList: [],
    prizeSize: 0, // 赞赏次数
    hbkdRankList: [], // 红包口袋充值排行榜
    openId: "", // 用户openId
    userId: "", // 用户userId
  },
  onLoad(options) {
    this.initData(options);
  },
  async initData({
    hbkdRechargeListNewStr,
    hbkdRemainVisible,
    openId,
    userId,
    templateMode,
  }) {
    let tmpHbkdRechargeList = [];
    let tmpHbkdRankList = [];
    let tmpRemainMoney = 0;
    let tmpTemplateMode = false;
    try {
      // 模板模式判断
      tmpTemplateMode = templateMode === 'true';
       // 格式化充值列表
      tmpHbkdRechargeList = tmpTemplateMode ? JSON.parse(hbkdRechargeListNewStr) : this.getFormatRechargeList(hbkdRechargeListNewStr);
       // 获取排行榜和余额
      const listRes = await reqGetHbkdRankList(wx.getStorageSync("liveId"));
      tmpHbkdRankList = listRes.data.list;
      tmpRemainMoney = listRes.data.money;
    } catch (err) {
      console.log(err);
      tmpHbkdRechargeList = [];
      tmpHbkdRankList = [];
      tmpRemainMoney = 0;
    }

    this.setData({
      hbkdRechargeList: tmpHbkdRechargeList,
      remainMoneyVisible: hbkdRemainVisible === "true",
      openId,
      userId,
      remainMoney: tmpRemainMoney,
      hbkdRankList: tmpHbkdRankList,
      prizeSize: tmpHbkdRankList.length,
      templateMode: tmpTemplateMode,
      modeName: this.getModeName(tmpTemplateMode),
    });
  },
  /**
   * 格式化充值列表
   * @param {string} rechargeListStr 例如：'8888,1888,999,2888,888,1688,588,5888'
   * @returns {name:'土壕随意',value: 'custom'}[]
   */
  getFormatRechargeList(rechargeListStr) {
    const targetRechargeList = rechargeListStr.split(',').map((item) => ({
      name: '',
      value: item
    }));
    targetRechargeList.splice(5, 0, {
      name: '土壕随意',
      value: 'custom'
    });
    return targetRechargeList;
  },
  /**
   * 跳转充值服务协议
   */
  toAgreement() {
    wx.navigateTo({
      url: "/pages/agreement/agreement",
    });
  },
  /**
   * 选择金额充值
   */
  onChooseRecharge(e) {
    if (this.data.inputVisible) {
      return;
    }
    // 自定义金额
    if (e.currentTarget.dataset.custom) {
      this.openMoneyInputMode();
    } else {
      // 固定金额
      const money = e.currentTarget.dataset.money;
      this.rechargeMoney(money);
    }
  },
  /**
   * 根据金额唤起支付
   */
  async rechargeMoney(money) {
    const splid = wx.getStorageSync("liveId");
    try {
      wx.showLoading({
        title: '请求中...',
        mask: true
      });
      // 1、充值
      await reqRechargeHbkd({
        total: money,
        splid,
        userId: this.data.userId,
        openId: this.data.openId,
      });
      wx.hideLoading();
      // 2、手动加上余额
      this.addRemainMoney(money);
      // 3、发送红包口袋礼物广播
      reqSendGiftBroadCast({
        giftId: "hbkd",
        content: money,
      });
      // 4、返回上一页
      this.goBack();
      // 5、关闭手动输入金额模式
      if (this.data.inputVisible) {
        this.closeMoneyInputMode();
      }
    } catch (err) {
      console.log(err);
      wx.showToast({
        title: "充值失败!",
        icon: "error",
      });
      wx.hideLoading();
    }
  },
  /**
   * 手动加上余额
   */
  addRemainMoney(money) {
    const tmpVal = Number(this.data.remainMoney) + Number(money);
    this.setData({
      remainMoney: tmpVal.toFixed(2),
    });
  },
  /**
   * 返回上一页
   */
  goBack() {
    timeoutTask(() => {
      wx.navigateBack();
    }, 500);
  },
  /**
   * 手动输入金额
   */
  onInputMoney(e) {
    this.setData({
      moneyInput: e.detail.value,
    });
  },
  /**
   * 验证输入的金额
   */
  validateMoneyInput() {
    if (!this.data.moneyInput) {
      wx.showToast({
        title: "请输入或者选择充值金额!",
        icon: "none",
      });
      this.closeMoneyInputMode();
      return false;
    }
    if (this.data.moneyInput === "0") {
      wx.showToast({
        title: "充值金额不能为0!",
        icon: "none",
      });
      this.closeMoneyInputMode();
      return false;
    }
    if (!/^\d+(\.\d{1,2})?$/.test(this.data.moneyInput)) {
      wx.showToast({
        title: "请输入正确的金额!",
        icon: "none",
      });
      this.closeMoneyInputMode();
      return false;
    }
    return true;
  },
  /**
   * 输入框失焦完成支付
   */
  onBlurMoney() {
    if (!this.validateMoneyInput()) {
      return;
    }
    this.rechargeMoney(this.data.moneyInput);
  },
  /**
   * 开启手动输入金额模式
   */
  openMoneyInputMode() {
    this.setData({
      inputVisible: true,
      isFocus: true,
    });
  },
  /**
   * 关闭手动输入金额模式
   */
  closeMoneyInputMode() {
    timeoutTask(() => {
      this.setData({
        inputVisible: false,
        isFocus: false,
        moneyInput: "",
      });
    }, 300);
  },
  /**
   * 计算出modeName
   * @param {boolean} templateMode 是否是模板模式
   */
  getModeName(templateMode) {
    if (app.globalData.splidInfo_sceneType === '91') {
      return 'zshlMode'
    }
    return templateMode ? 'templateMode' : 'commonMode';
  }
});
````

## File: packageA/pages/hbkdRecharge/hbkdRecharge.json
````json
{
  "navigationBarTitleText": "红包口袋"
}
````

## File: packageA/pages/hbkdRecharge/hbkdRecharge.wxml
````
<view class="hbkdRechargeContainer {{modeName}}">
  <!-- 红包口袋余额区域 -->
  <view class="remainArea" wx:if="{{remainMoneyVisible}}">
    <view class="moneyInfo">
      <view class="moneyValue">
        {{remainMoney}}
        <text class="unit">元</text>
      </view>
      <view class="moneyTip">口袋内金额将用于红包雨等全场互动</view>
    </view>
  </view>
  <!-- 红包口袋充值区域 -->
  <view class="rechargeArea {{!remainMoneyVisible ? 'mTop' : ''}}">
    <view class="rechargeBox">
      <view class="rechargeItem" wx:for="{{hbkdRechargeList}}" wx:key="index" data-money="{{item.value}}" data-custom="{{item.value === 'custom'}}" bindtap="onChooseRecharge">
        <!-- 固定选择模块 -->
        <view class="staticMod" wx:if="{{item.value !== 'custom'}}" >
          <view class="value">
            {{item.value}}
            <text class="unit">元</text>
          </view>
          <view class="name">{{item.name}}</view>
        </view>
        <!-- 自定义金额模块 -->
        <view class="customMod {{inputVisible ? 'inputMod' : ''}}" wx:else>
          <view class="customTxt1" wx:if="{{!inputVisible}}">{{item.name}}</view>
          <view class="customTxt2" wx:if="{{!inputVisible}}">自定义金额</view>
          <input type="number" maxlength="5" value="{{moneyInput}}" wx:if="{{inputVisible}}" focus="{{isFocus}}" bindinput="onInputMoney" bindblur="onBlurMoney"/>
          <text class="unit" wx:if="{{inputVisible}}">元</text>
          <image src="https://ustatic.joymew.com/joymewScreen/zshl/mobile/crown.png" class="crown" wx:if="{{modeName === 'zshlMode'}}"/>
        </view>
      </view>
    </view>
  </view>
  <!-- 充值排行榜区域 -->
  <view class="rankArea">
    <view class="agreement" bindtap="toAgreement">阅读并同意《充值服务协议》</view>
    <view class="countPrize">
      <view class="countValue">累计{{prizeSize}}次赞赏</view>
    </view>
    <view class="rankBox" wx:if="{{!templateMode || modeName === 'zshlMode'}}">
      <view class="rankItem" wx:for="{{hbkdRankList}}" wx:key="index">
        <image src="https://static.hudongmiao.com/joymewMp/recharge/firstMedal.png" class="topThreeIcon" wx:if="{{index === 0}}" />
        <image src="https://static.hudongmiao.com/joymewMp/recharge/secondMedal.png" class="topThreeIcon" wx:if="{{index === 1}}" />
        <image src="https://static.hudongmiao.com/joymewMp/recharge/thirdMedal.png" class="topThreeIcon" wx:if="{{index === 2}}" />
        <view class="num" wx:if="{{index > 2}}">{{index + 1}}</view>
        <image src="{{item.avator}}" class="headImg"></image>
        <view class="name">{{item.wx_name}}</view>
        <view class="wish">累计打赏{{item.allGold}}元</view>
      </view>
    </view>
    <view class="rankBox" wx:else>
      <view class="rankInner">
        <view class="rankItem" wx:for="{{hbkdRankList}}" wx:key="index">
          <image src="https://static.hudongmiao.com/joymewMp/rechargeNew/first.png" class="topThreeIcon" wx:if="{{index === 0}}" />
          <image src="https://static.hudongmiao.com/joymewMp/rechargeNew/second.png" class="topThreeIcon" wx:if="{{index === 1}}" />
          <image src="https://static.hudongmiao.com/joymewMp/rechargeNew/third.png" class="topThreeIcon" wx:if="{{index === 2}}" />
          <view class="num" wx:if="{{index > 2}}">{{index + 1}}</view>
          <image src="{{item.avator}}" class="headImg"></image>
          <view class="name">{{item.wx_name}}</view>
          <view class="wish">累计打赏{{item.allGold}}元</view>
        </view>
      </view>
    </view>
  </view>
</view>
````

## File: packageA/pages/hbkdRecharge/hbkdRecharge.wxss
````
@import "./styles/templateMode.wxss";
@import "./styles/commonMode.wxss";
@import "./styles/zshlMode.wxss";

.hbkdRechargeContainer {
    height: 100vh;
    overflow-y: scroll;
}
````

## File: packageA/pages/hbkdRecharge/styles/commonMode.wxss
````
.hbkdRechargeContainer.commonMode {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/bg2-01.png");
  background-size: 100% 100vh;
  background-repeat: no-repeat;
}

/* 红包口袋余额 */
.hbkdRechargeContainer.commonMode .remainArea {
  width: 100%;
  height: 435rpx;
  background-image: url(https://static.hudongmiao.com/joymewMp/hbkdRecharge/rainbow-01.png);
  background-size: 100% 100%;
  margin-top: 80rpx;
  color: #ffffff;
  font-weight: 400;
  text-align: center;
  line-height: 1.5;
  padding-top: 80rpx;
  position: relative;
}

.hbkdRechargeContainer.commonMode .remainArea .moneyInfo .moneyValue::before {
  content: "红包口袋";
  display: block;
  font-size: 34rpx;
}

.hbkdRechargeContainer.commonMode .remainArea .moneyInfo .moneyValue {
  font-size: 66rpx;
  font-weight: 700;
}

.hbkdRechargeContainer.commonMode .remainArea .moneyInfo .moneyTip {
  font-size: 20rpx;
}

/* 红包口袋充值区域 */
.hbkdRechargeContainer.commonMode .rechargeArea {
  width: 660rpx;
  height: 746rpx;
  background: #ffffff;
  border-radius: 72rpx;
  margin: 0 auto;
  margin-top: -230rpx;
  padding-top: 220rpx;
}
.hbkdRechargeContainer.commonMode .rechargeArea.mTop {
  margin-top: 40rpx;
  padding-top: 40rpx;
  height: 500rpx;
}
.hbkdRechargeContainer.commonMode .rechargeArea .rechargeBox {
  display: grid;
  grid-template-columns: repeat(3, min-content);
  grid-template-rows: repeat(3, min-content);
  justify-content: center;
  column-gap: 20rpx;
  row-gap: 20rpx;
  color: #fff;
  font-size: 32rpx;
}

.hbkdRechargeContainer.commonMode .rechargeArea .rechargeBox .rechargeItem {
  width: 191rpx;
  height: 124rpx;
  background-size: 100% 100%;
  line-height: 1.5;
}

.rechargeItem:nth-child(1),
.rechargeItem:nth-child(7) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon6.png");
}

.rechargeItem:nth-child(2),
.rechargeItem:nth-child(8) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon5.png");
}

.rechargeItem:nth-child(3),
.rechargeItem:nth-child(9) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon1.png");
}

.rechargeItem:nth-child(4) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon2.png");
}

.rechargeItem:nth-child(5) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon3.png");
}

.rechargeItem:nth-child(6) {
  background-image: url("https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon4.png");
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .staticMod {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .staticMod
  .value {
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .staticMod
  .value
  .unit {
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .staticMod
  .name {
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod {
  height: 100%;
  flex-direction: column;
  display: flex;
  justify-content: center;
  align-items: center;
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod.inputMod {
    text-align: center;
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod
  .customTxt1 {
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod
  .customTxt2 {
  font-size: 21rpx;
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod
  input {
}

.hbkdRechargeContainer.commonMode
  .rechargeArea
  .rechargeBox
  .rechargeItem
  .customMod
  .unit {
}

/* 充值排行榜区域 */
.hbkdRechargeContainer.commonMode .rankArea {
  margin-top: 40rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .agreement {
  font-size: 24rpx;
  font-weight: 400;
  color: #ffd027;
  text-align: center;
}

.hbkdRechargeContainer.commonMode .rankArea .countPrize {
  display: flex;
  justify-content: center;
  color: #ffffff;
  font-size: 36rpx;
  font-weight: 500;
  margin-top: 20rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .countPrize::before,
.hbkdRechargeContainer.commonMode .rankArea .countPrize::after {
  width: 30rpx;
  height: 26rpx;
  background-size: 100% 100%;
}

.hbkdRechargeContainer.commonMode .rankArea .countPrize::before {
  background-image: url("https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png");
}

.hbkdRechargeContainer.commonMode .rankArea .countPrize::after {
  background-image: url("https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png");
}

.hbkdRechargeContainer.commonMode .rankArea .countPrize .countValue {
  margin: 0 30rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox {
  width: 695rpx;
  margin: 0 auto;
  margin-top: 40rpx;
  background-color: #8a1dd3;
  overflow: hidden;
  border-radius: 20rpx;
  margin: 40rpx auto;
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem {
  display: flex;
  align-items: center;
  color: #fff;
  font-size: 28rpx;
  margin: 30rpx 20rpx;
}
.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem .topThreeIcon {
  width: 39rpx;
  height: 50rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem .num {
  width: 39rpx;
  height: 50rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem .headImg {
  width: 64rpx;
  height: 64rpx;
  border-radius: 50%;
  margin: 0 22rpx 0 17rpx;
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem .name {
}

.hbkdRechargeContainer.commonMode .rankArea .rankBox .rankItem .wish {
  color: #FFF32E;
  flex: 1;
  text-align: right;
}
````

## File: packageA/pages/hbkdRecharge/styles/templateMode.wxss
````
.hbkdRechargeContainer.templateMode {
    background-color: #FFDEB5;
}
/* 红包口袋余额区域 */
.hbkdRechargeContainer.templateMode .remainArea {
    width: 100%;
    height: 926rpx;
    background-image: url('https://ustatic.hudongmiao.com/joymewMp/rechargeNew/remainBg.png');
    background-size: 100% 100%;
    display: flex;
    justify-content: center;
    padding-top: 90rpx;
  }
  
  .hbkdRechargeContainer.templateMode .remainArea .moneyInfo {
    width: 442rpx;
    height: 200rpx;
    background-image: url('https://ustatic.hudongmiao.com/joymewMp/rechargeNew/dialog.png');
    background-size: 100% 100%;
  }
  
  .hbkdRechargeContainer.templateMode .remainArea .moneyInfo .moneyValue {
    background: -webkit-linear-gradient(180deg, #ff4425, #ff9180 0%, #ff4425 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 96rpx;
    text-align: center;
  }
  
  .hbkdRechargeContainer.templateMode .remainArea .moneyInfo .moneyValue .unit {
    background: -webkit-linear-gradient(180deg, #ff4425, #ff9180 0%, #ff4425 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 32rpx;
  }
  
  .hbkdRechargeContainer.templateMode .remainArea .moneyInfo .moneyTip {
    font-size: 24rpx;
    font-weight: 400;
    color: #ffffff;
    text-align: center;
    line-height: 75rpx;
  }
  /* 红包口袋充值区域 */
  .hbkdRechargeContainer.templateMode .rechargeArea {
    display: flex;
    justify-content: center;
    margin-top: -390rpx;
  }
  .hbkdRechargeContainer.templateMode .rechargeArea.mTop {
    margin-top: 40rpx;
  }
  .hbkdRechargeContainer.templateMode .rechargeArea.remainHidden {
    margin-top: 100rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox {
    width: 712rpx;
    height: 788rpx;
    background-image: url('https://ustatic.hudongmiao.com/joymewMp/rechargeNew/rechargeBg.png');
    background-size: 100% 100%;
    display: grid;
    grid-template-columns: repeat(3, min-content);
    grid-template-rows: repeat(3, min-content);
    justify-content: center;
    column-gap: 12rpx;
    row-gap: 24rpx;
    align-content: center;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem {
    width: 214rpx;
    height: 224rpx;
    border-radius: 24rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .staticMod {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .staticMod .value {
    font-size: 58rpx;
    font-weight: 700;
    color: #ffffff;
    white-space: nowrap;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .staticMod .value .unit {
    font-size: 20rpx;
    font-weight: 400;
    color: #ffffff;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .staticMod .name {
    font-size: 36rpx;
    font-weight: 600;
    color: #ffffff;
    margin-top: 15rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod .customTxt1 {
    font-size: 48rpx;
    font-weight: 400;
    color: #ffffff;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod .customTxt2 {
    font-size: 28rpx;
    font-weight: 400;
    color: #FDFFA7;
    margin-top: 30rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod input {
    width: 180rpx;
    height: 80rpx;
    color: #FFFFFF;
    font-size: 64rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod .unit {
    font-size: 20rpx;
    font-weight: 400;
    color: #ffffff;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem .customMod.inputMod {
    flex-direction: unset;
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(1),
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(7) {
    background: #d9d9d9 linear-gradient(224deg, #ffbf5f 0%, #fe5655 100%);
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(2),
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(8) {
    background: #d9d9d9 linear-gradient(224deg, #64bfe7 0%, #3211fd 100%);
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(3),
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(9) {
    background: #d9d9d9 linear-gradient(224deg, #feb7bb 0%, #fe154d 100%);
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(4) {
    background: #d9d9d9 linear-gradient(224deg, #9dbfff 0%, #d16efa 100%);
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(5) {
    background: #d9d9d9 linear-gradient(224deg, #fdcb89 0%, #fb966e 100%);
  }
  
  .hbkdRechargeContainer.templateMode .rechargeArea .rechargeBox .rechargeItem:nth-child(6) {
    background: #d9d9d9 linear-gradient(224deg, #f3a6f4 0%, #9e11fd 100%);
  }
  /* 充值排行榜区域 */
  .hbkdRechargeContainer.templateMode .rankArea {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 12rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rankArea .agreement {
    font-size: 24rpx;
    font-weight: 400;
    color: #fe3a14;
  }
  
  .hbkdRechargeContainer.templateMode .rankArea .countPrize {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 46rpx;
  }
  .hbkdRechargeContainer.templateMode .rankArea .countPrize::before,  .hbkdRechargeContainer.templateMode .rankArea .countPrize::after {
    content: '';
    display: block;
    width: 96rpx;
    height: 96rpx;
    background-size: 100% 100%;
  }
  .hbkdRechargeContainer.templateMode .rankArea .countPrize::before {
    background-image: url('https://ustatic.hudongmiao.com/joymewMp/rechargeNew/loveIonLeft.png');
  }
  .hbkdRechargeContainer.templateMode .rankArea .countPrize::after {
    background-image: url('https://ustatic.hudongmiao.com/joymewMp/rechargeNew/loveIonLeft.png');
    transform: rotateY(180deg);
  }

  .hbkdRechargeContainer.templateMode .rankArea .countPrize .countValue {
    font-size: 56rpx;
    font-weight: 500;
    color: #ffffff;
    text-shadow: 0px 8rpx 8rpx 0rpx rgba(250, 116, 45, 1);
    margin: 0 24rpx;
  }
  
  
  .hbkdRechargeContainer.templateMode .rankArea .rankBox {
    width: 708rpx;
    height: 760rpx;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(180deg, #ff9643, #ffc590 100%);
    border-radius: 24rpx;
    margin-top: 34rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner {
    width: 668rpx;
    height: 720rpx;
    background: #ffffff;
    border-radius: 24rpx;
    overflow-y: scroll;
    padding: 40rpx 20rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem {
    display: flex;
    align-items: center;
    margin-bottom: 32rpx;
  }
  
  .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem .topThreeIcon {
    width: 46rpx;
    height: 64rpx;
  }
  
   .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem .num {
    width: 46rpx;
    font-size: 48rpx;
    font-weight: 500;
    color: #333333;
    text-align: center;
  }
  
   .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem .headImg {
    width: 80rpx;
    height: 80rpx;
    border-radius: 94rpx;
    margin-left: 28rpx;
  }
  
   .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem .name {
    font-size: 32rpx;
    font-weight: 400;
    color: #000000;
    width: 220rpx;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    margin-left: 18rpx;
  }
  
   .hbkdRechargeContainer.templateMode .rankArea .rankBox .rankInner .rankItem .wish {
    font-size: 28rpx;
    font-weight: 400;
    color: #ff476f;
    width: 210rpx;
    text-align: right;
    white-space: nowrap;
  }
````

## File: packageA/pages/hbkdRecharge/styles/zshlMode.wxss
````
.hbkdRechargeContainer.zshlMode {
  background-color: #ffdeb5;
  background-image: url('https://ustatic.joymew.com/joymewScreen/zshl/mobile/hbkdBg.png');
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  padding-bottom: 40rpx;
}

/* 红包口袋余额区域 */
.hbkdRechargeContainer.zshlMode .remainArea {
  width: 100%;
  display: flex;
  justify-content: center;
  padding-top: 150rpx;
}

.hbkdRechargeContainer.zshlMode .remainArea .moneyInfo {
  width: 618rpx;
  height: 444rpx;
  background-image: url("https://ustatic.joymew.com/joymewScreen/zshl/mobile/hbkz.png");
  background-size: 100% 100%;
  padding-top: 20rpx;
}

.hbkdRechargeContainer.zshlMode .remainArea .moneyInfo .moneyValue {
  color: #9e2a24;
  font-size: 96rpx;
  text-align: center;
}

.hbkdRechargeContainer.zshlMode .remainArea .moneyInfo .moneyValue .unit {
  color: #9e2a24;
  font-size: 32rpx;
}

.hbkdRechargeContainer.zshlMode .remainArea .moneyInfo .moneyTip {
  font-size: 24rpx;
  font-weight: 400;
  color: #ffffff;
  text-align: center;
  line-height: 75rpx;
}

/* 红包口袋充值区域 */
.hbkdRechargeContainer.zshlMode .rechargeArea {
  display: flex;
  justify-content: center;
  margin-top: 35rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea.mTop {
  margin-top: 40rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea.remainHidden {
  margin-top: 100rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox {
  width: 712rpx;
  height: 690rpx;
  background-image: url("https://ustatic.joymew.com/joymewScreen/zshl/mobile/remarea.png");
  background-size: 100% 100%;
  display: grid;
  grid-template-columns: repeat(3, 169rpx);
  grid-template-rows: repeat(3, 114rpx);
  justify-content: center;
  column-gap: 35rpx;
  row-gap: 40rpx;
  align-content: center;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem {
  width: 169rpx;
  height: 114rpx;
  border-radius: 24rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .staticMod {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .staticMod .value {
  font-size: 38rpx;
  font-weight: 700;
  color: #ffffff;
  white-space: nowrap;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .staticMod .value .unit {
  font-size: 38rpx;
  font-weight: 400;
  color: #ffffff;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .staticMod .name {
  font-size: 36rpx;
  font-weight: 600;
  color: #ffffff;
  margin-top: 15rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod .crown {
  width: 50rpx;
  height: 50rpx;
  position: absolute;
  right: -21rpx;
  top: -21rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod .customTxt1 {
  font-size: 32rpx;
  font-weight: 400;
  color: #ffffff;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod .customTxt2 {
  font-size: 18rpx;
  font-weight: 400;
  color: #fdffa7;
  margin-top: 10rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod input {
  width: 180rpx;
  height: 80rpx;
  color: #ffffff;
  font-size: 32rpx;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod .unit {
  font-size: 20rpx;
  font-weight: 400;
  color: #ffffff;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem .customMod.inputMod {
  flex-direction: unset;
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(1),
.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(7) {
  background: #d9d9d9 linear-gradient(224deg, #ffbf5f 0%, #fe5655 100%);
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(2),
.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(8) {
  background: #d9d9d9 linear-gradient(224deg, #64bfe7 0%, #3211fd 100%);
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(3),
.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(9) {
  background: #d9d9d9 linear-gradient(224deg, #feb7bb 0%, #fe154d 100%);
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(4) {
  background: #d9d9d9 linear-gradient(224deg, #9dbfff 0%, #d16efa 100%);
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(5) {
  background: #d9d9d9 linear-gradient(224deg, #fdcb89 0%, #fb966e 100%);
}

.hbkdRechargeContainer.zshlMode .rechargeArea .rechargeBox .rechargeItem:nth-child(6) {
  background: #d9d9d9 linear-gradient(224deg, #f3a6f4 0%, #9e11fd 100%);
}

/* 充值排行榜区域 */
.hbkdRechargeContainer.zshlMode .rankArea {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 12rpx;
  position: relative;
}

.hbkdRechargeContainer.zshlMode .rankArea .agreement {
  font-size: 24rpx;
  font-weight: 400;
  color: #ffeb7f;
}

.hbkdRechargeContainer.zshlMode .rankArea .countPrize {
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: 80rpx;             
}

.hbkdRechargeContainer.zshlMode .rankArea .countPrize::before,
.hbkdRechargeContainer.zshlMode .rankArea .countPrize::after {
  content: "";
  display: block;
  width: 32rpx;
  height: 32rpx;
  background-size: 100% 100%;
}

.hbkdRechargeContainer.zshlMode .rankArea .countPrize::before {
  background-image: url("https://ustatic.joymew.com/joymewScreen/zshl/mobile/loveIcon.png");
}

.hbkdRechargeContainer.zshlMode .rankArea .countPrize::after {
  background-image: url("https://ustatic.joymew.com/joymewScreen/zshl/mobile/loveIcon.png");
}

.hbkdRechargeContainer.zshlMode .rankArea .countPrize .countValue {
  font-size: 32rpx;
  font-weight: 500;
  color: #cd7034;
  text-shadow: 0px 8rpx 8rpx 0rpx rgba(250, 116, 45, 1);
  margin: 0 20rpx;
  font-weight: 500;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox {
  width: 745rpx;
  min-height: 1000rpx;
  margin: 0 auto;
  background-image: url('https://ustatic.joymew.com/joymewScreen/zshl/mobile/rankBg.png');
  background-size: 100% 100%;
  margin-top: 34rpx;
  padding: 97rpx 20rpx 0 20rpx;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem {
  display: flex;
  align-items: center;
  margin-bottom: 20rpx;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem .topThreeIcon {
  width: 46rpx;
  height: 64rpx;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem .num {
  width: 46rpx;
  font-size: 48rpx;
  font-weight: 500;
  color: #cd7034;
  text-align: center;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem .headImg {
  width: 70rpx;
  height: 70rpx;
  border-radius: 94rpx;
  margin-left: 28rpx;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem .name {
  font-size: 32rpx;
  font-weight: 400;
  color: #bc7b76;
  width: 280rpx;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  margin-left: 18rpx;
}

.hbkdRechargeContainer.zshlMode .rankArea .rankBox  .rankItem .wish {
  font-size: 28rpx;
  font-weight: 400;
  color: #fb6c58;
  width: 210rpx;
  text-align: right;
  white-space: nowrap;
}

@media screen and (max-height: 550px) {
  .hbkdRechargeContainer.zshlMode .remainArea .moneyInfo {
    padding-top: 23rpx;
  }
}
````

## File: pages/joymewIndexDz/components/avatarGet/avatarGet.js
````javascript
import qiniu from "../../../../utils/qiniu/index";

Component({
  /**
   * 属性
   */
  properties: {
    avatarUrl: {
      type: String,
      value: "",
    },
  },
  /**
   * 组件的初始数据
   */
  data: {
    avatarUncropped: "",
  },
  attached() {
    this.initQiniu();
  },

  /**
   * 组件的方法列表
   */
  methods: {
    onChooseAvatar(e) {
      console.log(e);
      // e.detail.avatarUrl 本地临时图片路径
      this.setData({
        avatarUncropped: e.detail.avatarUrl,
      });
    },
    handleCancelCropper() {
      // 处理取消裁剪的逻辑
      this.setData({
        avatarUncropped: "",
      });
    },
    async handleConfirmCropper(e) {
      // 处理确认裁剪的逻辑
      // e.detail 裁剪后的图片地址
      try {
        wx.showLoading({
          title: "上传中",
          mask: true,
        });
        const res = await qiniu.qiniuUpload(e.detail);
        this.triggerEvent("updateavatar", {
          avatarUrl: res.imageURL,
        });
        // 关闭裁剪框和loading
        this.setData({
          avatarUncropped: "",
        });
        wx.hideLoading();
      } catch (err) {
        console.log(err);
        // 关闭裁剪框和loading
        this.setData({
          avatarUncropped: "",
        });
        wx.hideLoading();
        wx.showToast({
          title: "上传失败",
          icon: "error",
        });
      }
    },
    async initQiniu() {
      const res = await qiniu.getQiniuToken();
      qiniu.initQiniu(res.data.token);
    },
  },
});
````

## File: pages/joymewIndexDz/components/avatarGet/avatarGet.json
````json
{
  "component": true,
  "usingComponents": {
    "cropper": "/components/authDialog/cropper/cropper"
  }
}
````

## File: pages/joymewIndexDz/components/avatarGet/avatarGet.wxml
````
<view class="avatar-get">
  <button class="avatarButton" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
    <image class="avatar" src="{{avatarUrl}}"></image>
  </button>
</view>
<!-- 头像裁剪组件 -->
<cropper avatarUncropped="{{avatarUncropped}}" bind:cancelEvent="handleCancelCropper" bind:confirmEvent="handleConfirmCropper"></cropper>
````

## File: pages/joymewIndexDz/components/avatarGet/avatarGet.wxss
````
.avatarButton {
     width: 100rpx;
     height: 100rpx;
     padding-left: 0;
     padding-right: 0;
 }

 .avatarButton .avatar {
     width: 100%;
     height: 100%;
 }
````

## File: pages/joymewIndexDz/components/phoneGet/phoneGet.js
````javascript
import { showWxToast, timeoutTask } from "../../../../utils/index";
import { authGetPhoneByCode } from "../../../../api/login";

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    userPhone: {
      type: String,
      value: "",
    },
    phoneCompStatus: {
      type: Number,
      value: 0,
    },
  },
  observers: {
    phoneCompStatus(newVal) {
      if (newVal === 1) {
        // 微信组件获取手机号
        this.setData({
          needInputPhone: false,
        });
      } else if (newVal === 2) {
        // 手动输入手机号
        this.setData({
          needInputPhone: true,
        });
      }
    },
  },
  data: {
    needInputPhone: false,
    phoneInputFocus: false,
  },
  /**
   * 组件的方法列表
   */
  methods: {
    /**
     * 微信组件获取手机号
     */
    async getPhoneNumber(e) {
      if (e.detail.errno === 1400001 || !e.detail.code) {
        this.toInputPhone();
        return;
      }
      try {
        const res = await authGetPhoneByCode({
          code: e.detail.code,
        });
        if (res && res.phone_info && res.phone_info.phoneNumber) {
          this.setData({
            phone: res.phone_info.phoneNumber,
          });
          this.triggerEvent("updatephone", {
            userPhone: res.phone_info.phoneNumber,
          });
        } else {
            throw 'toInputPhone'
        }

      }catch(err) {
        console.log(err);
        this.toInputPhone();
      }
    },
    phoneBlur(e) {
      // 处理手机号输入框失去焦点的逻辑
      this.triggerEvent("updatephone", {
        userPhone: e.detail.value,
      });
    },
    /**
     * 降级为手动输入手机号
     */
    toInputPhone() {
      showWxToast("请输入手机号!");
      // 手机输入框显示
      this.setData({
        needInputPhone: true,
      });
      // 延迟0.3s输入框聚焦
      timeoutTask(() => {
        this.setData({
          phoneInputFocus: true,
        });
      }, 300);
    },
  },
});
````

## File: pages/joymewIndexDz/components/phoneGet/phoneGet.json
````json
{
    "component": true
}
````

## File: pages/joymewIndexDz/components/phoneGet/phoneGet.wxml
````
<view class="phone-get">
    <!-- 微信组件获取手机号 -->
    <view class="getPhoneIpt" wx:if="{{!needInputPhone}}">
        {{phone ? phone: '获取手机号'}}
        <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="getPhoneBtn" wx:if="{{!phone}}"></button>
    </view>
    <!-- 手动输入手机号 -->
    <input bindblur="phoneBlur" name="phone" placeholder='请输入手机号' maxlength="11" value="{{phone}}" class="iptPad ipt" wx:else focus="{{phoneInputFocus}}" type="number"></input>
    <!-- 公共的icon -->
    <view class="phoneIconBox"></view>
</view>
````

## File: pages/joymewIndexDz/components/phoneGet/phoneGet.wxss
````
.phone-get {
  position: relative;
}

.getPhoneIpt {
  position: relative;
  z-index: 1;
  width: 412rpx;
  height: 56rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  border-bottom: 2rpx solid #666666;
  padding-right: 68rpx;
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.getPhoneBtn {
  width: 100%;
  height: 100%;
  opacity: 0;
  background-color: transparent;
  position: absolute;
  right: 0;
  top: 0;
}

.phoneIconBox {
  width: 24rpx;
  height: 32rpx;
  position: absolute;
  right: 0rpx;
  bottom: 17rpx;
  background-size: 100% 100%;
  background-image: url('https://static.joymew.com/joymewMpTql/signTXH/phoneIcon.png');
}

.iptPad {
  padding-right: 70rpx;
}
````

## File: pages/joymewIndexDz/joymewIndexDz.js
````javascript
import { wxLogin, authUserNew } from "../../api/login";
import { getSignInState, signIn, getLiveInfo } from "../../api/index/index";
import { showWxToast } from "../../utils/index";
import { getCurrentTimestamp, dateCompare } from "../../utils/date";
import { PAGE_HOST } from "../../assets/constant/host";
import {
  getToken,
  setLiveId,
  getLiveId,
  setToken,
  getUserInfo,
  getUserPhone,
} from "../../utils/storage";

const app = getApp();

// 授权登录retry相关变量
let reLoginCount = 0;
const maxReLoginCount = 3;

// 是否活动过期
let isOverdate = false;
// 是否已经签到
let isSign = false;
Page({
  data: {
    customSignBg: "",
    liveId: "",
    phoneCompStatus: 0, // 手机号获取组件的状态 0:不获取手机号 1:微信组件获取 2: 手动输入
    signForm: {
      avatarUrl: "", // 头像url
      nickName: "", // 姓名
      bless_str: "参与游戏互动", // 口令(原祝福语字段)
      type: "", // 单位(原亲友类型)
      userPhone: "", // 手机号
    },
  },
  /**
   * 初始化要做的事：
   * 1. 设置liveId
   * 2. 获取签到状态、获取活动信息
   * 3. 根据获取到的信息作出相应的行为
   */
  async onLoad(options) {
    // 设置liveId
    if (!this.setLiveId(options.liveId)) {
      return;
    }
    await Promise.all([this.getLiveInfo(), this.getSignInState()]);

    // 根据获取到的信息作出相应的行为
    if (isSign && !isOverdate) {
      this.toLive();
    } else if (isOverdate) {
      showWxToast("活动已结束!");
    }
  },
  onShareAppMessage() { },
  /**
   * @description 设置liveId
   * @param {string} liveId
   * @returns {boolean} 是否设置成功
   */
  setLiveId(liveId) {
    if (liveId) {
      this.setData({
        liveId: liveId,
      });
    } else {
      const storageLiveId = getLiveId();
      if (storageLiveId) {
        this.setData({
          liveId: storageLiveId,
        });
      } else {
        wx.showToast({
          title: "缺少活动id",
          icon: "error",
        });
        return false;
      }
    }
    // 能走到这里说明liveId存在，存入缓存
    setLiveId(this.data.liveId);
    return true;
  },
  /**
   * 获取签到状态
   */
  async getSignInState() {
    try {
      const res = await getSignInState();
      if (res.data.isNeddReload === "1") {
        throw "401";
      }
      // 走到这里说明签到状态获取成功
      isSign = res.data.qian_dao_le_me;
      // 尝试从缓存里获取信息来填充表单
      this.initForm();
    } catch (err) {
      console.log(err);
      // 走到这里说明签到状态获取失败，尝试重新登录
      if (reLoginCount < maxReLoginCount) {
        reLoginCount++;
        console.log("重新登录中...", reLoginCount);
        return this.authLogin(this.getSignInState.bind(this));
      } else {
        wx.showToast({
          title: "签到失败!",
          icon: "error",
        });
      }
    }
  },
  /**
   * 获取活动信息
   */
  async getLiveInfo() {
    const setPhoneCompStatus = (forcephone, isOpenWxPhone) => {
      if (forcephone === "1" && isOpenWxPhone === "1") {
        this.setData({
          phoneCompStatus: 1,
        });
      } else if (forcephone === "1" && isOpenWxPhone === "0") {
        this.setData({
          phoneCompStatus: 2,
        });
      } else {
        this.setData({
          phoneCompStatus: 0,
        });
      }
    };
    const liveInfo = await getLiveInfo();
    if (liveInfo.data.splid.qd_back) {
      this.setData({
        customSignBg: liveInfo.data.splid.qd_back,
      });
    }
    if (
      dateCompare(liveInfo.data.splid.using_date) ||
      liveInfo.data.splid.is_end_wedding === "1"
    ) {
      isOverdate = true;
    }
    setPhoneCompStatus(
      liveInfo.data.splid.forcephone,
      liveInfo.data.siyiInfo.isOpenWxPhone
    );
  },
  async authLogin(failCb) {
    try {
      const { code } = await wxLogin();
      const res = await authUserNew(code);
      // 设置token
      setToken(res.data.token);

      // 有用户信息的情况下用户信息存入缓存
      const { avator, wx_name } = res.data.user;
      if (avator && wx_name) {
        app.setUserInfo({
          nickName: wx_name,
          avatarUrl: avator,
        });
      }
      // 有回调的话执行回调
      if (failCb) {
        return failCb.apply(this);
      }
    } catch (err) {
      console.log(err);
      // 有回调的话执行回调
      if (failCb) {
        return failCb.apply(this);
      }
    }
  },
  /**
   * 尝试从缓存里获取用户信息和手机号
   */
  initForm() {
    const stUserInfo = getUserInfo();
    if (stUserInfo.nickName && stUserInfo.avatarUrl) {
      this.setData({
        "signForm.avatarUrl": stUserInfo.avatarUrl,
        "signForm.nickName": stUserInfo.nickName,
      });
    }
    const userPhone = getUserPhone();
    if (userPhone) {
      this.setData({
        "signForm.userPhone": userPhone,
      });
    }
  },
  onGetAvatar(e) {
    const { avatarUrl } = e.detail;
    this.setData({
      "signForm.avatarUrl": avatarUrl,
    });
    console.log(avatarUrl);
  },
  /**
   * 输入姓名
   */
  onNickNameBlur(e) {
    this.setData({
      "signForm.nickName": e.detail.value,
    });
  },
  /**
   * 输入口令
   */
  onBlessStrBlur(e) {
    this.setData({
      "signForm.bless_str": e.detail.value,
    });
  },
  /**
   * 输入单位
   */
  onTypeBlur(e) {
    this.setData({
      "signForm.type": e.detail.value,
    });
  },
  /**
   * 通过子组件传递的手机号更新表单的手机号
   */
  updatePhone(e) {
    this.setData({
      "signForm.userPhone": e.detail.userPhone,
    });
  },
  toLive() {
    const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
    app.setH5Url(staicUrl);
    wx.redirectTo({
      url: "/pages/live/live",
    });
  },
  /**
   * 表单校验
   * @returns {boolean} 是否通过校验
   */
  validateForm() {
    const { nickName, avatarUrl, userPhone, bless_str, type } =
      this.data.signForm;
    // 校验头像
    if (!avatarUrl) {
      wx.showToast({
        title: "请选择头像",
        icon: "error",
      });
      return false;
    }
    if (
      !/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(
        avatarUrl
      )
    ) {
      wx.showToast({
        title: "头像非法!",
        icon: "error",
      });
      return false;
    }
    // 校验姓名
    if (!nickName) {
      wx.showToast({
        title: "请填写姓名",
        icon: "error",
      });
      return false;
    }
    // 校验口令
    if (!bless_str) {
      wx.showToast({
        title: "请填写口令",
        icon: "error",
      });
      return false;
    }
    // 校验单位
    if (!type) {
      wx.showToast({
        title: "请选择单位",
        icon: "error",
      });
      return false;
    }
    // 校验手机号
    if (this.data.phoneCompStatus !== 0) {
      if (!userPhone) {
        wx.showToast({
          title: "请填写手机号",
          icon: "error",
        });
        return false;
      } else if (!/^1[3-9]\d{9}$/.test(userPhone)) {
        wx.showToast({
          title: "手机号格式不正确",
          icon: "error",
        });
        return false;
      }
    }

    return true;
  },
  async onSign() {
    if (!this.validateForm()) {
      return;
    }
    console.log(this.data.signForm.avatarUrl)
    try {
      const res = await signIn({
        avator: this.data.signForm.avatarUrl,
        wish: this.data.signForm.bless_str,
        name: this.data.signForm.nickName,
        role: this.data.signForm.type,
        userPhone: this.data.phoneCompStatus !== 0 ? this.data.signForm.userPhone : "",
        birthDate: "",
        gender: "",
      });

      if (res?.data?.checkPhoneStatus === "no_pass") {
        showWxToast("抱歉，您无法签到!");
        return;
      }
      console.log(res);
      if (res && res.success) {
        this.toLive();
      }
    } catch (err) {
      console.log(err);
      wx.showToast({
        title: "签到失败!",
        icon: "error"
      });
    }
  },
});
````

## File: pages/joymewIndexDz/joymewIndexDz.json
````json
{
  "navigationBarTitleText": " 嗨喵悦动",
  "disableScroll": true,
  "navigationStyle": "custom",
  "usingComponents": {
    "phoneGet": "./components/phoneGet/phoneGet",
    "avatarGet": "./components/avatarGet/avatarGet"
  }
}
````

## File: pages/joymewIndexDz/joymewIndexDz.wxml
````
<view class="signNew">
    <image src='{{customSignBg}}' class="bg" mode="aspectFill"></image>
    <!-- 表单 -->
    <form class="signForm">
        <view class="formItem">
            <view class="formItem-key">头像:</view>
            <view class="formItem-value avatar">
                <!-- <button class="avatarButton" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
                    <image class="avatar" src="{{signForm.avatarUrl}}"></image>
                </button> -->
                <avatarGet avatarUrl="{{signForm.avatarUrl}}" bindupdateavatar="onGetAvatar"></avatarGet>
            </view>
        </view>
        <view class="formItem">
            <view class="formItem-key">姓名:</view>
            <view class="formItem-value">
                <input class="inputNickName" maxlength="12" placeholder="请输入姓名" value="{{signForm.nickName}}" bindblur="onNickNameBlur" />
            </view>
        </view>
        <view class="formItem">
            <view class="formItem-key">口令:</view>
            <view class="formItem-value">
                <input class="inputWish" maxlength="20" placeholder="请输入口令" value="{{signForm.bless_str}}"  bindblur="onBlessStrBlur" disabled/>
            </view>
        </view>
        <view class="formItem">
            <view class="formItem-key">单位:</view>
            <view class="formItem-value">
                <input class="inputWish" maxlength="20" placeholder="请输入单位" value="{{signForm.type}}"  bindblur="onTypeBlur" />
            </view>
        </view>
        <view class="formItem">
            <view class="formItem-key">手机号:</view>
            <view class="formItem-value">
                <phoneGet userPhone="{{signForm.userPhone}}" phoneCompStatus="{{phoneCompStatus}}" bindupdatephone="updatePhone" wx:if="{{phoneCompStatus !== 0}}"></phoneGet>
            </view>
        </view>
        <view class="buttonWrap">
            <view class="signButton" bindtap="onSign"></view>
        </view>
    </form>
</view>

<!-- 隐私授权弹窗 -->
<privacyAuthorize></privacyAuthorize>
````

## File: pages/joymewIndexDz/joymewIndexDz.wxss
````
.signNew {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .bg {
    width: 100%;
    height: 100%;
  }
  
  .signForm {
    width: 620rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: absolute;
    bottom: 80rpx;
    padding-top: 40rpx;
    padding-bottom: 40rpx;
    background-image: url("https://ustatic.joymew.com/joymewMp/joymewIndex/signBoxBgHX.png");
    background-size: 100% 100%;
  }
  
  .signForm .formItem {
    padding: 0 40rpx;
    display: flex;
    font-size: 32rpx;
    font-weight: 400;
    margin-bottom: 40rpx;
  }
  
  .signForm .formItem .formItem-key {
    color: #fff;
    width: 40rpx;
    width: 135rpx;
  }
  .signForm .formItem .formItem-value {
    color: #fff;
    border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
    flex: 1;
  }
  
  .signForm .formItem .formItem-value.avatar {
    border-bottom: none;
  }
  
  .signForm .buttonWrap {
    display: flex;
    justify-content: center;
  }
  .signForm .buttonWrap .signButton {
    background-size: 100% 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 380rpx;
    height: 85rpx;
    color: #000;
    background: #b3e0ee;
    border-radius: 45rpx;
  }
  
  .signForm .buttonWrap .signButton::after {
    content: "点击进入";
    display: block;
    position: absolute;
  }
````

## File: pages/luckyWheel/luckyWheel.js
````javascript
import {
  reqGetZyzInfo, // 获取游戏信息
  reqGetPoolMoney, // 不只是获取奖池金额，还能获取游戏状态
} from "../../api/zyzSmall";

Page({
  data: {
    turnId: 0, // 抽奖轮次id
    poolMoney: "0", // 奖池金额
    gameStatus: 1, // 当前游戏状态，用于控制页面显示
    prizeItemList: [], // 奖项列表(带汉字单位)
    prizeItemValList: [], // 奖项数值列表(不带汉字单位)
    countDown: 0, // 游戏界面的倒计时
    countDownInterval: null, // 更新倒计时的定时器
    userId: "", // 用户id，传给FeedbackEntry和LuckyWheelMain组件
    openId: "", // 用户openId，传给FeedbackEntry和LuckyWheelMain组件
    name: "", // 传递给LuckyWheelMain组件用来发送礼物广播的
    headImg: "", // 传递给LuckyWheelMain组件用来发送礼物广播的
    targetId: "", // 锚点，用于控制滚动到指定位置
  },
  // 方法
  // 修改奖池金额，给子组件用的
  changePoolMoney({ poolMoney: poolMoney }) {
    this.setData({
      poolMoney,
    });
  },
  // 返回剩余倒计时数值（秒）
  remainCountdown(endTime) {
    var nowTime = new Date().getTime();
    var subTime = parseInt((parseInt(endTime) - parseInt(nowTime)) / 1000);
    if (subTime < 0) {
      subTime = 0;
    }
    return subTime;
  },
  // 获取并设置奖池金额，在页面onLoad时调用
  setPoolMoneyOnLoad() {
    reqGetPoolMoney()
      .then((res) => {
        this.setData({
          poolMoney: res.data.balance,
        });
      })
      .catch((err) => {
        console.log("获取奖池金额失败", err);
      });
  },
  // 尝试进入游戏
  tryEnterGame({ isFirst = false }) {
    reqGetZyzInfo()
      .then((res) => {
        // 更新turnId
        this.setData({
          turnId: res.data.id,
        });

        // 根据endTime更新游戏状态
        if (res.data.endTime === "0") {
          !isFirst ? wx.showToast({title: "游戏尚未开始!", icon: "none"}) : null;
        } else {
          let countDownTotalTime = this.remainCountdown(res.data.endTime);
          this.startCountDown(countDownTotalTime);
          this.setData({
            gameStatus: 2,
          });
        }
      })
      .catch((err) => {
        wx.showToast({
          title: "获取游戏信息失败!",
          icon: "none",
        });
      });
  },
  // 启动一个Interval，从而更新倒计时、充值入口状态和控制游戏结束
  startCountDown(countDownTotalTime) {
    if (this.countDownInterval) {
      return;
    }
    // 开启充值入口
    this.setData({
      isEntry: true,
    });
    let countTime = countDownTotalTime;
    // 每秒倒计时减1
    this.countDownInterval = setInterval(() => {
      // 小于15秒时关闭充值入口
      if (countTime <= 15) {
        this.setData({
          isEntry: false,
        });
      }
      // 小于1秒时停止倒计时，并且结束游戏
      if (countTime <= 1) {
        this.endGame();
        clearInterval(this.countDownInterval);
      }
      // 只要倒计时大于0，就一直倒计时
      if (countTime > 0) {
        countTime -= 1;
        this.setData({
          countDown: countTime,
        });
      }
      // 每4秒向后端确认一下游戏状态
      if (countTime % 4 === 0) {
        this.updateWhileGaming();
      }
    }, 1000);
  },
  // 在游戏中进行的游戏状态检查和更新
  updateWhileGaming() {
    reqGetPoolMoney()
      .then((res) => {
        const remainCountdown = this.remainCountdown(res.data.endTime);
        if (remainCountdown <= 0) {
          this.endGame();
        }
        this.setData({
          poolMoney: res.data.balance,
        });
      })
      .catch((err) => {
        console.log(err);
        wx.showToast({
          title: "获取奖池金额失败",
          icon: "none",
        });
      });
  },
  // 结束游戏
  endGame() {
    this.setData({
      gameStatus: 3,
    });
  },

  onLoad(options) {
    this.setData({
      userId: options.userId,
      openId: options.openId,
      name: options.name,
      headImg: options.headImg,
      prizeItemList: getApp().globalData.gameInfo_luckyWheelPrizeItemList,
    });
    // 获取奖池金额
    this.setPoolMoneyOnLoad();
  },
  onShow: function () {
    this.tryEnterGame({ isFirst: true });
  },
  onHide: function () {
    clearInterval(this.data.countDownInterval);
    this.data.countDownInterval = null;
  },
  onUnload: function () {
    clearInterval(this.data.countDownInterval);
    this.data.countDownInterval = null;
  },
});
````

## File: pages/luckyWheel/luckyWheel.json
````json
{
  "navigationBarTitleText": "幸运小转盘",
  "usingComponents": {
    "Wait": "./wait/wait",
    "LuckyWheelMain": "./luckyWheelMain/luckyWheelMain",
    "PrizeSheet": "./prizeSheet/prizeSheet"
  },
  "disableScroll": true
}
````

## File: pages/luckyWheel/luckyWheel.wxml
````
<scroll-view class="luckyWheel-wrap" scroll-y="true" scroll-into-view="{{targetId}}" 	scroll-with-animation="true" >
  <!-- 反馈入口 -->
  <FeedbackEntry userId="{{userId}}" openId="{{openId}}"></FeedbackEntry>
  <!-- 等待页面 -->
  <Wait wx:if="{{gameStatus === 1}}" bind:tryEnterGame="tryEnterGame" />
  <!-- 游戏界面 -->
  <LuckyWheelMain wx:if="{{gameStatus===2}}" poolMoney="{{poolMoney}}" bind:changePoolMoney="changePoolMoney"
    prizeItemList="{{prizeItemList}}" countDown="{{countDown}}" isEntry="{{isEntry}}" userId="{{userId}}"
    openId="{{openId}}" name="{{name}}" headImg="{{headImg}}" bind:requestGameInitInfo="requestGameInitInfo" />
  <!-- 排行榜界面 -->
  <PrizeSheet wx:if="{{gameStatus===3}}" />
  <!-- 空置的锚点元素，用于页面滚动定位 -->
  <view id="bottom-anchor"></view>
</scroll-view>
````

## File: pages/luckyWheel/luckyWheel.wxss
````
.luckyWheel-wrap {
  position: relative;
  width: 100vw;
  height: 100vh;
  background-image: url('https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/main-bg.png');
  background-size: cover;
  background-position: center;
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMain.js
````javascript
import {
  reqGetZyzInfo, // 获取游戏信息
  reqZyzRecharge, // 充值请求
  reqStartZyz, // 开始抽奖请求
  reqSendBroadCast, // 送礼广播请求
  reqSendPrizeInfo, // 发送中奖广播请求
} from "../../../api/zyzSmall.js";

const TWEEN = require("../../../utils/tween.js");
const app = getApp();

Component({
  properties: {
    poolMoney: {
      // 奖池金额
      type: String,
      default: 0,
    },
    prizeItemList: {
      // 奖品列表
      type: Array,
      default: () => [],
    },
    countDown: {
      // 倒计时
      type: Number,
      default: 0,
    },
    isEntry: {
      // 充值入口是否开启
      type: Boolean,
      default: false,
    },
    // 用户的四项信息，用于发礼物相关的请求
    userId: {
      type: String,
      default: "",
    },
    openId: {
      type: String,
      default: "",
    },
    name: {
      type: String,
      default: "",
    },
    headImg: {
      type: String,
      default: "",
    },
    gameCode:  {
      type: String,
      default: ""
    }
  },

  data: {
    firstFivePrizeItems: [], // 前五个奖品
    lastFivePrizeItems: [], // 后五个奖品
    selectedGiftIndex: 0, // 选中的礼物索引
    isClicked: false, // 是否点击了开始按钮
    isWin: false, // 是否中奖
    brightItemIndex: 10, // 亮起的转盘选项索引
    // 礼物列表
    giftItems: [{
        id: 1,
        gift: "rocket1",
        name: "火箭小号",
        imgUrl: "https://static.hudongmiao.com/joymewMp/zyz/rocket1.png",
        isChoosed: true,
      },
      {
        id: 2,
        gift: "rocket2",
        name: "火箭中号",
        imgUrl: "https://static.hudongmiao.com/joymewMp/zyz/rocket2.png",
        isChoosed: false,
      },
      {
        id: 3,
        gift: "rocket3",
        name: "大号大号",
        imgUrl: "https://static.hudongmiao.com/joymewMp/zyz/rocket3.png",
        isChoosed: false,
      },
    ],
    isDrawing: false, // 当前是否正在抽奖
    drawAudio: null, // 抽奖音效
    winAudio: null, // 中奖音效
    moneyAudio: null, // 金钱音效
    prizeMoney: "", // 中奖金额
    balance: "", // 用于发送中奖广播
    opacity: 1,
    userAvatar: "", // 用户头像
    userNickname: "", // 用户昵称
  },

  observers: {
    // 监听countDown变化，自动更新格式化后的倒计时
    'countDown': function(countDown) {
      this.setData({
        formattedCountDown: this.formatCountDown(countDown)
      });
    }
  },

  methods: {
    // ready时初始化音频
    initAudio() {
      console.log('initAudio');
      this.data.drawAudio = wx.createInnerAudioContext();
      this.data.drawAudio.src = "https://ustatic.hudongmiao.com/joymewMp/luckyWheel/draw_audio.mp3";
      this.data.winAudio = wx.createInnerAudioContext();
      this.data.winAudio.src = "https://ustatic.hudongmiao.com/joymewMp/luckyWheel/win_audio.mp3";
      this.data.moneyAudio = wx.createInnerAudioContext();
      this.data.moneyAudio.src = "https://ustatic.hudongmiao.com/joymewMp/luckyWheel/money_audio.mp3";
      // 将所有音频音量设置为0
      this.data.drawAudio.volume = 0;
      this.data.winAudio.volume = 0;
      this.data.moneyAudio.volume = 0;
      // 将所有音频播放一遍，防止第一次播放时出现卡顿
      this.data.drawAudio.play();
      this.data.winAudio.play();
      this.data.moneyAudio.play();
    },
    // 选择礼物
    chooseGift(e) {
      const choosedId = e.currentTarget.dataset.id;
      this.data.giftItems.forEach((item, index) => {
        if (item.id === choosedId) {
          item.isChoosed = true;
          this.setData({
            giftItems: this.data.giftItems,
          });
        } else {
          item.isChoosed = false;
          this.setData({
            giftItems: this.data.giftItems,
          });
        }
      });
    },
    // 获取当前选择的礼物的对象
    getChoosedGift() {
      return this.data.giftItems.find((item) => {
        return item.isChoosed;
      });
    },
    // 检查当前能否发送礼物
    canSendGift() {
      // 检查充值入口是否开启
      if (!this.data.isEntry) {
        wx.showToast({
          title: '购买入口关闭',
          icon: 'none'
        });
        return false;
      }
      // 检查当前是否正在抽奖
      if (this.data.isDrawing) {
        return false;
      }
      return true;
    },
    // 点击发送礼物
    sendGift({
      type
    }) {
      // 如果点击的是"再玩一次"，则不播放按钮动画
      if (type !== "playAgain") {
        this.sendGiftBtnAnimation();
      }

      // 先检查当前能否发送礼物
      if (!this.canSendGift()) {
        return;
      }
      // 发出充值请求
      reqZyzRecharge({
          userId: this.data.userId,
          openId: this.data.openId,
          dzp_kind: '2'
        })
        // 确认充值完成后，获取游戏信息
        .then(() => {
          wx.showToast({
            title: '礼物发送成功!',
            icon: 'none'
          });
          // 发送送礼广播
          this.sendGiftBroadcast(this.getChoosedGift());
          return reqGetZyzInfo();
        })
        // 获取到游戏信息后，发送开始抽奖请求
        .then((res) => {
          this.data.turnId = res.data.id;
          return reqStartZyz({
            turnId: this.data.turnId,
            dzp_kind: '2'
          });
        })
        // 获取到抽奖请求信息后，开始抽奖转盘动画
        .then((res) => {
          //奖池金额刷新
          if (res.data.totalMoney.remainCoin) {
            this.triggerEvent("changePoolMoney", {
              poolMoney: res.data.totalMoney.remainCoin,
            });
          }
          this.setData({
            prizeMoney: res.data.endMoney,
            balance: res.data.totalMoney.balance
          });
          // 开始转盘动画
          const prizeItemIndex = this.getPrizeItemIndex(res.data.endMoney);
          this.wheelAnimation(prizeItemIndex);
        })
        .catch((err) => {
          wx.showToast({
            title: '礼物发送失败!',
            icon: 'none'
          });
          this.isDrawing = false;
        });
    },
    // 根据奖项内容返回索引
    getPrizeItemIndex(prizeItem) {
      const prizeItemList = this.data.prizeItemList;
      for (let i = 0; i < prizeItemList.length; i += 1) {
        const item = prizeItemList[i].replace(/[\u4e00-\u9fa5]/g, "");
        if (item === prizeItem) {
          return i;
        }
      }
    },
    // 转盘动画，targetIndex：中奖选项索引
    wheelAnimation(targetIndex) {
      const {
        drawAudio,
        winAudio,
        moneyAudio
      } = this.data;
      // 将音频暂停，防止之前的音频还在播放，并且将音量设置为1
      drawAudio.stop();
      winAudio.stop();
      moneyAudio.stop();
      drawAudio.volume = 1;
      winAudio.volume = 1;
      moneyAudio.volume = 1;

      let brightItemIndexTemp = 0; // 亮起方块在逆时针中的索引
      // 转盘方块DOM不是逆时针排列的，这里是转盘方块（逆时针）对应的prizeItem的索引，即0号方块（左上角）对应的是0号prizeItem，1号方块（上）对应的是1号prizeItem，但是4号方块对应的是5号prizeItem，以此类推
      const anticlockwiseIndex = [0, 1, 2, 3, 5, 9, 8, 7, 6, 4];
      const circleCount = 4; // 转的圈数
      const duration = 5000; // 动画时间（毫秒），由3366改为5000让转盘更慢
      // 中奖选项在逆时针顺序中的索引
      const targetIndexInAnticlockwise = anticlockwiseIndex.findIndex((item) => {
        return item === targetIndex;
      });


      new TWEEN.Tween({
          count: 0
        })
        .to({
          count: 10 * circleCount + targetIndexInAnticlockwise
        }, duration)
        .easing(TWEEN.Easing.Exponential.Out)
        .onUpdate((object) => {
          brightItemIndexTemp = Math.floor(object.count % 10);
          // 根据brightItemIndexTemp的值，改变brightItemIndex的值
          this.setData({
            brightItemIndex: anticlockwiseIndex[brightItemIndexTemp],
          });
        })
        // 动画开始时
        .onStart(() => {
          this.data.isDrawing = true; // 修改抽奖状态为正在抽奖
          drawAudio.play(); // 播放抽奖音效
        })
        // 动画结束后
        .onComplete(() => {
          drawAudio.stop(); // 停止播放抽奖音效
          winAudio.play(); // 播放中奖音效

          // 延迟1秒后
          setTimeout(() => {
            this.setData({
              isWin: true, // 显示中奖弹窗
              brightItemIndex: 10, // 亮起方块索引重置为10，即不亮
            });
            moneyAudio.play(); // 播放中奖到账的金币音效
          }, 1000);
          TWEEN.removeAll(); // 清除所有TWEEN动画
          clearInterval(animateInterval); // 清除动画定时器
          this.data.isDrawing = false; // 修改抽奖状态为未抽奖
          this.sendPrizeBroad(); // 发送中奖广播
        })
        .start();

      // 每10毫秒更新一次TWEEN动画
      const animateInterval = setInterval(() => {
        TWEEN.update();
      }, 10);
    },
    // 发送礼物按钮动画
    sendGiftBtnAnimation() {
      this.setData({
        isClicked: true,
      });
      setTimeout(() => {
        this.setData({
          isClicked: false,
        });
      }, 150);
    },
    // 发送礼物广播
    sendGiftBroadcast(giftChoosed) {
      let tmpCode = "";
      if (giftChoosed.id == 1) {
        tmpCode = 5002;
      } else if (giftChoosed.id == 2) {
        tmpCode = 6002;
      } else if (giftChoosed.id == 3) {
        tmpCode = 7002;
      }

      const blessingList = [
        "美酒佳肴,不甚荣幸",
        "醉酒饱德，不胜感激",
        "小小红包,感谢招待",
        "感谢招待,祝愿安康",
      ];
      const blessing = blessingList[Math.floor(Math.random() * blessingList.length)];
      const params = JSON.stringify({
        code: tmpCode,
        param: {
          headImg: this.data.headImg,
          nickname: this.data.name,
          wish: blessing,
        },
      });
      reqSendBroadCast({
        c: params,
      });
    },
    // 发送中奖广播
    sendPrizeBroad() {
      reqSendPrizeInfo({
          gold: this.data.prizeMoney,
          remainCoin: this.data.balance,
          turnId: this.data.turnId,
        })
        .catch((err) => {
          wx.showToast({
            title: '网络异常!',
            icon: 'none'
          });
        });
    },
    // 跳转到《充值服务协议》界面
    toAgreement: function () {
      wx.navigateTo({
        url: "/pages/agreement/agreement",
      });
    },
    // 关闭中奖弹窗（给子组件使用）
    closeWinDialog() {
      this.setData({
        isWin: false,
      });
    },
    // 格式化倒计时为00:00格式
    formatCountDown(countDown) {
      const min = Math.floor(countDown / 60);
      const sec = countDown % 60;
      const minStr = min < 10 ? '0' + min : '' + min;
      const secStr = sec < 10 ? '0' + sec : '' + sec;
      return `${minStr}:${secStr}`;
    },
  },
  lifetimes: {
    // 注意：这里需要在ready钩子而不是attached进行数据设置
    // 因为attached时，父组件的onLoad还没执行，还没有有效的参数传入
    ready: function () {
      this.setData({
        firstFivePrizeItems: this.data.prizeItemList.slice(0, 5),
        lastFivePrizeItems: this.data.prizeItemList.slice(5, 10),
        userAvatar: app.globalData.userInfo_avatar, // 全局头像
        userNickname: app.globalData.userInfo_nickname, // 全局昵称
      });
      // 组件挂载后，进行游戏的初始化
      this.triggerEvent("requestGameInitInfo");

      // 初始化音频对象
      this.initAudio();

    },
    detached: function () {
      // 组件销毁时，销毁音频资源
      let {
        drawAudio,
        winAudio,
        moneyAudio
      } = this.data;
      drawAudio.destroy();
      drawAudio = null;
      winAudio.destroy();
      winAudio = null;
      moneyAudio.destroy();
      moneyAudio = null;
    },
  },
});
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMain.json
````json
{
  "component": true,
  "usingComponents": {
    "Congratulate" : "./luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2"
  }
  
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMain.less
````
.lucky-wheel-main {
  width: 100%;
  height: 100%;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  background-color: rgba(0, 0, 0, 0.3);

  // 奖金池总金额
  .total-money {
    width: 100%;
    height: 34.615rpx;

    font-size: 34.615rpx;
    font-family: "Noto Sans SC";
    font-weight: 500;
    color: #fff;
    letter-spacing: 0.69.231rpx;
    text-align: center;
  }

  // 转盘区域
  .wheel-area {
    width: 732.692rpx;
    height: 801.923rpx;
    margin-top: 9px;

    background-image: url("https://static.joymew.com/joymewMp/miniWheel/wheel-bg.png");
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-position: center;

    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    justify-content: space-evenly;
    align-content: space-between;

    padding: 37.5rpx;

    .prize-item {
      width: 207.692rpx;
      height: 157.692rpx;
      background-repeat: no-repeat;
      background-size: 100% 100%;
      background-image: url("https://static.joymew.com/joymewMp/miniWheel/prize-item-blue.png");
      border-radius: 28.846rpx;

      font-size: 40rpx;
      line-height: 157.692rpx;
      font-family: impactregular;
      font-weight: 700;
      text-align: center;
      color: #fff;
      letter-spacing: 2.385rpx;

      // 亮起来的方块
      &.bright {
        background-color: linear-gradient(
          180.23deg,
          rgba(255, 255, 255, 0.5) 0.2%,
          rgba(255, 255, 255, 0.25) 99.8%
        );
        box-shadow: 0px 0px 5px 2px rgba(255, 255, 255, 1),
          0px 0px 10px 5px rgba(255, 255, 255, 1),
          inset 0px 0px 20px 10px rgba(255, 255, 255, 0.9);
      }
      // 红色方块
      &:nth-child(2),
      &:nth-child(11) {
        background-image: url("https://static.joymew.com/joymewMp/miniWheel/prize-item-red.png");
      }

      // 绿色方块
      &:nth-child(3),
      &:nth-child(8) {
        background-image: url("https://static.joymew.com/joymewMp/miniWheel/prize-item-green.png");
      }

      // 黄色方块
      &:nth-child(4),
      &:nth-child(5),
      &:nth-child(10) {
        background-image: url("https://static.joymew.com/joymewMp/miniWheel/prize-item-yellow.png");
      }
    }

    .count-down {
      width: 209.615rpx;
      height: 334.615rpx;

      font-size: 34.615rpx;
      color: #fff;
      letter-spacing: 0.692rpx;
      // line-height: 319.231rpx;
      text-align: center;

      background-image: url("https://static.joymew.com/joymewMp/miniWheel/count-down-bg.png");
      background-repeat: no-repeat;
      background-size: 100% 100%;
      background-position: center;

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;

      .i {
        font-style: normal;
        font-size: 69.231rpx;
        font-weight: 700;
        letter-spacing: 0.13844.231rpx;
        margin-top: 30.769rpx;
      }
    }
  }

  // 弹幕礼物区域
  .gift-area {
    width: 100%;
    height: 173.077rpx;

    display: flex;
    flex-direction: column;
    align-items: center;

    .gift-tip {
      width: 100%;
      height: 26.923rpx;
      line-height: 26.923rpx;

      font-size: 26.923rpx;
      font-family: "Noto Sans SC";
      color: #fff;
      letter-spacing: 0.53.846rpx;
      text-align: center;

      margin-bottom: 23.077rpx;
    }

    .gift-items {
      width: 586.538rpx;
      height: 121.153rpx;

      display: flex;
      justify-content: space-between;
      align-items: center;

      .gift-item {
        width: 155.769rpx;
        height: 100%;
        background-image: url("https://static.joymew.com/joymewMp/miniWheel/gift-bg.png");
        background-repeat: no-repeat;
        background-size: 100% 100%;
        background-position: center;

        position: relative;

        filter: brightness(0.6);
        &.active {
          filter: brightness(1);
        }
        .gift-item-img {
          height: 150rpx;

          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -40%);
        }
      }
    }
  }

  // 充值服务协议
  .agreement {
    margin-top: 30rpx;
    font-size: 24rpx;
    font-weight: 400;
    color: #fff;
  }
  // 发送礼物
  .send-gift-btn {
    width: 394.231rpx;
    height: 130.769rpx;
    margin-top: 16.908rpx;
    line-height: 120rpx;

    font-size: 34.616rpx;
    font-family: "Noto Sans SC";
    font-weight: 500;
    color: #fff;
    letter-spacing: 0.69.231rpx;
    text-align: center;

    background-image: url("https://static.joymew.com/joymewMp/miniWheel/send-gift-btn.png");
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-position: center;

    transition: 0.05s all;

    // 点击后的变化
    &.clicked {
      transform: scale(0.9);
      filter: brightness(0.8);
    }
  }
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMain.wxml
````
<view class="lucky-wheel-main">
  <!-- 恭喜中奖提示 -->
  <Congratulate wx:if="{{isWin}}" bind:close="closeWinDialog" bind:playAgain="sendGift" prizeMoney="{{prizeMoney}}" userAvatar="{{userAvatar}}" userNickname="{{userNickname}}" />
  <!-- 奖金池总金额 -->
  <view class="total-money publicHvCenter">
    <view class="text">奖池总金额： {{ poolMoney }}元</view>
  </view>
  <!-- 转盘区域 -->
  <view class="wheel-area">
    <!-- 转盘的前5个中奖选项 -->
    <!-- XXX 最好还是要让所有奖项均逆时针排列，这样就可以简化转盘动画中的逻辑了 -->
    <view class="prize-item {{brightItemIndex === index? 'bright': ''}}" wx:for="{{firstFivePrizeItems}}"
      wx:for-index="index" wx:for-item="item" wx:key="index">
      <view class="content">{{ item }}</view>
    </view>
    <!-- 转盘倒计时 -->
    <view class="count-down publicHCenter" style="opacity: {{opacity}}; transition: opacity 2s ease-in-out;">
      <i class="i">{{ formattedCountDown }}</i>
    </view>
    <!-- 转盘后5个中奖选项 -->
    <view class="prize-item" class="prize-item {{brightItemIndex === index+5? 'bright': ''}}"
      wx:for="{{lastFivePrizeItems}}" wx:key="index" wx:for-item="item" wx:key="index">
      <view class="content">{{ item }}</view>
    </view>
  </view>
  <!-- 弹幕礼物区域 -->
  <view class="gift-area">
    <view class="gift-tip">购买任意一款弹幕礼物，系统将赠送一次抽奖机会</view>
    <view class="gift-items">
      <view class="gift-item {{item.isChoosed?'active':''}}" wx:for="{{giftItems}}" wx:key="id" data-id="{{item.id}}"
        bind:tap="chooseGift">
        <image class="gift-item-img" mode="heightFix" src="{{item.imgUrl}}" alt="{{item.name}}"></image>
      </view>
    </view>
  </view>
  <!-- 充值服务协议 -->
  <view class="agreement" bindtap='toAgreement'>阅读并同意《充值服务协议》</view>
  <!-- 发送礼物按钮 -->
  <view class="send-gift-btn {{isClicked?'clicked':''}}" bind:tap="sendGift">
    <text>发送礼物</text>
  </view>
</view>
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMain.wxss
````
.lucky-wheel-main {
  position: relative;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding-bottom: 60rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/main-bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
}
.lucky-wheel-main .total-money {
  width: 600rpx;
  height: 200rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/total-bg.png");
  background-size: 100% 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lucky-wheel-main .total-money .text {
  transform: translateY(10rpx);
  width: 500rpx;
  height:100rpx;
  font-family: 'Impact', 'Arial Black', 'Noto Sans SC', sans-serif;
  font-size: 40rpx;
  font-weight: bold;
  color: #fff;
  letter-spacing: 4rpx;
  font-style: italic;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lucky-wheel-main .wheel-area {
  width: 650rpx;
  height: 805.923rpx;
  margin-top: 0rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/wheel-bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-position: center;
  display: flex;
  flex-direction: column;
  flex-wrap: wrap;
  justify-content: space-around;
  align-content: space-around;
  padding: 63.5rpx 70rpx;
}

.lucky-wheel-main .wheel-area .prize-item {
  width: 150rpx;
  height: 150rpx;
  background:#0000;
}

.lucky-wheel-main .wheel-area .prize-item .content {
  width: 150rpx;
  height: 150rpx;
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/item-bg4.png");
  border-radius: 28.846rpx;
  font-size: 32rpx;
  font-weight: bold;
  line-height: 150rpx;
  font-weight: 700;
  text-align: center;
  color: #fff;
  letter-spacing: 2.385rpx;
}

.lucky-wheel-main .wheel-area .prize-item.bright {
  background:url("https://ustatic.hudongmiao.com/joymewScreen/img/luckyWheel/item-effect2.png") no-repeat center center;
  background-size: 110% 110%;
}
.lucky-wheel-main .wheel-area .prize-item.bright .content{
      box-shadow: 0px 0px 10px 3px rgba(255, 215, 0, 0.8), 0px 0px 20px 8px rgba(255, 215, 0, 0.6), inset 0px 0px 30px 15px rgba(255, 255, 255, 0.3);
      border: 2px solid #FFD700;
}

.lucky-wheel-main .wheel-area .prize-item:nth-child(2) .content,
.lucky-wheel-main .wheel-area .prize-item:nth-child(11) .content{
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/item-bg1.png");
}
.lucky-wheel-main .wheel-area .prize-item:nth-child(3) .content,
.lucky-wheel-main .wheel-area .prize-item:nth-child(8) .content{
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/item-bg2.png");
}
.lucky-wheel-main .wheel-area .prize-item:nth-child(4) .content,
.lucky-wheel-main .wheel-area .prize-item:nth-child(5).content ,
.lucky-wheel-main .wheel-area .prize-item:nth-child(10) .content{
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/item-bg3.png");
}
.lucky-wheel-main .wheel-area .count-down {
  width: 150rpx;
  height: 320rpx;
  font-size: 34.615rpx;
  color: #fff;
  letter-spacing: 0.692rpx;
  text-align: center;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/time-bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-position: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.lucky-wheel-main .wheel-area .count-down .i {
  font-style: normal;
  font-size: 34.231rpx;
  font-weight: 700;
  letter-spacing: 0.13844 0.231rpx;
  margin-top: 30.769rpx;
}
.lucky-wheel-main .gift-area {
  width: 100%;
  height: 173.077rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.lucky-wheel-main .gift-area .gift-tip {
  width: 650rpx;
  height: 46.923rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/tip-bg.png");
  background-size: 100% 100%;
  background-repeat: no-repeat;
  line-height: 46.923rpx;
  font-size: 22.923rpx;
  font-family: "Noto Sans SC";
  color: #fff;
  text-align: center;
  margin-top: 20rpx;
  margin-bottom: 23.077rpx;
}
.lucky-wheel-main .gift-area .gift-items {
  width: 586.538rpx;
  height: 121.153rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.lucky-wheel-main .gift-area .gift-items .gift-item {
  width: 132rpx;
  height: 132rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/rocket-bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-position: center;
  border-radius: 50%;
  position: relative;
  
  filter: brightness(0.9);
  border: 1px solid #fff;
  box-shadow: 0 0 16rpx 6rpx rgba(255,255,255,0.7);
}
.lucky-wheel-main .gift-area .gift-items .gift-item.active {
  filter: brightness(1);
  border: 1px solid #FFD700;
  box-shadow: 0 0 20rpx 8rpx rgba(255,215,0,0.7);
}
.lucky-wheel-main .gift-area .gift-items .gift-item .gift-item-img {
  height: 101rpx;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.lucky-wheel-main .agreement {
  margin-top: 50rpx;
  font-size: 24rpx;
  font-weight: 400;
  color: #fff;
  background: rgba(0,0,0,0.18);
  border-radius: 32rpx;
  padding: 8rpx 32rpx;
  display: inline-block;
}
.lucky-wheel-main .send-gift-btn {
  width: 394.231rpx;
  height: 130.769rpx;
  margin-top: 16.908rpx;
  line-height: 120rpx;
  font-size: 34.616rpx;
  font-family: "Noto Sans SC";
  font-weight: 500;
  color: #fff;
  letter-spacing: 0.69 0.231rpx;
  text-align: center;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/send-btn.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-position: center;
  transition: 0.05s all;
}
.lucky-wheel-main .send-gift-btn.clicked {
  transform: scale(0.9);
  filter: brightness(0.8);
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.js
````javascript
Component({
  properties: {
    // 中奖金额
    prizeMoney: {
      type: String,
      default: "0",
    },
  },
  methods: {
    // 点击关闭按钮
    close() {
      this.triggerEvent("close");
    },
    // 再玩一遍
    playAgain() {
      this.triggerEvent("close");
      this.triggerEvent("playAgain");
    },
  },
});
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.wxml
````
<view class="congratulate">
  <!-- 恭喜中奖提示 -->
  <view class="congratulate-tip">
    <view class="bg">
      <image class="shine" mode="" src="https://static.joymew.com/joymewMp/miniWheel/shine.png" alt="shine" />
      <image class="red-packet" mode="widthFix" src="https://static.joymew.com/joymewMp/miniWheel/red-packet.png"
        alt="congratulate" />
    </view>
    <view class="info">
      <view class="info-text">恭喜获得!</view>
      <view class="info-money">
        <text>{{prizeMoney}}</text>
        <text>元</text>
      </view>
      <view class="info-tip"><text>微信钱包已实时到账</text></view>
      <view class="info-again-btn" bindtap="playAgain">
        <image class="info-again-btn-img" mode="widthFix"
          src="https://static.joymew.com/joymewMp/miniWheel/play-again.png" alt="again" />
      </view>
    </view>
  </view>
  <!-- 关闭按钮 -->
  <view class="close-btn" bind:tap="close">
    <image class="close-btn-img" mode="widthFix" src="https://static.joymew.com/joymewMp/miniWheel/close.png"
      alt="close" />
  </view>
</view>
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulate/luckyWheelMainCongratulate.wxss
````
.congratulate {
  z-index: 100;
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.congratulate .congratulate-tip {
  margin-top: 5vh;
  width: 100%;
  height: 961.538rpx;
  animation: popUp 0.2s ease-in-out forwards;
}
@keyframes popUp {
  0% {
    transform: scale(0);
  }
  100% {
    transform: scale(1);
  }
}
.congratulate .congratulate-tip .bg {
  position: absolute;
  width: 100%;
  height: 886.538rpx;
  z-index: -1;
}
.congratulate .congratulate-tip .bg .shine {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
.congratulate .congratulate-tip .bg .red-packet {
  position: absolute;
  top: 92.308rpx;
  left: 50%;
  transform: translateX(-50%);
  width: 651.923rpx;
  height: 809.615rpx;
}
.congratulate .congratulate-tip .info {
  margin-top: 498.077rpx;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: start;
  align-items: center;
}
.congratulate .congratulate-tip .info .info-text {
  font-size: 53.846rpx;
  font-family: Noto sans sc;
  font-weight: 700;
  text-align: center;
  color: #FFFFFF;
}
.congratulate .congratulate-tip .info .info-money {
  margin-top: 32.693rpx;
  font-size: 92.308rpx;
  font-weight: bold;
  text-align: center;
  color: #fffebb;
  text-shadow: -0.904rpx 5.692rpx 13.462rpx 0rpx rgba(168, 33, 33, 0.65);
}
.congratulate .congratulate-tip .info .info-tip {
  margin-top: 26.923rpx;
  height: 23.077rpx;
  font-size: 23.077rpx;
  font-family: Noto sans sc;
  font-weight: bold;
  color: #fff;
  text-shadow: -0.904rpx 5.692rpx 13.462rpx 0rpx rgba(168, 33, 33, 0.65);
}
.congratulate .congratulate-tip .info .info-again-btn {
  margin-top: 28.847rpx;
  width: 392.308rpx;
  height: 80.769rpx;
}
.congratulate .congratulate-tip .info .info-again-btn .info-again-btn-img {
  width: 100%;
  height: 100%;
}
.congratulate .close-btn {
  width: 71.154rpx;
  height: 71.154rpx;
}
.congratulate .close-btn .close-btn-img {
  width: 100%;
  height: 100%;
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.js
````javascript
Component({
  properties: {
    // 中奖金额
    prizeMoney: {
      type: String,
      default: "0",
    },
    // 用户头像
    userAvatar: {
      type: String,
      default: "",
    },
    // 用户昵称
    userNickname: {
      type: String,
      default: "",
    },
  },
  methods: {
    // 点击关闭按钮
    close() {
      this.triggerEvent("close");
    },
    // 再玩一遍
    playAgain() {
      this.triggerEvent("close");
      this.triggerEvent("playAgain");
    },
  },
});
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.wxml
````
<view class="congratulate">
  <!-- 恭喜中奖提示 -->
  <view class="congratulate-tip">
    <view class="bg">
      <image class="shine" mode="" src="https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/pop-light.png" alt="shine" />
      <image class="red-packet" mode="widthFix" src="https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/pop-bg.png"
        alt="congratulate" />
    </view>
    <view class="info">
      <view class="avatar">
        <image class="avatar-img" mode="aspectFill" src="{{userAvatar}}" alt="avatar" />
        <image class="avatar-dec" mode="widthFix" src="https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/avatar-dec.png"
          alt="avatar-dec" />
      </view>
      <view class="info-text">恭喜{{userNickname}}获得</view>
      <view class="info-money">
        <text>{{prizeMoney}}</text>
        <text>元</text>
      </view>
      <view class="info-tip"><text>微信钱包已实时到账</text></view>
      <view class="info-again-btn" bindtap="playAgain">
        <view class="info-again-btn-text">再来一次</view>
        <image class="info-again-btn-img" mode="widthFix"
          src="https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/tryagain-btn.png" alt="again" />
      </view>
    </view>
  </view>
  <!-- 关闭按钮 -->
  <view class="close-btn" bind:tap="close">
    <image class="close-btn-img" mode="widthFix" src="https://static.joymew.com/joymewMp/miniWheel/close.png"
      alt="close" />
  </view>
</view>
````

## File: pages/luckyWheel/luckyWheelMain/luckyWheelMainCongratulateV2/luckyWheelMainCongratulateV2.wxss
````
.congratulate {
  z-index: 100;
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  align-items: center;
}
.congratulate .congratulate-tip {
  margin-top: 5vh;
  width: 100%;
  height: 961.538rpx;
  animation: popUp 0.2s ease-in-out forwards;
}
@keyframes popUp {
  0% {
    transform: scale(0);
  }
  100% {
    transform: scale(1);
  }
}
.congratulate .congratulate-tip .bg {
  position: absolute;
  width: 100%;
  height: 886.538rpx;
  z-index: -1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.congratulate .congratulate-tip .bg .shine {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  transform: scale(1.2);
  animation: rotate 10s linear infinite;
}
@keyframes rotate {
  0% {
    transform: scale(1.2) rotate(0deg);
  }
  100% {
    transform: scale(1.2) rotate(360deg);
  }
}
.congratulate .congratulate-tip .bg .red-packet {
  position: relative;
  margin-top: 92.308rpx;
  width: 704.923rpx;
  height: 809.615rpx;
}

.congratulate .congratulate-tip .avatar {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 60rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
.congratulate .congratulate-tip .avatar .avatar-img {
  position: absolute;
  top: 220rpx;
  left: 50%;
  transform: translateX(-50%);
  width: 60rpx;
  height: 60rpx;
  border-radius: 50%;
}

.congratulate .congratulate-tip .avatar .avatar-dec {
  position: absolute;
  top: 250rpx;
  left: 50%;
  transform: translateX(-50%);
  width: 300rpx;
  height: 60rpx;
}

.congratulate .congratulate-tip .info {
  position: relative;
  margin-top: 92.308rpx;
  height: 809.615rpx;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: start;
  align-items: center;
}
.congratulate .congratulate-tip .info .info-text {
  position: absolute;
  top: 320rpx;
  left: 50%;
  max-width: 400rpx;
  transform: translateX(-50%);
  font-size: 32.846rpx;
  font-family: Noto sans sc;
  font-weight: 700;
  text-align: center;
  color: #E87C1A;
  text-shadow: none;
  letter-spacing: 2rpx;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.congratulate .congratulate-tip .info .info-money {
  position: absolute;
  top: 400rpx;
  left: 50%;
  transform: translateX(-50%);
  font-size: 92.308rpx;
  font-weight: bold;
  text-align: center;
  color: red;
  text-shadow: -0.904rpx 5.692rpx 13.462rpx 0rpx rgba(168, 33, 33, 0.65);
}
.congratulate .congratulate-tip .info .info-tip {
  position: absolute;
  top: 560rpx;
  left: 50%;
  max-width: 400rpx;
  transform: translateX(-50%);
  font-size: 22.846rpx;
  font-family: Noto sans sc;
  font-weight: 700;
  text-align: center;
  color: #E87C1A;
  text-shadow: none;
  letter-spacing: 2rpx;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-shadow: -0.904rpx 5.692rpx 13.462rpx 0rpx rgba(168, 33, 33, 0.65);
}
.congratulate .congratulate-tip .info .info-again-btn {
  position: relative;
  margin-top: 650rpx;
  width: 392.308rpx;
  height: 80.769rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  
}
.congratulate .congratulate-tip .info .info-again-btn .info-again-btn-text{
  color: #fff;
  font-size: 42rpx;
  font-weight: bold;
  text-align: center;
  letter-spacing: 2rpx;
  text-shadow: 0 2rpx 8rpx rgba(255,168,0,0.18);
  transform: translateY(10rpx);
}

.congratulate .congratulate-tip .info .info-again-btn .info-again-btn-img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}
.congratulate .close-btn {
  width: 71.154rpx;
  height: 71.154rpx;
}
.congratulate .close-btn .close-btn-img {
  width: 100%;
  height: 100%;
}
````

## File: pages/luckyWheel/prizeSheet/prizeSheet.js
````javascript
import { reqGetZyzRank } from "../../../api/zyzSmall";
import defaultContent from "../../../assets/constant/default";
import { generateRandomId } from "../../../utils/index";

Component({
  data: {
    resultListDisplay: [],
    otherPrizeList: [],
  },
  methods: {
    // 获取排行榜
    generateRank() {
      reqGetZyzRank().then((res) => {
        const resultListDisplay = res.data.list.slice(0, 10);
        // 如果resultListDisplay的长度小于10，就补充空对象;
        if (resultListDisplay.length < 10) {
          const winPerson = {
            USER_ID: generateRandomId(),
            avator: defaultContent.defaultJoymewAvatar,
            money: "0",
            wx_name: "Player",
          };
          for (let i = resultListDisplay.length; i < 10; i++) {
            resultListDisplay.push(winPerson);
          }
        }
        const otherPrizeList = resultListDisplay.slice(3);
        this.setData({
          resultListDisplay,
          otherPrizeList,
        });
      });
    },
  },
  lifetimes: {
    created() {
      this.generateRank();
    },
  },
});
````

## File: pages/luckyWheel/prizeSheet/prizeSheet.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/luckyWheel/prizeSheet/prizeSheet.wxml
````
<view class="prize-sheet">
  <image class="first-prize-avator" src="{{resultListDisplay[0].avator}}"></image>
  <view class="first-prize-name">{{resultListDisplay[0].wx_name}}</view>
  <view class="first-prize-money">{{resultListDisplay[0].money}}元</view>
  <image class="second-prize-avator" src="{{resultListDisplay[1].avator}}"></image>
  <view class="second-prize-name">{{resultListDisplay[1].wx_name}}</view>
  <view class="second-prize-money">{{resultListDisplay[1].money}}元</view>
  <image class="third-prize-avator" src="{{resultListDisplay[2].avator}}"></image>
  <view class="third-prize-name">{{resultListDisplay[2].wx_name}}</view>
  <view class="third-prize-money">{{resultListDisplay[2].money}}元</view>
  <view class="other-prize-list-container">
    <block wx:for="{{otherPrizeList}}" wx:for-item="item" wx:for-index="idx" wx:key="idx">
      <view class="other-prize-item">
        <view class="other-prize-index">{{idx + 4}}</view>
        <image class="other-prize-avator" src="{{item.avator}}" />
        <view class="other-prize-name">{{item.wx_name}}</view>
        <view class="other-prize-money">{{item.money}}元</view>
      </view>
    </block>
  </view>
  <!-- 获奖名单主体部分  deprecated-->
  <!-- <view class="prize-sheet-body-content">
    <view class="bg">
      <image class="bg-img" src="https://static.joymew.com/joymewMp/miniWheel/prize-sheet-board.png"></image>
    </view>
    <view class="row title">
      <view class="row-cell title-no">名次</view>
      <view class="row-cell title-avatar">头像</view>
      <view class="row-cell title-name">昵称</view>
      <view class="row-cell title-money">
        金额
        <text class="unit">（元）</text>
      </view>
    </view>
    <view class="row item" wx:for="{{resultListDisplay}}" wx:key="index">
      <view class="row-cell item-no">
        {{ index <= 2 ? '' : index + 1 }}
        <image class="item-no-img" wx:if="{{index === 0}}" src="https://static.joymew.com/joymewMp/miniWheel/no1.png"></image>
        <image class="item-no-img" wx:if="{{index === 1}}" src="https://static.joymew.com/joymewMp/miniWheel/no2.png"></image>
        <image class="item-no-img" wx:if="{{index === 2}}" src="https://static.joymew.com/joymewMp/miniWheel/no3.png"></image>
      </view>
      <view class="row-cell item-avatar">
        <image class="item-avatar-img" src="{{item.avatar}}" alt="avatar"></image>
      </view>
      <view class="row-cell item-name">{{ item.wx_name }}</view>
      <view class="row-cell item-money">{{ item.money }}</view>
    </view>
  </view> -->
</view>
````

## File: pages/luckyWheel/prizeSheet/prizeSheet.wxss
````
.prize-sheet {
  position: relative;
  width: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/prize-bg.png");
  background-repeat: no-repeat;
  background-size: 750rpx 1500rpx;
}
.prize-sheet .first-prize-avator{
    position: absolute;
    width: 90rpx;
    height: 90rpx;
    top: 215rpx;
    left: 325rpx;
    border-radius: 50%;
}
.prize-sheet .first-prize-name{
    position: absolute;
    width: 100rpx;
    height: 40rpx;
    top: 365rpx;
    left: 319rpx;
    font-size: 20rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.prize-sheet .first-prize-money{
    position: absolute;
    width: 120rpx;
    height: 40rpx;
    top: 310rpx;
    left: 310rpx;
    font-size: 24rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
}

.prize-sheet .second-prize-avator{
    position: absolute;
    width: 70rpx;
    height: 70rpx;
    top: 265rpx;
    left: 120rpx;
    border-radius: 50%;
}

.prize-sheet .second-prize-name{
    position: absolute;
    width: 100rpx;
    height: 40rpx;
    top: 384rpx;
    left: 95rpx;
    font-size: 16rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.prize-sheet .second-prize-money{
    position: absolute;
    width: 120rpx;
    height: 40rpx;
    top: 338rpx;
    left: 95rpx;
    font-size: 24rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
}

.prize-sheet .third-prize-avator{
    position: absolute;
    width: 70rpx;
    height: 70rpx;
    top: 265rpx;
    left: 542rpx;
    border-radius: 50%;
}

.prize-sheet .third-prize-name{
    position: absolute;
    width: 100rpx;
    height: 40rpx;
    top: 384rpx;
    left: 535rpx;
    font-size: 16rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.prize-sheet .third-prize-money{
    position: absolute;
    width: 120rpx;
    height: 40rpx;
    top: 338rpx;
    left: 525rpx;
    font-size: 24rpx;
    color: #C35400;
    display: flex;
    align-items: center;
    justify-content: center;
}

.other-prize-list-container{
    margin-top: 560rpx;
    margin-bottom: 20rpx;
    width: 680rpx;
    min-height: 400rpx;
    max-height: 800rpx;
    background: #fff;
    border-radius: 20rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow-y: scroll;
    /* -webkit-overflow-scrolling: touch; */
    padding: 30rpx 0;
}

.other-prize-item {
  width: 90%;
  display: flex;
  align-items: center;
  padding: 20rpx 40rpx;
  box-sizing: border-box;
}

.other-prize-item:not(:last-child) {
  border-bottom: 2px solid #f5e2d2;
}

.other-prize-index {
  width: 40rpx;
  text-align: center;
  font-size: 32rpx;
  color: #e88a3c;
  font-weight: bold;
  margin-right: 20rpx;
}

.other-prize-avator {
  width: 60rpx;
  height: 60rpx;
  border-radius: 50%;
  margin-right: 20rpx;
}

.other-prize-name {
  flex: 1;
  font-size: 32rpx;
  color: #e88a3c;
  font-weight: bold;
}

.other-prize-money {
  font-size: 32rpx;
  color: #e88a3c;
  font-weight: bold;
  margin-left: 20rpx;
}

.prize-sheet .prize-sheet-body-content {
  position: absolute;
  top: 165.904rpx;
  left: 50%;
  transform: translateX(-50%);
  width: 732.692rpx;
  height: 1037.231rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.prize-sheet .prize-sheet-body-content .bg {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
}
.prize-sheet .prize-sheet-body-content .bg .bg-img {
  width: 100%;
  height: 100%;
}
.prize-sheet .prize-sheet-body-content .row {
  width: 700rpx;
  height: 7.42%;
  display: flex;
  align-items: center;
}
.prize-sheet .prize-sheet-body-content .row .row-cell {
  width: 25%;
  height: 100%;
  line-height: 100%;
  font-size: 30.769rpx;
  font-weight: 700;
  letter-spacing: 2px;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}
.prize-sheet .prize-sheet-body-content .title {
  margin-top: 97.5rpx;
}
.prize-sheet .prize-sheet-body-content .title .title-money .unit {
  font-size: 23.077rpx;
}
.prize-sheet .prize-sheet-body-content .item .item-no {
  font-size: 38.462rpx;
}
.prize-sheet .prize-sheet-body-content .item .item-no .item-no-img {
  width: 63.461rpx;
  height: 63.461rpx;
}
.prize-sheet .prize-sheet-body-content .item .item-avator {
  display: flex;
  justify-content: center;
  align-items: center;
}
.prize-sheet .prize-sheet-body-content .item .item-avator .item-avator-img {
  width: 46.153rpx;
  height: 46.153rpx;
  border-radius: 50%;
}
.prize-sheet .prize-sheet-body-content .item .item-name {
  font-size: 26.923rpx;
  font-weight: normal;
}
.prize-sheet .prize-sheet-body-content .item .item-money {
  font-size: 38.462rpx;
  font-weight: 700;
  letter-spacing: 0;
}
````

## File: pages/luckyWheel/wait/wait.js
````javascript
Component({
  methods: {
    startGame() {
      this.triggerEvent("tryEnterGame");
    },
  },
});
````

## File: pages/luckyWheel/wait/wait.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/luckyWheel/wait/wait.wxml
````
<view class="wait">
  <view>
    <!-- 规则介绍 -->
    <view class="rule">
      <view class="rule-item-content">
        <view class="p">1.主持人点击开始按钮，游戏立即开始；</view>
        <view class="p">2.游戏时常150秒，在倒计时结束前单个参与者可以不限次数参与游戏；</view>
        <view class="p">3.参与者购买高级别弹幕后，系统将免费赠送机会；</view>
        <view class="p">4.所有奖项均为随机事件，参与者的花费将被计入总奖池，中奖者的奖金将从奖金池中扣除。</view>
      </view>
    </view>
    <!-- 等待开始提示 -->
    <view class="wait-start" bind:tap="startGame">
      <image class="wait-start-bg" src="https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/start-btn.png" alt="wait-start" />
    </view>

    <!-- 礼盒特效 -->
    <view class="bottom-box">
        <view class="gift1"></view> 
        <view class="gift2"></view> 
        <view class="gift3"></view> 
        <view class="particle"></view> 
    </view>
  </view>


</view>
````

## File: pages/luckyWheel/wait/wait.wxss
````
.wait {
  position: absolute;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/game-start-bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
}
.wait .rule-title {
  position: absolute;
  top: 146.154rpx;
  left: 50%;
  transform: translateX(-50%);
  width: 236.539rpx;
  height: 61.019rpx;
}
.wait .rule-title .rule-title-img {
  width: 100%;
  height: 100%;
}
.wait .rule {
  position: relative;
  width: 750rpx;
  height: 1046rpx;
  background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/rule-bg.png");
  background-size: 100% 100%;
}
.wait .rule .rule-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}
.wait .rule .rule-item-content {
  position: absolute;
  width: 640rpx;
  top: 220rpx;
  left:60rpx;
  padding:0rpx 30rpx;
}
.wait .rule .rule-item-content .p {
  border-bottom: 1px dashed #fff;
  padding-bottom: 25rpx;
  margin-bottom: 25.308rpx;
  font-family: Noto Sans SC;
  font-size: 34.616rpx;
  font-weight: 500;
  line-height: 48.077rpx;
  color: #fff;
}
.wait .wait-start {
  position: absolute;
  top: 876.923rpx;
  left: 50%;
  width: 333.692rpx;
  height:126.616rpx;
  font-size: 55rpx;
  font-family: Noto sans SC;
  text-align: center;
  color: #fff;
  z-index: 2;
  animation: breathe 0.4s ease-in-out infinite alternate;
}
@keyframes breathe {
  from {
    transform: translateX(-50%) scale(1);
  }
  to {
    transform: translateX(-50%) scale(1.05);
  }
}
.wait .wait-start .wait-start-bg {
  position: absolute;
  display: block;
  width: 100%;
  height: 100%;
  z-index: -1;
}
.wait .bottom-box{
    position: relative;
    width: 100%;
    height: 300rpx;
}
.particle{
    width: 750rpx;
    height: 480rpx;
    position: absolute;
    bottom: 0rpx;
    left:0rpx;
    background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/particle1.png");
    background-size: 100% 100%;
    z-index: 1;
}
.gift1{
    width: 285rpx;
    height: 285rpx;
    position: absolute;
    bottom: 20rpx;
    left:230rpx;
    background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/small-gift1.png");
    background-size: 100% 100%;
    animation: shake 1.2s infinite ease-in-out;
}

@keyframes shake {
  0% { transform: rotate(0deg);}
  20% { transform: rotate(-6deg);}
  40% { transform: rotate(6deg);}
  60% { transform: rotate(-4deg);}
  80% { transform: rotate(4deg);}
  100% { transform: rotate(0deg);}
}

.gift2 {
    width: 113rpx;
    height: 115rpx;
    position: absolute;
    bottom: 50rpx;
    left: 600rpx;
    background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/small-gift2.png");
    background-size: 100% 100%;
    animation: shake2 1s infinite ease-in-out;
}
@keyframes shake2 {
    0% { transform: rotate(0deg);}
    25% { transform: rotate(4deg);}
    50% { transform: rotate(-4deg);}
    75% { transform: rotate(4deg);}
    100% { transform: rotate(0deg);}
}

.gift3 {
    width: 164rpx;
    height: 173rpx;
    position: absolute;
    bottom: 60rpx;
    left: 0rpx;
    background-image: url("https://ustatic.hudongmiao.com/joymewMp/luckyWheelNew/small-gift3.png");
    background-size: 100% 100%;
    animation: shake3 1.5s infinite ease-in-out;
}
@keyframes shake3 {
    0% { transform: rotate(0deg) translateY(0);}
    20% { transform: rotate(8deg) translateY(-8rpx);}
    40% { transform: rotate(-8deg) translateY(8rpx);}
    60% { transform: rotate(6deg) translateY(-6rpx);}
    80% { transform: rotate(-6deg) translateY(6rpx);}
    100% { transform: rotate(0deg) translateY(0);}
}
````

## File: utils/tween.js
````javascript
module.exports = (function () {
  var __MODS__ = {};
  var __DEFINE__ = function (modId, func, req) {
    var m = {
      exports: {},
      _tempexports: {}
    };
    __MODS__[modId] = {
      status: 0,
      func: func,
      req: req,
      m: m
    };
  };
  var __REQUIRE__ = function (modId, source) {
    if (!__MODS__[modId]) return require(source);
    if (!__MODS__[modId].status) {
      var m = __MODS__[modId].m;
      m._exports = m._tempexports;
      var desp = Object.getOwnPropertyDescriptor(m, "exports");
      if (desp && desp.configurable) Object.defineProperty(m, "exports", {
        set: function (val) {
          if (typeof val === "object" && val !== m._exports) {
            m._exports.__proto__ = val.__proto__;
            Object.keys(val).forEach(function (k) {
              m._exports[k] = val[k];
            });
          }
          m._tempexports = val
        },
        get: function () {
          return m._tempexports;
        }
      });
      __MODS__[modId].status = 1;
      __MODS__[modId].func(__MODS__[modId].req, m, m.exports);
    }
    return __MODS__[modId].m.exports;
  };
  var __REQUIRE_WILDCARD__ = function (obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};
      if (obj != null) {
        for (var k in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k];
        }
      }
      newObj.default = obj;
      return newObj;
    }
  };
  var __REQUIRE_DEFAULT__ = function (obj) {
    return obj && obj.__esModule ? obj.default : obj;
  };
  __DEFINE__(1698738435262, function (require, module, exports) {
    /**
     * Tween.js - Licensed under the MIT license
     * https://github.com/tweenjs/tween.js
     * ----------------------------------------------
     *
     * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.
     * Thank you all, you're awesome!
     */


    var _Group = function () {
      this._tweens = {};
      this._tweensAddedDuringUpdate = {};
    };

    _Group.prototype = {
      getAll: function () {

        return Object.keys(this._tweens).map(function (tweenId) {
          return this._tweens[tweenId];
        }.bind(this));

      },

      removeAll: function () {

        this._tweens = {};

      },

      add: function (tween) {

        this._tweens[tween.getId()] = tween;
        this._tweensAddedDuringUpdate[tween.getId()] = tween;

      },

      remove: function (tween) {

        delete this._tweens[tween.getId()];
        delete this._tweensAddedDuringUpdate[tween.getId()];

      },

      update: function (time, preserve) {

        var tweenIds = Object.keys(this._tweens);

        if (tweenIds.length === 0) {
          return false;
        }

        time = time !== undefined ? time : TWEEN.now();

        // Tweens are updated in "batches". If you add a new tween during an update, then the
        // new tween will be updated in the next batch.
        // If you remove a tween during an update, it may or may not be updated. However,
        // if the removed tween was added during the current batch, then it will not be updated.
        while (tweenIds.length > 0) {
          this._tweensAddedDuringUpdate = {};

          for (var i = 0; i < tweenIds.length; i++) {

            var tween = this._tweens[tweenIds[i]];

            if (tween && tween.update(time) === false) {
              tween._isPlaying = false;

              if (!preserve) {
                delete this._tweens[tweenIds[i]];
              }
            }
          }

          tweenIds = Object.keys(this._tweensAddedDuringUpdate);
        }

        return true;

      }
    };

    var TWEEN = new _Group();

    TWEEN.Group = _Group;
    TWEEN._nextId = 0;
    TWEEN.nextId = function () {
      return TWEEN._nextId++;
    };


    // Include a performance.now polyfill.
    // In node.js, use process.hrtime.
    if (typeof (self) === 'undefined' && typeof (process) !== 'undefined' && process.hrtime) {
      TWEEN.now = function () {
        var time = process.hrtime();

        // Convert [seconds, nanoseconds] to milliseconds.
        return time[0] * 1000 + time[1] / 1000000;
      };
    }
    // In a browser, use self.performance.now if it is available.
    else if (typeof (self) !== 'undefined' &&
      self.performance !== undefined &&
      self.performance.now !== undefined) {
      // This must be bound, because directly assigning this function
      // leads to an invocation exception in Chrome.
      TWEEN.now = self.performance.now.bind(self.performance);
    }
    // Use Date.now if it is available.
    else if (Date.now !== undefined) {
      TWEEN.now = Date.now;
    }
    // Otherwise, use 'new Date().getTime()'.
    else {
      TWEEN.now = function () {
        return new Date().getTime();
      };
    }


    TWEEN.Tween = function (object, group) {
      this._object = object;
      this._valuesStart = {};
      this._valuesEnd = {};
      this._valuesStartRepeat = {};
      this._duration = 1000;
      this._repeat = 0;
      this._repeatDelayTime = undefined;
      this._yoyo = false;
      this._isPlaying = false;
      this._reversed = false;
      this._delayTime = 0;
      this._startTime = null;
      this._easingFunction = TWEEN.Easing.Linear.None;
      this._interpolationFunction = TWEEN.Interpolation.Linear;
      this._chainedTweens = [];
      this._onStartCallback = null;
      this._onStartCallbackFired = false;
      this._onUpdateCallback = null;
      this._onRepeatCallback = null;
      this._onCompleteCallback = null;
      this._onStopCallback = null;
      this._group = group || TWEEN;
      this._id = TWEEN.nextId();

    };

    TWEEN.Tween.prototype = {
      getId: function () {
        return this._id;
      },

      isPlaying: function () {
        return this._isPlaying;
      },

      to: function (properties, duration) {

        this._valuesEnd = Object.create(properties);

        if (duration !== undefined) {
          this._duration = duration;
        }

        return this;

      },

      duration: function duration(d) {
        this._duration = d;
        return this;
      },

      start: function (time) {

        this._group.add(this);

        this._isPlaying = true;

        this._onStartCallbackFired = false;

        this._startTime = time !== undefined ? typeof time === 'string' ? TWEEN.now() + parseFloat(time) : time : TWEEN.now();
        this._startTime += this._delayTime;

        for (var property in this._valuesEnd) {

          // Check if an Array was provided as property value
          if (this._valuesEnd[property] instanceof Array) {

            if (this._valuesEnd[property].length === 0) {
              continue;
            }

            // Create a local copy of the Array with the start value at the front
            this._valuesEnd[property] = [this._object[property]].concat(this._valuesEnd[property]);

          }

          // If `to()` specifies a property that doesn't exist in the source object,
          // we should not set that property in the object
          if (this._object[property] === undefined) {
            continue;
          }

          // Save the starting value.
          this._valuesStart[property] = this._object[property];

          if ((this._valuesStart[property] instanceof Array) === false) {
            this._valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings
          }

          this._valuesStartRepeat[property] = this._valuesStart[property] || 0;

        }

        return this;

      },

      stop: function () {

        if (!this._isPlaying) {
          return this;
        }

        this._group.remove(this);
        this._isPlaying = false;

        if (this._onStopCallback !== null) {
          this._onStopCallback(this._object);
        }

        this.stopChainedTweens();
        return this;

      },

      end: function () {

        this.update(Infinity);
        return this;

      },

      stopChainedTweens: function () {

        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {
          this._chainedTweens[i].stop();
        }

      },

      group: function (group) {
        this._group = group;
        return this;
      },

      delay: function (amount) {

        this._delayTime = amount;
        return this;

      },

      repeat: function (times) {

        this._repeat = times;
        return this;

      },

      repeatDelay: function (amount) {

        this._repeatDelayTime = amount;
        return this;

      },

      yoyo: function (yoyo) {

        this._yoyo = yoyo;
        return this;

      },

      easing: function (easingFunction) {

        this._easingFunction = easingFunction;
        return this;

      },

      interpolation: function (interpolationFunction) {

        this._interpolationFunction = interpolationFunction;
        return this;

      },

      chain: function () {

        this._chainedTweens = arguments;
        return this;

      },

      onStart: function (callback) {

        this._onStartCallback = callback;
        return this;

      },

      onUpdate: function (callback) {

        this._onUpdateCallback = callback;
        return this;

      },

      onRepeat: function onRepeat(callback) {

        this._onRepeatCallback = callback;
        return this;

      },

      onComplete: function (callback) {

        this._onCompleteCallback = callback;
        return this;

      },

      onStop: function (callback) {

        this._onStopCallback = callback;
        return this;

      },

      update: function (time) {

        var property;
        var elapsed;
        var value;

        if (time < this._startTime) {
          return true;
        }

        if (this._onStartCallbackFired === false) {

          if (this._onStartCallback !== null) {
            this._onStartCallback(this._object);
          }

          this._onStartCallbackFired = true;
        }

        elapsed = (time - this._startTime) / this._duration;
        elapsed = (this._duration === 0 || elapsed > 1) ? 1 : elapsed;

        value = this._easingFunction(elapsed);

        for (property in this._valuesEnd) {

          // Don't update properties that do not exist in the source object
          if (this._valuesStart[property] === undefined) {
            continue;
          }

          var start = this._valuesStart[property] || 0;
          var end = this._valuesEnd[property];

          if (end instanceof Array) {

            this._object[property] = this._interpolationFunction(end, value);

          } else {

            // Parses relative end values with start as base (e.g.: +10, -3)
            if (typeof (end) === 'string') {

              if (end.charAt(0) === '+' || end.charAt(0) === '-') {
                end = start + parseFloat(end);
              } else {
                end = parseFloat(end);
              }
            }

            // Protect against non numeric properties.
            if (typeof (end) === 'number') {
              this._object[property] = start + (end - start) * value;
            }

          }

        }

        if (this._onUpdateCallback !== null) {
          this._onUpdateCallback(this._object, elapsed);
        }

        if (elapsed === 1) {

          if (this._repeat > 0) {

            if (isFinite(this._repeat)) {
              this._repeat--;
            }

            // Reassign starting values, restart by making startTime = now
            for (property in this._valuesStartRepeat) {

              if (typeof (this._valuesEnd[property]) === 'string') {
                this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);
              }

              if (this._yoyo) {
                var tmp = this._valuesStartRepeat[property];

                this._valuesStartRepeat[property] = this._valuesEnd[property];
                this._valuesEnd[property] = tmp;
              }

              this._valuesStart[property] = this._valuesStartRepeat[property];

            }

            if (this._yoyo) {
              this._reversed = !this._reversed;
            }

            if (this._repeatDelayTime !== undefined) {
              this._startTime = time + this._repeatDelayTime;
            } else {
              this._startTime = time + this._delayTime;
            }

            if (this._onRepeatCallback !== null) {
              this._onRepeatCallback(this._object);
            }

            return true;

          } else {

            if (this._onCompleteCallback !== null) {

              this._onCompleteCallback(this._object);
            }

            for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {
              // Make the chained tweens start exactly at the time they should,
              // even if the `update()` method was called way past the duration of the tween
              this._chainedTweens[i].start(this._startTime + this._duration);
            }

            return false;

          }

        }

        return true;

      }
    };


    TWEEN.Easing = {

      Linear: {

        None: function (k) {

          return k;

        }

      },

      Quadratic: {

        In: function (k) {

          return k * k;

        },

        Out: function (k) {

          return k * (2 - k);

        },

        InOut: function (k) {

          if ((k *= 2) < 1) {
            return 0.5 * k * k;
          }

          return -0.5 * (--k * (k - 2) - 1);

        }

      },

      Cubic: {

        In: function (k) {

          return k * k * k;

        },

        Out: function (k) {

          return --k * k * k + 1;

        },

        InOut: function (k) {

          if ((k *= 2) < 1) {
            return 0.5 * k * k * k;
          }

          return 0.5 * ((k -= 2) * k * k + 2);

        }

      },

      Quartic: {

        In: function (k) {

          return k * k * k * k;

        },

        Out: function (k) {

          return 1 - (--k * k * k * k);

        },

        InOut: function (k) {

          if ((k *= 2) < 1) {
            return 0.5 * k * k * k * k;
          }

          return -0.5 * ((k -= 2) * k * k * k - 2);

        }

      },

      Quintic: {

        In: function (k) {

          return k * k * k * k * k;

        },

        Out: function (k) {

          return --k * k * k * k * k + 1;

        },

        InOut: function (k) {

          if ((k *= 2) < 1) {
            return 0.5 * k * k * k * k * k;
          }

          return 0.5 * ((k -= 2) * k * k * k * k + 2);

        }

      },

      Sinusoidal: {

        In: function (k) {

          return 1 - Math.cos(k * Math.PI / 2);

        },

        Out: function (k) {

          return Math.sin(k * Math.PI / 2);

        },

        InOut: function (k) {

          return 0.5 * (1 - Math.cos(Math.PI * k));

        }

      },

      Exponential: {

        In: function (k) {

          return k === 0 ? 0 : Math.pow(1024, k - 1);

        },

        Out: function (k) {

          return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);

        },

        InOut: function (k) {

          if (k === 0) {
            return 0;
          }

          if (k === 1) {
            return 1;
          }

          if ((k *= 2) < 1) {
            return 0.5 * Math.pow(1024, k - 1);
          }

          return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);

        }

      },

      Circular: {

        In: function (k) {

          return 1 - Math.sqrt(1 - k * k);

        },

        Out: function (k) {

          return Math.sqrt(1 - (--k * k));

        },

        InOut: function (k) {

          if ((k *= 2) < 1) {
            return -0.5 * (Math.sqrt(1 - k * k) - 1);
          }

          return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);

        }

      },

      Elastic: {

        In: function (k) {

          if (k === 0) {
            return 0;
          }

          if (k === 1) {
            return 1;
          }

          return -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);

        },

        Out: function (k) {

          if (k === 0) {
            return 0;
          }

          if (k === 1) {
            return 1;
          }

          return Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;

        },

        InOut: function (k) {

          if (k === 0) {
            return 0;
          }

          if (k === 1) {
            return 1;
          }

          k *= 2;

          if (k < 1) {
            return -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);
          }

          return 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;

        }

      },

      Back: {

        In: function (k) {

          var s = 1.70158;

          return k * k * ((s + 1) * k - s);

        },

        Out: function (k) {

          var s = 1.70158;

          return --k * k * ((s + 1) * k + s) + 1;

        },

        InOut: function (k) {

          var s = 1.70158 * 1.525;

          if ((k *= 2) < 1) {
            return 0.5 * (k * k * ((s + 1) * k - s));
          }

          return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);

        }

      },

      Bounce: {

        In: function (k) {

          return 1 - TWEEN.Easing.Bounce.Out(1 - k);

        },

        Out: function (k) {

          if (k < (1 / 2.75)) {
            return 7.5625 * k * k;
          } else if (k < (2 / 2.75)) {
            return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;
          } else if (k < (2.5 / 2.75)) {
            return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;
          } else {
            return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;
          }

        },

        InOut: function (k) {

          if (k < 0.5) {
            return TWEEN.Easing.Bounce.In(k * 2) * 0.5;
          }

          return TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;

        }

      }

    };

    TWEEN.Interpolation = {

      Linear: function (v, k) {

        var m = v.length - 1;
        var f = m * k;
        var i = Math.floor(f);
        var fn = TWEEN.Interpolation.Utils.Linear;

        if (k < 0) {
          return fn(v[0], v[1], f);
        }

        if (k > 1) {
          return fn(v[m], v[m - 1], m - f);
        }

        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);

      },

      Bezier: function (v, k) {

        var b = 0;
        var n = v.length - 1;
        var pw = Math.pow;
        var bn = TWEEN.Interpolation.Utils.Bernstein;

        for (var i = 0; i <= n; i++) {
          b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);
        }

        return b;

      },

      CatmullRom: function (v, k) {

        var m = v.length - 1;
        var f = m * k;
        var i = Math.floor(f);
        var fn = TWEEN.Interpolation.Utils.CatmullRom;

        if (v[0] === v[m]) {

          if (k < 0) {
            i = Math.floor(f = m * (1 + k));
          }

          return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);

        } else {

          if (k < 0) {
            return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);
          }

          if (k > 1) {
            return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);
          }

          return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);

        }

      },

      Utils: {

        Linear: function (p0, p1, t) {

          return (p1 - p0) * t + p0;

        },

        Bernstein: function (n, i) {

          var fc = TWEEN.Interpolation.Utils.Factorial;

          return fc(n) / fc(i) / fc(n - i);

        },

        Factorial: (function () {

          var a = [1];

          return function (n) {

            var s = 1;

            if (a[n]) {
              return a[n];
            }

            for (var i = n; i > 1; i--) {
              s *= i;
            }

            a[n] = s;
            return s;

          };

        })(),

        CatmullRom: function (p0, p1, p2, p3, t) {

          var v0 = (p2 - p0) * 0.5;
          var v1 = (p3 - p1) * 0.5;
          var t2 = t * t;
          var t3 = t * t2;

          return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;

        }

      }

    };

    // UMD (Universal Module Definition)
    (function (root) {

      if (typeof define === 'function' && define.amd) {

        // AMD
        define([], function () {
          return TWEEN;
        });

      } else if (typeof module !== 'undefined' && typeof exports === 'object') {

        // Node.js
        module.exports = TWEEN;

      } else if (root !== undefined) {

        // Global variable
        root.TWEEN = TWEEN;

      }

    })(this);

  }, function (modId) {
    var map = {};
    return __REQUIRE__(map[modId], modId);
  })
  return __REQUIRE__(1698738435262);
})()
````

## File: api/comment/comment.js
````javascript
import { $request, request } from "../../utils/request";

// 获取我的评价 及主持人信息
export function getHostInfo({ splid }) {
  return $request("splidComment/getMyComment", "POST", {
    splid,
  });
}

// 进行评价
export function commitComment({
  splid,
  // nickname,
  // avatar,
  content,
  label,
  satisfaction,
}) {
  return $request("splidComment/saveUserComment", "POST", {
    splid,
    // nickname,
    // avatar,
    content,
    type: "3", //场次评论
    label,
    satisfaction,
  });
}

// 获取评价汇总信息，
export function getHostCommentBase({ splid }) {
  return $request("splidComment/getUserComment", "POST", {
    splid,
  });
}

// 获取所欲评价用户评价列表
export function getHostCommentList({ splid, currentPage, showCount }) {
  return $request("splidComment/getCommentList", "POST", {
    splid,
    type: "3", //场次评价
    currentPage,
    showCount,
  });
}

// 打赏主持
export function Reward({ splid, totalfee}) {
  return request("hmWxmoney/chongzhiReward", "POST", {
    splid,
    totalfee,    
    // USER_ID,
    // openid,
  });
}


/**
 * 回复
 */
 export function replyUser({ album_comment_id, content, splid }) {
  return $request('splidComment/saveUserComment2', 'POST', {
    type: '5', // 4 司仪   5 用户
    content,
    album_comment_id,
    splid,
  });
}
const TEMPLATEID = 'UTCMF0gyzmJ3VJnAnXCHBYfeJKj-ehZXmNAeyegsTmg';
// const TEMPLATEID3 = 'UTCMF0gyzmJ3VJnAnXCHBYfeJKj-ehZXmNAeyegsTmg';
//询问订阅消息
export function getSubscribeMessage(sceneType) {
  return new Promise((resolve, reject) => {
    let type = TEMPLATEID;
    // if (sceneType === '0') {
    //   type = TEMPLATEID;
    // } else {
    //   type = TEMPLATEID3;
    // }
    wx.requestSubscribeMessage({
      tmplIds: [type],
      success: result => {
        resolve(result[type]);
      },
      fail: (err) => {
        reject(err);
      },
    });
  });
}

// 预定主持
export function reserveHost(pObj) {
  return $request('schedule/save', 'POST', pObj);
}

// 获取预定信息
export function getReserveInfo(splid) {
  return $request('schedule/getUserSchedule', 'POST', {
    splid,
  });
}

// 保存访问信息
export function saveVisitInfo({
  splid,
  album_comment_id,
  start_time,
  end_time,
  time_length,
}) {
  return $request('splidComment/updateComment', 'POST', {
    splid,
    album_comment_id,
    start_time,
    end_time,
    time_length,
  });
}


// 现场回顾
// ?size=100&num=1&type=1&splid=d8257eecb950428488aca95aadd7c7bd
export function getReview({
  splid,
  size,
  num,
}) {
  return request('subscribeController/getMyLoveInfo', 'POST', {
    splid,
    size: String(size),
    num: String(num),
    type:'1',
  });
}

// 幸福值排行
//https://hm.hudongmiao.com/
//?splid=d8257eecb950428488aca95aadd7c7bd
export function getReviewRank(splid) {
  return request('subscribeController/getMyLoveList', 'POST', {
    splid,
  });
}

//照片礼物
//https://hm.hudongmiao.com/
//?splid=d8257eecb950428488aca95aadd7c7bd
export function sendGift({
  splid,
  img,
  msg,
}) {
  return request('sendMsgController/liwuGo6', 'POST', {
    splid,
    liwuId: 'Miao_PhotoWall',
    content:msg,
    tpUrl: img,
    times: 10,
    kind:'1'
  });
}
// 弹幕礼物
//https://hm.hudongmiao.com/
//?splid=d8257eecb950428488aca95aadd7c7bd
export function sendDanmu({splid , msg}) {
  return request('sendMsgController/msgGo6', 'POST', {
    content: msg,
    color: '0',
    splid,
    kind:'1'
  });
}

// 弹幕礼物
//https://hm.hudongmiao.com/
//?splid=d8257eecb950428488aca95aadd7c7bd
export function getQNToken() {
  return $request('dengLuHm/getQiniuToken', 'POST', {
  });
}


// 获取嗨喵福利内容
export function getMewRewards() {
  return $request('splidComment/getAdvertInfo', 'POST', {});
}
````

## File: api/comment/draw.js
````javascript
import { $request, requestH5,  } from "../../utils/request";

// 获取抽奖列表
export function getLotteryInfo() {
  return $request("kpComment/getLotteryInfo", "POST", {
    lotteryId: '1',
  });
}
// 获取抽奖详情
export function getLotteryDetail({lotteryId}) {
  return $request("kpComment/getLotteryInfoById", "POST", {
    lotteryId,
  });
}

// 参与抽奖
export function saveLotteryInfo({lotteryId}) {
  // const now = new Date()
  // const hours = now.getHours()
  // const minutes = now.getMinutes()
  // const add0 = (num) => num>9?num:'0'+ String(num)
  // const time = `${add0(hours)}:${add0(minutes)}`
  return $request("kpComment/saveLotteryInfo", "POST", {
    // lotteryId: '1',
    lotteryId,
    // time,
  });
}

/**
 * 获取中奖记录
 * @param {string} splid
 * @returns {Promise<{
 *  data: {
 * newestLotteryId: string; // 最新一次抽奖的id
 * myWinningRecordList: Array<{
 * id: number;
 * awardname: string;
 * piclink: string;
 * prize_name: null | string;
 * }> // 我的中奖记录
 * winningRecordList: Array<{
 * awardname: string;
 * cusaward_id: number;
 * kind: string;
 * piclink: string;
 * prize_name?: string;
 * rank: string;
 * splid: string;
 * winnerList: Array<{
 * avator?: string;
 * category: string;
 * create_time: string;
 * grade: string;
 * id: string;
 * notdraw: string;
 * phone_show: string;
 * splid: string;
 * userId: string;
 * wx_name: string;
 * }>;
 * }>;
 * }
 *  message: string;
 *  statusCode: string;
 *  success: boolean;
 * }}
 */
export const reqGetWinningRecord = (splid) => {
  return requestH5('dice/getWinningRecord', 'GET', {
    splid,
    cancelLoading: true,
  });
};
````

## File: api/feedback/feedback.js
````javascript
import { request,requestUpload } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 提交反馈
export function submitFeedback(paramObj) {
    return request('wxScan/commandInfo6', 'POST', {
        userId: paramObj.userId,
        content: paramObj.desc,
        phone_number: paramObj.phone,
        reason: paramObj.type,
        splid: getLiveId(),
        piclink: paramObj.imgurl,
    });
}

// 上传反馈图片
export function uploadFeedbackImg(path) {
    return requestUpload('beiJing/shangchuanTomcat', path);
}

// 选择图片
export function wxChooseImage(uploaderNum) {
    return new Promise((resolve, reject) => {
        wx.chooseImage({
            count: 3 - uploaderNum,
            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
            success: (res) => {
                resolve(res);
            },
            fail: (err) => {
                reject(err);
            },
        })
    });
}
````

## File: api/gift.js
````javascript
import {
  request
} from '../utils/request'

/**
 * 获取礼物列表
 * @param {String} liveId 活动id
 * @returns
 */
export function reqGetGiftList(splid) {
  return request("hmGiftController/listGift7", "GET", {
    splid,
  });
}

/**
 * 获取签到排名(送祝福排名)
 */
export function reqGetSignRankList(splid) {
  return request("hmGiftController/findGiftRankListAll", "GET", {
    splid,
  });
}

/**
 * 发礼物
 */
export function reqSendGift({
  splid,
  giftId
}) {
  return request("hmGiftController/sendGift6", "POST", {
    splid,
    giftconst: giftId,
  });
}

/**
 * 发礼物广播
 * @param {string} giftId
 * @param {string} content 文本内容
 * @param {string} imgUrl 图片
 * @param {string} times 照片礼物时间
 */
export function reqSendGiftBroadCast({
  giftId,
  content,
  imgUrl,
  times
}) {
  const tempObj = {
    liwuId: giftId,
    content,
    tpUrl: imgUrl,
    times,
  };
  const targetObj = {
    splid: wx.getStorageSync('liveId')
  }
  for (let key in tempObj) {
    if (tempObj[key]) {
      targetObj[key] = tempObj[key];
    }
  }
  return request('sendMsgController/liwuGo6', 'POST', targetObj);
}

/**
 * 发喵钻红包
 * @param {string} total 喵钻金额
 * @param {string} size 喵钻发送给多少人
 * @param {string} type 喵钻红包类型
 * 
 */
export function reqSendDiamondHb({
  total,
  size,
  type
}) {
  return request("redPackage/sendRedPackage", "POST", {
    splid: wx.getStorageSync('liveId'),
    total,
    size,
    type,
  });
}

/**
 * 修改个人信息
 */
export function reqEditUserInfo({
  wx_name = '',
  avator = '',
  table_number = '',
  position = '',
  type = ''
}) {
  return request('hmGiftController/editUserInfo', 'POST', {
    wx_name,
    avator,
    table_number,
    position,
    type,
    splid: wx.getStorageSync('liveId'),
  });
}

/**
 * 购买进场特效
 */
export function reqBuyVipEnterEffect(giftId) {
  return request('hmGiftController/buyVipJc', 'POST', {
    giftconst: giftId,
    splid: wx.getStorageSync('liveId'),
  });
}


/**
 * 获取抽奖机会
 */
export function reqGetSendGiftChance() {
  return request('giftLotteryController/getChance', 'POST', {
    splid: wx.getStorageSync('liveId'),
  });
}

/**
 * 发礼物抽奖
 * id和queryType都是获取抽奖机会接口返回的
 */
export function reqSendGiftLottery({id,queryType}) {
  return request('giftLotteryController/useChance', 'POST', {
    splid: wx.getStorageSync('liveId'),
    id,
    queryType,
  });
}

/**
 * 用掉发礼物的机会
 */
export function reqUpdateSendGiftStatus({id,queryType}) {
  return request('giftLotteryController/updateStatus', 'POST', {
    splid: wx.getStorageSync('liveId'),
    id,
    queryType,
  });
}
````

## File: api/guessHb/guessHb.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 获取猜红包状态
export function getGuessInfo(cancelLoading) {
    return request('guessRedPackage/getGuessInfo', 'POST', {
        splid: getLiveId(),
        cancelLoading,
    });
}

// 参与猜红包
export function attendGuess(pObj) {
    return request('guessRedPackage/robRedPackage', 'POST', {
        splid: getLiveId(),
        sort: pObj.sort,
        rob_sort: pObj.robSort,
        guess_money: pObj.guessMoney,
        red_package_id: pObj.hbId,
    });
}

// 猜红包充值
export function guessHbRecharge(paramObj) {
    return request('hmWxmoney/chongzhiKbx', 'POST', {
        splid: getLiveId(),
        giftId: 'guess',
        userId: paramObj.userId,
        openid: paramObj.openid,
        total: paramObj.money,
    });
}
````

## File: api/hbkdRecharge/hbkdRecharge.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 红包口袋充值
export function rechageHbkd(paramObj) {
    return request('hmWxmoney/chongZhiRedB', 'POST', {
        splid: getLiveId(),
        totalfee: paramObj.total,
        USER_ID: paramObj.userId,
        openid: paramObj.openId,
    });
}
// 红包口袋列表
export function getHbkdList() {
    return request('hbkd/shenLuoTianZheng6', 'POST', {
        splid: getLiveId(),
    });
}
````

## File: api/index/index.js
````javascript
import { request, $request, requestH5 } from '../../utils/request';
import { getLiveId } from '../../utils/storage';

const app = getApp();
//验证司仪
export function validateEmcee() {
  return request('emceeUser/validate', 'POST', {});
}

//获取活动信息
export function getLiveInfo(liveId) {
  return request('wxScan/saiYaRen', 'POST', {
    splid: liveId ? liveId : getLiveId(),
  });
}

//充值(测试方法)
export function recharge(money) {
  return new Promise((resolve, reject) => {
    request('hmWxmoney/chongzhiMiao', 'post', {
      total: money,
      userId: wx.getStorageSync('userId'),
      openid: wx.getStorageSync('openId'),
    })
      .then(res1 => {
        return pay(res1);
      })
      .then(res2 => {
        resolve(res2);
      })
      .catch(err => {
        console.log(err);
        reject(err);
      });
  });
}

//支付(测试方法)
export function pay(param) {
  return new Promise((resolve, reject) => {
    wx.requestPayment({
      timeStamp: param.obj.timeStamp,
      nonceStr: param.obj.nonceStr,
      package: param.obj.package,
      signType: 'MD5',
      paySign: param.obj.paySign,
      success: function(res) {
        console.log(res);
        resolve(res);
      },
      fail: function(res) {
        reject(res);
      },
    });
  });
}

// 获取签到状态
export function getSignInState() {
  return request('hmScanReportController/getQianDaoInfo', 'GET', {
    splid: getLiveId(),
  });
}
// 签到
export function signIn(paramObj) {
  return request('hmScanReportController/qianDao', 'POST', {
    avator: paramObj.avator || app.globalData.userInfo.avatarUrl,
    splid: getLiveId(),
    bless_str: paramObj.wish,
    wx_name: paramObj.name,
    phonenumber: paramObj.userPhone ? paramObj.userPhone : '',
    type: paramObj.role,
    table_number: paramObj.deskNum,
    birthDate: paramObj.birthDate,
    gender: paramObj.gender,
  });
}

// 订阅消息
export function addSubscribeSize() {
  return request('subscribeController/addSubscribeSize', 'POST', {});
}

// userId换取liveId
export function getLiveIdByUserId(userId) {
  return $request('fixed/getQrcode', 'POST', {
    userId,
  });
}

// 文本内容验证
export function securityMsgCheck(ct) {
  return request('subscribeController/msg_sec_check', 'POST', {
    content: ct,
    type: '1',
  });
}

// 获取聊天记录
export function getMsgInfo() {
  return requestH5('wxScan/getMsgInfo', 'GET', {
    splid: getLiveId(),
    num: 1,
    size: 30,
  });
}

// 发送聊天消息
export function sendChatMessage(message) {
  return requestH5('sendMsgController/msgGo6', 'POST', {
    splid: getLiveId(),
    content: message,
    color: 0,
  });
}

// 保存浏览记录
export function saveBrowseRecord(pObj) {
  return $request('book/saveBookInfo', 'POST', {
    ...pObj,
    cancelLoading: true
  });
}

// 保存签到信息(h5授权前调用)
export function saveSignInfo({
  splid = getLiveId(),
  bless_str = '',
  phonenumber = '',
  type = '',
  birthDate = '',
  gender = '',
  redirect_url = '',
  table_number = ''
}) {
  return request('hmScanReportController/saveQianDaoParam', 'POST', {
    splid,
    bless_str,
    phonenumber,
    type,
    birthDate,
    gender,
    redirect_url,
    table_number
  });
}

// 获取礼物列表
export function getGiftList() {
  return request('hmGiftController/listGift7', 'GET', {
    splid: getLiveId(),
  });
}
````

## File: api/kbx/kbx.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 开宝箱充值
export function kbxRecharge(paramObj) {
    return request('hmWxmoney/chongzhiKbx', 'POST', {
        splid: getLiveId(),
        giftId: 'kbx',
        userId: paramObj.userId,
        openid: paramObj.openid,
        total: paramObj.money,
    });
}

// 抢宝箱
export function robBox(paramObj) {
    return request('kakaluote/guipaiqigong6', 'POST', {
        splid: getLiveId(),
        boxIdList: paramObj.boxIds,
        order_by: paramObj.sort,
    });
}

// 获取宝箱列表
export function getBoxesList() {
    return request('kakaluote/chaojisaiyaren6', 'GET', {
        splid: getLiveId(),
    });
}

// 发送广播
export function sendBroadCast(paramObj) {
    return request('sendMsgController/duxin6', 'POST', {
        splid: getLiveId(),
        ykq_info: paramObj.c
    });
}

// 获取game状态
export function getGameState(userId) {
    return request('play/baiyan6', 'GET', {
        splid: getLiveId(),
        userId,
    });
}

// 获取我的宝箱
export function getMyBoxes() {
    return request('kakaluote/jianlai6', 'GET', {
        splid: getLiveId(),
    });
}

// 获取红包列表
export function getHbList(cancelLoading) {
    return request('hbqController/showHbqList6', 'GET', {
        splid: getLiveId(),
        cancelLoading,
    });
}

// 买红包
export function buyHb(paramObj) {
    return request('hbqController/hbqPay6', 'POST', {
        splid: getLiveId(),
        eggIdList: paramObj.hbIds,
        order_by: paramObj.sort,
    });
}

// 红包墙充值
export function hbqRecharge(paramObj) {
    return request('hmWxmoney/chongzhiKbx', 'POST', {
        splid: getLiveId(),
        giftId: 'hbq',
        userId: paramObj.userId,
        openid: paramObj.openid,
        total: paramObj.money,
    });
}

// 获取红包排行榜
export function getHbRankList() {
    return request('hbqController/hbqRankList6', 'GET', {
        splid: getLiveId(),
    });
}
````

## File: api/login.js
````javascript
import { request } from '../utils/request.js';
import { getLiveId } from '../utils/storage';
/**
 * 微信登录获取code
 */
export function wxLogin() {
  return new Promise((resolve, reject) => {
    wx.login({
      timeout: 10000,
      success: result => {
        resolve(result);
      },
      fail: () => {
        reject(1);
      },
    });
  });
}
/**
 * 用户授权
 */
export function authUser(paramObj) {
  let param;
  if (paramObj.userInfo) {
    param = {
      code: paramObj.code,
      userInfo: paramObj.userInfo,
      splid: getLiveId(),
    };
  } else {
    param = {
      code: paramObj.code,
      encryptedData: paramObj.encryptedData,
      iv: paramObj.iv,
      splid: getLiveId(),
    };
  }
  return request('wxScan/oauth_user6', 'POST', param);
}

// 用户授权new
export function authUserNew(code) {
  return request('wxScan/oauth_user7', 'POST', {
    code,
    cancelLoading: true
  });
}

/**
 * 获取用户信息
 * 
 */
export function wxGetUserInfo() {
  return new Promise((resolve, reject) => {
    wx.getUserInfo({
      lang: 'zh_CN',
      success: result => {
        resolve(result);
      },
      fail: () => {
        reject(1);
      },
    });
  });
}

export function wxGetUserInfoNew() {
  return new Promise((resolve, reject) => {
    wx.getUserProfile({
      lang: 'zh_CN',
      desc: '业务需要',
      success: result => {
        resolve(result);
      },
      fail: err => {
        reject(err);
      },
    });
  });
}
// 授权获取手机号(旧版获取手机号,需要提前login)
export function authGetPhoneMiaoShop(paramObj) {
  return request('wxScan/authPhoneMiao', 'POST', {
    encryptedData: paramObj.encryptedData,
    iv: paramObj.iv,
  });
}

// 授权获取手机号(新版获取手机号,不需要提前login)
export function authGetPhoneByCode(paramObj) {
  return request('wxScan/getPhoneNumber', 'POST', {
    code: paramObj.code,
    type: '3', // 4:嗨猫 3:婚礼堂 1:默认 2:婚礼人
    splid: getLiveId(),
  });
}

// 注销账号
export function logOff(splid) {
  return request('hmScanReportController/logOff', 'GET', {
    splid,
  });
}
````

## File: api/nyn/nyn.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 获取奖池金额
export function getPoolMoney() {
    return request('jianLai/luckyDbList6', 'GET', {
        splid: getLiveId(),
        cancelLoading: true,
    });
}
// 获取奖项列表
// export function getPrizeList() {
//     return request('jianLai/startData6', 'GET', {});
// }
// 获取扭一扭相关信息
export function getNynInfo() {
    return request('jianLai/getLuckyId6', 'GET', {
        splid: getLiveId(),
        playInfo: 'hdGame88',
    });
}
// 获取扭一扭排行榜列表
export function getNynRank() {
    return request('jianLai/luckyDbRank6', 'GET', {
        splid: getLiveId(),
    });
}
// 扭一扭充值
export function nynRecharge(paramObj) {
    return request('hmWxmoney/chongzhiNyn', 'POST', {
        splid: getLiveId(),
        giftId: 'one',
        USER_ID: paramObj.userId,
        openid: paramObj.openId,
    });
}
// 扭一扭开始
export function startNyn(paramObj) {
    return request('jianLai/niuyiniu6', 'POST', {
        splid: getLiveId(),
        playInfo: 'hdGame88',
        id: paramObj.turnId,
    });
}
// 扭一扭发送中奖信息
export function sendPrizeInfo(paramObj) {
    return request('jianLai/luoXuanWan6', 'POST', {
        type: '2',
        gold: paramObj.gold,
        balance: paramObj.remainCoin,
        splid: getLiveId(),
        id: paramObj.turnId,
    });
}
// 发送广播
export function sendBroadCast(paramObj) {
    return request('sendMsgController/duxin6', 'POST', {
        splid: getLiveId(),
        ykq_info: paramObj.c
    });
}
````

## File: api/recharge/recharge.js
````javascript
import { request, requestUpload } from '../../utils/request';
import { getLiveId } from '../../utils/storage';

// 获取发送礼物排行榜
export function getGiftRankList() {
    return request('hmGiftController/findGiftRankList6', 'GET', {
        splid: getLiveId(),
    });
}
// 获取男女方发送礼物排行榜
export function getRoleGiftRankList() {
    return request('hmGiftController/findGiftRankList7', 'GET', {
        splid: getLiveId(),
    });
}
// 发送礼物
export function sendGift({giftId, is_half_gift = ''}) {
    return request('hmGiftController/sendGift6', 'POST', {
        splid: getLiveId(),
        giftconst: giftId,
        is_half_gift,
    });
}
// 发送霸气弹幕礼物
export function sendDanmuGift(paramObj) {
    return request('hmGiftController/sendGift6', 'POST', {
        splid: getLiveId(),
        giftconst: paramObj.giftId,
        content: paramObj.giftWish,
        gift_source: paramObj.giftSource,
    });
}

// 发送礼物广播
export function sendGiftBroadCast(paramObj) {
    return request('sendMsgController/liwuGo6', 'POST', {
        splid: getLiveId(),
        liwuId: paramObj.giftId,
        content: paramObj.content || '',
    });
}
// 支付
export function diamondRecharge(paramObj) {
    return request('hmWxmoney/chongzhiMiao', 'POST', {
        total: paramObj.total,
        userId: paramObj.userId,
        openid: paramObj.openId,
    });
}

// 领取vip头像框
export function becomeVip() {
    return request('wxScan/becomeVip', 'POST', {
        miao_vip: 'vip1',
        splid: getLiveId(),
    });
}

// 选择图片
export function wxChooseImage() {
    return new Promise((resolve, reject) => {
        wx.chooseImage({
            count: 1,
            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
            success: (res) => {
                resolve(res);
            },
            fail: (err) => {
                reject(err);
            },
        })
    });
}

// 上传图片
export function uploadHeadImg(path) {
    return requestUpload('beiJing/shangchuanTomcat', path);
}

// 修改个人信息
export function editUserInfo(paramObj) {
    return request('hmGiftController/editUserInfo', 'POST', {
        wx_name: paramObj.wx_name,
        avator: paramObj.avator,
        table_number: paramObj.table_number || '',
        position: paramObj.position || '',
        type: paramObj.type || '',
        splid: getLiveId(),
    });
}

export function buyLivePhoto(livePhotoId) {
    return request('hmGiftController/buyPhoto', 'POST', {
        id: livePhotoId,
        splid: getLiveId(),
    });
}

// 送礼物游戏支付并发送
export function sendGiftGameRecharge({giftconst,openid, userId, content}) {
    return request('hmWxmoney/sendWishPay', 'POST', {
        giftconst,
        openid,
        userId,
        content,
        splid: getLiveId(),
    });
}

// 全屏特效支付并发送
export function sendSuperDanmuRecharge({giftconst,openid, userId, content}) {
    return request('hmWxmoney/sendSuperGift', 'POST', {
        giftconst,
        openid,
        userId,
        content,
        splid: getLiveId(),
    });
}
````

## File: api/system.js
````javascript
import { showWxToast } from '../utils/index'

const TEMPLATEID = 'UTCMF0gyzmJ3VJnAnXCHBYfeJKj-ehZXmNAeyegsTmg';
const TEMPLATEID2 = '9g7GI9bSASPDm3il5xvn-Iojh8CbON6Wjjk3nKEgGoc';

// 检查小程序更新
export function checkSystemUpdate() {
    const updateManager = wx.getUpdateManager()

    updateManager.onCheckForUpdate(function (res) {
        // 请求完新版本信息的回调
        console.log('onCheckForUpdate',res.hasUpdate)
    })

    updateManager.onUpdateReady(function () {
        wx.showModal({
            title: '更新提示',
            content: '新版本已经准备好，是否重启应用？',
            success: function (res) {
                if (res.confirm) {
                    // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
                    updateManager.applyUpdate()
                }
            }
        })
    })

    updateManager.onUpdateFailed(function () {
        // 新版本下载失败
        showWxToast('新版本下载失败!');
    })
}

//获取系统信息
export function getSystemInfo() {
    return new Promise((resolve, reject) => {
        wx.getSystemInfo({
            success: (result) => {
                resolve(result);
            },
            fail: () => {
                reject(1);
            }
        });
    })
}

//获取用户的当前设置(是否授权过等信息)
export function getSetting() {
    return new Promise((resolve, reject) => {
        wx.getSetting({
            success: (result) => {
                resolve(result);
            },
            fail: () => {
                reject(1);
            }
        });
    })
}

//询问订阅消息
export function getSubscribeMessage() {
    return new Promise((resolve, reject) => {
        wx.requestSubscribeMessage({
            tmplIds: [TEMPLATEID,TEMPLATEID2],
            success: (result) => {
                resolve(result[TEMPLATEID]);
            },
            fail: () => {
                reject(1);
            }
        });
    })
}

// 下载文件
export function wxDownloadFile(filePath) {
    return new Promise((resolve,reject) => {
        wx.downloadFile({
            url: filePath,
            success: (res) => {
                resolve(res);
            },
            fail: (err) => {
                reject(err);
            },
        });
    });
}

// 文件保存到相册
export function wxSaveFileToAlbum(tmpFilePath) {
    return new Promise((resolve,reject) => {
        wx.saveImageToPhotosAlbum({
            filePath: tmpFilePath,
            success: (res) => {
                resolve(res);
            },
            fail: (err) => {
                reject(err);
            },
        });
    });
}
````

## File: api/weddingMan/index.js
````javascript
import { $request } from '../../utils/request';


// 进行评价
export function getUserInfo(id, userType) {
  //userType 1 表示司仪用户  3 表示婚礼人用户  2 表示当前互动用户
  return $request('qiMiao/getOhterUserInfo', 'GET', {
		obj_userId: String(id),
		user_type: String(userType)
  });
}



// 获取用户的作品列表
export function getCaseList(id) {
  return $request('qiMiao/getCaseList', 'GET', {
		obj_userId: id
  });
}

// getUserInfo,
// getCaseList,
// addBrowses,
// getUserComments,
// 获取评价列表
export function getUserComments(paramObj) {
  return $request('splidComment/getMyCommentList', 'GET', {
		is_need_label: '1',
		type: '3',
		currentPage: paramObj.currentPage,
		showCount: paramObj.showCount,
		obj_userId: paramObj.userId
  });

	// return http.$get('splidComment/getMyCommentList', {
	// 	is_need_label: '1',
	// 	type: '3',
	// 	currentPage: paramObj.currentPage,
	// 	showCount: paramObj.showCount,
	// 	obj_userId: paramObj.userId
	// });
}
````

## File: api/zfdm/zfdm.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 争分夺秒充值
export function zfdmRecharge(paramObj) {
    return request('hmWxmoney/chongzhiRace', 'POST', {
        splid: getLiveId(),
        USER_ID: paramObj.userId,
        openid: paramObj.openId,
    });
}

// 获取争分夺秒信息
export function getZfdmInfo(isLoop) {
    return request('race/getRaceInfo', 'GET', {
        splid: getLiveId(),
        cancelLoading: isLoop ? isLoop : '',
    });
}

// 争分夺秒开始游戏
export function startZfdm(paramObj) {
    return request('race/robRace', 'POST', {
        splid: getLiveId(),
        guess_info_id: paramObj.guessInfoId,
        raceTime: paramObj.raceTime,
    });
}

// 获取排行榜
export function getZfdmRankList(redpackageId) {
    return request('race/getRaceRankList', 'GET', {
        splid: getLiveId(),
        red_package_id: redpackageId,
    });
}
````

## File: api/zyz/zyz.js
````javascript
import { request } from '../../utils/request'
import { getLiveId } from '../../utils/storage'

// 获取奖池金额
export function getPoolMoney() {
    return request('jianLai/luckyDbList6', 'GET', {
        splid: getLiveId(),
        cancelLoading: true,
    });
}
// 获取转一转相关信息W
export function getZyzInfo() {
    return request('jianLai/getLuckyId6', 'GET', {
        splid: getLiveId(),
        playInfo: 'hdGame89',
    });
}
// 获取转一转排行榜列表
export function getZyzRank() {
    return request('jianLai/luckyDbRank6', 'GET', {
        splid: getLiveId(),
    });
}
// 转一转充值
export function zyzRecharge(paramObj) {
    return request('hmWxmoney/chongzhiNyn', 'POST', {
        splid: getLiveId(),
        giftId: 'one',
        USER_ID: paramObj.userId,
        openid: paramObj.openId,
    });
}
// 转一转开始
export function startZyz(paramObj) {
    return request('jianLai/luckyDb6', 'POST', {
        splid: getLiveId(),
        playInfo: 'hdGame89',
        id: paramObj.turnId,
    });
}
// 转一转发送中奖信息
export function sendPrizeInfo(paramObj) {
    return request('jianLai/luoXuanWan6', 'POST', {
        type: '2',
        gold: paramObj.gold,
        balance: paramObj.remainCoin,
        splid: getLiveId(),
        id: paramObj.turnId,
    });
}
// 发送广播
export function sendBroadCast(paramObj) {
    return request('sendMsgController/duxin6', 'POST', {
        splid: getLiveId(),
        ykq_info: paramObj.c
    });
}
````

## File: components/authDialog/authDialog.js
````javascript
import { wxLogin, authUserNew } from "../../api/login";
import qiniu from "../../utils/qiniu/index";
import { setToken } from "../../utils/storage";
import { showWxToast, getRandom } from "../../utils/index";
import defaultContent from "../../assets/constant/default";

const app = getApp();

const DEFAULTAVATAR = "https://ustatic.hudongmiao.com/joymewMp/grayAvator.png";
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    dialogVisible: {
      value: false,
      type: Boolean,
    },
    isJoymewIndex: {
      // 是否是首页调用
      value: true,
      type: Boolean,
    },
    hasAgree: {
      // 用户是否同意隐私协议(用于模拟微信侧没有用户同意记录的情况)
      // 注意：只有指定账号才需要这个状态！
      value: false,
      type: Boolean,
    }
  },
  observers: {
    dialogVisible: function (dialogVisible) {
      if (dialogVisible) {
        // 授权的登录弹窗出现
        console.log("*******授权登录弹窗出现********");
        this.loginSilence();
      }
    },
    avatarCropped: function (newVal) {
      if (newVal) {
        this.setData({
          avatarUrl: newVal,
        });
        console.log("上传服务器前的图片地址:", this.data.avatarUrl);
        this.uploadAvatar(this.data.avatarUrl);
      }
    },
  },
  data: {
    isNewAuthBox: false,
    avatarUrl: DEFAULTAVATAR,
    avatarUncropped: "",
    avatarCropped: "",
    nickName: ""
  },
  /**
   * 组件的方法列表
   */
  methods: {
    openAuthNew: function () {
      let that = this;
      if (!this.data.avatarUrl || this.data.avatarUrl === DEFAULTAVATAR) {
        wx.showModal({
          title: "提示",
          content: "请上传头像!",
          cancelText: "默认头像",
          confirmText: "知道了",
          success: function (sm) {
            if (sm.confirm) {
              console.log("用户点击确认");
            } else if (sm.cancel) {
              // 设置默认头像
              const AVATARS = defaultContent.defaultAvatars;
              const tmpLen = AVATARS.length;
              that.setData({
                avatarUrl: AVATARS[getRandom(0, tmpLen)],
              });
            }
          },
        });
        return;
      }
      if (!this.data.nickName) {
        // showWxToast('请填写姓名!');
        wx.showModal({
          title: "提示",
          content: "请填写姓名!",
          cancelText: "默认姓名",
          confirmText: "知道了",
          success: function (sm) {
            if (sm.confirm) {
              console.log("用户点击取消");
            } else if (sm.cancel) {
              // 设置默认姓名
              that.setData({
                nickName: `嗨喵用户${getRandom(0, 9999)}`,
              });
            }
          },
        });
        return;
      }
      const tmpUserInfo = {
        nickName: this.data.nickName,
        avatarUrl: this.data.avatarUrl,
      };
      app.setUserInfo(tmpUserInfo);
      this.triggerEvent("authSuccess");
    },
    loginSilence: function () {
      wxLogin()
        .then((res) => {
          console.log("***wxLogin***");
          console.log(res);
          return authUserNew(res.code);
        })
        .then((res2) => {
          console.log("***静默授权结果***");
          console.log(res2);
          setToken(res2.data.token);
          const tmpUserInfo = res2.data.user;
          this.setAvatarNickname(tmpUserInfo);
        })
        .catch((err) => {
          console.log("静默授权失败");
          console.log(err);
          this.closeAuth();
        });
    },
    setAvatarNickname(userInfo) {
      // 需要手动填写头像、昵称的情况
      if (!this.data.isJoymewIndex) {
        this.initQiniuInfo();
        this.setData({
          isNewAuthBox: true,
        });
        return;
      }

      // 需要h5授权的情况
      const { avator, wx_name } = userInfo;
      // 非新用户，服务端存储了头像、昵称
      if (avator && wx_name) {
        app.setUserInfo({
          nickName: wx_name,
          avatarUrl: avator,
        });
        this.triggerEvent("authSuccess");
      } else {
        // 新用户第一次打开
        this.triggerEvent("authSuccess", "needH5Auth");
      }
    },
    closeAuth: function () {
      this.triggerEvent("authFail");
    },
    onChooseAvatar: function (e) {
      const { avatarUrl } = e.detail;
      this.setData({
        avatarUrl,
        avatarUncropped: avatarUrl,
      });
    },
    beforeChooseAvatar: function () {
      console.log("***beforeChooseAvatar方法内部***");
      // 这个方法被执行说明需要引导用户同意隐私协议
      this.triggerEvent("showPrivacy");
    },
    userNameFocus: function () {
      // 用户点击昵称输入框，说明用户同意隐私协议
      this.triggerEvent("showPrivacy");
    },
    handleCancelCropper() {
      this.setData({
        avatarUncropped: "",
        avatarUrl: "",
      });
    },
    handleConfirmCropper(e) {
      this.setData({
        avatarUncropped: "",
        avatarCropped: e.detail,
      });
    },
    userNameBlur: function (e) {
      if (wx.requirePrivacyAuthorize) {
        wx.requirePrivacyAuthorize({});
      }
      this.setData({
        nickName: e.detail.value,
      });
      this.triggerEvent("showPrivacy");
    },
    uploadAvatar: function (avatarPath) {
      qiniu
        .qiniuUpload(avatarPath)
        .then((res) => {
          console.log(res);
          this.setData({
            avatarUrl: res.imageURL,
          });
        })
        .catch((err) => {
          console.log(err);
          showWxToast("头像上传失败!请重新进入小程序!");
        });
    },
    initQiniuInfo: function () {
      qiniu
        .getQiniuToken()
        .then((res) => {
          console.log(res.data.token);
          qiniu.initQiniu(res.data.token);
        })
        .catch((err) => {
          console.log(err);
        });
    },
  },
});
````

## File: components/authDialog/authDialog.json
````json
{
  "component": true,
  "usingComponents": {
    "cropper": "./cropper/cropper"
  }
}
````

## File: components/authDialog/authDialog.wxml
````
<!-- 新授权登陆 -->
<view class="authLogin {{isNewAuthBox?'shade':''}}" wx:if="{{dialogVisible}}">
  <view class="authBox" wx:if="{{isNewAuthBox}}">
    <!-- 拥有原生行为的按钮 -->
    <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar" bindtap="beforeChooseAvatar" wx:if="{{hasAgree}}">
      <image class="avatar" src="{{avatarUrl}}"></image>
    </button>
    <!-- 没有原生行为的按钮 用于校验用户是否同意隐私协议-->
    <button class="avatar-wrapper" bindtap="beforeChooseAvatar" wx:else>
      <image class="avatar" src="{{avatarUrl}}"></image>
    </button>
    <!-- 拥有原生行为的按钮 -->
    <view class="nameIpt" wx:if="{{hasAgree}}">
      <text class="key">昵称</text>
      <input type="nickname" class="weui-input" value="{{nickName}}" bindblur="userNameBlur" maxlength="12" placeholder="请输入昵称" placeholder-class="phcolor" />
    </view>
    <!-- 没有原生行为的按钮 用于校验用户是否同意隐私协议-->
    <view class="nameIpt" wx:else>
      <text class="key">昵称</text>
      <input class="weui-input" value="{{nickName}}" bindfocus="userNameFocus" maxlength="12" placeholder="请输入昵称" placeholder-class="phcolor" />
    </view>
    <view class="btn" bindtap="openAuthNew">授权登录</view>
    <image class="closeImg" src="https://static.joymew.com/joymewMp/authDialog/closeIcon.png" bindtap="closeAuth"></image>
    <cropper avatarUncropped="{{avatarUncropped}}" bind:cancelEvent="handleCancelCropper" bind:confirmEvent="handleConfirmCropper"></cropper>
  </view>
</view>
````

## File: components/authDialog/authDialog.wxss
````
.authLogin {
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.shade {
  background-color: rgba(32, 32, 32, 0.72);
}
.authLogin > .authBox {
  width: 520rpx;
  height: 600rpx;
  background-image: url('https://static.joymew.com/joymewMp/authDialog/authBg.png');
  background-size: 100% 100%;
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.authLogin > .authBox > .logoImg {
  width: 124rpx;
  height: 124rpx;
  position: absolute;
  top: 137rpx;
}

.authLogin > .authBox > .name {
  font-size: 36rpx;
  font-weight: bold;
  color: #313131;
  position: absolute;
  top: 288rpx;
}

.authLogin > .authBox > .btn {
  width: 300rpx;
  height: 80rpx;
  background: linear-gradient(-45deg, #feb141, #fec74d);
  box-shadow: 0px 12px 24px 0px rgba(254, 177, 65, 0.24);
  border-radius: 40rpx;
  font-size: 28rpx;
  font-weight: bold;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  bottom: 61rpx;
  letter-spacing: 0.5vw;
}

.authLogin > .authBox > .closeImg {
  width: 44rpx;
  height: 44rpx;
  position: absolute;
  bottom: -89rpx;
}

.authBox > .avatar-wrapper {
  width: 200rpx;
  height: 200rpx;
  margin-top: 40rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
.authBox > .avatar-wrapper > .avatar {
  width: 120rpx;
  height: 120rpx;
}
.authBox > .nameIpt {
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  margin-top: 40rpx;
  border-top: 2rpx solid rgba(0, 0, 0, 0.1);
  border-bottom: 2rpx solid rgba(0, 0, 0, 0.1);
  width: 100%;
  height: 85rpx;
  padding: 0 20rpx;
}
.authBox > .nameIpt > .key {
  color: #333333;
  font-size: 38rpx;
}
.authBox > .nameIpt > .weui-input {
  width: 380rpx;
  font-size: 38rpx;
}
.phcolor {
  color: #333333;
}
````

## File: components/authDialog/cropper/cropper.js
````javascript
Component({
    /**
     * 组件的属性列表
     */
    properties: {
      avatarUncropped: {
        type: String,
        value: '',
      },
    },
    observers: {
      avatarUncropped: function(newVal) {
        if (newVal) {
          wx.nextTick(() => {
            this.cropper = this.selectComponent('#image-cropper');
            this.setData({
              src: newVal,
            });
          });
        }
      },
    },
    /**
     * 组件的初始数据
     */
    data: {
      src: '',
      width: 250, //宽度
      height: 250, //高度
      max_width: 300,
      max_height: 300,
      disable_rotate: true, //是否禁用旋转
      disable_ratio: false, //锁定比例
      limit_move: true, //是否限制移动
    },
    lifetimes: {
      attached() {},
    },
    /**
     * 组件的方法列表
     */
    methods: {
      cropperload(e) {
        console.log('cropper加载完成');
      },
      loadimage(e) {
        wx.hideLoading();
        console.log('图片');
        this.cropper.imgReset();
      },
      clickcut(e) {
        console.log(e.detail);
        //图片预览
        wx.previewImage({
          current: e.detail.url, // 当前显示图片的http链接
          urls: [e.detail.url], // 需要预览的图片http链接列表
        });
      },
      cancelCropper() {
        this.triggerEvent('cancelEvent');
      },
      confirmCropper() {
        this.cropper.getImg(obj => {
          this.triggerEvent('confirmEvent', obj.url);
        });
      },
      rotate() {
        //在用户旋转的基础上旋转90°
        this.cropper.setAngle((this.cropper.data.angle += 90));
      },
    },
  });
````

## File: components/authDialog/cropper/cropper.json
````json
{
    "component": true,
    "usingComponents": {}
  }
````

## File: components/authDialog/cropper/cropper.wxml
````
<view class="cropperContainer" wx:if="{{avatarUncropped}}">
  <view style="width:100%;height:500rpx;">
    <image-cropper id="image-cropper" bindload="cropperload" bindimageload="loadimage" bindtapcut="clickcut" limit_move="{{false}}" disable_rotate="{{true}}" width="{{width}}" height="{{height}}" imgSrc="{{src}}" angle="{{angle}}" disable_width="{{true}}" max_width="{{max_width}}" max_height="{{max_height}}" disable_height="{{true}}" disable_ratio="{{true}}"></image-cropper>
  </view>
  <text class="hint">点击中间裁剪框可查看裁剪后的图片</text>
  <view class='bottom'>
    <text class="btnText" catchtap='cancelCropper'>取消</text>
    <text class="btnText" catchtap='rotate'>旋转</text>
    <text class="btnText" catchtap='confirmCropper'>确认</text>
  </view>
</view>
````

## File: components/authDialog/cropper/cropper.wxss
````
.cropperContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: black;
    z-index: 99999;
  }
  .top {
    position: absolute;
    width: 100%;
    top: 10rpx;
    display: flex;
    flex-flow: wrap;
    z-index: 10;
    color: white;
    justify-content: space-around;
  }
  
  .hint {
    position: absolute;
    top: 10rpx;
    width: 100%;
    font-size: 33rpx;
    text-align: center;
    color: white;
    z-index: 10;
  }
  
  page {
    background: white;
  }
  .bottom {
    position: absolute;
    width: 100%;
    bottom: 50rpx;
    display: flex;
    z-index: 10;
    justify-content: space-around;
    align-items: center;
    flex-wrap: wrap;
    height: 120rpx;
  }
  
  button {
    font-size: 27rpx;
    z-index: 2;
    padding: 0 20rpx;
    height: 60rpx;
    min-width: 70rpx;
    margin: 0 4rpx;
  }
  
  .input {
    display: flex;
    height: 50rpx;
    width: 50%;
  }
  
  .input>.label {
    min-width: 150rpx;
    font-size: 30rpx;
    height: 50rpx;
    line-height: 50rpx;
  }
  
  .input>input {
    margin-left: 10rpx;
    text-align: center;
    max-width: 160rpx;
    border: 1px solid rgb(255, 255, 255);
    height: 50rpx;
    line-height: 50rpx;
    min-height: 50rpx;
    box-sizing: border-box;
  }
  .btnText {
    font-size: 42rpx;
    color: #ffffff;
  }
````

## File: components/feedbackEntry/feedbackEntry.js
````javascript
Component({
    /**
     * 组件的属性列表
     */
    properties: {
        userId: {
            value: '',
            type: String
        },
    },
    observers: {
    },
    data: {
    },
    /**
     * 组件的方法列表
     */
    methods: {
        // 跳转到反馈页面
        toFeedback() {
            wx.navigateTo({
                url: '/pages/feedback/feedback?userId=' + this.properties.userId,
            });
        },
    }
})
````

## File: components/feedbackEntry/feedbackEntry.json
````json
{
    "component": true
}
````

## File: components/feedbackEntry/feedbackEntry.wxml
````
<view class="feedbackEntry" bindtap="toFeedback">
    <image src="../../assets/image/icon/kefuIcon.png" class="kefuIcon" />
    反馈投诉
</view>
````

## File: components/feedbackEntry/feedbackEntry.wxss
````
.feedbackEntry {
    width: 147rpx;
    height: 58rpx;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    border-top-left-radius: 25rpx;
    border-bottom-left-radius: 25rpx;
    position: fixed;
    top: 48rpx;
    right: 0;
    font-size: 24rpx;
    color: #ffe2ce;
    padding: 0 8rpx 0 13rpx;
    /* 最高层级 */
    z-index: 9999;
}

.feedbackEntry>.kefuIcon {
    width: 24rpx;
    height: 24rpx;
    margin-right: 4rpx;
}
````

## File: components/image-cropper/image-cropper.js
````javascript
Component({
    properties: {
        /**     
         * 图片路径
         */
        'imgSrc': {
            type: String
        },
        /**
         * 裁剪框高度
         */
        'height': {
            type: Number,
            value: 200
        },
        /**
         * 裁剪框宽度
         */
        'width': {
            type: Number,
            value: 200
        },
        /**
         * 裁剪框最小尺寸
         */
        'min_width': {
            type: Number,
            value: 100
        },
        'min_height': {
            type: Number,
            value: 100
        },
        /**
         * 裁剪框最大尺寸
         */
        'max_width': {
            type: Number,
            value: 300
        },
        'max_height': {
            type: Number,
            value: 300
        },
        /**
         * 裁剪框禁止拖动
         */
        'disable_width': {
            type: Boolean,
            value: false
        },
        'disable_height': {
            type: Boolean,
            value: false
        },
        /**
         * 锁定裁剪框比例
         */
        'disable_ratio': {
            type: Boolean,
            value: false
        },
        /**
         * 生成的图片尺寸相对剪裁框的比例
         */
        'export_scale': {
            type: Number,
            value: 3
        },
        /**
         * 生成的图片质量0-1
         */
        'quality': {
            type: Number,
            value: 1
        },
        'cut_top': {
            type: Number,
            value: null
        },
        'cut_left': {
            type: Number,
            value: null
        },
        /**
         * canvas上边距（不设置默认不显示）
         */
        'canvas_top': {
            type: Number,
            value: null
        },
        /**
         * canvas左边距（不设置默认不显示）
         */
        'canvas_left': {
            type: Number,
            value: null
        },
        /**
         * 图片宽度
         */
        'img_width': {
            type: null,
            value: null
        },
        /**
         * 图片高度
         */
        'img_height': {
            type: null,
            value: null
        },
        /**
         * 图片缩放比
         */
        'scale': {
            type: Number,
            value: 1
        },
        /**
         * 图片旋转角度
         */
        'angle': {
            type: Number,
            value: 0
        },
        /**
         * 最小缩放比
         */
        'min_scale': {
            type: Number,
            value: 0.5
        },
        /**
         * 最大缩放比
         */
        'max_scale': {
            type: Number,
            value: 2
        },
        /**
         * 是否禁用旋转
         */
        'disable_rotate': {
            type: Boolean,
            value: false
        },
        /**
         * 是否限制移动范围(剪裁框只能在图片内)
         */
        'limit_move': {
            type: Boolean,
            value: false
        }
    },
    data: {
        el: 'image-cropper', //暂时无用
        info: wx.getSystemInfoSync(),
        MOVE_THROTTLE: null, //触摸移动节流settimeout
        MOVE_THROTTLE_FLAG: true, //节流标识
        INIT_IMGWIDTH: 0, //图片设置尺寸,此值不变（记录最初设定的尺寸）
        INIT_IMGHEIGHT: 0, //图片设置尺寸,此值不变（记录最初设定的尺寸）
        TIME_BG: null, //背景变暗延时函数
        TIME_CUT_CENTER: null,
        _touch_img_relative: [{
            x: 0,
            y: 0
        }], //鼠标和图片中心的相对位置
        _flag_cut_touch: false, //是否是拖动裁剪框
        _hypotenuse_length: 0, //双指触摸时斜边长度
        _flag_img_endtouch: false, //是否结束触摸
        _flag_bright: true, //背景是否亮
        _canvas_overflow: true, //canvas缩略图是否在屏幕外面
        _canvas_width: 200,
        _canvas_height: 200,
        origin_x: 0.5, //图片旋转中心
        origin_y: 0.5, //图片旋转中心
        _cut_animation: false, //是否开启图片和裁剪框过渡
        _img_top: wx.getSystemInfoSync().windowHeight / 2, //图片上边距
        _img_left: wx.getSystemInfoSync().windowWidth / 2, //图片左边距
        watch: {
            //监听截取框宽高变化
            width(value, that) {
                    if (value < that.data.min_width) {
                        that.setData({
                            width: that.data.min_width
                        });
                    }
                    that._computeCutSize();
                },
                height(value, that) {
                    if (value < that.data.min_height) {
                        that.setData({
                            height: that.data.min_height
                        });
                    }
                    that._computeCutSize();
                },
                angle(value, that) {
                    //停止居中裁剪框，继续修改图片位置
                    that._moveStop();
                    if (that.data.limit_move) {
                        if (that.data.angle % 90) {
                            that.setData({
                                angle: Math.round(that.data.angle / 90) * 90
                            });
                            return;
                        }
                    }
                },
                _cut_animation(value, that) {
                    //开启过渡300毫秒之后自动关闭
                    clearTimeout(that.data._cut_animation_time);
                    if (value) {
                        that.data._cut_animation_time = setTimeout(() => {
                            that.setData({
                                _cut_animation: false
                            });
                        }, 300)
                    }
                },
                limit_move(value, that) {
                    if (value) {
                        if (that.data.angle % 90) {
                            that.setData({
                                angle: Math.round(that.data.angle / 90) * 90
                            });
                        }
                        that._imgMarginDetectionScale();
                        !that.data._canvas_overflow && that._draw();
                    }
                },
                canvas_top(value, that) {
                    that._canvasDetectionPosition();
                },
                canvas_left(value, that) {
                    that._canvasDetectionPosition();
                },
                imgSrc(value, that) {
                    that.pushImg();
                },
                cut_top(value, that) {
                    that._cutDetectionPosition();
                    if (that.data.limit_move) {
                        !that.data._canvas_overflow && that._draw();
                    }
                },
                cut_left(value, that) {
                    that._cutDetectionPosition();
                    if (that.data.limit_move) {
                        !that.data._canvas_overflow && that._draw();
                    }
                }
        }
    },
    attached() {
        this.data.info = wx.getSystemInfoSync();
        //启用数据监听
        this._watcher();
        this.data.INIT_IMGWIDTH = this.data.img_width;
        this.data.INIT_IMGHEIGHT = this.data.img_height;
        this.setData({
            _canvas_height: this.data.height,
            _canvas_width: this.data.width,
        });
        this._initCanvas();
        this.data.imgSrc && (this.data.imgSrc = this.data.imgSrc);
        //根据开发者设置的图片目标尺寸计算实际尺寸
        this._initImageSize();
        //设置裁剪框大小>设置图片尺寸>绘制canvas
        this._computeCutSize();
        //检查裁剪框是否在范围内
        this._cutDetectionPosition();
        //检查canvas是否在范围内
        this._canvasDetectionPosition();
        //初始化完成
        this.triggerEvent('load', {
            cropper: this
        });
    },
    methods: {
        /**
         * 上传图片
         */
        upload() {
                let that = this;
                wx.chooseImage({
                    count: 1,
                    sizeType: ['original', 'compressed'],
                    sourceType: ['album', 'camera'],
                    success(res) {
                        const tempFilePaths = res.tempFilePaths[0];
                        that.pushImg(tempFilePaths);
                        wx.showLoading({
                            title: '加载中...'
                        })
                    }
                })
            },
            /**
             * 返回图片信息
             */
            getImg(getCallback) {
                this._draw(() => {
                    wx.canvasToTempFilePath({
                        width: this.data.width * this.data.export_scale,
                        height: Math.round(this.data.height * this.data.export_scale),
                        destWidth: this.data.width * this.data.export_scale,
                        destHeight: Math.round(this.data.height) * this.data.export_scale,
                        fileType: 'png',
                        quality: this.data.quality,
                        canvasId: this.data.el,
                        success: (res) => {
                            getCallback({
                                url: res.tempFilePath,
                                width: this.data.width * this.data.export_scale,
                                height: this.data.height * this.data.export_scale
                            });
                        }
                    }, this)
                });
            },
            /**
             * 设置图片动画
             * {
             *    x:10,//图片在原有基础上向下移动10px
             *    y:10,//图片在原有基础上向右移动10px
             *    angle:10,//图片在原有基础上旋转10deg
             *    scale:0.5,//图片在原有基础上增加0.5倍
             * }
             */
            setTransform(transform) {
                if (!transform) return;
                if (!this.data.disable_rotate) {
                    this.setData({
                        angle: transform.angle ? this.data.angle + transform.angle : this.data.angle
                    });
                }
                var scale = this.data.scale;
                if (transform.scale) {
                    scale = this.data.scale + transform.scale;
                    scale = scale <= this.data.min_scale ? this.data.min_scale : scale;
                    scale = scale >= this.data.max_scale ? this.data.max_scale : scale;
                }
                this.data.scale = scale;
                let cutX = this.data.cut_left;
                let cutY = this.data.cut_top;
                if (transform.cutX) {
                    this.setData({
                        cut_left: cutX + transform.cutX
                    });
                    this.data.watch.cut_left(null, this);
                }
                if (transform.cutY) {
                    this.setData({
                        cut_top: cutY + transform.cutY
                    });
                    this.data.watch.cut_top(null, this);
                }
                this.data._img_top = transform.y ? this.data._img_top + transform.y : this.data._img_top;
                this.data._img_left = transform.x ? this.data._img_left + transform.x : this.data._img_left;
                //图像边缘检测,防止截取到空白
                this._imgMarginDetectionScale();
                //停止居中裁剪框，继续修改图片位置
                this._moveDuring();
                this.setData({
                    scale: this.data.scale,
                    _img_top: this.data._img_top,
                    _img_left: this.data._img_left
                });
                !this.data._canvas_overflow && this._draw();
                //可以居中裁剪框了
                this._moveStop(); //结束操作
            },
            /**
             * 设置剪裁框位置
             */
            setCutXY(x, y) {
                this.setData({
                    cut_top: y,
                    cut_left: x
                });
            },
            /**
             * 设置剪裁框尺寸
             */
            setCutSize(w, h) {
                this.setData({
                    width: w,
                    height: h
                });
                this._computeCutSize();
            },
            /**
             * 设置剪裁框和图片居中
             */
            setCutCenter() {
                let cut_top = (this.data.info.windowHeight - this.data.height) * 0.5;
                let cut_left = (this.data.info.windowWidth - this.data.width) * 0.5;
                //顺序不能变
                this.setData({
                    _img_top: this.data._img_top - this.data.cut_top + cut_top,
                    cut_top: cut_top, //截取的框上边距
                    _img_left: this.data._img_left - this.data.cut_left + cut_left,
                    cut_left: cut_left, //截取的框左边距
                });
            },
            _setCutCenter() {
                let cut_top = (this.data.info.windowHeight - this.data.height) * 0.5;
                let cut_left = (this.data.info.windowWidth - this.data.width) * 0.5;
                this.setData({
                    cut_top: cut_top, //截取的框上边距
                    cut_left: cut_left, //截取的框左边距
                });
            },
            /**
             * 设置剪裁框宽度-即将废弃
             */
            setWidth(width) {
                this.setData({
                    width: width
                });
                this._computeCutSize();
            },
            /**
             * 设置剪裁框高度-即将废弃
             */
            setHeight(height) {
                this.setData({
                    height: height
                });
                this._computeCutSize();
            },
            /**
             * 是否锁定旋转
             */
            setDisableRotate(value) {
                this.data.disable_rotate = value;
            },
            /**
             * 是否限制移动
             */
            setLimitMove(value) {
                this.setData({
                    _cut_animation: true,
                    limit_move: !!value
                });
            },
            /**
             * 初始化图片，包括位置、大小、旋转角度
             */
            imgReset() {
                this.setData({
                    scale: 1,
                    angle: 0,
                    _img_top: wx.getSystemInfoSync().windowHeight / 2,
                    _img_left: wx.getSystemInfoSync().windowWidth / 2,
                })
            },
            /**
             * 加载（更换）图片
             */
            pushImg(src) {
                if (src) {
                    this.setData({
                        imgSrc: src
                    });
                    //发现是手动赋值直接返回，交给watch处理
                    return;
                }

                // getImageInfo接口传入 src: '' 会导致内存泄漏

                if (!this.data.imgSrc) return;
                wx.getImageInfo({
                    src: this.data.imgSrc,
                    success: (res) => {
                            this.data.imageObject = res;
                            //图片非本地路径需要换成本地路径
                            if (this.data.imgSrc.search(/tmp/) == -1) {
                                this.setData({
                                    imgSrc: res.path
                                });
                            }
                            //计算最后图片尺寸
                            this._imgComputeSize();
                            if (this.data.limit_move) {
                                //限制移动，不留空白处理
                                this._imgMarginDetectionScale();
                            }
                            this._draw();
                        },
                        fail: (err) => {
                            this.setData({
                                imgSrc: ''
                            });
                        }
                });
            },
            imageLoad(e) {
                setTimeout(() => {
                    this.triggerEvent('imageload', this.data.imageObject);

                }, 1000)
            },
            /**
             * 设置图片放大缩小
             */
            setScale(scale) {
                if (!scale) return;
                this.setData({
                    scale: scale
                });
                !this.data._canvas_overflow && this._draw();
            },
            /**
             * 设置图片旋转角度
             */
            setAngle(angle) {
                if (!angle) return;
                this.setData({
                    _cut_animation: true,
                    angle: angle
                });
                this._imgMarginDetectionScale();
                !this.data._canvas_overflow && this._draw();
            },
            _initCanvas() {
                //初始化canvas
                if (!this.data.ctx) {
                    this.data.ctx = wx.createCanvasContext("image-cropper", this);
                }
            },
            /**
             * 根据开发者设置的图片目标尺寸计算实际尺寸
             */
            _initImageSize() {
                //处理宽高特殊单位 %>px
                if (this.data.INIT_IMGWIDTH && typeof this.data.INIT_IMGWIDTH == "string" && this.data.INIT_IMGWIDTH.indexOf("%") != -1) {
                    let width = this.data.INIT_IMGWIDTH.replace("%", "");
                    this.data.INIT_IMGWIDTH = this.data.img_width = this.data.info.windowWidth / 100 * width;
                }
                if (this.data.INIT_IMGHEIGHT && typeof this.data.INIT_IMGHEIGHT == "string" && this.data.INIT_IMGHEIGHT.indexOf("%") != -1) {
                    let height = this.data.img_height.replace("%", "");
                    this.data.INIT_IMGHEIGHT = this.data.img_height = this.data.info.windowHeight / 100 * height;
                }
            },
            /**
             * 检测剪裁框位置是否在允许的范围内(屏幕内)
             */
            _cutDetectionPosition() {
                let _cutDetectionPositionTop = () => {
                        //检测上边距是否在范围内
                        if (this.data.cut_top < 0) {
                            this.setData({
                                cut_top: 0
                            });
                        }
                        if (this.data.cut_top > this.data.info.windowHeight - this.data.height) {
                            this.setData({
                                cut_top: this.data.info.windowHeight - this.data.height
                            });
                        }
                    },
                    _cutDetectionPositionLeft = () => {
                        //检测左边距是否在范围内
                        if (this.data.cut_left < 0) {
                            this.setData({
                                cut_left: 0
                            });
                        }
                        if (this.data.cut_left > this.data.info.windowWidth - this.data.width) {
                            this.setData({
                                cut_left: this.data.info.windowWidth - this.data.width
                            });
                        }
                    };
                //裁剪框坐标处理（如果只写一个参数则另一个默认为0，都不写默认居中）
                if (this.data.cut_top == null && this.data.cut_left == null) {
                    this._setCutCenter();
                } else if (this.data.cut_top != null && this.data.cut_left != null) {
                    _cutDetectionPositionTop();
                    _cutDetectionPositionLeft();
                } else if (this.data.cut_top != null && this.data.cut_left == null) {
                    _cutDetectionPositionTop();
                    this.setData({
                        cut_left: (this.data.info.windowWidth - this.data.width) / 2
                    });
                } else if (this.data.cut_top == null && this.data.cut_left != null) {
                    _cutDetectionPositionLeft();
                    this.setData({
                        cut_top: (this.data.info.windowHeight - this.data.height) / 2
                    });
                }
            },
            /**
             * 检测canvas位置是否在允许的范围内(屏幕内)如果在屏幕外则不开启实时渲染
             * 如果只写一个参数则另一个默认为0，都不写默认超出屏幕外
             */
            _canvasDetectionPosition() {
                if (this.data.canvas_top == null && this.data.canvas_left == null) {
                    this.data._canvas_overflow = false;
                    this.setData({
                        canvas_top: -5000,
                        canvas_left: -5000
                    });
                } else if (this.data.canvas_top != null && this.data.canvas_left != null) {
                    if (this.data.canvas_top < -this.data.height || this.data.canvas_top > this.data.info.windowHeight) {
                        this.data._canvas_overflow = true;
                    } else {
                        this.data._canvas_overflow = false;
                    }
                } else if (this.data.canvas_top != null && this.data.canvas_left == null) {
                    this.setData({
                        canvas_left: 0
                    });
                } else if (this.data.canvas_top == null && this.data.canvas_left != null) {
                    this.setData({
                        canvas_top: 0
                    });
                    if (this.data.canvas_left < -this.data.width || this.data.canvas_left > this.data.info.windowWidth) {
                        this.data._canvas_overflow = true;
                    } else {
                        this.data._canvas_overflow = false;
                    }
                }
            },
            /**
             * 图片边缘检测-位置
             */
            _imgMarginDetectionPosition(scale) {
                if (!this.data.limit_move) return;
                let left = this.data._img_left;
                let top = this.data._img_top;
                var scale = scale || this.data.scale;
                let img_width = this.data.img_width;
                let img_height = this.data.img_height;
                if (this.data.angle / 90 % 2) {
                    img_width = this.data.img_height;
                    img_height = this.data.img_width;
                }
                left = this.data.cut_left + img_width * scale / 2 >= left ? left : this.data.cut_left + img_width * scale / 2;
                left = this.data.cut_left + this.data.width - img_width * scale / 2 <= left ? left : this.data.cut_left + this.data.width - img_width * scale / 2;
                top = this.data.cut_top + img_height * scale / 2 >= top ? top : this.data.cut_top + img_height * scale / 2;
                top = this.data.cut_top + this.data.height - img_height * scale / 2 <= top ? top : this.data.cut_top + this.data.height - img_height * scale / 2;
                this.setData({
                    _img_left: left,
                    _img_top: top,
                    scale: scale
                })
            },
            /**
             * 图片边缘检测-缩放
             */
            _imgMarginDetectionScale() {
                if (!this.data.limit_move) return;
                let scale = this.data.scale;
                let img_width = this.data.img_width;
                let img_height = this.data.img_height;
                if (this.data.angle / 90 % 2) {
                    img_width = this.data.img_height;
                    img_height = this.data.img_width;
                }
                if (img_width * scale < this.data.width) {
                    scale = this.data.width / img_width;
                }
                if (img_height * scale < this.data.height) {
                    scale = Math.max(scale, this.data.height / img_height);
                }
                this._imgMarginDetectionPosition(scale);
            },
            _setData(obj) {
                let data = {};
                for (var key in obj) {
                    if (this.data[key] != obj[key]) {
                        data[key] = obj[key];
                    }
                }
                this.setData(data);
                return data;
            },
            /**
             * 计算图片尺寸
             */
            _imgComputeSize() {
                let img_width = this.data.img_width,
                    img_height = this.data.img_height;
                if (!this.data.INIT_IMGHEIGHT && !this.data.INIT_IMGWIDTH) {
                    //默认按图片最小边 = 对应裁剪框尺寸
                    img_width = this.data.imageObject.width;
                    img_height = this.data.imageObject.height;
                    if (img_width / img_height > this.data.width / this.data.height) {
                        img_height = this.data.height;
                        img_width = this.data.imageObject.width / this.data.imageObject.height * img_height;
                    } else {
                        img_width = this.data.width;
                        img_height = this.data.imageObject.height / this.data.imageObject.width * img_width;
                    }
                } else if (this.data.INIT_IMGHEIGHT && !this.data.INIT_IMGWIDTH) {
                    img_width = this.data.imageObject.width / this.data.imageObject.height * this.data.INIT_IMGHEIGHT;
                } else if (!this.data.INIT_IMGHEIGHT && this.data.INIT_IMGWIDTH) {
                    img_height = this.data.imageObject.height / this.data.imageObject.width * this.data.INIT_IMGWIDTH;
                }
                this.setData({
                    img_width: img_width,
                    img_height: img_height
                });
            },
            //改变截取框大小
            _computeCutSize() {
                if (this.data.width > this.data.info.windowWidth) {
                    this.setData({
                        width: this.data.info.windowWidth,
                    });
                } else if (this.data.width + this.data.cut_left > this.data.info.windowWidth) {
                    this.setData({
                        cut_left: this.data.info.windowWidth - this.data.cut_left,
                    });
                };
                if (this.data.height > this.data.info.windowHeight) {
                    this.setData({
                        height: this.data.info.windowHeight,
                    });
                } else if (this.data.height + this.data.cut_top > this.data.info.windowHeight) {
                    this.setData({
                        cut_top: this.data.info.windowHeight - this.data.cut_top,
                    });
                }!this.data._canvas_overflow && this._draw();
            },
            //开始触摸
            _start(event) {
                this.data._flag_img_endtouch = false;
                if (event.touches.length == 1) {
                    //单指拖动
                    this.data._touch_img_relative[0] = {
                        x: (event.touches[0].clientX - this.data._img_left),
                        y: (event.touches[0].clientY - this.data._img_top)
                    }
                } else {
                    //双指放大
                    let width = Math.abs(event.touches[0].clientX - event.touches[1].clientX);
                    let height = Math.abs(event.touches[0].clientY - event.touches[1].clientY);
                    this.data._touch_img_relative = [{
                        x: (event.touches[0].clientX - this.data._img_left),
                        y: (event.touches[0].clientY - this.data._img_top)
                    }, {
                        x: (event.touches[1].clientX - this.data._img_left),
                        y: (event.touches[1].clientY - this.data._img_top)
                    }];
                    this.data._hypotenuse_length = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));
                }!this.data._canvas_overflow && this._draw();
            },
            _move_throttle() {
                //安卓需要节流
                if (this.data.info.platform == 'android') {
                    clearTimeout(this.data.MOVE_THROTTLE);
                    this.data.MOVE_THROTTLE = setTimeout(() => {
                        this.data.MOVE_THROTTLE_FLAG = true;
                    }, 1000 / 40)
                    return this.data.MOVE_THROTTLE_FLAG;
                } else {
                    this.data.MOVE_THROTTLE_FLAG = true;
                }
            },
            _move(event) {
                if (this.data._flag_img_endtouch || !this.data.MOVE_THROTTLE_FLAG) return;
                this.data.MOVE_THROTTLE_FLAG = false;
                this._move_throttle();
                this._moveDuring();
                if (event.touches.length == 1) {
                    //单指拖动
                    let left = (event.touches[0].clientX - this.data._touch_img_relative[0].x),
                        top = (event.touches[0].clientY - this.data._touch_img_relative[0].y);
                    //图像边缘检测,防止截取到空白
                    this.data._img_left = left;
                    this.data._img_top = top;
                    this._imgMarginDetectionPosition();
                    this.setData({
                        _img_left: this.data._img_left,
                        _img_top: this.data._img_top
                    });
                } else {
                    //双指放大
                    let width = (Math.abs(event.touches[0].clientX - event.touches[1].clientX)),
                        height = (Math.abs(event.touches[0].clientY - event.touches[1].clientY)),
                        hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2)),
                        scale = this.data.scale * (hypotenuse / this.data._hypotenuse_length),
                        current_deg = 0;
                    scale = scale <= this.data.min_scale ? this.data.min_scale : scale;
                    scale = scale >= this.data.max_scale ? this.data.max_scale : scale;
                    //图像边缘检测,防止截取到空白
                    this.data.scale = scale;
                    this._imgMarginDetectionScale();
                    //双指旋转(如果没禁用旋转)
                    let _touch_img_relative = [{
                        x: (event.touches[0].clientX - this.data._img_left),
                        y: (event.touches[0].clientY - this.data._img_top)
                    }, {
                        x: (event.touches[1].clientX - this.data._img_left),
                        y: (event.touches[1].clientY - this.data._img_top)
                    }];
                    if (!this.data.disable_rotate) {
                        let first_atan = 180 / Math.PI * Math.atan2(_touch_img_relative[0].y, _touch_img_relative[0].x);
                        let first_atan_old = 180 / Math.PI * Math.atan2(this.data._touch_img_relative[0].y, this.data._touch_img_relative[0].x);
                        let second_atan = 180 / Math.PI * Math.atan2(_touch_img_relative[1].y, _touch_img_relative[1].x);
                        let second_atan_old = 180 / Math.PI * Math.atan2(this.data._touch_img_relative[1].y, this.data._touch_img_relative[1].x);
                        //当前旋转的角度
                        let first_deg = first_atan - first_atan_old,
                            second_deg = second_atan - second_atan_old;
                        if (first_deg != 0) {
                            current_deg = first_deg;
                        } else if (second_deg != 0) {
                            current_deg = second_deg;
                        }
                    }
                    this.data._touch_img_relative = _touch_img_relative;
                    this.data._hypotenuse_length = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));
                    //更新视图
                    this.setData({
                        angle: this.data.angle + current_deg,
                        scale: this.data.scale
                    });
                }!this.data._canvas_overflow && this._draw();
            },
            //结束操作
            _end(event) {
                this.data._flag_img_endtouch = true;
                this._moveStop();
            },
            //点击中间剪裁框处理
            _click(event) {
                if (!this.data.imgSrc) {
                    //调起上传
                    this.upload();
                    return;
                }
                this._draw(() => {
                    let x = event.detail ? event.detail.x : event.touches[0].clientX;
                    let y = event.detail ? event.detail.y : event.touches[0].clientY;
                    if ((x >= this.data.cut_left && x <= (this.data.cut_left + this.data.width)) && (y >= this.data.cut_top && y <= (this.data.cut_top + this.data.height))) {
                        //生成图片并回调
                        wx.canvasToTempFilePath({
                            width: this.data.width * this.data.export_scale,
                            height: Math.round(this.data.height * this.data.export_scale),
                            destWidth: this.data.width * this.data.export_scale,
                            destHeight: Math.round(this.data.height) * this.data.export_scale,
                            fileType: 'png',
                            quality: this.data.quality,
                            canvasId: this.data.el,
                            success: (res) => {
                                this.triggerEvent('tapcut', {
                                    url: res.tempFilePath,
                                    width: this.data.width * this.data.export_scale,
                                    height: this.data.height * this.data.export_scale
                                });
                            }
                        }, this)
                    }
                });
            },
            //渲染
            _draw(callback) {
                if (!this.data.imgSrc) return;
                let draw = () => {
                    //图片实际大小
                    let img_width = this.data.img_width * this.data.scale * this.data.export_scale;
                    let img_height = this.data.img_height * this.data.scale * this.data.export_scale;
                    //canvas和图片的相对距离
                    var xpos = this.data._img_left - this.data.cut_left;
                    var ypos = this.data._img_top - this.data.cut_top;
                    //旋转画布
                    this.data.ctx.translate(xpos * this.data.export_scale, ypos * this.data.export_scale);
                    this.data.ctx.rotate(this.data.angle * Math.PI / 180);
                    this.data.ctx.drawImage(this.data.imgSrc, -img_width / 2, -img_height / 2, img_width, img_height);
                    this.data.ctx.draw(false, () => {
                        callback && callback();
                    });
                }
                if (this.data.ctx.width != this.data.width || this.data.ctx.height != this.data.height) {
                    //优化拖动裁剪框，所以必须把宽高设置放在离用户触发渲染最近的地方
                    this.setData({
                        _canvas_height: this.data.height,
                        _canvas_width: this.data.width,
                    }, () => {
                        //延迟40毫秒防止点击过快出现拉伸或裁剪过多
                        setTimeout(() => {
                            draw();
                        }, 40);
                    });
                } else {
                    draw();
                }
            },
            //裁剪框处理
            _cutTouchMove(e) {
                if (this.data._flag_cut_touch && this.data.MOVE_THROTTLE_FLAG) {
                    if (this.data.disable_ratio && (this.data.disable_width || this.data.disable_height)) return;
                    //节流
                    this.data.MOVE_THROTTLE_FLAG = false;
                    this._move_throttle();
                    let width = this.data.width,
                        height = this.data.height,
                        cut_top = this.data.cut_top,
                        cut_left = this.data.cut_left,
                        size_correct = () => {
                            width = width <= this.data.max_width ? width >= this.data.min_width ? width : this.data.min_width : this.data.max_width;
                            height = height <= this.data.max_height ? height >= this.data.min_height ? height : this.data.min_height : this.data.max_height;
                        },
                        size_inspect = () => {
                            if ((width > this.data.max_width || width < this.data.min_width || height > this.data.max_height || height < this.data.min_height) && this.data.disable_ratio) {
                                size_correct();
                                return false;
                            } else {
                                size_correct();
                                return true;
                            }
                        };
                    height = this.data.CUT_START.height + ((this.data.CUT_START.corner > 1 && this.data.CUT_START.corner < 4 ? 1 : -1) * (this.data.CUT_START.y - e.touches[0].clientY));
                    switch (this.data.CUT_START.corner) {
                    case 1:
                        width = this.data.CUT_START.width + this.data.CUT_START.x - e.touches[0].clientX;
                        if (this.data.disable_ratio) {
                            height = width / (this.data.width / this.data.height)
                        }
                        if (!size_inspect()) return;
                        cut_left = this.data.CUT_START.cut_left - (width - this.data.CUT_START.width);
                        break
                    case 2:
                        width = this.data.CUT_START.width + this.data.CUT_START.x - e.touches[0].clientX;
                        if (this.data.disable_ratio) {
                            height = width / (this.data.width / this.data.height)
                        }
                        if (!size_inspect()) return;
                        cut_top = this.data.CUT_START.cut_top - (height - this.data.CUT_START.height)
                        cut_left = this.data.CUT_START.cut_left - (width - this.data.CUT_START.width)
                        break
                    case 3:
                        width = this.data.CUT_START.width - this.data.CUT_START.x + e.touches[0].clientX;
                        if (this.data.disable_ratio) {
                            height = width / (this.data.width / this.data.height)
                        }
                        if (!size_inspect()) return;
                        cut_top = this.data.CUT_START.cut_top - (height - this.data.CUT_START.height);
                        break
                    case 4:
                        width = this.data.CUT_START.width - this.data.CUT_START.x + e.touches[0].clientX;
                        if (this.data.disable_ratio) {
                            height = width / (this.data.width / this.data.height)
                        }
                        if (!size_inspect()) return;
                        break
                    }
                    if (!this.data.disable_width && !this.data.disable_height) {
                        this.setData({
                            width: width,
                            cut_left: cut_left,
                            height: height,
                            cut_top: cut_top,
                        })
                    } else if (!this.data.disable_width) {
                        this.setData({
                            width: width,
                            cut_left: cut_left
                        })
                    } else if (!this.data.disable_height) {
                        this.setData({
                            height: height,
                            cut_top: cut_top
                        })
                    }
                    this._imgMarginDetectionScale();
                }
            },
            _cutTouchStart(e) {
                let currentX = e.touches[0].clientX;
                let currentY = e.touches[0].clientY;
                let cutbox_top4 = this.data.cut_top + this.data.height - 30;
                let cutbox_bottom4 = this.data.cut_top + this.data.height + 20;
                let cutbox_left4 = this.data.cut_left + this.data.width - 30;
                let cutbox_right4 = this.data.cut_left + this.data.width + 30;

                let cutbox_top3 = this.data.cut_top - 30;
                let cutbox_bottom3 = this.data.cut_top + 30;
                let cutbox_left3 = this.data.cut_left + this.data.width - 30;
                let cutbox_right3 = this.data.cut_left + this.data.width + 30;

                let cutbox_top2 = this.data.cut_top - 30;
                let cutbox_bottom2 = this.data.cut_top + 30;
                let cutbox_left2 = this.data.cut_left - 30;
                let cutbox_right2 = this.data.cut_left + 30;

                let cutbox_top1 = this.data.cut_top + this.data.height - 30;
                let cutbox_bottom1 = this.data.cut_top + this.data.height + 30;
                let cutbox_left1 = this.data.cut_left - 30;
                let cutbox_right1 = this.data.cut_left + 30;
                if (currentX > cutbox_left4 && currentX < cutbox_right4 && currentY > cutbox_top4 && currentY < cutbox_bottom4) {
                    this._moveDuring();
                    this.data._flag_cut_touch = true;
                    this.data._flag_img_endtouch = true;
                    this.data.CUT_START = {
                        width: this.data.width,
                        height: this.data.height,
                        x: currentX,
                        y: currentY,
                        corner: 4
                    }
                } else if (currentX > cutbox_left3 && currentX < cutbox_right3 && currentY > cutbox_top3 && currentY < cutbox_bottom3) {
                    this._moveDuring();
                    this.data._flag_cut_touch = true;
                    this.data._flag_img_endtouch = true;
                    this.data.CUT_START = {
                        width: this.data.width,
                        height: this.data.height,
                        x: currentX,
                        y: currentY,
                        cut_top: this.data.cut_top,
                        cut_left: this.data.cut_left,
                        corner: 3
                    }
                } else if (currentX > cutbox_left2 && currentX < cutbox_right2 && currentY > cutbox_top2 && currentY < cutbox_bottom2) {
                    this._moveDuring();
                    this.data._flag_cut_touch = true;
                    this.data._flag_img_endtouch = true;
                    this.data.CUT_START = {
                        width: this.data.width,
                        height: this.data.height,
                        cut_top: this.data.cut_top,
                        cut_left: this.data.cut_left,
                        x: currentX,
                        y: currentY,
                        corner: 2
                    }
                } else if (currentX > cutbox_left1 && currentX < cutbox_right1 && currentY > cutbox_top1 && currentY < cutbox_bottom1) {
                    this._moveDuring();
                    this.data._flag_cut_touch = true;
                    this.data._flag_img_endtouch = true;
                    this.data.CUT_START = {
                        width: this.data.width,
                        height: this.data.height,
                        cut_top: this.data.cut_top,
                        cut_left: this.data.cut_left,
                        x: currentX,
                        y: currentY,
                        corner: 1
                    }
                }
            },
            _cutTouchEnd(e) {
                this._moveStop();
                this.data._flag_cut_touch = false;
            },
            //停止移动时需要做的操作
            _moveStop() {
                //清空之前的自动居中延迟函数并添加最新的
                clearTimeout(this.data.TIME_CUT_CENTER);
                this.data.TIME_CUT_CENTER = setTimeout(() => {
                        //动画启动
                        if (!this.data._cut_animation) {
                            this.setData({
                                _cut_animation: true
                            });
                        }
                        this.setCutCenter();
                    }, 1000)
                    //清空之前的背景变化延迟函数并添加最新的
                clearTimeout(this.data.TIME_BG);
                this.data.TIME_BG = setTimeout(() => {
                    if (this.data._flag_bright) {
                        this.setData({
                            _flag_bright: false
                        });
                    }
                }, 2000)
            },
            //移动中
            _moveDuring() {
                //清空之前的自动居中延迟函数
                clearTimeout(this.data.TIME_CUT_CENTER);
                //清空之前的背景变化延迟函数
                clearTimeout(this.data.TIME_BG);
                //高亮背景
                if (!this.data._flag_bright) {
                    this.setData({
                        _flag_bright: true
                    });
                }
            },
            //监听器
            _watcher() {
                Object.keys(this.data).forEach(v => {
                    this._observe(this.data, v, this.data.watch[v]);
                })
            },
            _observe(obj, key, watchFun) {
                var val = obj[key];
                Object.defineProperty(obj, key, {
                    configurable: true,
                    enumerable: true,
                    set: (value) => {
                            val = value;
                            watchFun && watchFun(val, this);
                        },
                        get() {
                            if (val && '_img_top|img_left||width|height|min_width|max_width|min_height|max_height|export_scale|cut_top|cut_left|canvas_top|canvas_left|img_width|img_height|scale|angle|min_scale|max_scale'.indexOf(key) != -1) {
                                let ret = parseFloat(parseFloat(val).toFixed(3));
                                if (typeof val == "string" && val.indexOf("%") != -1) {
                                    ret += '%';
                                }
                                return ret;
                            }
                            return val;
                        }
                })
            },
            _preventTouchMove() {}
    }
})
````

## File: components/image-cropper/image-cropper.json
````json
{
	"component": true
}
````

## File: components/image-cropper/image-cropper.wxml
````
<view class='image-cropper' catchtouchmove='_preventTouchMove'>
    <view class='main' bindtouchend="_cutTouchEnd" bindtouchstart="_cutTouchStart" bindtouchmove="_cutTouchMove" bindtap="_click">
        <view class='content'>
            <view class='content_top bg_gray {{_flag_bright?"":"bg_black"}}' style="height:{{cut_top}}px;transition-property:{{_cut_animation?'':'background'}}"></view>
            <view class='content_middle' style="height:{{height}}px;">
                <view class='content_middle_left bg_gray {{_flag_bright?"":"bg_black"}}' style="width:{{cut_left}}px;transition-property:{{_cut_animation?'':'background'}}"></view>
                <view class='content_middle_middle' style="width:{{width}}px;height:{{height}}px;transition-duration: .3s;transition-property:{{_cut_animation?'':'background'}};">
                    <view class="border border-top-left"></view>
                    <view class="border border-top-right"></view>
                    <view class="border border-right-top"></view>
                    <view class="border border-right-bottom"></view>
                    <view class="border border-bottom-right"></view>
                    <view class="border border-bottom-left"></view>
                    <view class="border border-left-bottom"></view>
                    <view class="border border-left-top"></view>
                </view>
                <view class='content_middle_right bg_gray {{_flag_bright?"":"bg_black"}}' style="transition-property:{{_cut_animation?'':'background'}}"></view>
            </view>
            <view class='content_bottom bg_gray {{_flag_bright?"":"bg_black"}}' style="transition-property:{{_cut_animation?'':'background'}}"></view>
        </view>
        <image bindload="imageLoad" bindtouchstart="_start" bindtouchmove="_move" bindtouchend="_end" style="width:{{img_width ? img_width + 'px' : 'auto'}};height:{{img_height ? img_height + 'px' : 'auto'}};transform:translate3d({{_img_left-img_width/2}}px,{{_img_top-img_height/2}}px,0) scale({{scale}}) rotate({{angle}}deg);transition-duration:{{_cut_animation?.4:0}}s;" class='img' src='{{imgSrc}}'></image>
    </view>
    <canvas canvas-id='image-cropper' disable-scroll="true" style="width:{{_canvas_width * export_scale}}px;height:{{_canvas_height * export_scale}}px;left:{{canvas_left}}px;top:{{canvas_top}}px" class='image-cropper-canvas'></canvas>
</view>
````

## File: components/image-cropper/image-cropper.wxss
````
.image-cropper {
    background: rgba(14, 13, 13, .8);
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 1;
}

.image-cropper .main {
    position: absolute;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}

.image-cropper .content {
    z-index: 9;
    position: absolute;
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    pointer-events: none;
}

.image-cropper .bg_black {
    background: rgba(0, 0, 0, 0.8) !important;
}

.image-cropper .bg_gray {
    background: rgba(0, 0, 0, 0.45);
    transition-duration: .35s;
}

.image-cropper .content>.content_top {
    pointer-events: none;
}

.image-cropper .content>.content_middle {
    display: flex;
    height: 200px;
    width: 100%;
}

.image-cropper .content_middle_middle {
    width: 200px;
    box-sizing: border-box;
    position: relative;
    transition-duration: .3s;
}

.image-cropper .content_middle_right {
    flex: auto;
}

.image-cropper .content>.content_bottom {
    flex: auto;
}

.image-cropper .img {
    z-index: 2;
    top: 0;
    left: 0;
    position: absolute;
    border: none;
    width: 100%;
    backface-visibility: hidden;
    transform-origin: center;
}

.image-cropper .image-cropper-canvas {
    position: fixed;
    background: white;
    width: 150px;
    height: 150px;
    z-index: 10;
    top: -200%;
    pointer-events: none;
}

.image-cropper .border {
    background: white;
    pointer-events: auto;
    position: absolute;
}

.image-cropper .border-top-left {
    left: -2.5px;
    top: -2.5px;
    height: 2.5px;
    width: 33rpx;
}

.image-cropper .border-top-right {
    right: -2.5px;
    top: -2.5px;
    height: 2.5px;
    width: 33rpx;
}

.image-cropper .border-right-top {
    top: -1px;
    width: 2.5px;
    height: 30rpx;
    right: -2.5px;
}

.image-cropper .border-right-bottom {
    width: 2.5px;
    height: 30rpx;
    right: -2.5px;
    bottom: -1px;
}

.image-cropper .border-bottom-left {
    height: 2.5px;
    width: 33rpx;
    bottom: -2.5px;
    left: -2.5px;
}

.image-cropper .border-bottom-right {
    height: 2.5px;
    width: 33rpx;
    bottom: -2.5px;
    right: -2.5px;
}

.image-cropper .border-left-top {
    top: -1px;
    width: 2.5px;
    height: 30rpx;
    left: -2.5px;
}

.image-cropper .border-left-bottom {
    width: 2.5px;
    height: 30rpx;
    left: -2.5px;
    bottom: -1px;
}
````

## File: components/privacyAuthorize/privacyAuthorize.json
````json
{
  "component": true
}
````

## File: components/rateStar/rateStar.js
````javascript
// components/rateStar/rateStar.js
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    rate: {
      type: [Number, String],
      default: 0
    },
    size: {
      type: [Number, String],
      default: 0
    },    
    edit: {
      type:Boolean,
      default: false
    }
  },

  /**
   * 组件的初始数据
   */
  data: {

  },

  /**
   * 组件的方法列表
   */
  methods: {
    setRate(e){
      if(!this.data.edit){
        return 
      }
      let rate = e.currentTarget.dataset.rate
			this.triggerEvent('change', rate)
    }
  }
})
````

## File: components/rateStar/rateStar.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: components/rateStar/rateStar.wxml
````
<view class="wrapper">
  <block wx:for="{{[1,2,3,4,5]}}" wx:for-item="item" wx:for-index="index" wx:key="index" >
    <image class="star-icon {{size}}" src="/assets/image/comment/unstar.png" data-rate="{{item}}" bindtap="setRate" wx:if="{{rate<item}}"></image>
    <image class="star-icon {{size}}" src="/assets/image/comment/star.png" data-rate="{{item}}" bindtap="setRate" wx:if="{{rate>=item}}"></image>
  </block>
</view>
````

## File: components/rateStar/rateStar.wxss
````
/* components/rateStar/rateStar.wxss */
.wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
}

.star-icon{
  width: 28rpx;
  height: 28rpx;
  margin-left: 12rpx;
}
.big{
  width: 42rpx;
  height: 42rpx;
  margin-left: 12rpx;
}
.bigger{
  width: 48rpx;
  height: 48rpx;
  margin-left: 36rpx;
}
````

## File: components/sign/sign.js
````javascript
import {
  showWxToast,
  timeoutTask
} from '../../utils/index';
import {
  authGetPhoneByCode
} from '../../api/login';

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    activityTitle: {
      value: '',
      type: String,
    },
    userNameProp: {
      value: '',
      type: String,
    },
    wishProp: {
      value: '',
      type: String,
    },
    sceneType: {
      value: '',
      type: String,
    },
    isExamine: {
      value: false,
      type: Boolean,
    },
    isForcePhone: {
      value: false,
      type: Boolean,
    },
    miaoShopId: {
      value: '',
      type: String,
    },
    wxGetPhoneButtonVisible: {
      value: false,
      type: Boolean,
    },
  },
  observers: {
    userNameProp: function (userNameProp) {
      this.setData({
        userName: userNameProp,
      });
    },
    wishProp: function (wishProp) {
      this.setData({
        wish: wishProp,
      });
    },
    wxGetPhoneButtonVisible: function(newVal) {
      this.setData({
        needInputPhone: !newVal
      });
    },
  },
  data: {
    role: '', // 亲友类型 1:男方亲友 2:女方亲友  '': 不选
    userName: '', // 姓名
    wish: '', // 祝福语
    gender: '0', // 性别 0:男 1:女 商城版独有
    phone: '', // 手机号 商城版
    // birthDate: '', // 生日 商城版独有
    needInputPhone: false,
    phoneInputFocus: false,
  },
  /**
   * 组件的方法列表
   */
  methods: {
    userNameBlur(e) {
      console.log('***userNameBlur***');
      this.setData({
        userName: e.detail.value,
      });
    },
    wishesBlur(e) {
      console.log('***wishesBlur***');
      if (e.detail.value) {
        this.setData({
          wish: e.detail.value,
        });
      }
    },
    phoneBlur(e) {
      console.log('***phoneBlur***');
      if (e.detail.value) {
        this.setData({
          phone: e.detail.value,
          phoneInputFocus: false,
        });
      }
    },
    // 选择亲友
    chooseRelatives(e) {
      console.log('***chooseRelatives***');
      console.log(e);
      this.setData({
        role: e.currentTarget.dataset.role,
      });
    },
    sign() {
      if (this.properties.miaoShopId) {
        this.signMiaoShop();
        return;
      }
      // if (!this.data.userName) {
      //   showWxToast('贵宾姓名不能为空!');
      //   return;
      // }
      if (!this.data.wish) {
        showWxToast('祝福语不能为空!');
        return;
      }
      if (this.data.phone && this.data.phone.length !== 11) {
        showWxToast('请输入正确格式的手机号!');
        return;
      }
      // 需要强制获取手机号
      if (this.data.isForcePhone && !this.data.phone) {
        showWxToast('手机号不能为空!');
        this.setData({
          needInputPhone: true,
          phoneInputFocus: true
        });
        return;
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.role);
      console.log(this.data.phone);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        role: this.data.role,
        userPhone: this.data.phone,
      });
    },
    refreshWish() {
      this.triggerEvent('refreshWishEvent');
    },
    chooseGender: function (e) {
      console.log(e.currentTarget.dataset.gender);
      this.setData({
        gender: e.currentTarget.dataset.gender,
      });
    },
    personInputPhone() {
      showWxToast('请输入手机号!');
      // 手机输入框显示
      this.setData({
        needInputPhone: true,
      })
      // 延迟0.3s输入框聚焦
      timeoutTask(() => {
        this.setData({
          phoneInputFocus: true
        })
      }, 300);
    },
    getPhoneNumber: function (e) {
      console.log('*******getPhoneNumber方法内部*******');
      console.log(e.detail.code);
      console.log(e.detail.errno);
      if (e.detail.errno === 1400001 || !e.detail.code) {
        this.personInputPhone();
        return;
      }
      try {
        authGetPhoneByCode({
            code: e.detail.code
          })
          .then(res => {
            console.log(res);
            if (res && res.phone_info && res.phone_info.phoneNumber) {
              this.setData({
                phone: res.phone_info.phoneNumber,
              });
            } else {
              this.personInputPhone();
            }
          })
          .catch(err => {
            console.log(err);
            this.personInputPhone();
          });
      } catch (err) {
        console.log(err);
        this.personInputPhone();
      }
    },
    // handleBirthDateChange: function(e) {
    //   console.log(e.detail.value);
    //   this.setData({
    //     birthDate: e.detail.value,
    //   });
    // },
    signMiaoShop: function () {
      // if (!this.data.userName) {
      //   showWxToast('贵宾姓名不能为空!');
      //   return;
      // }
      if (!this.data.wish) {
        showWxToast('祝福语不能为空!');
        return;
      }
      if (!this.data.isExamine && this.data.isForcePhone) {
        if (!this.data.phone) {
          showWxToast('手机号不能为空!');
          this.setData({
            needInputPhone: true,
            phoneInputFocus: true
          });
          return;
        }
        if (this.data.phone.length !== 11) {
          showWxToast('手机号格式错误!');
          return;
        }
        // if (!this.data.birthDate) {
        //   showWxToast('请选择生日!');
        //   return;
        // }
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.phone);
      // console.log(this.data.birthDate);
      console.log(this.data.gender);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        userPhone: this.data.phone,
        // birthDate: this.data.birthDate,
        gender: this.data.gender,
      });
    },
  },
});
````

## File: components/sign/sign.json
````json
{
    "component": true
}
````

## File: components/signCustom/signCustom.js
````javascript
import {
  showWxToast,
  timeoutTask
} from '../../utils/index';
import {
  authGetPhoneByCode
} from '../../api/login';

const app = getApp();
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    activityTitle: {
      value: '',
      type: String,
    },
    userNameProp: {
      value: '',
      type: String,
    },
    wishProp: {
      value: '',
      type: String,
    },
    sceneType: {
      value: '',
      type: String,
    },
    isExamine: {
      value: false,
      type: Boolean,
    },
    isForcePhone: {
      value: false,
      type: Boolean,
    },
    miaoShopId: {
      value: '',
      type: String,
    },
    customSignBg: {
      value: '',
      type: String,
    },
    isForbidSend: {
      value: '',
      type: Boolean
    },
    wxGetPhoneButtonVisible: {
      value: false,
      type: Boolean,
    },
  },
  observers: {
    userNameProp: function (userNameProp) {
      this.setData({
        userName: userNameProp,
      });
    },
    wishProp: function (wishProp) {
      this.setData({
        wish: wishProp,
      });
    },
    activityTitle: function (newVal) {
      if (newVal && newVal.indexOf('&') > -1) {
        this.setData({
          activityTitleArr: newVal.split('&')
        });
      }
    },
    wxGetPhoneButtonVisible: function(newVal) {
      this.setData({
        needInputPhone: !newVal
      });
    },
  },
  data: {
    role: '', // 亲友类型 1:男方亲友 2:女方亲友  '': 不选
    userName: '', // 姓名
    wish: '', // 祝福语
    gender: '0', // 性别 0:男 1:女 商城版独有
    phone: '', // 手机号 商城版
    birthDate: '', // 生日 商城版独有
    activityTitleArr: [], // 企业版标题 指定标识符&处换行
    needInputPhone: false,
    phoneInputFocus: false,
  },
  /**
   * 组件的方法列表
   */
  methods: {
    userNameBlur(e) {
      console.log('***userNameBlur***');
      this.setData({
        userName: e.detail.value,
      });
    },
    wishesBlur(e) {
      console.log('***wishesBlur***');
      if (e.detail.value) {
        this.setData({
          wish: e.detail.value,
        });
      }
    },
    phoneBlur(e) {
      console.log('***phoneBlur***');
      if (e.detail.value) {
        this.setData({
          phone: e.detail.value,
          phoneInputFocus: false,
        });
      }
    },
    // 选择亲友
    chooseRelatives(e) {
      console.log('***chooseRelatives***');
      console.log(e);
      this.setData({
        role: e.currentTarget.dataset.role,
      });
    },
    sign() {
      if (this.data.miaoShopId) {
        this.signMiaoShop();
        return;
      }
      if (!this.data.wish) {
        showWxToast('祝福语不能为空!');
        return;
      }
      if (this.data.phone && this.data.phone.length !== 11) {
        showWxToast('请输入正确格式的手机号!');
        return;
      }
      // 需要强制获取手机号
      if (this.data.isForcePhone && !this.data.phone) {
        showWxToast('手机号不能为空!');
        this.setData({
          needInputPhone: true,
          phoneInputFocus: true
        });
        return;
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.role);
      console.log(this.data.phone);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        role: this.data.role,
        userPhone: this.data.phone,
      });
    },
    refreshWish() {
      this.triggerEvent('refreshWishEvent');
    },
    chooseGender: function (e) {
      console.log(e.currentTarget.dataset.gender);
      this.setData({
        gender: e.currentTarget.dataset.gender,
      });
    },
    getPhoneNumber: function (e) {
      console.log('*******getPhoneNumber方法内部*******');
      console.log(e.detail.code);
      console.log(e.detail.errno);
      if (e.detail.errno === 1400001 || !e.detail.code) {
        showWxToast('手机号获取失败!请输入手机号!');
        // 手机输入框显示
        this.setData({
          needInputPhone: true,
        })
        // 延迟0.3s输入框聚焦
        timeoutTask(() => {
          this.setData({
            phoneInputFocus: true
          })
        }, 300);
        return;
      }
      try {
        authGetPhoneByCode({
            code: e.detail.code,
          })
          .then(res => {
            console.log(res);
            if (res && res.phone_info && res.phone_info.phoneNumber) {
              this.setData({
                phone: res.phone_info.phoneNumber,
              });
            } else {
              showWxToast('手机号获取失败!请输入手机号!');
              // 手机输入框显示
              this.setData({
                needInputPhone: true,
              })
              // 延迟0.3s输入框聚焦
              timeoutTask(() => {
                this.setData({
                  phoneInputFocus: true
                })
              }, 300);
            }
          })
          .catch(err => {
            console.log(err);
            showWxToast(JSON.stringify(err));
          });
      } catch (err) {
        console.log(err);
        showWxToast(JSON.stringify(err));
      }
    },
    handleBirthDateChange: function (e) {
      console.log(e.detail.value);
      this.setData({
        birthDate: e.detail.value,
      });
    },
    signMiaoShop: function () {
      console.log('signMiaoShop方法执行!');
      // if (!this.data.userName) {
      //   showWxToast('贵宾姓名不能为空!');
      //   return;
      // }
      if (!this.data.wish) {
        showWxToast('祝福语不能为空!');
        return;
      }
      if (!this.data.isExamine) {
        if (!this.data.phone) {
          showWxToast('手机号不能为空!');
          this.setData({
            needInputPhone: true,
            phoneInputFocus: true
          });
          return;
        }
        if (this.data.phone.length !== 11) {
          showWxToast('手机号格式错误!');
          return;
        }
        if (!this.data.birthDate) {
          showWxToast('请选择生日!');
          return;
        }
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.phone);
      console.log(this.data.birthDate);
      console.log(this.data.gender);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        userPhone: this.data.phone,
        birthDate: this.data.birthDate,
        gender: this.data.gender,
      });
    },
  },
});
````

## File: components/signCustom/signCustom.json
````json
{
    "component": true
}
````

## File: components/signCustom/signCustom.wxml
````
<view class="signNew">
    <image src='{{customSignBg}}' class="bg" mode="aspectFill"></image>
    <view class="signBox signBox{{sceneType}}">
        <view class="fItem" wx:if="{{miaoShopId}}">
            <text class="key key{{sceneType}}">性别：</text>
            <view class="sexGroup">
                <view class="sexItem sexItem{{sceneType}}" bindtap="chooseGender" data-gender='0'>
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/male.png' class="sexIcon"></image>
                    男
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/tickedIcon.png' class="tickedIcon" wx:if="{{gender === '0'}}"></image>
                </view>
                <view class="sexItem sexItem{{sceneType}}" bindtap="chooseGender" data-gender='1'>
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/female.png' class="sexIcon"></image>
                    女
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/tickedIcon.png' class="tickedIcon" wx:if="{{gender === '1'}}"></image>
                </view>
            </view>
        </view>
        <view class="fItem" wx:if="{{!isExamine}}">
            <text class="key key{{sceneType}}">祝福语：</text>
            <input bindblur="wishesBlur" name="wishes" placeholder='祝福语' maxlength="20" value="{{wish}}" placeholder-class="phcolor{{sceneType}}" class="iptPad ipt{{sceneType}}" disabled="{{isForbidSend}}"></input>
            <view class="refreshBtn refreshBtn{{sceneType}}" bindtap="refreshWish"></view>
        </view>
        <!-- 婚礼版独有 -->
        <view class="fItem" wx:if="{{!miaoShopId && sceneType === '0'}}">
            <text class="key key0">亲友团：</text>
            <view class="chooseGroup">
                <view class="chooseItem {{ role === '1'?'active':'' }}" catchtap="chooseRelatives" data-role="1">
                    <text>男方</text>
                </view>
                <view class="chooseItem {{ role === '2'?'active':'' }}" catchtap="chooseRelatives" data-role="2">
                    <text>女方</text>
                </view>
                <view class="chooseItem {{ role === ''?'active':'' }}" catchtap="chooseRelatives" data-role="">
                    <text>不选</text>
                </view>
            </view>
        </view>
        <view class="fItem" wx:if="{{!isExamine && (isForcePhone || miaoShopId)}}">
            <text class="key key{{sceneType}}">手机号：</text>
            <view class="getPhoneIpt getPhoneIpt{{sceneType}}" wx:if="{{!needInputPhone}}">
                {{phone ? phone: '获取手机号'}}
                <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="getPhoneBtn" wx:if="{{!phone}}">
                    获取手机号
                </button>
            </view>
            <input bindblur="phoneBlur" name="phone" placeholder='请输入手机号' maxlength="11" value="{{phone}}" placeholder-class="phcolor{{sceneType}}" class="iptPad ipt{{sceneType}}" wx:else focus="{{phoneInputFocus}}" type="number"></input>
            <view class="phoneIconBox phoneIconBox{{sceneType}}"></view>
        </view>
        <view class="fItem" wx:if="{{miaoShopId}}">
            <text class="key key{{sceneType}}">生日：</text>
            <picker mode="date" bindchange="handleBirthDateChange" value="{{birthDate}}">
                <view class="birthDate">
                    <view class="val">{{birthDate === '' ? '请选择' : birthDate}}</view>
                    <image src='https://static.joymew.com/joymewMp/joymewIndex/downArrow.png' class="downArrow"></image>
                </view>
            </picker>
        </view>
        <view class="signBtn signBtn{{sceneType}}" catchtap="sign">
            <text wx:if="{{sceneType !== '1'}}">点击进入</text>
        </view>
    </view>
</view>
````

## File: components/signCustom/signCustom.wxss
````
.signNew {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  perspective: 4000rpx;
}
.bg {
  width: 100%;
  height: 100%;
}

.signBox {
  width: 620rpx;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: absolute;
  bottom: 80rpx;
  padding-top: 40rpx;
  padding-bottom: 40rpx;
}

/* differance */
.signBox0,
.signBox54 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/box-04.png');
  width: 678rpx;
}

.signBox1 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/boxQy01.png');
}

.signBox2 {
  background-color: #dbfafe;
}

.signBox21,
.signBox24,
.signBox25 {
  background-color: #f9eded;
}

.signBox22 {
  background-color: #cf1820;
}

.signBox23 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/signBoxCrl.png');
}

.signBox41 {
  background: #d0efff;
}

.signBox42 {
  background: #fef188;
}

.signBox43 {
  background: #ffffd8;
}

.signBox51 {
  background: #2c3032;
}

.signBox52 {
  background: #ff9484;
}

.signBox53 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/signBoxBgHX.png');
}

.fItem {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 620rpx;
  padding: 0 40rpx;
  margin-bottom: 40rpx;
  position: relative;
}

.signBox0 .fItem , .signBox54 .fItem {
  align-items: unset;
  flex-direction: column;
}

.key {
  font-size: 32rpx;
  font-weight: 600;
}

/* differance */
.key0,
.key54 {
  color: #ee8b6b;
  margin-bottom: 20rpx;
  font-size: 28rpx;
}

.key2,
.key21,
.key23,
.key24,
.key25,
.key41,
.key42,
.key43,
.key52 {
  color: #333333;
}

.key1 {
  color: #facd7f;
}

.key22,
.key51,
.key53 {
  color: #ffffff;
}

input {
  width: 412rpx;
  height: 56rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  border-top: none;
  border-left: none;
  border-right: none;
  outline: none;
}

/* differance */
.ipt0,
.ipt54 {
  color: #333333;
  border-bottom: 2rpx solid #e8757e;
  width: 540rpx;
  font-size: 40rpx;
}

.ipt1,
.ipt53 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.ipt2,
.ipt21,
.ipt24,
.ipt25 {
  color: #333333;
  border-bottom: 1rpx solid rgba(51, 51, 51, 0.6);
}

.ipt22 {
  color: #ffffff;
  border-bottom: 1rpx solid #cc8c8c;
}

.ipt23 {
  color: #333333;
  border-bottom: 1rpx solid #54d5e9;
}

.ipt41 {
  color: #333333;
  border-bottom: 1rpx solid #efd1ee;
}

.ipt42 {
  color: #333333;
  border-bottom: 1rpx solid #e20013;
}

.ipt43 {
  color: #333333;
  border-bottom: 1rpx solid #ea002a;
}

.ipt51 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.ipt52 {
  color: #333333;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.phcolor0,
.phcolor54 {
  color: #000000;
}

.phcolor1,
.phcolor22,
.phcolor51 {
  color: #ffffff;
}

.phcolor2,
.phcolor23,
.phcolor25,
.phcolor41,
.phcolor42,
.phcolor43,
.phcolor52 {
  color: #333333;
}

.iptPad {
  padding-right: 70rpx;
}

.refreshBtn {
  width: 28rpx;
  height: 28rpx;
  background-size: 100% 100%;
  position: absolute;
  right: 35rpx;
  bottom: 17rpx;
}
/* differance */
.refreshBtn0,
.refreshBtn54 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/refreshIconPink.png');
  right: 42rpx;
}

.refreshBtn1,
.refreshBtn2,
.refreshBtn21,
.refreshBtn22,
.refreshBtn23,
.refreshBtn24,
.refreshBtn25,
.refreshBtn41,
.refreshBtn42,
.refreshBtn43,
.refreshBtn51 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/txhReloadIcon.png');
}

.refreshBtn52 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/qqyReloadIcon.png');
}

.refreshBtn53 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/bbyReloadIcon.png');
}

.phoneIconBox {
  width: 24rpx;
  height: 32rpx;
  position: absolute;
  right: 57rpx;
  bottom: 17rpx;
  background-size: 100% 100%;
}

/* differance */
.phoneIconBox0,
.phoneIconBox54 {
  background-image: url('https://static.joymew.com/joymewMpTql/signWedding/phoneIcon.png');
}

.phoneIconBox1,
.phoneIconBox2,
.phoneIconBox21,
.phoneIconBox22,
.phoneIconBox23,
.phoneIconBox24,
.phoneIconBox25,
.phoneIconBox41,
.phoneIconBox42,
.phoneIconBox43,
.phoneIconBox51,
.phoneIconBox52,
.phoneIconBox53 {
  background-image: url('https://static.joymew.com/joymewMpTql/signTXH/phoneIcon.png');
}

.chooseGroup {
  width: 540rpx;
  height: 56rpx;
  box-sizing: border-box;
  display: flex;
  justify-content: space-around;
}

.chooseGroup>.chooseItem {
  width: 170rpx;
  height: 56rpx;
  background: rgba(122, 97, 230, 0.4);
  border-radius: 28rpx;
  font-size: 28rpx;
  font-weight: 400;
  text-align: center;
  line-height: 56rpx;
  color: #ffffff;
}

.chooseGroup>.chooseItem.active {
  background: #7a61e6;
}

.sexGroup {
  width: 412rpx;
  height: 59rpx;
  display: flex;
  justify-content: space-around;
}

.sexGroup>.sexItem {
  display: flex;
  align-items: center;
  position: relative;
  font-size: 32rpx;
  font-weight: 400;
  text-align: center;
}

/* differance */
.sexItem0,
.sexItem2,
.sexItem21,
.sexItem23,
.sexItem24,
.sexItem25,
.sexItem41,
.sexItem42,
.sexItem43,
.sexItem52,
.sexItem54 {
  color: #333333;
}

.sexItem1,
.sexItem22,
.sexItem51,
.sexItem53 {
  color: #ffffff;
}

.sexGroup .sexItem>.sexIcon {
  width: 59rpx;
  height: 59rpx;
  display: flex;
  align-items: center;
  margin-right: 17rpx;
}

.sexGroup .sexItem>.tickedIcon {
  position: absolute;
  width: 20rpx;
  height: 20rpx;
  top: 38rpx;
  left: 40rpx;
}

.getPhoneIpt {
  position: relative;
  z-index: 1;
  width: 412rpx;
  height: 56rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  border-bottom: 2rpx solid #666666;
  padding-right: 68rpx;
}

/* differance */
.getPhoneIpt0,
.getPhoneIpt54 {
  width: 540rpx;
  border-bottom: 2rpx solid #e8757e;
  font-size: 40rpx;
}

.getPhoneIpt2,
.getPhoneIpt21 {
  color: #333333;
}

.getPhoneIpt1 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.getPhoneIpt22 {
  color: #ffffff;
  border-bottom: 1rpx solid #cc8c8c;
}

.getPhoneIpt23 {
  color: #333333;
  border-bottom: 1rpx solid #54d5e9;
}

.getPhoneIpt24,
.getPhoneIpt25 {
  color: #333333;
  border-bottom: 1rpx solid rgba(51, 51, 51, 0.6);
}

.getPhoneIpt41 {
  color: #333333;
  border-bottom: 1rpx solid #efd1ee;
}

.getPhoneIpt42 {
  color: #333333;
  border-bottom: 1rpx solid #e20013;
}

.getPhoneIpt43 {
  color: #333333;
  border-bottom: 1rpx solid #ea002a;
}

.getPhoneIpt51,
.getPhoneIpt53 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.getPhoneIpt52 {
  color: #333333;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}

.getPhoneIpt>.getPhoneBtn {
  width: 100%;
  height: 100%;
  opacity: 0;
  background-color: transparent;
  position: absolute;
  right: 0;
  top: 0;
}

.birthDate {
  width: 412rpx;
  height: 56rpx;
  background: #ffffff;
  border-radius: 4rpx;
  position: absolute;
  right: 55rpx;
  top: -8rpx;
}

.birthDate>.downArrow {
  width: 27rpx;
  height: 14rpx;
  position: absolute;
  right: 15rpx;
  bottom: 21rpx;
  transition: all 0.1s linear;
}

.birthDate>.val {
  width: 80%;
  height: 100%;
  position: absolute;
  font-size: 32rpx;
  font-weight: 400;
  color: #666666;
  line-height: 56rpx;
  padding-left: 18rpx;
}

.signBtn {
  width: 380rpx;
  height: 72rpx;
  border-radius: 36rpx;
  font-size: 32rpx;
  font-weight: 500;
  margin-top: 8rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* differance */
.signBtn0,
.signBtn54 {
  background: linear-gradient(180deg, #e87080 0%, #ee8b6b 100%);
  color: #ffffff;
}

.signBtn1 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/signBtnQy01.png');
  background-size: 100% 100%;
}

.signBtn2,
.signBtn21,
.signBtn24,
.signBtn25 {
  background: #fab0ce;
  color: #ffffff;
}

.signBtn22 {
  background: #fddd97;
  color: #ffffff;
}

.signBtn23,
.signBtn41 {
  background: #54d5e9;
  color: #ffffff;
}

.signBtn42 {
  background: #e20013;
  color: #ffffff;
}

.signBtn43 {
  background: #ea002a;
  color: #ffffff;
}

.signBtn51 {
  background: #beb161;
  color: #ffffff;
}

.signBtn52 {
  background: #ef2152;
  color: #ffffff;
}

.signBtn53 {
  background: #b3e0ee;
  color: #ffffff;
}
````

## File: components/signLz/signLz.js
````javascript
import {
  showWxToast,
  timeoutTask
} from '../../utils/index';
import {
  authGetPhoneByCode
} from '../../api/login';

const tmpDeskList = [];
for (let i = 0; i < 90; i += 1) {
  if (i < 3) {
    tmpDeskList.push(i + 1);
  } else if (i < 12) {
    tmpDeskList.push(i + 2);
  } else if (i < 21) {
    tmpDeskList.push(i + 3);
  } else if (i < 30) {
    tmpDeskList.push(i + 4);
  } else if (i < 39) {
    tmpDeskList.push(i + 5);
  } else if (i < 48) {
    tmpDeskList.push(i + 6);
  } else if (i < 57) {
    tmpDeskList.push(i + 7);
  } else if (i < 66) {
    tmpDeskList.push(i + 8);
  } else if (i < 75) {
    tmpDeskList.push(i + 9);
  } else if (i < 84) {
    tmpDeskList.push(i + 10);
  } else {
    tmpDeskList.push(i + 11);
  }
}

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    activityTitle: {
      value: '',
      type: String,
    },
    userNameProp: {
      value: '',
      type: String,
    },
    wishProp: {
      value: '',
      type: String,
    },
    isExamine: {
      value: false,
      type: Boolean,
    },
    sceneType: {
      value: '',
      type: String,
    },
    wxGetPhoneButtonVisible: {
      value: false,
      type: Boolean,
    },
  },
  observers: {
    userNameProp: function (userNameProp) {
      this.setData({
        userName: userNameProp,
      });
    },
    wishProp: function (wishProp) {
      this.setData({
        wish: wishProp,
      });
    },
    wxGetPhoneButtonVisible: function(newVal) {
      this.setData({
        needInputPhone: !newVal
      });
    },
  },
  attached() {
    console.log('attached');
  },
  data: {
    userName: '', // 姓名
    wish: '', // 祝福语
    phone: '', // 手机号
    deskNum: '', // 桌号
    deskList: tmpDeskList,
    role: '', // 亲友类型 1:男方亲友 2:女方亲友  '': 不选
    needInputPhone: false,
    phoneInputFocus: false,
  },
  /**
   * 组件的方法列表
   */
  methods: {
    userNameBlur(e) {
      console.log('***userNameBlur***');
      this.setData({
        userName: e.detail.value,
      });
    },
    wishesBlur(e) {
      console.log('***wishesBlur***');
      if (e.detail.value) {
        this.setData({
          wish: e.detail.value,
        });
      }
    },
    phoneBlur(e) {
      console.log('***phoneBlur***');
      if (e.detail.value) {
        this.setData({
          phone: e.detail.value,
          phoneInputFocus: false,
        });
      }
    },
    // 选择亲友
    chooseRelatives(e) {
      console.log('***chooseRelatives***');
      console.log(e);
      this.setData({
        role: e.currentTarget.dataset.role,
      });
    },
    handlePickerChange: function (e) {
      console.log(e.detail.value);
      let tmpDeskNum = this.data.deskNum;
      tmpDeskNum = this.data.deskList[e.detail.value];
      this.setData({
        deskNum: tmpDeskNum,
      });
    },
    sign() {
      // if (!this.data.userName) {
      //   showWxToast('贵宾姓名不能为空!');
      //   return;
      // }
      if (!this.data.isExamine) {
        if (!this.data.wish) {
          showWxToast('祝福语不能为空!');
          return;
        }
        if (!this.data.phone) {
          showWxToast('手机号不能为空!');
          this.setData({
            needInputPhone: true,
            phoneInputFocus: true
          });
          return;
        }
        if (this.data.phone.length !== 11) {
          showWxToast('手机号格式错误!');
          return;
        }
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.phone);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        userPhone: this.data.phone,
        role: this.data.role,
        deskNum: this.data.deskNum,
      });
    },
    refreshWish() {
      this.triggerEvent('refreshWishEvent');
    },
    personInputPhone() {
      showWxToast('请输入手机号!');
      // 手机输入框显示
      this.setData({
        needInputPhone: true,
      })
      // 延迟0.3s输入框聚焦
      timeoutTask(() => {
        this.setData({
          phoneInputFocus: true
        })
      }, 300);
    },
    getPhoneNumber: function (e) {
      console.log('******getPhoneNumber方法内部*******');
      console.log(e.detail.code);
      console.log(e.detail.errno);
      if (e.detail.errno === 1400001 || !e.detail.code) {
        this.personInputPhone();
        return;
      }
      try {
        authGetPhoneByCode({
            code: e.detail.code
          })
          .then(res => {
            console.log(res);
            if (res && res.phone_info && res.phone_info.phoneNumber) {
              this.setData({
                phone: res.phone_info.phoneNumber,
              });
            } else {
              this.personInputPhone();
            }
          })
          .catch(err => {
            console.log(err);
            this.personInputPhone();
          });
      } catch (err) {
        console.log(err);
        this.personInputPhone();
      }
    }
  },
});
````

## File: components/signLz/signLz.json
````json
{
    "component": true
}
````

## File: components/signLz/signLz.wxml
````
<!-- 狼尊定制 -->
<view class="signNew">
  <image src="https://ustatic.hudongmiao.com/joymewMpTql/hk_slogan.png" class="hk_slogan" mode="widthFix"></image>
  <image src="https://ustatic.hudongmiao.com/joymewMpTql/hk_title.png" class="hk_title" mode="widthFix"></image>
  <image src="https://ustatic.hudongmiao.com/joymewMpTql/hk_benifit.png" class="hk_benifit" mode="widthFix"></image>
  <view class="newdate-slogan">— 开启婚庆获客2.0时代 —</view>
  <view class="signBox">
    <view class="welcom-eng">Welcome to join us</view>
    <view class="welcom-cn">欢迎加入我们</view>
    
    <view class="fItem" wx:if="{{!isExamine}}">
      <text class="key">手机号：</text>
      <view class="getPhoneIpt {{phone ? 'hasPhone' : ''}}" wx:if="{{!needInputPhone}}">
        {{phone ? phone: '获取手机号'}}
        <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="getPhoneBtn" wx:if="{{!phone}}">
          获取手机号
        </button>
      </view>
      <input bindblur="phoneBlur" name="phone" placeholder='请输入手机号' maxlength="11" class="namIpt" value="{{phone}}" focus="{{phoneInputFocus}}" type="number" wx:else></input>
      <image src="https://ustatic.hudongmiao.com/joymewMpTql/phone_icon.png" class="phoneIcon"></image>
    </view>
     <view class="fItem" wx:if="{{!isExamine}}">
      <text class="key">签到语：</text>
      <input bindblur="wishesBlur" name="wishes" placeholder='祝福语' maxlength="20" value="{{wish}}" class="iptPad"></input>
      <image src="https://ustatic.hudongmiao.com/joymewMpTql/refresh_icon.png" class="refreshBtn" bindtap="refreshWish"></image>
    </view>
    <!-- <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="signBtn" wx:if="{{!phone}}" data-type="signBtn">
      点击进入
    </button> -->
    <view class="signBtn" catchtap="sign">点击进入</view>
  </view>
  <view class="bottom-slogan-wrap">
    <view class="slogan-strong">嗨喵 让获客更简单</view>
    <view class="slogan-common">欢聚时刻 嗨喵相伴</view>
  </view>
</view>
````

## File: components/signLz/signLz.wxss
````
.signNew {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  background-image: url('https://ustatic.hudongmiao.com/joymewMpTql/lz-bg.png');
  background-color: #0f1019;
}

.hk_slogan {
  width: 216rpx;
  height: 60rpx;
}

.hk_title {
  width: 552rpx;
  height: 132rpx;
  margin-top: 8rpx;
}

.hk_benifit {
  width: 520rpx;
  height: 48rpx;
  margin-top: 16rpx;
}

.newdate-slogan {
  font-size: 32rpx;
  font-weight: 500;
  color: #ffffff;
  margin-top: 34rpx;
}

.signBox {
  width: 654rpx;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 32rpx;
  padding-bottom: 56rpx;
  background-color: rgba(255, 255, 255, 0.30);
  border: 2rpx solid;
  border-image: linear-gradient(145deg, #ffffff 0%, rgba(255, 255, 255, 0.00) 100%, #ffffff 100%) 1 1;
  border-radius: 8rpx;
  margin-top: 64rpx;
}

.welcom-eng {
  font-size: 24rpx;
  font-weight: 400;
  color: #ffffff;
}

.welcom-cn {
  font-size: 36rpx;
  font-family: PingFang SC, PingFang SC-Medium;
  font-weight: 500;
  text-align: LEFT;
  color: #ffffff;
  line-height: 48rpx;
}

.fItem {
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  width: 586rpx;
  margin-bottom: 48rpx;
  position: relative;
}

.key {
  font-size: 32rpx;
  font-weight: 600;
  color: #FFFFFF;
}

input {
  width: 382rpx;
  height: 54rpx;
  border-radius: 4rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  outline: none;
  color: #333333;
}

.iptPad {
  padding-right: 60rpx;
  padding-left: 20rpx;
  width: 586rpx;
  height: 62rpx;
  margin-top: 10rpx;
  font-size: 36rpx;
  background-color: #ffffff;
}

.namIpt {
  width: 586rpx;
  height: 62rpx;
  font-size: 36rpx;
  margin-top: 10rpx;
  padding-right: 20rpx;
  padding-left: 20rpx;
  background-color: #ffffff;
}

.refreshBtn {
  width: 40rpx;
  height: 40rpx;
  position: absolute;
  right: 12rpx;
  bottom: 12rpx;
}

.phoneIconBox {
  width: 24rpx;
  height: 30rpx;
  position: absolute;
  right: 57rpx;
  bottom: 17rpx;
  background-size: 100% 100%;
}

.chooseGroup {
  width: 586rpx;
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  margin-top: 10rpx;
}

.chooseGroup>.chooseItem {
  width: 158rpx;
  height: 72rpx;
  background: #ffffff;
  border-radius: 58rpx;
  font-size: 28rpx;
  font-weight: 400;
  text-align: center;
  line-height: 72rpx;
  color: #ECC697;
}

.chooseGroup>.chooseItem.active {
  background: #deac81;
  color: #ffffff;
}

.sexGroup {
  width: 412rpx;
  height: 54rpx;
  display: flex;
  justify-content: space-around;
}

.sexGroup>.sexItem {
  display: flex;
  align-items: center;
  position: relative;
  font-size: 32rpx;
  font-weight: 400;
  text-align: center;
  color: #333333;
}

.sexGroup .sexItem>.sexIcon {
  width: 59rpx;
  height: 59rpx;
  display: flex;
  align-items: center;
  margin-right: 17rpx;
}

.sexGroup .sexItem>.tickedIcon {
  position: absolute;
  width: 20rpx;
  height: 20rpx;
  top: 38rpx;
  left: 40rpx;
}

.getPhoneIpt {
  position: relative;
  z-index: 1;
  width: 586rpx;
  height: 62rpx;
  font-size: 36rpx;
  font-weight: normal;
  background-color: #ffffff;
  padding-right: 68rpx;
  padding-left: 20rpx;
  color: #333333;
  margin-top: 10rpx;
  display: flex;
  align-items: center;
}

.getPhoneIpt.hasPhone {
  color: #333333;
}

.getPhoneIpt>.getPhoneBtn {
  width: 100%;
  height: 100%;
  opacity: 0;
  background-color: transparent;
  position: absolute;
  right: 0;
  top: 0;
}

.phoneIcon {
  width: 44rpx;
  height: 44rpx;
  position: absolute;
  right: 0;
  z-index: 9999;
  top: 62rpx;
  z-index: 9999;
}

.deskNum {
  width: 586rpx;
  height: 62rpx;
  background: #ffffff;
  border-radius: 4rpx;
  position: relative;
  margin-top: 10rpx;
}

.deskNum>.downArrow {
  width: 22rpx;
  height: 12rpx;
  position: absolute;
  right: 12rpx;
  bottom: 21rpx;
  transition: all 0.1s linear;
}

.deskNum>.val {
  width: 80%;
  height: 100%;
  position: absolute;
  font-size: 32rpx;
  font-weight: 400;
  color: #333333;
  line-height: 54rpx;
  padding-left: 10rpx;
}

.signBtn {
  width: 578rpx;
  height: 72rpx;
  border-radius: 58rpx;
  font-size: 28rpx;
  font-weight: 500;
  margin-top: 48rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #ECC697;
  color: #FFFFFF;
}

.bottom-slogan-wrap {
  position: absolute;
  bottom: 54rpx;
}

.slogan-strong {
  font-size: 28rpx;
  font-weight: 500;
  color: #ffffff;
  text-align: center;
}

.slogan-common {
  font-size: 24rpx;
  font-weight: 400;
  color: #ffffff;
  margin-top: 14rpx;
  text-align: center;
}

@media screen and (max-height: 720px) {
  .newdate-slogan {
    margin-top: 20rpx;
  }
  .signBox {
    margin-top: 20rpx;
  }

  .bottom-slogan-wrap {
    bottom: 20rpx;
  }
}
````

## File: components/signYj/signYj.js
````javascript
import {
  showWxToast,
  timeoutTask
} from '../../utils/index';
import {
  authGetPhoneByCode
} from '../../api/login';

const tmpDeskList = [];
for (let i = 0; i < 90; i += 1) {
  if (i < 3) {
    tmpDeskList.push(i + 1);
  } else if (i < 12) {
    tmpDeskList.push(i + 2);
  } else if (i < 21) {
    tmpDeskList.push(i + 3);
  } else if (i < 30) {
    tmpDeskList.push(i + 4);
  } else if (i < 39) {
    tmpDeskList.push(i + 5);
  } else if (i < 48) {
    tmpDeskList.push(i + 6);
  } else if (i < 57) {
    tmpDeskList.push(i + 7);
  } else if (i < 66) {
    tmpDeskList.push(i + 8);
  } else if (i < 75) {
    tmpDeskList.push(i + 9);
  } else if (i < 84) {
    tmpDeskList.push(i + 10);
  } else {
    tmpDeskList.push(i + 11);
  }
}

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    activityTitle: {
      value: '',
      type: String,
    },
    userNameProp: {
      value: '',
      type: String,
    },
    wishProp: {
      value: '',
      type: String,
    },
    isExamine: {
      value: false,
      type: Boolean,
    },
    sceneType: {
      value: '',
      type: String,
    },
    wxGetPhoneButtonVisible: {
      value: false,
      type: Boolean,
    },
    // customBg: {
    //   value: '',
    //   type: String,
    // }
  },
  observers: {
    userNameProp: function (userNameProp) {
      this.setData({
        userName: userNameProp,
      });
    },
    wishProp: function (wishProp) {
      this.setData({
        wish: wishProp,
      });
    },
    wxGetPhoneButtonVisible: function(newVal) {
      this.setData({
        needInputPhone: !newVal
      });
    },
  },
  attached() {
    console.log('attached');
  },
  data: {
    userName: '', // 姓名
    wish: '', // 祝福语
    phone: '', // 手机号
    deskNum: '', // 桌号
    deskList: tmpDeskList,
    role: '', // 亲友类型 1:男方亲友 2:女方亲友  '': 不选
    needInputPhone: false,
    phoneInputFocus: false,
  },
  /**
   * 组件的方法列表
   */
  methods: {
    userNameBlur(e) {
      console.log('***userNameBlur***');
      this.setData({
        userName: e.detail.value,
      });
    },
    wishesBlur(e) {
      console.log('***wishesBlur***');
      if (e.detail.value) {
        this.setData({
          wish: e.detail.value,
        });
      }
    },
    phoneBlur(e) {
      console.log('***phoneBlur***');
      if (e.detail.value) {
        this.setData({
          phone: e.detail.value,
          phoneInputFocus: false,
        });
      }
    },
    // 选择亲友
    chooseRelatives(e) {
      console.log('***chooseRelatives***');
      console.log(e);
      this.setData({
        role: e.currentTarget.dataset.role,
      });
    },
    handlePickerChange: function (e) {
      console.log(e.detail.value);
      let tmpDeskNum = this.data.deskNum;
      tmpDeskNum = this.data.deskList[e.detail.value];
      this.setData({
        deskNum: tmpDeskNum,
      });
    },
    sign() {
      // if (!this.data.userName) {
      //   showWxToast('贵宾姓名不能为空!');
      //   return;
      // }
      if (!this.data.isExamine) {
        if (!this.data.wish) {
          showWxToast('祝福语不能为空!');
          return;
        }
        if (!this.data.phone) {
          showWxToast('手机号不能为空!');
          this.setData({
            needInputPhone: true,
            phoneInputFocus: true
          });
          return;
        }
        if (this.data.phone.length !== 11) {
          showWxToast('手机号格式错误!');
          return;
        }
      }
      console.log(this.data.userName);
      console.log(this.data.wish);
      console.log(this.data.phone);
      console.log(this.data.role);
      console.log(this.data.deskNum);
      this.triggerEvent('signEvent', {
        userName: this.data.userName,
        wish: this.data.wish,
        userPhone: this.data.phone,
        role: this.data.role,
        deskNum: this.data.deskNum,
      });
    },
    refreshWish() {
      this.triggerEvent('refreshWishEvent');
    },
    personInputPhone() {
      showWxToast('请输入手机号!');
      // 手机输入框显示
      this.setData({
        needInputPhone: true,
      })
      // 延迟0.3s输入框聚焦
      timeoutTask(() => {
        this.setData({
          phoneInputFocus: true
        })
      }, 300);
    },
    getPhoneNumber: function (e) {
      console.log('******getPhoneNumber方法内部*******');
      console.log(e.detail.code);
      console.log(e.detail.errno);
      if (e.detail.errno === 1400001 || !e.detail.code) {
        this.personInputPhone();
        return;
      }
      try {
        authGetPhoneByCode({
            code: e.detail.code
          })
          .then(res => {
            console.log(res);
            if (res && res.phone_info && res.phone_info.phoneNumber) {
              this.setData({
                phone: res.phone_info.phoneNumber,
              });
            } else {
              this.personInputPhone();
            }
          })
          .catch(err => {
            console.log(err);
            this.personInputPhone();
            // showWxToast(JSON.stringify(err));
          });
      } catch (err) {
        console.log(err);
        this.personInputPhone();
        // showWxToast(JSON.stringify(err));
      }
    }
  },
});
````

## File: components/signYj/signYj.json
````json
{
    "component": true
}
````

## File: components/signYj/signYj.wxml
````
<!-- 云境定制 -->
<view class="signNew">
    <!-- <image src="{{customBg}}" class="customBg" mode="aspectFit"></image> -->
    <image src="https://ustatic.hudongmiao.com/joymewMpTql/signWedding/yjBgtite.png" class="yjBgtite" mode="widthFix"></image>
    <view class="signBox">
        <image src="https://ustatic.hudongmiao.com/joymewMpTql/signWedding/yjBgtit.png" class="yjBgtit" mode="widthFix"></image>
        <!-- <view class="fItem">
            <text class="key">姓名：</text>
            <input bindblur="userNameBlur" name="userName" placeholder='请输入您的姓名' maxlength="12" class="namIpt" value="{{userName}}"></input>
        </view> -->
        <view class="fItem" wx:if="{{!isExamine}}">
            <text class="key">手机号：</text>
            <view class="getPhoneIpt {{phone ? 'hasPhone' : ''}}" wx:if="{{!needInputPhone}}">
                {{phone ? phone: '获取手机号'}}
                <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="getPhoneBtn" wx:if="{{!phone}}">
                    获取手机号
                </button>
            </view>
            <input bindblur="phoneBlur" name="phone" placeholder='请输入手机号' maxlength="11" class="namIpt" value="{{phone}}" focus="{{phoneInputFocus}}" type="number" wx:else></input>
            <image src="/assets/image/phone.png" class="phoneIcon"></image>
        </view>
        <view class="fItem" wx:if="{{!isExamine}}">
            <text class="key">祝福语：</text>
            <input bindblur="wishesBlur" name="wishes" placeholder='祝福语' maxlength="20" value="{{wish}}" class="iptPad"></input>
            <image class="refreshBtn" bindtap="refreshWish" src="/assets/image/refresh.png"></image>
        </view>
        <view class="fItem" wx:if="{{sceneType === '0'}}">
            <text class="key">亲友团：</text>
            <view class="chooseGroup">
                <view class="chooseItem {{ role === '1'?'active':'' }}" catchtap="chooseRelatives" data-role="1">
                    <text>男方</text>
                </view>
                <view class="chooseItem {{ role === '2'?'active':'' }}" catchtap="chooseRelatives" data-role="2">
                    <text>女方</text>
                </view>
                <view class="chooseItem {{ role === ''?'active':'' }}" catchtap="chooseRelatives" data-role="">
                    <text>不选</text>
                </view>
            </view>
        </view>
        <view class="fItem" wx:if="{{sceneType === '0'}}">
            <text class="key">桌号：</text>
            <picker value="{{deskNum}}" range="{{deskList}}" bindchange="handlePickerChange" style="height: 40rpx">
                <view class="deskNum">
                    <view class="val">{{deskNum === '' ? '请选择' : deskNum}}</view>
                    <image src='https://static.joymew.com/joymewMp/joymewIndex/downArrow.png' class="downArrow"></image>
                </view>
            </picker>
        </view>
        <!-- <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="signBtn" wx:if="{{!phone}}" data-type="signBtn">
            点击进入
        </button> -->
        <view class="signBtn" catchtap="sign">点击进入</view>
    </view>
</view>
````

## File: components/signYj/signYj.wxss
````
.signNew {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  background-image: url('https://ustatic.hudongmiao.com/joymewMpTql/signWedding/yunjinBg2.png');
  background-color: #0f1019;
}
.customBg {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}
.yjBgtite {
  width: 320rpx;
  height: 125rpx;
  position: absolute;
  top: 40rpx;
}
.yjBgtit {
  width: 380rpx;
  height: 134rpx;
}
.signBox {
  width: 680rpx;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: absolute;
  top: 148rpx;
  padding: 40rpx 0;
  border-bottom: 2rpx solid #deac81;
  border-right: 2rpx solid #deac81;
  border-left: 2rpx solid #deac81;
}
.fItem {
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  width: 586rpx;
  margin-bottom: 20rpx;
  position: relative;
}
.key {
  font-size: 36rpx;
  font-weight: 600;
  color: #deac81;
}
input {
  width: 382rpx;
  height: 54rpx;
  border-radius: 4rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  outline: none;
  color: #333333;
}
.iptPad {
  padding-right: 60rpx;
  padding-left: 20rpx;
  width: 586rpx;
  height: 62rpx;
  margin-top: 10rpx;
  font-size: 36rpx;
  background-color: #ffffff;
}
.namIpt {
  width: 586rpx;
  height: 62rpx;
  font-size: 36rpx;
  margin-top: 10rpx;
  padding-right: 20rpx;
  padding-left: 20rpx;
  background-color: #ffffff;
}
.refreshBtn {
  width: 30rpx;
  height: 30rpx;
  position: absolute;
  right: 12rpx;
  bottom: 12rpx;
}
.phoneIconBox {
  width: 24rpx;
  height: 30rpx;
  position: absolute;
  right: 57rpx;
  bottom: 17rpx;
  background-size: 100% 100%;
}
.chooseGroup {
  width: 586rpx;
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  margin-top: 10rpx;
}
.chooseGroup > .chooseItem {
  width: 105rpx;
  height: 54rpx;
  background: #ffffff;
  border-radius: 10rpx;
  font-size: 32rpx;
  font-weight: 400;
  text-align: center;
  line-height: 52rpx;
  color: #000000;
}
.chooseGroup > .chooseItem.active {
  background: #deac81;
}
.sexGroup {
  width: 412rpx;
  height: 54rpx;
  display: flex;
  justify-content: space-around;
}
.sexGroup > .sexItem {
  display: flex;
  align-items: center;
  position: relative;
  font-size: 32rpx;
  font-weight: 400;
  text-align: center;
  color: #333333;
}
.sexGroup .sexItem > .sexIcon {
  width: 59rpx;
  height: 59rpx;
  display: flex;
  align-items: center;
  margin-right: 17rpx;
}
.sexGroup .sexItem > .tickedIcon {
  position: absolute;
  width: 20rpx;
  height: 20rpx;
  top: 38rpx;
  left: 40rpx;
}
.getPhoneIpt {
  position: relative;
  z-index: 1;
  width: 586rpx;
  height: 62rpx;
  font-size: 36rpx;
  font-weight: normal;
  background-color: #ffffff;
  padding-right: 68rpx;
  padding-left: 20rpx;
  color: #333333;
  margin-top: 10rpx;
  display: flex;
  align-items: center;
}
.getPhoneIpt.hasPhone {
  color: #333333;
}
.getPhoneIpt > .getPhoneBtn {
  width: 100%;
  height: 100%;
  opacity: 0;
  background-color: transparent;
  position: absolute;
  right: 0;
  top: 0;
}
.phoneIcon {
  width: 48rpx;
  height: 48rpx;
  position: absolute;
  right: 0;
  top: 62rpx;
  z-index: 9999;
}

.deskNum {
  width: 586rpx;
  height: 62rpx;
  background: #ffffff;
  border-radius: 4rpx;
  position: relative;
  margin-top: 10rpx;
}
.deskNum > .downArrow {
  width: 22rpx;
  height: 12rpx;
  position: absolute;
  right: 12rpx;
  bottom: 21rpx;
  transition: all 0.1s linear;
}
.deskNum > .val {
  width: 80%;
  height: 100%;
  position: absolute;
  font-size: 32rpx;
  font-weight: 400;
  color: #333333;
  line-height: 54rpx;
  padding-left: 10rpx;
}
.signBtn {
  width: 586rpx;
  height: 78rpx;
  border-radius: 12rpx;
  font-size: 32rpx;
  font-weight: 500;
  margin-top: 35rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #deac81;
  color: #333333;
}
@media screen and (min-height: 720px) {
  .yjBgtite {
    top: 80rpx;
  }
  .signBox {
    top: 320rpx;
  }
}
````

## File: libs/svgaplayer.weapp.js
````javascript
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SVGA=t()}}((function(){return function t(e,r,i){function n(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[s]={exports:{}};e[s][0].call(l.exports,(function(t){return n(e[s][1][t]||t)}),l,l.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){"use strict";e.exports=function(){var e={};function r(){e.converter._configure(),e.decoder._configure(),e.Field._configure(),e.MapField._configure(),e.Message._configure(),e.Namespace._configure(),e.Method._configure(),e.ReflectionObject._configure(),e.OneOf._configure(),e.parse._configure(),e.Reader._configure(),e.Root._configure(),e.Service._configure(),e.verifier._configure(),e.Type._configure(),e.types._configure(),e.wrappers._configure(),e.Writer._configure()}if(e.build="minimal",e.Writer=t(34),e.Reader=t(22),e.util=t(31),e.rpc=t(25),e.roots=t(24),e.verifier=t(32),e.tokenize=t(27),e.parse=t(19),e.common=t(5),e.ReflectionObject=t(17),e.Namespace=t(16),e.Root=t(23),e.Enum=t(8),e.Type=t(28),e.Field=t(9),e.OneOf=t(18),e.MapField=t(13),e.Service=t(26),e.Method=t(15),e.converter=t(6),e.decoder=t(7),e.Message=t(14),e.wrappers=t(33),e.types=t(29),e.util=t(31),e.configure=r,e.load=function(t,r,i){return"function"==typeof r?(i=r,r=new e.Root):r||(r=new e.Root),r.load(t,i)},e.loadSync=function(t,r){return r||(r=new e.Root),r.loadSync(t)},e.parseFromPbString=function(t,r,i){return"function"==typeof r?(i=r,r=new e.Root):r||(r=new e.Root),r.parseFromPbString(t,i)},r(),arguments&&arguments.length)for(var i=0;i<arguments.length;i++){var n=arguments[i];if(n.hasOwnProperty("exports"))return void(n.exports=e)}return e}()},{13:13,14:14,15:15,16:16,17:17,18:18,19:19,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,31:31,32:32,33:33,34:34,5:5,6:6,7:7,8:8,9:9}],24:[function(t,e,r){"use strict";e.exports={}},{}],27:[function(t,e,r){"use strict";e.exports=d;var i=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,o=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,s=/^ *[*/]+ */,a=/^\s*\*?\/*/,u=/\n/g,h=/\s/,l=/\\(.?)/g,f={0:"\0",r:"\r",n:"\n",t:"\t"};function c(t){return t.replace(l,(function(t,e){switch(e){case"\\":case"":return e;default:return f[e]||""}}))}function d(t,e){t=t.toString();var r=0,l=t.length,f=1,d=null,p=null,y=0,m=!1,v=[],g=null;function b(t){return Error("illegal "+t+" (line "+f+")")}function w(e){return t.charAt(e)}function _(r,i){d=t.charAt(r++),y=f,m=!1;var n,o=r-(e?2:3);do{if(--o<0||"\n"===(n=t.charAt(o))){m=!0;break}}while(" "===n||"\t"===n);for(var h=t.substring(r,i).split(u),l=0;l<h.length;++l)h[l]=h[l].replace(e?a:s,"").trim();p=h.join("\n").trim()}function x(e){var r=k(e),i=t.substring(e,r);return/^\s*\/{1,2}/.test(i)}function k(t){for(var e=t;e<l&&"\n"!==w(e);)e++;return e}function A(){if(v.length>0)return v.shift();if(g)return function(){var e="'"===g?o:n;e.lastIndex=r-1;var i=e.exec(t);if(!i)throw b("string");return r=e.lastIndex,O(g),g=null,c(i[1])}();var s,a,u,d,p;do{if(r===l)return null;for(s=!1;h.test(u=w(r));)if("\n"===u&&++f,++r===l)return null;if("/"===w(r)){if(++r===l)throw b("comment");if("/"===w(r))if(e){if(d=r,p=!1,x(r)){p=!0;do{if((r=k(r))===l)break;r++}while(x(r))}else r=Math.min(l,k(r)+1);p&&_(d,r),f++,s=!0}else{for(p="/"===w(d=r+1);"\n"!==w(++r);)if(r===l)return null;++r,p&&_(d,r-1),++f,s=!0}else{if("*"!==(u=w(r)))return"/";d=r+1,p=e||"*"===w(d);do{if("\n"===u&&++f,++r===l)throw b("comment");a=u,u=w(r)}while("*"!==a||"/"!==u);++r,p&&_(d,r-2),s=!0}}}while(s);var y=r;if(i.lastIndex=0,!i.test(w(y++)))for(;y<l&&!i.test(w(y));)++y;var m=t.substring(r,r=y);return'"'!==m&&"'"!==m||(g=m),m}function O(t){v.push(t)}function S(){if(!v.length){var t=A();if(null===t)return null;O(t)}return v[0]}return Object.defineProperty({next:A,peek:S,push:O,skip:function(t,e){var r=S();if(r===t)return A(),!0;if(!e)throw b("token '"+r+"', '"+t+"' expected");return!1},cmnt:function(t){var r=null;return void 0===t?y===f-1&&(e||"*"===d||m)&&(r=p):(y<t&&S(),y!==t||m||!e&&"/"!==d||(r=p)),r}},"line",{get:function(){return f}})}d.unescape=c},{}],5:[function(t,e,r){"use strict";e.exports=o;var i,n=/\/|\./;function o(t,e){n.test(t)||(t="google/protobuf/"+t+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),o[t]=e}o("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),o("duration",{Duration:i={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),o("timestamp",{Timestamp:i}),o("empty",{Empty:{fields:{}}}),o("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),o("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),o("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),o.get=function(t){return o[t]||null}},{}],22:[function(t,e,r){"use strict";e.exports=a;var i,n,o=t(31);function s(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function a(t){this.buf=t,this.pos=0,this.len=t.length}var u,h="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new a(t);if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer)return new a(new Uint8Array(t));throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new a(t);throw Error("illegal buffer")};function l(){var t=new i(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw s(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw s(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function f(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function c(){if(this.pos+8>this.len)throw s(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}a.create=o.Buffer?function(t){return(a.create=function(t){return o.Buffer.isBuffer(t)?new(void 0)(t):h(t)})(t)}:h,a.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,a.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),a.prototype.int32=function(){return 0|this.uint32()},a.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},a.prototype.bool=function(){return 0!==this.uint32()},a.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|f(this.buf,this.pos+=4)},a.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var t=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},a.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var t=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},a.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw s(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,r):e===r?new this.buf.constructor(0):this._slice.call(this.buf,e,r)},a.prototype.string=function(){var t=this.bytes();return n.read(t,0,t.length)},a.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw s(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},a.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},a._configure=function(){i=t(12),n=t(30);var e=o.Long?"toLong":"toNumber";o.merge(a.prototype,{int64:function(){return l.call(this)[e](!1)},uint64:function(){return l.call(this)[e](!0)},sint64:function(){return l.call(this).zzDecode()[e](!1)},fixed64:function(){return c.call(this)[e](!0)},sfixed64:function(){return c.call(this)[e](!1)}})}},{12:12,30:30,31:31}],32:[function(t,e,r){"use strict";var i,n;function o(t,e){return t.name+": "+e+(t.repeated&&"array"!==e?"[]":t.map&&"object"!==e?"{k:"+t.keyType+"}":"")+" expected"}function s(t,e,r,s){var a=s.types;if(t.resolvedType)if(t.resolvedType instanceof i){if(Object.keys(t.resolvedType.values).indexOf(r)<0)return o(t,"enum value")}else{var u=a[e].verify(r);if(u)return t.name+"."+u}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":if(!n.isInteger(r))return o(t,"integer");break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":if(!(n.isInteger(r)||r&&n.isInteger(r.low)&&n.isInteger(r.high)))return o(t,"integer|Long");break;case"float":case"double":if("number"!=typeof r)return o(t,"number");break;case"bool":if("boolean"!=typeof r)return o(t,"boolean");break;case"string":if(!n.isString(r))return o(t,"string");break;case"bytes":if(!(r&&"number"==typeof r.length||n.isString(r)))return o(t,"buffer")}}function a(t,e){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":if(!n.key32Re.test(e))return o(t,"integer key");break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":if(!n.key64Re.test(e))return o(t,"integer|Long key");break;case"bool":if(!n.key2Re.test(e))return o(t,"boolean key")}}function u(t){return function(e){return function(r){var i;if("object"!=typeof r||null===r)return"object expected";var u,h={};t.oneofsArray.length&&(u={});for(var l=0;l<t.fieldsArray.length;++l){var f,c=t._fieldsArray[l].resolve(),d=r[c.name];if(!c.optional||null!=d&&r.hasOwnProperty(c.name))if(c.map){if(!n.isObject(d))return o(c,"object");var p=Object.keys(d);for(f=0;f<p.length;++f){if(i=a(c,p[f]))return i;if(i=s(c,l,d[p[f]],e))return i}}else if(c.repeated){if(!Array.isArray(d))return o(c,"array");for(f=0;f<d.length;++f)if(i=s(c,l,d[f],e))return i}else{if(c.partOf){var y=c.partOf.name;if(1===h[c.partOf.name]&&1===u[y])return c.partOf.name+": multiple values";u[y]=1}if(i=s(c,l,d,e))return i}}}}}e.exports=u,u._configure=function(){i=t(8),n=t(31)}},{31:31,8:8}],19:[function(t,e,r){"use strict";var i,n,o,s,a,u,h,l,f,c,d;e.exports=A,A.filename=null,A.defaults={keepCase:!1};var p=/^[1-9][0-9]*$/,y=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,g=/^0[0-7]+$/,b=/^-?0[0-7]+$/,w=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,_=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,k=/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/;function A(t,e,r){e instanceof n||(r=e,e=new n),r||(r=A.defaults);var O,S,E,N,T,j=i(t,r.alternateCommentMode||!1),R=j.next,F=j.push,I=j.peek,B=j.skip,P=j.cmnt,C=!0,M=!1,D=e,L=r.keepCase?function(t){return t}:d.camelCase;function z(t,e,r){var i=A.filename;return r||(A.filename=null),Error("illegal "+(e||"token")+" '"+t+"' ("+(i?i+", ":"")+"line "+j.line+")")}function V(){var t,e=[];do{if('"'!==(t=R())&&"'"!==t)throw z(t);e.push(R()),B(t),t=I()}while('"'===t||"'"===t);return e.join("")}function Z(t){var e=R();switch(e){case"'":case'"':return F(e),V();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(t,e){var r=1;switch("-"===t.charAt(0)&&(r=-1,t=t.substring(1)),t){case"inf":case"INF":case"Inf":return r*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(t))return r*parseInt(t,10);if(m.test(t))return r*parseInt(t,16);if(g.test(t))return r*parseInt(t,8);if(w.test(t))return r*parseFloat(t);throw z(t,"number",!0)}(e)}catch(r){if(t&&x.test(e))return e;throw z(e,"value")}}function U(t,e){var r,i;do{!e||'"'!==(r=I())&&"'"!==r?t.push([i=q(R()),B("to",!0)?q(R()):i]):t.push(V())}while(B(",",!0));B(";")}function q(t,e){switch(t){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!e&&"-"===t.charAt(0))throw z(t,"id");if(y.test(t))return parseInt(t,10);if(v.test(t))return parseInt(t,16);if(b.test(t))return parseInt(t,8);throw z(t,"id")}function J(){if(void 0!==O)throw z("package");if(O=R(),!x.test(O))throw z(O,"name");D=D.define(O),B(";")}function $(){var t,e=I();switch(e){case"weak":t=E||(E=[]),R();break;case"public":R();default:t=S||(S=[])}e=V(),B(";"),t.push(e)}function K(){if(B("="),N=V(),!(M="proto3"===N)&&"proto2"!==N)throw z(N,"syntax");B(";")}function H(t,e){switch(e){case"option":return G(t,e),B(";"),!0;case"message":return function(t,e){if(!_.test(e=R()))throw z(e,"type name");var r=new o(e);W(r,(function(t){if(!H(r,t))switch(t){case"map":!function(t){B("<");var e=R();if(void 0===c.mapKey[e])throw z(e,"type");B(",");var r=R();if(!x.test(r))throw z(r,"type");B(">");var i=R();if(!_.test(i))throw z(i,"name");B("=");var n=new a(L(i),q(R()),e,r);W(n,(function(t){if("option"!==t)throw z(t);G(n,t),B(";")}),(function(){tt(n)})),t.add(n)}(r);break;case"required":case"optional":case"repeated":X(r,t);break;case"oneof":!function(t,e){if(!_.test(e=R()))throw z(e,"name");var r=new u(L(e));W(r,(function(t){"option"===t?(G(r,t),B(";")):(F(t),X(r,"optional"))})),t.add(r)}(r,t);break;case"extensions":U(r.extensions||(r.extensions=[]));break;case"reserved":U(r.reserved||(r.reserved=[]),!0);break;default:if(!M||!x.test(t))throw z(t);F(t),X(r,"optional")}})),t.add(r)}(t,e),!0;case"enum":return function(t,e){if(!_.test(e=R()))throw z(e,"name");var r=new h(e);W(r,(function(t){switch(t){case"option":G(r,t),B(";");break;case"reserved":U(r.reserved||(r.reserved=[]),!0);break;default:!function(t,e){if(!_.test(e))throw z(e,"name");B("=");var r=q(R(),!0),i={};W(i,(function(t){if("option"!==t)throw z(t);G(i,t),B(";")}),(function(){tt(i)})),t.add(e,r,i.comment)}(r,t)}})),t.add(r)}(t,e),!0;case"service":return function(t,e){if(!_.test(e=R()))throw z(e,"service name");var r=new l(e);W(r,(function(t){if(!H(r,t)){if("rpc"!==t)throw z(t);!function(t,e){var r=e;if(!_.test(e=R()))throw z(e,"name");var i,n,o,s,a=e;if(B("("),B("stream",!0)&&(n=!0),!x.test(e=R()))throw z(e);if(i=e,B(")"),B("returns"),B("("),B("stream",!0)&&(s=!0),!x.test(e=R()))throw z(e);o=e,B(")");var u=new f(a,r,i,o,n,s);W(u,(function(t){if("option"!==t)throw z(t);G(u,t),B(";")})),t.add(u)}(r,t)}})),t.add(r)}(t,e),!0;case"extend":return function(t,e){if(!x.test(e=R()))throw z(e,"reference");var r=e;W(null,(function(e){switch(e){case"required":case"repeated":case"optional":X(t,e,r);break;default:if(!M||!x.test(e))throw z(e);F(e),X(t,"optional",r)}}))}(t,e),!0}return!1}function W(t,e,r){var i=j.line;if(t&&(t.comment=P(),t.filename=A.filename),B("{",!0)){for(var n;"}"!==(n=R());)e(n);B(";",!0)}else r&&r(),B(";"),t&&"string"!=typeof t.comment&&(t.comment=P(i))}function X(t,e,r){var i=R();if("group"!==i){if(!x.test(i))throw z(i,"type");var n=R();if(!_.test(n))throw z(n,"name");n=L(n),B("=");var a=new s(n,q(R()),i,e,r);W(a,(function(t){if("option"!==t)throw z(t);G(a,t),B(";")}),(function(){tt(a)})),t.add(a),M||!a.repeated||void 0===c.packed[i]&&void 0!==c.basic[i]||a.setOption("packed",!1,!0)}else!function(t,e){var r=R();if(!_.test(r))throw z(r,"name");var i=d.lcFirst(r);r===i&&(r=d.ucFirst(r)),B("=");var n=q(R()),a=new o(r);a.group=!0;var u=new s(i,n,r,e);u.filename=A.filename,W(a,(function(t){switch(t){case"option":G(a,t),B(";");break;case"required":case"optional":case"repeated":X(a,t);break;default:throw z(t)}})),t.add(a).add(u)}(t,e)}function G(t,e){var r=B("(",!0);if(!x.test(e=R()))throw z(e,"name");var i=e;r&&(B(")"),i="("+i+")",e=I(),k.test(e)&&(i+=e,R())),B("="),Y(t,i)}function Y(t,e){if(B("{",!0))do{if(!_.test(T=R()))throw z(T,"name");"{"===I()?Y(t,e+"."+T):(B(":"),"{"===I()?Y(t,e+"."+T):Q(t,e+"."+T,Z(!0)))}while(!B("}",!0));else Q(t,e,Z(!0))}function Q(t,e,r){t.setOption&&t.setOption(e,r)}function tt(t){if(B("[",!0)){do{G(t,"option")}while(B(",",!0));B("]")}return t}for(;null!==(T=R());)switch(T){case"package":if(!C)throw z(T);J();break;case"import":if(!C)throw z(T);$();break;case"syntax":if(!C)throw z(T);K();break;case"option":if(!C)throw z(T);G(D,T),B(";");break;default:if(H(D,T)){C=!1;continue}throw z(T)}return A.filename=null,{package:O,imports:S,weakImports:E,syntax:N,root:e}}A._configure=function(){i=t(27),n=t(23),o=t(28),s=t(9),a=t(13),u=t(18),h=t(8),l=t(26),f=t(15),c=t(29),d=t(31)}},{13:13,15:15,18:18,23:23,26:26,27:27,28:28,29:29,31:31,8:8,9:9}],17:[function(t,e,r){"use strict";var i,n;function o(t,e){if(!i.isString(t))throw TypeError("name must be a string");if(e&&!i.isObject(e))throw TypeError("options must be an object");this.options=e,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}e.exports=o,o.className="ReflectionObject",Object.defineProperties(o.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],e=this.parent;e;)t.unshift(e.name),e=e.parent;return t.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var e=t.root;e instanceof n&&e._handleAdd(this)},o.prototype.onRemove=function(t){var e=t.root;e instanceof n&&e._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof n&&(this.resolved=!0),this},o.prototype.getOption=function(t){if(this.options)return this.options[t]},o.prototype.setOption=function(t,e,r){return r&&this.options&&void 0!==this.options[t]||((this.options||(this.options={}))[t]=e),this},o.prototype.setOptions=function(t,e){if(t)for(var r=Object.keys(t),i=0;i<r.length;++i)this.setOption(r[i],t[r[i]],e);return this},o.prototype.toString=function(){var t=this.constructor.className,e=this.fullName;return e.length?t+" "+e:t},o._configure=function(e){n=t(23),i=t(31)}},{23:23,31:31}],16:[function(t,e,r){"use strict";e.exports=l;var i,n,o,s,a,u=t(17);function h(t,e){if(t&&t.length){for(var r={},i=0;i<t.length;++i)r[t[i].name]=t[i].toJSON(e);return r}}function l(t,e){u.call(this,t,e),this.nested=void 0,this._nestedArray=null}function f(t){return t._nestedArray=null,t}((l.prototype=Object.create(u.prototype)).constructor=l).className="Namespace",l.fromJSON=function(t,e){return new l(t,e.options).addJSON(e.nested)},l.arrayToJSON=h,l.isReservedId=function(t,e){if(t)for(var r=0;r<t.length;++r)if("string"!=typeof t[r]&&t[r][0]<=e&&t[r][1]>=e)return!0;return!1},l.isReservedName=function(t,e){if(t)for(var r=0;r<t.length;++r)if(t[r]===e)return!0;return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=o.toArray(this.nested))}}),l.prototype.toJSON=function(t){return o.toObject(["options",this.options,"nested",h(this.nestedArray,t)])},l.prototype.addJSON=function(t){if(t)for(var e,r=Object.keys(t),o=0;o<r.length;++o)e=t[r[o]],this.add((void 0!==e.fields?s.fromJSON:void 0!==e.values?i.fromJSON:void 0!==e.methods?a.fromJSON:void 0!==e.id?n.fromJSON:l.fromJSON)(r[o],e));return this},l.prototype.get=function(t){return this.nested&&this.nested[t]||null},l.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof i)return this.nested[t].values;throw Error("no such enum: "+t)},l.prototype.add=function(t){if(!(t instanceof n&&void 0!==t.extend||t instanceof s||t instanceof i||t instanceof a||t instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var e=this.get(t.name);if(e){if(!(e instanceof l&&t instanceof l)||e instanceof s||e instanceof a)throw Error("duplicate name '"+t.name+"' in "+this);for(var r=e.nestedArray,o=0;o<r.length;++o)t.add(r[o]);this.remove(e),this.nested||(this.nested={}),t.setOptions(e.options,!0)}}else this.nested={};return this.nested[t.name]=t,t.onAdd(this),f(this)},l.prototype.remove=function(t){if(!(t instanceof u))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0),t.onRemove(this),f(this)},l.prototype.define=function(t,e){if(o.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var r=this;t.length>0;){var i=t.shift();if(r.nested&&r.nested[i]){if(!((r=r.nested[i])instanceof l))throw Error("path conflicts with non-namespace objects")}else r.add(r=new l(i))}return e&&r.addJSON(e),r},l.prototype.resolveAll=function(){for(var t=this.nestedArray,e=0;e<t.length;)t[e]instanceof l?t[e++].resolveAll():t[e++].resolve();return this.resolve()},l.prototype.lookup=function(t,e,r){if("boolean"==typeof e?(r=e,e=void 0):e&&!Array.isArray(e)&&(e=[e]),o.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),e);var i=this.get(t[0]);if(i){if(1===t.length){if(!e||e.indexOf(i.constructor)>-1)return i}else if(i instanceof l&&(i=i.lookup(t.slice(1),e,!0)))return i}else for(var n=0;n<this.nestedArray.length;++n)if(this._nestedArray[n]instanceof l&&(i=this._nestedArray[n].lookup(t,e,!0)))return i;return null===this.parent||r?null:this.parent.lookup(t,e)},l.prototype.lookupType=function(t){var e=this.lookup(t,[s]);if(!e)throw Error("no such type: "+t);return e},l.prototype.lookupEnum=function(t){var e=this.lookup(t,[i]);if(!e)throw Error("no such Enum '"+t+"' in "+this);return e},l.prototype.lookupTypeOrEnum=function(t){var e=this.lookup(t,[s,i]);if(!e)throw Error("no such Type or Enum '"+t+"' in "+this);return e},l.prototype.lookupService=function(t){var e=this.lookup(t,[a]);if(!e)throw Error("no such Service '"+t+"' in "+this);return e},l._configure=function(){i=t(8),n=t(9),o=t(31),s=t(28),a=t(26)}},{17:17,26:26,28:28,31:31,8:8,9:9}],8:[function(t,e,r){"use strict";e.exports=o;var i=t(17);((o.prototype=Object.create(i.prototype)).constructor=o).className="Enum";var n=t(16);function o(t,e,r,n,o){if(i.call(this,t,r),e&&"object"!=typeof e)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=n,this.comments=o||{},this.reserved=void 0,e)for(var s=Object.keys(e),a=0;a<s.length;++a)"number"==typeof e[s[a]]&&(this.valuesById[this.values[s[a]]=e[s[a]]]=s[a])}o.fromJSON=function(t,e){var r=new o(t,e.values,e.options,e.comment,e.comments);return r.reserved=e.reserved,r},o.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return util.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",e?this.comment:void 0,"comments",e?this.comments:void 0])},o.prototype.add=function(t,e,r){if(!util.isString(t))throw TypeError("name must be a string");if(!util.isInteger(e))throw TypeError("id must be an integer");if(void 0!==this.values[t])throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(e))throw Error("id "+e+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(void 0!==this.valuesById[e]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+e+" in "+this);this.values[t]=e}else this.valuesById[this.values[t]=e]=t;return this.comments[t]=r||null,this},o.prototype.remove=function(t){if(!util.isString(t))throw TypeError("name must be a string");var e=this.values[t];if(null==e)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[e],delete this.values[t],delete this.comments[t],this},o.prototype.isReservedId=function(t){return n.isReservedId(this.reserved,t)},o.prototype.isReservedName=function(t){return n.isReservedName(this.reserved,t)}},{16:16,17:17}],23:[function(t,e,r){"use strict";e.exports=f;var i=t(16);((f.prototype=Object.create(i.prototype)).constructor=f).className="Root";var n,o,s,a=t(9),u=t(8),h=t(18),l=t(31);function f(t){i.call(this,"",t),this.deferred=[],this.files=[],this.names=[]}function c(){}f.fromJSON=function(t,e){return t="string"==typeof t?JSON.parse(t):t,e||(e=new f),t.options&&e.setOptions(t.options),e.addJSON(t.nested)},f.prototype.resolvePath=l.path.resolve,f.prototype.parseFromPbString=function t(e,r,i){"function"==typeof r&&(i=r,r=void 0);var n=this;if(!i)return l.asPromise(t,n,e,r);var a=null;if("string"==typeof e)a=JSON.parse(e);else{if("object"!=typeof e)return void console.log("pb\u683c\u5f0f\u8f6c\u5316\u5931\u8d25");a=e}function u(t,e){if(i){var r=i;i=null,r(t,e)}}function h(t,e){try{if(l.isString(e)&&"{"===e.charAt(0)&&(e=JSON.parse(e)),l.isString(e)){o.filename=t;var i,s=o(e,n,r),a=0;if(s.imports)for(;a<s.imports.length;++a)f(i=s.imports[a]);if(s.weakImports){for(a=0;a<s.weakImports.length;++a)i=s.weakImports[a];f(i)}}else n.setOptions(e.options).addJSON(e.nested)}catch(h){u(h)}u(null,n)}function f(t){n.names.indexOf(t)>-1||(n.names.push(t),t in s&&h(t,s[t]))}h(a.name,a.pbJsonStr)},f.prototype.load=function t(e,r,i){"function"==typeof r&&(i=r,r=void 0);var n=this;if(!i)return l.asPromise(t,n,e,r);var a=i===c;function u(t,e){if(i){var r=i;if(i=null,a)throw t;r(t,e)}}function h(t,e){try{if(l.isString(e)&&"{"===e.charAt(0)&&(e=JSON.parse(e)),l.isString(e)){o.filename=t;var i,s=o(e,n,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(i=n.resolvePath(t,s.imports[h]))&&f(i);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(i=n.resolvePath(t,s.weakImports[h]))&&f(i,!0)}else n.setOptions(e.options).addJSON(e.nested)}catch(c){u(c)}a||d||u(null,n)}function f(t,e){var r=t.lastIndexOf("google/protobuf/");if(r>-1){var o=t.substring(r);o in s&&(t=o)}if(!(n.files.indexOf(t)>-1))if(n.files.push(t),t in s)a?h(t,s[t]):(++d,setTimeout((function(){--d,h(t,s[t])})));else if(a){var f;try{f=l.fs.readFileSync(t).toString("utf8")}catch(c){return void(e||u(c))}h(t,f)}else++d,l.fetch(t,(function(r,o){--d,i&&(r?e?d||u(null,n):u(r):h(t,o))}))}var d=0;l.isString(e)&&(e=[e]);for(var p,y=0;y<e.length;++y)(p=n.resolvePath("",e[y]))&&f(p);if(a)return n;d||u(null,n)},f.prototype.loadSync=function(t,e){if(!l.isNode)throw Error("not supported");return this.load(t,e,c)},f.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(t){return"'extend "+t.extend+"' in "+t.parent.fullName})).join(", "));return i.prototype.resolveAll.call(this)};var d=/^[A-Z]/;function p(t,e){var r=e.parent.lookup(e.extend);if(r){var i=new a(e.fullName,e.id,e.type,e.rule,void 0,e.options);return i.declaringField=e,e.extensionField=i,r.add(i),!0}return!1}f.prototype._handleAdd=function(t){if(t instanceof a)void 0===t.extend||t.extensionField||p(0,t)||this.deferred.push(t);else if(t instanceof u)d.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof h)){if(t instanceof n)for(var e=0;e<this.deferred.length;)p(0,this.deferred[e])?this.deferred.splice(e,1):++e;for(var r=0;r<t.nestedArray.length;++r)this._handleAdd(t._nestedArray[r]);d.test(t.name)&&(t.parent[t.name]=t)}},f.prototype._handleRemove=function(t){if(t instanceof a){if(void 0!==t.extend)if(t.extensionField)t.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var e=this.deferred.indexOf(t);e>-1&&this.deferred.splice(e,1)}}else if(t instanceof u)d.test(t.name)&&delete t.parent[t.name];else if(t instanceof i){for(var r=0;r<t.nestedArray.length;++r)this._handleRemove(t._nestedArray[r]);d.test(t.name)&&delete t.parent[t.name]}},f._configure=function(){n=t(28),o=t(19),s=t(5),a=t(9),u=t(8),h=t(18),l=t(31)}},{16:16,18:18,19:19,28:28,31:31,5:5,8:8,9:9}],28:[function(t,e,r){"use strict";e.exports=m;var i,n,o,s,a,u,h,l,f,c,d,p,y=t(16);function m(t,e){y.call(this,t,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function v(t){return t._fieldsById=t._fieldsArray=t._oneofsArray=null,delete t.encode,delete t.decode,delete t.verify,t}((m.prototype=Object.create(y.prototype)).constructor=m).className="Type",Object.defineProperties(m.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var t=Object.keys(this.fields),e=0;e<t.length;++e){var r=this.fields[t[e]],i=r.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=u.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=u.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=m.generateConstructor(this))},set:function(t){var e=t.prototype;e instanceof o||((t.prototype=new o).constructor=t,u.merge(t.prototype,e)),t.$type=t.prototype.$type=this,u.merge(t,o,!0),u.merge(t.prototype,o,!0),this._ctor=t;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var i={};for(r=0;r<this.oneofsArray.length;++r){var n=this._oneofsArray[r].resolve().name,s=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=0;return{setter:function(r){if(!(t.indexOf(r)<0)){e[r]=1;for(var i=0;i<t.length;++i)t[i]!==r&&delete this[t[i]]}},getter:function(){for(var t=Object.keys(this),r=t.length-1;r>-1;--r)if(1===e[t[r]]&&void 0!==this[t[r]]&&null!==this[t[r]])return t[r]}}}(this._oneofsArray[r].oneof);i[n]={get:s.getter,set:s.setter}}r&&Object.defineProperties(t.prototype,i)}}}),m.generateConstructor=function(t){return function(e){for(var r,i=0;i<t.fieldsArray.length;i++)(r=t._fieldsArray[i]).map?this[r.name]={}:r.repeated&&(this[r.name]=[]);if(e)for(var n=Object.keys(e),o=0;o<n.length;++o)null!=e[n[o]]&&(this[n[o]]=e[n[o]])}},m.fromJSON=function(t,e){var r=new m(t,e.options);r.extensions=e.extensions,r.reserved=e.reserved;for(var o=Object.keys(e.fields),a=0;a<o.length;++a)r.add((void 0!==e.fields[o[a]].keyType?p.fromJSON:n.fromJSON)(o[a],e.fields[o[a]]));if(e.oneofs)for(o=Object.keys(e.oneofs),a=0;a<o.length;++a)r.add(s.fromJSON(o[a],e.oneofs[o[a]]));if(e.nested)for(o=Object.keys(e.nested),a=0;a<o.length;++a){var u=e.nested[o[a]];r.add((void 0!==u.id?n.fromJSON:void 0!==u.fields?m.fromJSON:void 0!==u.values?i.fromJSON:void 0!==u.methods?f.fromJSON:y.fromJSON)(o[a],u))}return e.extensions&&e.extensions.length&&(r.extensions=e.extensions),e.reserved&&e.reserved.length&&(r.reserved=e.reserved),e.group&&(r.group=!0),e.comment&&(r.comment=e.comment),r},m.prototype.toJSON=function(t){var e=y.prototype.toJSON.call(this,t),r=!!t&&Boolean(t.keepComments);return{options:e&&e.options||void 0,oneofs:y.arrayToJSON(this.oneofsArray,t),fields:y.arrayToJSON(this.fieldsArray.filter((function(t){return!t.declaringField})),t)||{},extensions:this.extensions&&this.extensions.length?this.extensions:void 0,reserved:this.reserved&&this.reserved.length?this.reserved:void 0,group:this.group||void 0,nested:e&&e.nested||void 0,comment:r?this.comment:void 0}},m.prototype.resolveAll=function(){for(var t=this.fieldsArray,e=0;e<t.length;)t[e++].resolve();var r=this.oneofsArray;for(e=0;e<r.length;)r[e++].resolve();return y.prototype.resolveAll.call(this)},m.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},m.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof n&&void 0===t.extend){if(this._fieldsById&&this._fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=this,t.onAdd(this),v(this)}return t instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(this),v(this)):y.prototype.add.call(this,t)},m.prototype.remove=function(t){if(t instanceof n&&void 0===t.extend){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(this),v(this)}if(t instanceof s){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),v(this)}return y.prototype.remove.call(this,t)},m.prototype.isReservedId=function(t){return y.isReservedId(this.reserved,t)},m.prototype.isReservedName=function(t){return y.isReservedName(this.reserved,t)},m.prototype.create=function(t){return new this.ctor(t)},m.prototype.setup=function(){for(var t=this.fullName,e=[],r=0;r<this.fieldsArray.length;++r)e.push(this._fieldsArray[r].resolve().resolvedType);this.decode=l(this)({Reader:a,types:e,util:u}),this.verify=h(this)({types:e,util:u}),this.fromObject=d.fromObject(this)({types:e,util:u}),this.toObject=d.toObject(this)({types:e,util:u});var i=c[t];if(i){var n=Object.create(this);n.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(n),n.toObject=this.toObject,this.toObject=i.toObject.bind(n)}return this},m.prototype.encode=function(t,e){return this.setup().encode(t,e)},m.prototype.encodeDelimited=function(t,e){return this.encode(t,e&&e.len?e.fork():e).ldelim()},m.prototype.decode=function(t,e){return this.setup().decode(t,e)},m.prototype.decodeDelimited=function(t){return t instanceof a||(t=a.create(t)),this.decode(t,t.uint32())},m.prototype.verify=function(t){return this.setup().verify(t)},m.prototype.fromObject=function(t){return this.setup().fromObject(t)},m.prototype.toObject=function(t,e){return this.setup().toObject(t,e)},m.d=function(t){return function(e){u.decorateType(e,t)}},m._configure=function(){i=t(8),n=t(9),o=t(14),s=t(18),t(34),a=t(22),u=t(31),h=t(32),l=t(7),f=t(26),c=t(33),d=t(6),p=t(13)}},{13:13,14:14,16:16,18:18,22:22,26:26,31:31,32:32,33:33,34:34,6:6,7:7,8:8,9:9}],18:[function(t,e,r){"use strict";e.exports=s;var i,n,o=t(17);function s(t,e,r,i){if(Array.isArray(e)||(r=e,e=void 0),o.call(this,t,r),void 0!==e&&!Array.isArray(e))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}function a(t){if(t.parent)for(var e=0;e<t.fieldsArray.length;++e)t.fieldsArray[e].parent||t.parent.add(t.fieldsArray[e])}((s.prototype=Object.create(o.prototype)).constructor=s).className="OneOf",s.fromJSON=function(t,e){return new s(t,e.oneof,e.options,e.comment)},s.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return n.toObject(["options",this.options,"oneof",this.oneof,"comment",e?this.comment:void 0])},s.prototype.add=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=this,a(this),this},s.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");var e=this.fieldsArray.indexOf(t);if(e<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(e,1),(e=this.oneof.indexOf(t.name))>-1&&this.oneof.splice(e,1),t.partOf=null,this},s.prototype.onAdd=function(t){o.prototype.onAdd.call(this,t);for(var e=0;e<this.oneof.length;++e){var r=t.get(this.oneof[e]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}a(this)},s.prototype.onRemove=function(t){for(var e,r=0;r<this.fieldsArray.length;++r)(e=this.fieldsArray[r]).parent&&e.parent.remove(e);o.prototype.onRemove.call(this,t)},s.d=function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;)t[e]=arguments[e++];return function(e,r){n.decorateType(e.constructor).add(new s(r,t)),Object.defineProperty(e,r,{get:n.oneOfGetter(t),set:n.oneOfSetter(t)})}},s._configure=function(){i=t(9),n=t(31)}},{17:17,31:31,9:9}],9:[function(t,e,r){"use strict";e.exports=h;var i,n,o,s,a=t(17);((h.prototype=Object.create(a.prototype)).constructor=h).className="Field";var u=/^required|optional|repeated$/;function h(t,e,r,i,s,h,l){if(o.isObject(i)?(l=s,h=i,i=s=void 0):o.isObject(s)&&(l=h,h=s,s=void 0),a.call(this,t,h),!o.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==i&&!u.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");this.rule=i&&"optional"!==i?i:void 0,this.type=r,this.id=e,this.extend=s||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==n.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}h.fromJSON=function(t,e){return new h(t,e.id,e.type,e.rule,e.extend,e.options,e.comment)},Object.defineProperty(h.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),h.prototype.setOption=function(t,e,r){return"packed"===t&&(this._packed=null),a.prototype.setOption.call(this,t,e,r)},h.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return o.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:void 0])},h.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=n.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof s?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof i&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof i)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var t;o.utf8.write(this.typeDefault,t=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof s&&(this.parent.ctor.prototype[this.name]=this.defaultValue),a.prototype.resolve.call(this)},h.d=function(t,e,r,i){return"function"==typeof e?e=o.decorateType(e).name:e&&"object"==typeof e&&(e=o.decorateEnum(e).name),function(n,s){o.decorateType(n.constructor).add(new h(s,t,e,r,{default:i}))}},h._configure=function(){s=t(28),i=t(8),n=t(29),o=t(31)}},{17:17,28:28,29:29,31:31,8:8}],13:[function(t,e,r){"use strict";e.exports=s;var i,n,o=t(9);function s(t,e,r,i,s,a){if(o.call(this,t,e,i,void 0,void 0,s,a),!n.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}((s.prototype=Object.create(o.prototype)).constructor=s).className="MapField",s.fromJSON=function(t,e){return new s(t,e.id,e.keyType,e.type,e.options,e.comment)},s.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return n.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return o.prototype.resolve.call(this)},s.d=function(t,e,r){return"function"==typeof r?r=n.decorateType(r).name:r&&"object"==typeof r&&(r=n.decorateEnum(r).name),function(i,o){n.decorateType(i.constructor).add(new s(o,t,e,r))}},s._configure=function(){i=t(29),n=t(31)}},{29:29,31:31,9:9}],15:[function(t,e,r){"use strict";e.exports=o;var i,n=t(17);function o(t,e,r,o,s,a,u,h){if(i.isObject(s)?(u=s,s=a=void 0):i.isObject(a)&&(u=a,a=void 0),void 0!==e&&!i.isString(e))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");n.call(this,t,u),this.type=e||"rpc",this.requestType=r,this.requestStream=!!s||void 0,this.responseType=o,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=h}((o.prototype=Object.create(n.prototype)).constructor=o).className="Method",o.fromJSON=function(t,e){return new o(t,e.type,e.requestType,e.responseType,e.requestStream,e.responseStream,e.options,e.comment)},o.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",e?this.comment:void 0])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))},o._configure=function(){i=t(31)}},{17:17,31:31}],7:[function(t,e,r){"use strict";var i,n,o;function s(t){return"missing required '"+t.name+"'"}function a(t){return function(e){var r=e.Reader,a=e.types,u=e.util;return function(e,h){e instanceof r||(e=r.create(e));for(var l,f=void 0===h?e.len:e.pos+h,c=new this.ctor;e.pos<f;){var d=e.uint32();if(t.group&&4==(7&d))break;for(var p=d>>>3,y=0,m=!1;y<t.fieldsArray.length;++y){var v=t._fieldsArray[y].resolve(),g=v.name,b=v.resolvedType instanceof i?"int32":v.type;if(p==v.id){if(m=!0,v.map)e.skip().pos++,c[g]===u.emptyObject&&(c[g]={}),l=e[v.keyType](),e.pos++,n.long[v.keyType],null==n.basic[b]?c[g]["object"==typeof l?u.longToHash(l):l]=a[y].decode(e,e.uint32()):c[g]["object"==typeof l?u.longToHash(l):l]=e[b]();else if(v.repeated)if(c[g]&&c[g].length||(c[g]=[]),null!=n.packed[b]&&2==(7&d))for(var w=e.uint32()+e.pos;e.pos<w;)c[g].push(e[b]());else null==n.basic[b]?v.resolvedType.group?c[g].push(a[y].decode(e)):c[g].push(a[y].decode(e,e.uint32())):c[g].push(e[b]());else null==n.basic[b]?v.resolvedType.group?c[g]=a[y].decode(e):c[g]=a[y].decode(e,e.uint32()):c[g]=e[b]();break}}m||(console.log("t",d),e.skipType(7&d))}for(y=0;y<t._fieldsArray.length;++y){var _=t._fieldsArray[y];if(_.required&&!c.hasOwnProperty(_.name))throw o.ProtocolError(s(_),{instance:c})}return c}}}e.exports=a,a._configure=function(){i=t(8),n=t(29),o=t(31)}},{29:29,31:31,8:8}],14:[function(t,e,r){"use strict";var i;function n(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)this[e[r]]=t[e[r]]}e.exports=n,n.create=function(t){return this.$type.create(t)},n.encode=function(t,e){return arguments.length?1==arguments.length?this.$type.encode(arguments[0]):this.$type.encode(arguments[0],arguments[1]):this.$type.encode(this)},n.encodeDelimited=function(t,e){return this.$type.encodeDelimited(t,e)},n.decode=function(t){return this.$type.decode(t)},n.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},n.verify=function(t){return this.$type.verify(t)},n.fromObject=function(t){return this.$type.fromObject(t)},n.toObject=function(t,e){return t=t||this,this.$type.toObject(t,e)},n.prototype.toJSON=function(){return this.$type.toObject(this,i.toJSONOptions)},n.set=function(t,e){n[t]=e},n.get=function(t){return n[t]},n._configure=function(){i=t(31)}},{31:31}],29:[function(t,e,r){"use strict";var i=e.exports,n=t(31),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function s(t,e){var r=0,i={};for(e|=0;r<t.length;)i[o[r+e]]=t[r++];return i}i.basic=s([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),i.defaults=s([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",n.emptyArray,null]),i.long=s([0,0,0,1,1],7),i.mapKey=s([0,0,0,5,5,0,0,0,1,1,0,2],2),i.packed=s([1,5,0,0,0,5,5,0,0,0,1,1,0]),i._configure=function(){n=t(31)}},{31:31}],33:[function(t,e,r){"use strict";var i,n=r;n[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var e=this.lookup(t["@type"]);if(e){var r="."===t["@type"].charAt(0)?t["@type"].substr(1):t["@type"];return this.create({type_url:"/"+r,value:e.encode(e.fromObject(t)).finish()})}}return this.fromObject(t)},toObject:function(t,e){if(e&&e.json&&t.type_url&&t.value){var r=t.type_url.substring(t.type_url.lastIndexOf("/")+1),n=this.lookup(r);n&&(t=n.decode(t.value))}if(!(t instanceof this.ctor)&&t instanceof i){var o=t.$type.toObject(t,e);return o["@type"]=t.$type.fullName,o}return this.toObject(t,e)}},n._configure=function(){i=t(14)}},{14:14}],6:[function(t,e,r){"use strict";var i,n,o=e.exports;function s(t,e,r,o){var s=o.m,a=o.d,u=o.types,h=o.ksi,l=void 0!==h;if(t.resolvedType)if(t.resolvedType instanceof i){for(var f=l?a[r][h]:a[r],c=t.resolvedType.values,d=Object.keys(c),p=0;p<d.length;p++)if(!(t.repeated&&c[d[p]]===t.typeDefault||d[p]!=f&&c[d[p]]!=f)){l?s[r][h]=c[d[p]]:s[r]=c[d[p]];break}}else{if("object"!=typeof(l?a[r][h]:a[r]))throw TypeError(t.fullName+": object expected");l?s[r][h]=u[e].fromObject(a[r][h]):s[r]=u[e].fromObject(a[r])}else{var y=!1;switch(t.type){case"double":case"float":l?s[r][h]=Number(a[r][h]):s[r]=Number(a[r]);break;case"uint32":case"fixed32":l?s[r][h]=a[r][h]>>>0:s[r]=a[r]>>>0;break;case"int32":case"sint32":case"sfixed32":l?s[r][h]=0|a[r][h]:s[r]=0|a[r];break;case"uint64":y=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n.Long?l?s[r][h]=n.Long.fromValue(a[r][h]).unsigned=y:s[r]=n.Long.fromValue(a[r]).unsigned=y:"string"==typeof(l?a[r][h]:a[r])?l?s[r][h]=parseInt(a[r][h],10):s[r]=parseInt(a[r],10):"number"==typeof(l?a[r][h]:a[r])?l?s[r][h]=a[r][h]:s[r]=a[r]:"object"==typeof(l?a[r][h]:a[r])&&(l?s[r][h]=new n.LongBits(a[r][h].low>>>0,a[r][h].high>>>0).toNumber(y):s[r]=new n.LongBits(a[r].low>>>0,a[r].high>>>0).toNumber(y));break;case"bytes":"string"==typeof(l?a[r][h]:a[r])?l?n.base64.decode(a[r][h],s[r][h]=n.newBuffer(n.base64.length(a[r][h])),0):n.base64.decode(a[r],s[r]=n.newBuffer(n.base64.length(a[r])),0):(l?a[r][h]:a[r]).length&&(l?s[r][h]=a[r][h]:s[r]=a[r]);break;case"string":l?s[r][h]=String(a[r][h]):s[r]=String(a[r]);break;case"bool":l?s[r][h]=Boolean(a[r][h]):s[r]=Boolean(a[r])}}}function a(t,e,r,o){var s=o.m,a=o.d,u=o.types,h=o.ksi,l=o.o,f=void 0!==h;if(t.resolvedType)t.resolvedType instanceof i?f?a[r][h]=l.enums===String?u[e].values[s[r][h]]:s[r][h]:a[r]=l.enums===String?u[e].values[s[r]]:s[r]:f?a[r][h]=u[e].toObject(s[r][h],l):a[r]=u[e].toObject(s[r],l);else{var c=!1;switch(t.type){case"double":case"float":f?a[r][h]=l.json&&!isFinite(s[r][h])?String(s[r][h]):s[r][h]:a[r]=l.json&&!isFinite(s[r])?String(s[r]):s[r];break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":"number"==typeof s[r][h]?f?a[r][h]=l.longs===String?String(s[r][h]):s[r][h]:a[r]=l.longs===String?String(s[r]):s[r]:f?a[r][h]=l.longs===String?n.Long.prototype.toString.call(s[r][h]):l.longs===Number?new n.LongBits(s[r][h].low>>>0,s[r][h].high>>>0).toNumber(c):s[r][h]:a[r]=l.longs===String?n.Long.prototype.toString.call(s[r]):l.longs===Number?new n.LongBits(s[r].low>>>0,s[r].high>>>0).toNumber(c):s[r];break;case"bytes":f?a[r][h]=l.bytes===String?n.base64.encode(s[r][h],0,s[r][h].length):l.bytes===Array?Array.prototype.slice.call(s[r][h]):s[r][h]:a[r]=l.bytes===String?n.base64.encode(s[r],0,s[r].length):l.bytes===Array?Array.prototype.slice.call(s[r]):s[r];break;default:f?a[r][h]=s[r][h]:a[r]=s[r]}}}o._configure=function(){i=t(8),n=t(31)},o.fromObject=function(t){var e=t.fieldsArray;return function(t){return function(r){if(r instanceof this.ctor)return r;if(!e.length)return new this.ctor;for(var o=new this.ctor,a=0;a<e.length;++a){var u,h=e[a].resolve(),l=h.name;if(h.map){if(r[l]){if("object"!=typeof r[l])throw TypeError(h.fullName+": object expected");o[l]={}}var f=Object.keys(r[l]);for(u=0;u<f.length;++u)s(h,a,l,n.merge(n.copy(t),{m:o,d:r,ksi:f[u]}))}else if(h.repeated){if(r[l]){if(!Array.isArray(r[l]))throw TypeError(h.fullName+": array expected");for(o[l]=[],u=0;u<r[l].length;++u)s(h,a,l,n.merge(n.copy(t),{m:o,d:r,ksi:u}))}}else(h.resolvedType instanceof i||null!=r[l])&&s(h,a,l,n.merge(n.copy(t),{m:o,d:r}))}return o}}},o.toObject=function(t){var e=t.fieldsArray.slice().sort(n.compareFieldsById);return function(r){return e.length?function(o,s){s=s||{};for(var u,h,l={},f=[],c=[],d=[],p=0;p<e.length;++p)e[p].partOf||(e[p].resolve().repeated?f:e[p].map?c:d).push(e[p]);if(f.length&&(s.arrays||s.defaults))for(p=0;p<f.length;++p)l[f[p].name]=[];if(c.length&&(s.objects||s.defaults))for(p=0;p<c.length;++p)l[c[p].name]={};if(d.length&&s.defaults)for(p=0;p<d.length;++p)if(h=(u=d[p]).name,u.resolvedType instanceof i)l[h]=s.enums=String?u.resolvedType.valuesById[u.typeDefault]:u.typeDefault;else if(u.long)if(n.Long){var y=new n.Long(u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned);l[h]=s.longs===String?y.toString():s.longs===Number?y.toNumber():y}else l[h]=s.longs===String?u.typeDefault.toString():u.typeDefault.toNumber();else u.bytes?l[h]=s.bytes===String?String.fromCharCode.apply(String,u.typeDefault):Array.prototype.slice.call(u.typeDefault).join("*..*").split("*..*"):l[h]=u.typeDefault;var m=!1;for(p=0;p<e.length;++p){h=(u=e[p]).name;var v,g,b=t._fieldsArray.indexOf(u);if(u.map){if(m||(m=!0),o[h]&&(v=Object.keys(o[h]).length))for(l[h]={},g=0;g<v.length;++g)a(u,b,h,n.merge(n.copy(r),{m:o,d:l,ksi:v[g],o:s}))}else if(u.repeated){if(o[h]&&o[h].length)for(l[h]=[],g=0;g<o[h].length;++g)a(u,b,h,n.merge(n.copy(r),{m:o,d:l,ksi:g,o:s}))}else null!=o[h]&&o.hasOwnProperty(h)&&a(u,b,h,n.merge(n.copy(r),{m:o,d:l,o:s})),u.partOf&&s.oneofs&&(l[u.partOf.name]=h)}return l}:function(){return{}}}}},{31:31,8:8}],26:[function(t,e,r){"use strict";e.exports=a;var i,n,o,s=t(16);function a(t,e){s.call(this,t,e),this.methods={},this._methodsArray=null}function u(t){return t._methodsArray=null,t}((a.prototype=Object.create(s.prototype)).constructor=a).className="Service",a.fromJSON=function(t,e){var r=new a(t,e.options);if(e.methods)for(var n=Object.keys(e.methods),o=0;o<n.length;++o)r.add(i.fromJSON(n[o],e.methods[n[o]]));return e.nested&&r.addJSON(e.nested),r.comment=e.comment,r},a.prototype.toJSON=function(t){var e=s.prototype.toJSON.call(this,t),r=!!t&&Boolean(t.keepComments);return n.toObject(["options",e&&e.options||void 0,"methods",s.arrayToJSON(this.methodsArray,t)||{},"nested",e&&e.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=n.toArray(this.methods))}}),a.prototype.get=function(t){return this.methods[t]||s.prototype.get.call(this,t)},a.prototype.resolveAll=function(){for(var t=this.methodsArray,e=0;e<t.length;++e)t[e].resolve();return s.prototype.resolve.call(this)},a.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof i?(this.methods[t.name]=t,t.parent=this,u(this)):s.prototype.add.call(this,t)},a.prototype.remove=function(t){if(t instanceof i){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,u(this)}return s.prototype.remove.call(this,t)},a.prototype.create=function(t,e,r){for(var i,s=new o.Service(t,e,r),a=0;a<this.methodsArray.length;++a){var u=n.lcFirst((i=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");s[u]=n.codegen(["r","c"],n.isReserved(u)?u+"_":u)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return s},a._configure=function(){i=t(15),n=t(31),o=t(25)}},{15:15,16:16,25:25,31:31}],34:[function(t,e,r){"use strict";e.exports=h;var i,n=t(31),o=t(30);function s(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function a(){}function u(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new s(a,0,0),this.tail=this.head,this.states=null}function l(t,e,r){e[r]=255&t}function f(t,e){this.len=t,this.next=void 0,this.val=e}function c(t,e,r){for(;t.hi;)e[r++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=127&t.lo|128,t.lo=t.lo>>>7;e[r++]=t.lo}function d(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}h.create=n.Buffer?function(){return(h.create=function(){return new(void 0)})()}:function(){return new h},h.alloc=function(t){return new n.Array(t)},n.Array!==Array&&(h.alloc=n.pool(h.alloc,n.Array.prototype.subarray)),h.prototype._push=function(t,e,r){return this.tail=this.tail.next=new s(t,e,r),this.len+=e,this},f.prototype=Object.create(s.prototype),f.prototype.fn=function(t,e,r){for(;t>127;)e[r++]=127&t|128,t>>>=7;e[r]=t},h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new f((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(c,10,i.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=i.from(t);return this._push(c,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=i.from(t).zzEncode();return this._push(c,e.length(),e)},h.prototype.bool=function(t){return this._push(l,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(d,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=i.from(t);return this._push(d,4,e.lo)._push(d,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(n.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(n.float.writeDoubleLE,8,t)};var p=n.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var i=0;i<t.length;++i)e[r+i]=t[i]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(l,1,0);if(n.isString(t)){var r=h.alloc(e=o.length(t));o.write(t,r,0),t=r}return this.uint32(e)._push(p,e,t)},h.prototype.string=function(t){var e=o.length(t);return e?this.uint32(e)._push(o.write,e,t):this._push(l,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new s(a,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new s(a,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this},h.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e},h._configure=function(){i=t(12),t(4),o=t(30)}},{12:12,30:30,31:31,4:4}],31:[function(t,e,r){"use strict";var i=e.exports,n=t(24);i.LongBits=t(12),i.Long=t(11),i.pool=t(21),i.float=t(10),i.asPromise=t(3),i.EventEmitter=t(2),i.path=t(20),i.base64=t(4),i.utf8=t(30),i.compareFieldsById=function(t,e){return t.id-e.id},i.toArray=function(t){if(t){for(var e=Object.keys(t),r=new Array(e.length),i=0;i<e.length;)r[i]=t[e[i++]];return r}return[]},i.toObject=function(t){for(var e={},r=0;r<t.length;){var i=t[r++],n=t[r++];void 0!==n&&(e[i]=n)}return e},i.isString=function(t){return"string"==typeof t||t instanceof String},i.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},i.isObject=function(t){return t&&"object"==typeof t},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var t=Object.keys(this),r=t.length-1;r>-1;--r)if(1===e[t[r]]&&void 0!==this[t[r]]&&null!==this[t[r]])return t[r]}},i.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}},i.merge=function(t,e,r){for(var i=Object.keys(e),n=0;n<i.length;++n)void 0!==t[i[n]]&&r||(t[i[n]]=e[i[n]]);return t},i.decorateType=function(e,r){if(e.$type)return r&&e.$type.name!==r&&(i.decorateRoot.remove(e.$type),e.$type.name=r,i.decorateRoot.add(e.$type)),e.$type;Type||(Type=t(28));var n=new Type(r||e.name);return i.decorateRoot.add(n),n.ctor=e,Object.defineProperty(e,"$type",{value:n,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:n,enumerable:!1}),n},i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.copy=function(t){if("object"!=typeof t)return t;var e={};for(var r in t)e[r]=t[r];return e},i.deepCopy=function t(e){if("object"!=typeof e)return e;var r={};for(var i in e)r[i]=t(e[i]);return r},i.ProtocolError=function(t){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&merge(this,r)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i.Buffer=null,i.newBuffer=function(t){return"number"==typeof t?new i.Array(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},i.stringToBytes=function(t){var e,r,i=[];e=t.length;for(var n=0;n<e;n++)(r=t.charCodeAt(n))>=65536&&r<=1114111?(i.push(r>>18&7|240),i.push(r>>12&63|128),i.push(r>>6&63|128),i.push(63&r|128)):r>=2048&&r<=65535?(i.push(r>>12&15|224),i.push(r>>6&63|128),i.push(63&r|128)):r>=128&&r<=2047?(i.push(r>>6&31|192),i.push(63&r|128)):i.push(255&r);return i},i.byteToString=function(t){if("string"==typeof t)return t;for(var e="",r=t,i=0;i<r.length;i++){var n=r[i].toString(2),o=n.match(/^1+?(?=0)/);if(o&&8==n.length){for(var s=o[0].length,a=r[i].toString(2).slice(7-s),u=1;u<s;u++)a+=r[u+i].toString(2).slice(2);e+=String.fromCharCode(parseInt(a,2)),i+=s-1}else e+=String.fromCharCode(r[i])}return e},i.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Object.defineProperty(i,"decorateRoot",{get:function(){return n.decorated||(n.decorated=new(t(23)))}})},{10:10,11:11,12:12,2:2,20:20,21:21,23:23,24:24,28:28,3:3,30:30,4:4}],25:[function(t,e,r){"use strict";e.exports=n;var i=t(31);function n(t,e,r){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}(n.prototype=Object.create(i.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function t(e,r,n,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return i.asPromise(t,a,e,r,n,o);if(a.rpcImpl)try{return a.rpcImpl(e,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(t,r){if(t)return a.emit("error",t,e),s(t);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(t){return a.emit("error",t,e),s(t)}return a.emit("data",r,e),s(null,r)}a.end(!0)}))}catch(u){return a.emit("error",u,e),void setTimeout((function(){s(u)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},n.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{31:31}],2:[function(t,e,r){"use strict";function i(){this._listeners={}}e.exports=i,i.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this},i.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var r=this._listeners[t],i=0;i<r.length;)r[i].fn===e?r.splice(i,1):++i;return this},i.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,r)}return this}},{}],3:[function(t,e,r){"use strict";e.exports=function(t,e){for(var r=new Array(arguments.length-1),i=0,n=2,o=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,s){r[i]=function(t){if(o)if(o=!1,t)s(t);else{for(var e=new Array(arguments.length-1),r=0;r<e.length;)e[r++]=arguments[r];n.apply(null,e)}};try{t.apply(e||null,r)}catch(a){o&&(o=!1,s(a))}}))}},{}],4:[function(t,e,r){"use strict";var i=e.exports;i.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&"="===t.charAt(e);)++r;return Math.ceil(3*t.length)/4-r};for(var n=new Array(64),o=new Array(123),s=0;s<64;)o[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(t,e,r){for(var i,o=null,s=[],a=0,u=0;e<r;){var h=t[e++];switch(u){case 0:s[a++]=n[h>>2],i=(3&h)<<4,u=1;break;case 1:s[a++]=n[i|h>>4],i=(15&h)<<2,u=2;break;case 2:s[a++]=n[i|h>>6],s[a++]=n[63&h],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=n[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},i.decode=function(t,e,r){for(var i,n=r,s=0,a=0;a<t.length;){var u=t.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(s){case 0:i=u,s=1;break;case 1:e[r++]=i<<2|(48&u)>>4,i=u,s=2;break;case 2:e[r++]=(15&i)<<4|(60&u)>>2,i=u,s=3;break;case 3:e[r++]=(3&i)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return r-n},i.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},{}],10:[function(t,e,r){"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),i=128===r[3];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function o(t,i,n){e[0]=t,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function s(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],e[0]}function a(t,i){return r[3]=t[i],r[2]=t[i+1],r[1]=t[i+2],r[0]=t[i+3],e[0]}t.writeFloatLE=i?n:o,t.writeFloatBE=i?o:n,t.readFloatLE=i?s:a,t.readFloatBE=i?a:s}():function(){function e(t,e,r,i){var n=e<0?1:0;if(n&&(e=-e),0===e)t(1/e>0?0:2147483648,r,i);else if(isNaN(e))t(2143289344,r,i);else if(e>34028234663852886e22)t((n<<31|2139095040)>>>0,r,i);else if(e<11754943508222875e-54)t((n<<31|Math.round(e/1401298464324817e-60))>>>0,r,i);else{var o=Math.floor(Math.log(e)/Math.LN2);t((n<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,r,i)}}function r(t,e,r){var i=t(e,r),n=2*(i>>31)+1,o=i>>>23&255,s=8388607&i;return 255===o?s?NaN:n*(1/0):0===o?1401298464324817e-60*n*s:n*Math.pow(2,o-150)*(s+8388608)}t.writeFloatLE=e.bind(null,n),t.writeFloatBE=e.bind(null,o),t.readFloatLE=r.bind(null,s),t.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),i=128===r[7];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function o(t,i,n){e[0]=t,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function s(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],r[4]=t[i+4],r[5]=t[i+5],r[6]=t[i+6],r[7]=t[i+7],e[0]}function a(t,i){return r[7]=t[i],r[6]=t[i+1],r[5]=t[i+2],r[4]=t[i+3],r[3]=t[i+4],r[2]=t[i+5],r[1]=t[i+6],r[0]=t[i+7],e[0]}t.writeDoubleLE=i?n:o,t.writeDoubleBE=i?o:n,t.readDoubleLE=i?s:a,t.readDoubleBE=i?a:s}():function(){function e(t,e,r,i,n,o){var s=i<0?1:0;if(s&&(i=-i),0===i)t(0,n,o+e),t(1/i>0?0:2147483648,n,o+r);else if(isNaN(i))t(0,n,o+e),t(2146959360,n,o+r);else if(i>17976931348623157e292)t(0,n,o+e),t((s<<31|2146435072)>>>0,n,o+r);else{var a;if(i<22250738585072014e-324)t((a=i/5e-324)>>>0,n,o+e),t((s<<31|a/4294967296)>>>0,n,o+r);else{var u=Math.floor(Math.log(i)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=i*Math.pow(2,-u))>>>0,n,o+e),t((s<<31|u+1023<<20|1048576*a&1048575)>>>0,n,o+r)}}}function r(t,e,r,i,n){var o=t(i,n+e),s=t(i,n+r),a=2*(s>>31)+1,u=s>>>20&2047,h=4294967296*(1048575&s)+o;return 2047===u?h?NaN:a*(1/0):0===u?5e-324*a*h:a*Math.pow(2,u-1075)*(h+4503599627370496)}t.writeDoubleLE=e.bind(null,n,0,4),t.writeDoubleBE=e.bind(null,o,4,0),t.readDoubleLE=r.bind(null,s,0,4),t.readDoubleBE=r.bind(null,a,4,0)}(),t}function n(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function o(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=255&t}function s(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}e.exports=i(i)},{}],11:[function(t,e,r){"use strict";e.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(E){}function n(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function o(t){return!0===(t&&t.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=o;var s={},a={};function u(t,e){var r,i,n;return e?(n=0<=(t>>>=0)&&t<256)&&(i=a[t])?i:(r=l(t,(0|t)<0?-1:0,!0),n&&(a[t]=r),r):(n=-128<=(t|=0)&&t<128)&&(i=s[t])?i:(r=l(t,t<0?-1:0,!1),n&&(s[t]=r),r)}function h(t,e){if(isNaN(t))return e?b:g;if(e){if(t<0)return b;if(t>=y)return A}else{if(t<=-m)return O;if(t+1>=m)return k}return t<0?h(-t,e).neg():l(t%p|0,t/p|0,e)}function l(t,e,r){return new n(t,e,r)}n.fromInt=u,n.fromNumber=h,n.fromBits=l;var f=Math.pow;function c(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return g;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return c(t.substring(1),e,r).neg();for(var n=h(f(r,8)),o=g,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+a),r);if(a<8){var l=h(f(r,a));o=o.mul(l).add(h(u))}else o=(o=o.mul(n)).add(h(u))}return o.unsigned=e,o}function d(t,e){return"number"==typeof t?h(t,e):"string"==typeof t?c(t,e):l(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}n.fromString=c,n.fromValue=d;var p=4294967296,y=p*p,m=y/2,v=u(1<<24),g=u(0);n.ZERO=g;var b=u(0,!0);n.UZERO=b;var w=u(1);n.ONE=w;var _=u(1,!0);n.UONE=_;var x=u(-1);n.NEG_ONE=x;var k=l(-1,2147483647,!1);n.MAX_VALUE=k;var A=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=A;var O=l(0,-2147483648,!1);n.MIN_VALUE=O;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},S.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(O)){var e=h(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var n=h(f(t,6),this.unsigned),o=this,s="";;){var a=o.div(n),u=(o.sub(a.mul(n)).toInt()>>>0).toString(t);if((o=a).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1==(1&this.low)},S.isEven=function(){return 0==(1&this.low)},S.equals=function(t){return o(t)||(t=d(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},S.eq=S.equals,S.notEquals=function(t){return!this.eq(t)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(t){return this.comp(t)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(t){return this.comp(t)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(t){return this.comp(t)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(t){return this.comp(t)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(t){if(o(t)||(t=d(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(w)},S.neg=S.negate,S.add=function(t){o(t)||(t=d(t));var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,s=t.high>>>16,a=65535&t.high,u=t.low>>>16,h=0,f=0,c=0,p=0;return c+=(p+=n+(65535&t.low))>>>16,f+=(c+=i+u)>>>16,h+=(f+=r+a)>>>16,h+=e+s,l((c&=65535)<<16|(p&=65535),(h&=65535)<<16|(f&=65535),this.unsigned)},S.subtract=function(t){return o(t)||(t=d(t)),this.add(t.neg())},S.sub=S.subtract,S.multiply=function(t){if(this.isZero())return g;if(o(t)||(t=d(t)),i)return l(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return g;if(this.eq(O))return t.isOdd()?O:g;if(t.eq(O))return this.isOdd()?O:g;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(v)&&t.lt(v))return h(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,a=t.high>>>16,u=65535&t.high,f=t.low>>>16,c=65535&t.low,p=0,y=0,m=0,b=0;return m+=(b+=s*c)>>>16,y+=(m+=n*c)>>>16,m&=65535,y+=(m+=s*f)>>>16,p+=(y+=r*c)>>>16,y&=65535,p+=(y+=n*f)>>>16,y&=65535,p+=(y+=s*u)>>>16,p+=e*c+r*f+n*u+s*a,l((m&=65535)<<16|(b&=65535),(p&=65535)<<16|(y&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(t){if(o(t)||(t=d(t)),t.isZero())throw Error("division by zero");var e,r,n;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?b:g;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return b;if(t.gt(this.shru(1)))return _;n=b}else{if(this.eq(O))return t.eq(w)||t.eq(x)?O:t.eq(O)?w:(e=this.shr(1).div(t).shl(1)).eq(g)?t.isNegative()?w:x:(r=this.sub(t.mul(e)),n=e.add(r.div(t)));if(t.eq(O))return this.unsigned?b:g;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=g}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),a=s<=48?1:f(2,s-48),u=h(e),c=u.mul(t);c.isNegative()||c.gt(r);)c=(u=h(e-=a,this.unsigned)).mul(t);u.isZero()&&(u=w),n=n.add(u),r=r.sub(c)}return n},S.div=S.divide,S.modulo=function(t){return o(t)||(t=d(t)),i?l((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return l(~this.low,~this.high,this.unsigned)},S.and=function(t){return o(t)||(t=d(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},S.or=function(t){return o(t)||(t=d(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},S.xor=function(t){return o(t)||(t=d(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},S.shiftLeft=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(t){if(o(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?l(this.low>>>t|e<<32-t,e>>>t,this.unsigned):l(32===t?e:e>>>t-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},S.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},S.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},n.fromBytes=function(t,e,r){return r?n.fromBytesLE(t,e):n.fromBytesBE(t,e)},n.fromBytesLE=function(t,e){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},n.fromBytesBE=function(t,e){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},{}],12:[function(t,e,r){"use strict";function i(t,e){this.lo=t>>>0,this.hi=e>>>0}e.exports=i;var n=i.zero=new i(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return n;var e=t<0;e&&(t=-t);var r=t>>>0,o=(t-r)/4294967296>>>0;return e&&(o=~o>>>0,r=~r>>>0,++r>4294967295&&(r=0,++o>4294967295&&(o=0))),new i(r,o)},i.from=function(t){return"number"==typeof t?i.fromNumber(t):"string"==typeof t||t instanceof String?i.fromNumber(parseInt(t,10)):t.low||t.high?new i(t.low>>>0,t.high>>>0):n},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var s=String.prototype.charCodeAt;i.fromHash=function(t){return t===o?n:new i((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}},{}],20:[function(t,e,r){"use strict";var i=e.exports,n=i.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},o=i.normalize=function(t){var e=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(t),i="";r&&(i=e.shift()+"/");for(var o=0;o<e.length;)".."===e[o]?o>0&&".."!==e[o-1]?e.splice(--o,2):r?e.splice(o,1):++o:"."===e[o]?e.splice(o,1):++o;return i+e.join("/")};i.resolve=function(t,e,r){return r||(e=o(e)),n(e)?e:(r||(t=o(t)),(t=t.replace(/(?:\/|^)[^/]+$/,"")).length?o(t+"/"+e):e)}},{}],21:[function(t,e,r){"use strict";e.exports=function(t,e,r){var i=r||8192,n=i>>>1,o=null,s=i;return function(r){if(r<1||r>n)return t(r);s+r>i&&(o=t(i),s=0);var a=e.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},{}],30:[function(t,e,r){"use strict";var i=e.exports;i.length=function(t){for(var e=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?e+=1:r<2048?e+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},i.read=function(t,e,r){if(r-e<1)return"";for(var i,n=null,o=[],s=0;e<r;)(i=t[e++])<128?o[s++]=i:i>191&&i<224?o[s++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0);return n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))},i.write=function(t,e,r){for(var i,n,o=r,s=0;s<t.length;++s)(i=t.charCodeAt(s))<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=t.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&n),++s,e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128);return r-o}},{}],35:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getMiniBridge=void 0,r.getMiniBridge=function(){return"undefined"==typeof wx&&"undefined"!=typeof my?my:wx}},{}],36:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BezierPath=void 0;var i=function(t,e,r){this.d=t,this.transform=e,this.styles=r,this._d=t,this._transform=e,this._styles=r};r.BezierPath=i},{}],37:[function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.EllipsePath=void 0;var o=function(t){function e(e,r,i,n,o,s){var a=t.call(this,"",o,s)||this;return a._x=e,a._y=r,a._radiusX=i,a._radiusY=n,a._transform=o,a._styles=s,a}return n(e,t),e}(t(36).BezierPath);r.EllipsePath=o},{36:36}],38:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FrameEntity=void 0;var i=t(36),n=function t(e){this.alpha=0,this.transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.layout={x:0,y:0,width:0,height:0},this.nx=0,this.ny=0,this.shapes=[],this.alpha=parseFloat(e.alpha)||0,e.layout&&(this.layout.x=parseFloat(e.layout.x)||0,this.layout.y=parseFloat(e.layout.y)||0,this.layout.width=parseFloat(e.layout.width)||0,this.layout.height=parseFloat(e.layout.height)||0),e.transform&&(this.transform.a=parseFloat(e.transform.a)||1,this.transform.b=parseFloat(e.transform.b)||0,this.transform.c=parseFloat(e.transform.c)||0,this.transform.d=parseFloat(e.transform.d)||1,this.transform.tx=parseFloat(e.transform.tx)||0,this.transform.ty=parseFloat(e.transform.ty)||0),e.clipPath&&e.clipPath.length>0&&(this.maskPath=new i.BezierPath(e.clipPath,void 0,{fill:"#000000"})),e.shapes&&(e.shapes instanceof Array&&e.shapes.forEach((function(t){switch(t.pathArgs=t.args,t.type){case 0:t.type="shape",t.pathArgs=t.shape;break;case 1:t.type="rect",t.pathArgs=t.rect;break;case 2:t.type="ellipse",t.pathArgs=t.ellipse;break;case 3:t.type="keep"}if(t.styles){t.styles.fill&&("number"==typeof t.styles.fill.r&&(t.styles.fill[0]=t.styles.fill.r),"number"==typeof t.styles.fill.g&&(t.styles.fill[1]=t.styles.fill.g),"number"==typeof t.styles.fill.b&&(t.styles.fill[2]=t.styles.fill.b),"number"==typeof t.styles.fill.a&&(t.styles.fill[3]=t.styles.fill.a)),t.styles.stroke&&("number"==typeof t.styles.stroke.r&&(t.styles.stroke[0]=t.styles.stroke.r),"number"==typeof t.styles.stroke.g&&(t.styles.stroke[1]=t.styles.stroke.g),"number"==typeof t.styles.stroke.b&&(t.styles.stroke[2]=t.styles.stroke.b),"number"==typeof t.styles.stroke.a&&(t.styles.stroke[3]=t.styles.stroke.a));var e=t.styles.lineDash||[];switch(t.styles.lineDashI>0&&e.push(t.styles.lineDashI),t.styles.lineDashII>0&&(e.length<1&&e.push(0),e.push(t.styles.lineDashII),e.push(0)),t.styles.lineDashIII>0&&(e.length<2&&(e.push(0),e.push(0)),e[2]=t.styles.lineDashIII),t.styles.lineDash=e,t.styles.lineJoin){case 0:t.styles.lineJoin="miter";break;case 1:t.styles.lineJoin="round";break;case 2:t.styles.lineJoin="bevel"}switch(t.styles.lineCap){case 0:t.styles.lineCap="butt";break;case 1:t.styles.lineCap="round";break;case 2:t.styles.lineCap="square"}}})),e.shapes[0]&&"keep"===e.shapes[0].type?this.shapes=t.lastShapes:(this.shapes=e.shapes,t.lastShapes=e.shapes));var r=this.transform.a*this.layout.x+this.transform.c*this.layout.y+this.transform.tx,n=this.transform.a*(this.layout.x+this.layout.width)+this.transform.c*this.layout.y+this.transform.tx,o=this.transform.a*this.layout.x+this.transform.c*(this.layout.y+this.layout.height)+this.transform.tx,s=this.transform.a*(this.layout.x+this.layout.width)+this.transform.c*(this.layout.y+this.layout.height)+this.transform.tx,a=this.transform.b*this.layout.x+this.transform.d*this.layout.y+this.transform.ty,u=this.transform.b*(this.layout.x+this.layout.width)+this.transform.d*this.layout.y+this.transform.ty,h=this.transform.b*this.layout.x+this.transform.d*(this.layout.y+this.layout.height)+this.transform.ty,l=this.transform.b*(this.layout.x+this.layout.width)+this.transform.d*(this.layout.y+this.layout.height)+this.transform.ty;this.nx=Math.min(Math.min(o,s),Math.min(r,n)),this.ny=Math.min(Math.min(h,l),Math.min(a,u))};r.FrameEntity=n},{36:36}],39:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Player=r.Parser=void 0;var i=t(41),n=t(42);r.Parser=i.Parser,r.Player=n.Player},{41:41,42:42}],42:[function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{u(i.next(t))}catch(e){o(e)}}function a(t){try{u(i.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(a){o=[6,a],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.Player=void 0;var o=t(45),s=t(47),a=t(35).getMiniBridge(),u=function(){function t(){this.loops=0,this.clearsAfterStop=!0,this.fillMode="Forward",this._contentMode="AspectFit",this._animator=new s.ValueAnimator,this._forwardAnimating=!1,this._currentFrame=0,this._dynamicImage={},this._dynamicText={}}return t.prototype.setCanvas=function(t,e){return i(this,void 0,void 0,(function(){var r=this;return n(this,(function(i){return[2,new Promise((function(i,n){var o=a.createSelectorQuery();e&&(o=o.in(e)),o.select(t).fields({node:!0,size:!0}).exec((function(t){var e;if(r.canvas=null===(e=null==t?void 0:t[0])||void 0===e?void 0:e.node,r.canvas)if(r.ctx=r.canvas.getContext("2d"),r.ctx){var o=a.getSystemInfoSync().pixelRatio;r.canvas.width=t[0].width*o,r.canvas.height=t[0].height*o,i(void 0)}else n("canvas context not found.");else n("canvas not found.")}))}))]}))}))},t.prototype.setVideoItem=function(t){return i(this,void 0,void 0,(function(){var e,r,s=this;return n(this,(function(a){switch(a.label){case 0:return this._currentFrame=0,this._videoItem=t,t?[4,Promise.all(Object.keys(t.spec.images).map((function(e){return i(s,void 0,void 0,(function(){var r;return n(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.loadWXImage(t.spec.images[e])];case 1:return r=i.sent(),[2,{key:e,value:r}];case 2:return i.sent(),[2,{key:e,value:void 0}];case 3:return[2]}}))}))})))]:[3,2];case 1:return e=a.sent(),r={},e.forEach((function(t){r[t.key]=t.value})),t.decodedImages=r,this._renderer=new o.Renderer(this._videoItem,this.ctx,this.canvas),[3,3];case 2:this._renderer=void 0,a.label=3;case 3:return this.clear(),this._update(),[2]}}))}))},t.prototype.loadWXImage=function(t){var e=this;if(!this.canvas)throw"no canvas";return new Promise((function(r,i){var n=e.canvas.createImage();n.onload=function(){r(n)},n.onerror=function(t){console.log(t),i("image decoded fail.")},n.src="string"==typeof t?t:"data:image/png;base64,"+a.arrayBufferToBase64(t)}))},t.prototype.setContentMode=function(t){this._contentMode=t,this._update()},t.prototype.startAnimation=function(t){void 0===t&&(t=!1),this.stopAnimation(!1),this._doStart(void 0,t,void 0)},t.prototype.startAnimationWithRange=function(t,e){void 0===e&&(e=!1),this.stopAnimation(!1),this._doStart(t,e,void 0)},t.prototype.pauseAnimation=function(){this.stopAnimation(!1)},t.prototype.stopAnimation=function(t){this._forwardAnimating=!1,void 0!==this._animator&&this._animator.stop(),void 0===t&&(t=this.clearsAfterStop),t&&this.clear()},t.prototype.clear=function(){var t;null===(t=this._renderer)||void 0===t||t.clear()},t.prototype.stepToFrame=function(t,e){void 0===e&&(e=!1);var r=this._videoItem;r&&(t>=r.frames||t<0||(this.pauseAnimation(),this._currentFrame=t,this._update(),e&&this._doStart(void 0,!1,this._currentFrame)))},t.prototype.stepToPercentage=function(t,e){void 0===e&&(e=!1);var r=this._videoItem;if(r){var i=t*r.frames;i>=r.frames&&i>0&&(i=r.frames-1),this.stepToFrame(i,e)}},t.prototype.setImage=function(t,e){return i(this,void 0,void 0,(function(){var r;return n(this,(function(i){switch(i.label){case 0:return[4,this.loadWXImage(t)];case 1:return r=i.sent(),this._dynamicImage[e]=r,[2]}}))}))},t.prototype.setText=function(t,e){this._dynamicText[e]=t},t.prototype.clearDynamicObjects=function(){this._dynamicImage={},this._dynamicText={}},t.prototype.onFinished=function(t){this._onFinished=t},t.prototype.onFrame=function(t){this._onFrame=t},t.prototype.onPercentage=function(t){this._onPercentage=t},t.prototype._doStart=function(t,e,r){var i=this;void 0===e&&(e=!1),void 0===r&&(r=0);var n=this._videoItem;n&&(this._animator=new s.ValueAnimator,this._animator.canvas=this.canvas,void 0!==t?(this._animator.startValue=Math.max(0,t.location),this._animator.endValue=Math.min(n.frames-1,t.location+t.length),this._animator.duration=(this._animator.endValue-this._animator.startValue+1)*(1/n.FPS)*1e3):(this._animator.startValue=0,this._animator.endValue=n.frames-1,this._animator.duration=n.frames*(1/n.FPS)*1e3),this._animator.loops=this.loops<=0?1/0:this.loops,this._animator.fillRule="Backward"===this.fillMode?1:0,this._animator.onUpdate=function(t){i._currentFrame!==Math.floor(t)&&(i._forwardAnimating&&(i._currentFrame,Math.floor(t)),i._currentFrame=Math.floor(t),i._update(),"function"==typeof i._onFrame&&i._onFrame(i._currentFrame),"function"==typeof i._onPercentage&&i._onPercentage((i._currentFrame+1)/n.frames))},this._animator.onEnd=function(){i._forwardAnimating=!1,!0===i.clearsAfterStop&&i.clear(),"function"==typeof i._onFinished&&i._onFinished()},!0===e?(this._animator.reverse(r),this._forwardAnimating=!1):(this._animator.start(r),this._forwardAnimating=!0),this._currentFrame=this._animator.startValue,this._update())},t.prototype._resize=function(){var t=this.ctx,e=this._videoItem;if(t&&e){var r=1,i=1,n=0,o=0,s=this.canvas.width,a=this.canvas.height,u=e.videoSize;if("Fill"===this._contentMode)r=s/u.width,i=a/u.height;else if("AspectFit"===this._contentMode||"AspectFill"===this._contentMode){var h=u.width/u.height,l=s/a;h>=l&&"AspectFit"===this._contentMode||h<=l&&"AspectFill"===this._contentMode?(r=i=s/u.width,o=(a-u.height*i)/2):(h<l&&"AspectFit"===this._contentMode||h>l&&"AspectFill"===this._contentMode)&&(r=i=a/u.height,n=(s-u.width*r)/2)}this._renderer&&(this._renderer.globalTransform={a:r,b:0,c:0,d:i,tx:n,ty:o})}},t.prototype._update=function(){this._resize(),this._renderer&&(this._renderer._dynamicImage=this._dynamicImage,this._renderer._dynamicText=this._dynamicText,this._renderer.drawFrame(this._currentFrame),this._renderer.playAudio(this._currentFrame))},t}();r.Player=u},{35:35,45:45,47:47}],41:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Parser=void 0;var i=t(48),n=t(35),o=t(40).inflate,s=t(43).ProtoMovieEntity,a=n.getMiniBridge(),u=function(){function t(){}return t.prototype.load=function(t){return new Promise((function(e,r){0===t.indexOf("http://")||0===t.indexOf("https://")?a.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",success:function(t){try{var n=o(t.data),a=s.decode(n);e(new i.VideoEntity(a))}catch(u){r(u)}},fail:function(t){r(t)}}):a.getFileSystemManager().readFile({filePath:t,success:function(t){try{var n=o(t.data),a=s.decode(n);e(new i.VideoEntity(a))}catch(u){r(u)}},fail:function(t){r(t)}})}))},t}();r.Parser=u},{35:35,40:40,43:43,48:48}],40:[function(t,e,r){"use strict";var i;i=this,function(t){var e=function(t,e,r,i){for(var n=65535&t|0,o=t>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{o=o+(n=n+e[i++]|0)|0}while(--s);n%=65521,o%=65521}return n|o<<16|0},r=new Uint32Array(function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}()),i=function(t,e,i,n){var o=r,s=n+i;t^=-1;for(var a=n;a<s;a++)t=t>>>8^o[255&(t^e[a])];return-1^t},n=function(t,e){var r,i,n,o,s,a,u,h,l,f,c,d,p,y,m,v,g,b,w,_,x,k,A,O,S=t.state;r=t.next_in,A=t.input,i=r+(t.avail_in-5),n=t.next_out,O=t.output,o=n-(e-t.avail_out),s=n+(t.avail_out-257),a=S.dmax,u=S.wsize,h=S.whave,l=S.wnext,f=S.window,c=S.hold,d=S.bits,p=S.lencode,y=S.distcode,m=(1<<S.lenbits)-1,v=(1<<S.distbits)-1;t:do{d<15&&(c+=A[r++]<<d,d+=8,c+=A[r++]<<d,d+=8),g=p[c&m];e:for(;;){if(c>>>=b=g>>>24,d-=b,0==(b=g>>>16&255))O[n++]=65535&g;else{if(!(16&b)){if(0==(64&b)){g=p[(65535&g)+(c&(1<<b)-1)];continue e}if(32&b){S.mode=12;break t}t.msg="invalid literal/length code",S.mode=30;break t}w=65535&g,(b&=15)&&(d<b&&(c+=A[r++]<<d,d+=8),w+=c&(1<<b)-1,c>>>=b,d-=b),d<15&&(c+=A[r++]<<d,d+=8,c+=A[r++]<<d,d+=8),g=y[c&v];r:for(;;){if(c>>>=b=g>>>24,d-=b,!(16&(b=g>>>16&255))){if(0==(64&b)){g=y[(65535&g)+(c&(1<<b)-1)];continue r}t.msg="invalid distance code",S.mode=30;break t}if(_=65535&g,d<(b&=15)&&(c+=A[r++]<<d,(d+=8)<b&&(c+=A[r++]<<d,d+=8)),(_+=c&(1<<b)-1)>a){t.msg="invalid distance too far back",S.mode=30;break t}if(c>>>=b,d-=b,_>(b=n-o)){if((b=_-b)>h&&S.sane){t.msg="invalid distance too far back",S.mode=30;break t}if(x=0,k=f,0===l){if(x+=u-b,b<w){w-=b;do{O[n++]=f[x++]}while(--b);x=n-_,k=O}}else if(l<b){if(x+=u+l-b,(b-=l)<w){w-=b;do{O[n++]=f[x++]}while(--b);if(x=0,l<w){w-=b=l;do{O[n++]=f[x++]}while(--b);x=n-_,k=O}}}else if(x+=l-b,b<w){w-=b;do{O[n++]=f[x++]}while(--b);x=n-_,k=O}for(;w>2;)O[n++]=k[x++],O[n++]=k[x++],O[n++]=k[x++],w-=3;w&&(O[n++]=k[x++],w>1&&(O[n++]=k[x++]))}else{x=n-_;do{O[n++]=O[x++],O[n++]=O[x++],O[n++]=O[x++],w-=3}while(w>2);w&&(O[n++]=O[x++],w>1&&(O[n++]=O[x++]))}break}}break}}while(r<i&&n<s);r-=w=d>>3,c&=(1<<(d-=w<<3))-1,t.next_in=r,t.next_out=n,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=n<s?s-n+257:257-(n-s),S.hold=c,S.bits=d},o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),s=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),h=function(t,e,r,i,n,h,l,f){var c,d,p,y,m,v,g,b,w,_=f.bits,x=0,k=0,A=0,O=0,S=0,E=0,N=0,T=0,j=0,R=0,F=null,I=0,B=new Uint16Array(16),P=new Uint16Array(16),C=null,M=0;for(x=0;x<=15;x++)B[x]=0;for(k=0;k<i;k++)B[e[r+k]]++;for(S=_,O=15;O>=1&&0===B[O];O--);if(S>O&&(S=O),0===O)return n[h++]=20971520,n[h++]=20971520,f.bits=1,0;for(A=1;A<O&&0===B[A];A++);for(S<A&&(S=A),T=1,x=1;x<=15;x++)if(T<<=1,(T-=B[x])<0)return-1;if(T>0&&(0===t||1!==O))return-1;for(P[1]=0,x=1;x<15;x++)P[x+1]=P[x]+B[x];for(k=0;k<i;k++)0!==e[r+k]&&(l[P[e[r+k]]++]=k);if(0===t?(F=C=l,v=19):1===t?(F=o,I-=257,C=s,M-=257,v=256):(F=a,C=u,v=-1),R=0,k=0,x=A,m=h,E=S,N=0,p=-1,y=(j=1<<S)-1,1===t&&j>852||2===t&&j>592)return 1;for(;;){g=x-N,l[k]<v?(b=0,w=l[k]):l[k]>v?(b=C[M+l[k]],w=F[I+l[k]]):(b=96,w=0),c=1<<x-N,A=d=1<<E;do{n[m+(R>>N)+(d-=c)]=g<<24|b<<16|w|0}while(0!==d);for(c=1<<x-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,k++,0==--B[x]){if(x===O)break;x=e[r+l[k]]}if(x>S&&(R&y)!==p){for(0===N&&(N=S),m+=A,T=1<<(E=x-N);E+N<O&&!((T-=B[E+N])<=0);)E++,T<<=1;if(j+=1<<E,1===t&&j>852||2===t&&j>592)return 1;n[p=R&y]=S<<24|E<<16|m-h|0}}return 0!==R&&(n[m+R]=x-N<<24|64<<16|0),f.bits=S,0},l={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},f=l.Z_FINISH,c=l.Z_BLOCK,d=l.Z_TREES,p=l.Z_OK,y=l.Z_STREAM_END,m=l.Z_NEED_DICT,v=l.Z_STREAM_ERROR,g=l.Z_DATA_ERROR,b=l.Z_MEM_ERROR,w=l.Z_BUF_ERROR,_=l.Z_DEFLATED,x=12,k=30,A=function(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)};function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var S,E,N=function(t){if(!t||!t.state)return v;var e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,p},T=function(t){if(!t||!t.state)return v;var e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,N(t)},j=function(t,e){var r;if(!t||!t.state)return v;var i=t.state;return e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,T(t))},R=function(t,e){if(!t)return v;var r=new O;t.state=r,r.window=null;var i=j(t,e);return i!==p&&(t.state=null),i},F=!0,I=function(t){if(F){S=new Int32Array(512),E=new Int32Array(32);for(var e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(h(1,t.lens,0,288,S,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;h(2,t.lens,0,32,E,0,t.work,{bits:5}),F=!1}t.lencode=S,t.lenbits=9,t.distcode=E,t.distbits=5},B=function(t,e,r,i){var n,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>i&&(n=i),o.window.set(e.subarray(r-i,r-i+n),o.wnext),(i-=n)?(o.window.set(e.subarray(r-i,r),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},P=T,C=R,M=function(t,r){var o,s,a,u,l,O,S,E,N,T,j,R,F,P,C,M,D,L,z,V,Z,U,q,J,$=0,K=new Uint8Array(4),H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(o=t.state).mode===x&&(o.mode=13),l=t.next_out,a=t.output,S=t.avail_out,u=t.next_in,s=t.input,O=t.avail_in,E=o.hold,N=o.bits,T=O,j=S,U=p;t:for(;;)switch(o.mode){case 1:if(0===o.wrap){o.mode=13;break}for(;N<16;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(2&o.wrap&&35615===E){o.check=0,K[0]=255&E,K[1]=E>>>8&255,o.check=i(o.check,K,2,0),E=0,N=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",o.mode=k;break}if((15&E)!==_){t.msg="unknown compression method",o.mode=k;break}if(N-=4,Z=8+(15&(E>>>=4)),0===o.wbits)o.wbits=Z;else if(Z>o.wbits){t.msg="invalid window size",o.mode=k;break}o.dmax=1<<o.wbits,t.adler=o.check=1,o.mode=512&E?10:x,E=0,N=0;break;case 2:for(;N<16;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(o.flags=E,(255&o.flags)!==_){t.msg="unknown compression method",o.mode=k;break}if(57344&o.flags){t.msg="unknown header flags set",o.mode=k;break}o.head&&(o.head.text=E>>8&1),512&o.flags&&(K[0]=255&E,K[1]=E>>>8&255,o.check=i(o.check,K,2,0)),E=0,N=0,o.mode=3;case 3:for(;N<32;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.head&&(o.head.time=E),512&o.flags&&(K[0]=255&E,K[1]=E>>>8&255,K[2]=E>>>16&255,K[3]=E>>>24&255,o.check=i(o.check,K,4,0)),E=0,N=0,o.mode=4;case 4:for(;N<16;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.head&&(o.head.xflags=255&E,o.head.os=E>>8),512&o.flags&&(K[0]=255&E,K[1]=E>>>8&255,o.check=i(o.check,K,2,0)),E=0,N=0,o.mode=5;case 5:if(1024&o.flags){for(;N<16;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.length=E,o.head&&(o.head.extra_len=E),512&o.flags&&(K[0]=255&E,K[1]=E>>>8&255,o.check=i(o.check,K,2,0)),E=0,N=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&((R=o.length)>O&&(R=O),R&&(o.head&&(Z=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(s.subarray(u,u+R),Z)),512&o.flags&&(o.check=i(o.check,s,R,u)),O-=R,u+=R,o.length-=R),o.length))break t;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===O)break t;R=0;do{Z=s[u+R++],o.head&&Z&&o.length<65536&&(o.head.name+=String.fromCharCode(Z))}while(Z&&R<O);if(512&o.flags&&(o.check=i(o.check,s,R,u)),O-=R,u+=R,Z)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===O)break t;R=0;do{Z=s[u+R++],o.head&&Z&&o.length<65536&&(o.head.comment+=String.fromCharCode(Z))}while(Z&&R<O);if(512&o.flags&&(o.check=i(o.check,s,R,u)),O-=R,u+=R,Z)break t}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;N<16;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(E!==(65535&o.check)){t.msg="header crc mismatch",o.mode=k;break}E=0,N=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),t.adler=o.check=0,o.mode=x;break;case 10:for(;N<32;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}t.adler=o.check=A(E),E=0,N=0,o.mode=11;case 11:if(0===o.havedict)return t.next_out=l,t.avail_out=S,t.next_in=u,t.avail_in=O,o.hold=E,o.bits=N,m;t.adler=o.check=1,o.mode=x;case x:if(r===c||r===d)break t;case 13:if(o.last){E>>>=7&N,N-=7&N,o.mode=27;break}for(;N<3;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}switch(o.last=1&E,N-=1,3&(E>>>=1)){case 0:o.mode=14;break;case 1:if(I(o),o.mode=20,r===d){E>>>=2,N-=2;break t}break;case 2:o.mode=17;break;case 3:t.msg="invalid block type",o.mode=k}E>>>=2,N-=2;break;case 14:for(E>>>=7&N,N-=7&N;N<32;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",o.mode=k;break}if(o.length=65535&E,E=0,N=0,o.mode=15,r===d)break t;case 15:o.mode=16;case 16:if(R=o.length){if(R>O&&(R=O),R>S&&(R=S),0===R)break t;a.set(s.subarray(u,u+R),l),O-=R,u+=R,S-=R,l+=R,o.length-=R;break}o.mode=x;break;case 17:for(;N<14;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(o.nlen=257+(31&E),E>>>=5,N-=5,o.ndist=1+(31&E),E>>>=5,N-=5,o.ncode=4+(15&E),E>>>=4,N-=4,o.nlen>286||o.ndist>30){t.msg="too many length or distance symbols",o.mode=k;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;N<3;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.lens[H[o.have++]]=7&E,E>>>=3,N-=3}for(;o.have<19;)o.lens[H[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,q={bits:o.lenbits},U=h(0,o.lens,0,19,o.lencode,0,o.work,q),o.lenbits=q.bits,U){t.msg="invalid code lengths set",o.mode=k;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;M=($=o.lencode[E&(1<<o.lenbits)-1])>>>16&255,D=65535&$,!((C=$>>>24)<=N);){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(D<16)E>>>=C,N-=C,o.lens[o.have++]=D;else{if(16===D){for(J=C+2;N<J;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(E>>>=C,N-=C,0===o.have){t.msg="invalid bit length repeat",o.mode=k;break}Z=o.lens[o.have-1],R=3+(3&E),E>>>=2,N-=2}else if(17===D){for(J=C+3;N<J;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}N-=C,Z=0,R=3+(7&(E>>>=C)),E>>>=3,N-=3}else{for(J=C+7;N<J;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}N-=C,Z=0,R=11+(127&(E>>>=C)),E>>>=7,N-=7}if(o.have+R>o.nlen+o.ndist){t.msg="invalid bit length repeat",o.mode=k;break}for(;R--;)o.lens[o.have++]=Z}}if(o.mode===k)break;if(0===o.lens[256]){t.msg="invalid code -- missing end-of-block",o.mode=k;break}if(o.lenbits=9,q={bits:o.lenbits},U=h(1,o.lens,0,o.nlen,o.lencode,0,o.work,q),o.lenbits=q.bits,U){t.msg="invalid literal/lengths set",o.mode=k;break}if(o.distbits=6,o.distcode=o.distdyn,q={bits:o.distbits},U=h(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,q),o.distbits=q.bits,U){t.msg="invalid distances set",o.mode=k;break}if(o.mode=20,r===d)break t;case 20:o.mode=21;case 21:if(O>=6&&S>=258){t.next_out=l,t.avail_out=S,t.next_in=u,t.avail_in=O,o.hold=E,o.bits=N,n(t,j),l=t.next_out,a=t.output,S=t.avail_out,u=t.next_in,s=t.input,O=t.avail_in,E=o.hold,N=o.bits,o.mode===x&&(o.back=-1);break}for(o.back=0;M=($=o.lencode[E&(1<<o.lenbits)-1])>>>16&255,D=65535&$,!((C=$>>>24)<=N);){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(M&&0==(240&M)){for(L=C,z=M,V=D;M=($=o.lencode[V+((E&(1<<L+z)-1)>>L)])>>>16&255,D=65535&$,!(L+(C=$>>>24)<=N);){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}E>>>=L,N-=L,o.back+=L}if(E>>>=C,N-=C,o.back+=C,o.length=D,0===M){o.mode=26;break}if(32&M){o.back=-1,o.mode=x;break}if(64&M){t.msg="invalid literal/length code",o.mode=k;break}o.extra=15&M,o.mode=22;case 22:if(o.extra){for(J=o.extra;N<J;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.length+=E&(1<<o.extra)-1,E>>>=o.extra,N-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;M=($=o.distcode[E&(1<<o.distbits)-1])>>>16&255,D=65535&$,!((C=$>>>24)<=N);){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(0==(240&M)){for(L=C,z=M,V=D;M=($=o.distcode[V+((E&(1<<L+z)-1)>>L)])>>>16&255,D=65535&$,!(L+(C=$>>>24)<=N);){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}E>>>=L,N-=L,o.back+=L}if(E>>>=C,N-=C,o.back+=C,64&M){t.msg="invalid distance code",o.mode=k;break}o.offset=D,o.extra=15&M,o.mode=24;case 24:if(o.extra){for(J=o.extra;N<J;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}o.offset+=E&(1<<o.extra)-1,E>>>=o.extra,N-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){t.msg="invalid distance too far back",o.mode=k;break}o.mode=25;case 25:if(0===S)break t;if(R=j-S,o.offset>R){if((R=o.offset-R)>o.whave&&o.sane){t.msg="invalid distance too far back",o.mode=k;break}R>o.wnext?(R-=o.wnext,F=o.wsize-R):F=o.wnext-R,R>o.length&&(R=o.length),P=o.window}else P=a,F=l-o.offset,R=o.length;R>S&&(R=S),S-=R,o.length-=R;do{a[l++]=P[F++]}while(--R);0===o.length&&(o.mode=21);break;case 26:if(0===S)break t;a[l++]=o.length,S--,o.mode=21;break;case 27:if(o.wrap){for(;N<32;){if(0===O)break t;O--,E|=s[u++]<<N,N+=8}if(j-=S,t.total_out+=j,o.total+=j,j&&(t.adler=o.check=o.flags?i(o.check,a,j,l-j):e(o.check,a,j,l-j)),j=S,(o.flags?E:A(E))!==o.check){t.msg="incorrect data check",o.mode=k;break}E=0,N=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;N<32;){if(0===O)break t;O--,E+=s[u++]<<N,N+=8}if(E!==(4294967295&o.total)){t.msg="incorrect length check",o.mode=k;break}E=0,N=0}o.mode=29;case 29:U=y;break t;case k:U=g;break t;case 31:return b;case 32:default:return v}return t.next_out=l,t.avail_out=S,t.next_in=u,t.avail_in=O,o.hold=E,o.bits=N,(o.wsize||j!==t.avail_out&&o.mode<k&&(o.mode<27||r!==f))&&B(t,t.output,t.next_out,j-t.avail_out),T-=t.avail_in,j-=t.avail_out,t.total_in+=T,t.total_out+=j,o.total+=j,o.wrap&&j&&(t.adler=o.check=o.flags?i(o.check,a,j,t.next_out-j):e(o.check,a,j,t.next_out-j)),t.data_type=o.bits+(o.last?64:0)+(o.mode===x?128:0)+(20===o.mode||15===o.mode?256:0),(0===T&&0===j||r===f)&&U===p&&(U=w),U},D=function(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,p},L=function(t,e){if(!t||!t.state)return v;var r=t.state;return 0==(2&r.wrap)?v:(r.head=e,e.done=!1,p)},z=function(t,r){var i,n=r.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?v:11===i.mode&&e(1,r,n,0)!==i.check?g:B(t,r,n,n)?(i.mode=31,b):(i.havedict=1,p):v},V=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Z=!1}for(var U=new Uint8Array(256),q=0;q<256;q++)U[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;U[254]=U[254]=1;var J=function(t,e){var r,i,n=e||t.length,o=new Array(2*n);for(i=0,r=0;r<n;){var s=t[r++];if(s<128)o[i++]=s;else{var a=U[s];if(a>4)o[i++]=65533,r+=a-1;else{for(s&=2===a?31:3===a?15:7;a>1&&r<n;)s=s<<6|63&t[r++],a--;a>1?o[i++]=65533:s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|1023&s)}}}return function(t,e){if(e<65534&&t.subarray&&Z)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));for(var r="",i=0;i<e;i++)r+=String.fromCharCode(t[i]);return r}(o,i)},$=function(t,e){(e=e||t.length)>t.length&&(e=t.length);for(var r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+U[t[r]]>e?r:e},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},W=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},X=Object.prototype.toString,G=l.Z_NO_FLUSH,Y=l.Z_FINISH,Q=l.Z_OK,tt=l.Z_STREAM_END,et=l.Z_NEED_DICT,rt=l.Z_STREAM_ERROR,it=l.Z_DATA_ERROR,nt=l.Z_MEM_ERROR;function ot(t){this.options=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)V(r,i)&&(t[i]=r[i])}}return t}({chunkSize:65536,windowBits:15,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;var r=C(this.strm,e.windowBits);if(r!==Q)throw new Error(K[r]);if(this.header=new W,L(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=function(t){var e,r,i,n,o,s=t.length,a=0;for(n=0;n<s;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),a+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(a),o=0,n=0;o<a;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|63&r):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|63&r):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|63&r);return e}(e.dictionary):"[object ArrayBuffer]"===X.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=z(this.strm,e.dictionary))!==Q))throw new Error(K[r])}function st(t,e){var r=new ot(e);if(r.push(t),r.err)throw r.msg||K[r.err];return r.result}ot.prototype.push=function(t,e){var r,i,n,o=this.strm,s=this.options.chunkSize,a=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?Y:G,"[object ArrayBuffer]"===X.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(s),o.next_out=0,o.avail_out=s),(r=M(o,i))===et&&a&&((r=z(o,a))===Q?r=M(o,i):r===it&&(r=et));o.avail_in>0&&r===tt&&o.state.wrap>0&&0!==t[o.next_in];)P(o),r=M(o,i);switch(r){case rt:case it:case et:case nt:return this.onEnd(r),this.ended=!0,!1}if(n=o.avail_out,o.next_out&&(0===o.avail_out||r===tt))if("string"===this.options.to){var u=$(o.output,o.next_out),h=o.next_out-u,l=J(o.output,u);o.next_out=h,o.avail_out=s-h,h&&o.output.set(o.output.subarray(u,u+h),0),this.onData(l)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(r!==Q||0!==n){if(r===tt)return r=D(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},ot.prototype.onData=function(t){this.chunks.push(t)},ot.prototype.onEnd=function(t){t===Q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(t){for(var e=0,r=0,i=t.length;r<i;r++)e+=t[r].length;for(var n=new Uint8Array(e),o=0,s=0,a=t.length;o<a;o++){var u=t[o];n.set(u,s),s+=u.length}return n}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var at=ot,ut=st,ht=function(t,e){return(e=e||{}).raw=!0,st(t,e)},lt=st,ft=l,ct={Inflate:at,inflate:ut,inflateRaw:ht,ungzip:lt,constants:ft};t.Inflate=at,t.constants=ft,t.default=ct,t.inflate=ut,t.inflateRaw=ht,t.ungzip=lt,Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof r&&void 0!==e?r:(i="undefined"!=typeof globalThis?globalThis:i||self).pako={})},{}],48:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoEntity=void 0;var i=t(46),n=function(t){var e,r;this.spec=t,this.version="2.0.0",this.decodedImages={},this.version=t.ver,this.videoSize={width:t.params.viewBoxWidth||0,height:t.params.viewBoxHeight||0},this.FPS=t.params.fps||20,this.frames=t.params.frames||0,this.sprites=null!==(r=null===(e=t.sprites)||void 0===e?void 0:e.map((function(t){return new i.SpriteEntity(t)})))&&void 0!==r?r:[],this.audios=[]};r.VideoEntity=n},{46:46}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProtoMovieEntity=r.proto=void 0;var i=t(1),n=JSON.parse('{"nested":{"com":{"nested":{"opensource":{"nested":{"svga":{"options":{"objc_class_prefix":"SVGAProto","java_package":"com.opensource.svgaplayer.proto"},"nested":{"MovieParams":{"fields":{"viewBoxWidth":{"type":"float","id":1},"viewBoxHeight":{"type":"float","id":2},"fps":{"type":"int32","id":3},"frames":{"type":"int32","id":4}}},"SpriteEntity":{"fields":{"imageKey":{"type":"string","id":1},"frames":{"rule":"repeated","type":"FrameEntity","id":2},"matteKey":{"type":"string","id":3}}},"AudioEntity":{"fields":{"audioKey":{"type":"string","id":1},"startFrame":{"type":"int32","id":2},"endFrame":{"type":"int32","id":3},"startTime":{"type":"int32","id":4},"totalTime":{"type":"int32","id":5}}},"Layout":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4}}},"Transform":{"fields":{"a":{"type":"float","id":1},"b":{"type":"float","id":2},"c":{"type":"float","id":3},"d":{"type":"float","id":4},"tx":{"type":"float","id":5},"ty":{"type":"float","id":6}}},"ShapeEntity":{"oneofs":{"args":{"oneof":["shape","rect","ellipse"]}},"fields":{"type":{"type":"ShapeType","id":1},"shape":{"type":"ShapeArgs","id":2},"rect":{"type":"RectArgs","id":3},"ellipse":{"type":"EllipseArgs","id":4},"styles":{"type":"ShapeStyle","id":10},"transform":{"type":"Transform","id":11}},"nested":{"ShapeType":{"values":{"SHAPE":0,"RECT":1,"ELLIPSE":2,"KEEP":3}},"ShapeArgs":{"fields":{"d":{"type":"string","id":1}}},"RectArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4},"cornerRadius":{"type":"float","id":5}}},"EllipseArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"radiusX":{"type":"float","id":3},"radiusY":{"type":"float","id":4}}},"ShapeStyle":{"fields":{"fill":{"type":"RGBAColor","id":1},"stroke":{"type":"RGBAColor","id":2},"strokeWidth":{"type":"float","id":3},"lineCap":{"type":"LineCap","id":4},"lineJoin":{"type":"LineJoin","id":5},"miterLimit":{"type":"float","id":6},"lineDashI":{"type":"float","id":7},"lineDashII":{"type":"float","id":8},"lineDashIII":{"type":"float","id":9}},"nested":{"RGBAColor":{"fields":{"r":{"type":"float","id":1},"g":{"type":"float","id":2},"b":{"type":"float","id":3},"a":{"type":"float","id":4}}},"LineCap":{"values":{"LineCap_BUTT":0,"LineCap_ROUND":1,"LineCap_SQUARE":2}},"LineJoin":{"values":{"LineJoin_MITER":0,"LineJoin_ROUND":1,"LineJoin_BEVEL":2}}}}}},"FrameEntity":{"fields":{"alpha":{"type":"float","id":1},"layout":{"type":"Layout","id":2},"transform":{"type":"Transform","id":3},"clipPath":{"type":"string","id":4},"shapes":{"rule":"repeated","type":"ShapeEntity","id":5}}},"MovieEntity":{"fields":{"version":{"type":"string","id":1},"params":{"type":"MovieParams","id":2},"images":{"keyType":"string","type":"bytes","id":3},"sprites":{"rule":"repeated","type":"SpriteEntity","id":4},"audios":{"rule":"repeated","type":"AudioEntity","id":5}}}}}}}}}}}');r.proto=i.Root.fromJSON(n),r.ProtoMovieEntity=r.proto.lookupType("com.opensource.svga.MovieEntity")},{1:1}],47:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ValueAnimator=void 0;var i=function(){function t(){this.startValue=0,this.endValue=0,this.duration=0,this.loops=1,this.fillRule=0,this.mRunning=!1,this.mStartTime=0,this.mCurrentFrication=0,this.mReverse=!1,this.onStart=function(){},this.onUpdate=function(t){},this.onEnd=function(){}}return t.prototype.start=function(t){this.doStart(!1,t)},t.prototype.reverse=function(t){this.doStart(!0,t)},t.prototype.stop=function(){this.doStop()},t.prototype.animatedValue=function(){return(this.endValue-this.startValue)*this.mCurrentFrication+this.startValue},t.prototype.doStart=function(e,r){void 0===r&&(r=void 0),this.mReverse=e,this.mRunning=!0,this.mStartTime=t.currentTimeMillsecond(),r&&(this.mStartTime-=e?(1-r/(this.endValue-this.startValue))*this.duration:r/(this.endValue-this.startValue)*this.duration),this.mCurrentFrication=0,this.onStart(),this.doFrame()},t.prototype.doStop=function(){this.mRunning=!1},t.prototype.doFrame=function(){var e,r=this,i=function(){var e;r.mRunning&&(r.doDeltaTime(t.currentTimeMillsecond()-r.mStartTime),null===(e=r.canvas)||void 0===e||e.requestAnimationFrame(i))};null===(e=this.canvas)||void 0===e||e.requestAnimationFrame(i)},t.prototype.doDeltaTime=function(t){var e=!1;t>=this.duration*this.loops?(this.mCurrentFrication=1===this.fillRule?0:1,this.mRunning=!1,e=!0):(this.mCurrentFrication=t%this.duration/this.duration,this.mReverse&&(this.mCurrentFrication=1-this.mCurrentFrication)),this.onUpdate(this.animatedValue()),!1===this.mRunning&&e&&this.onEnd()},t.currentTimeMillsecond=function(){return"undefined"==typeof performance?(new Date).getTime():performance.now()},t}();r.ValueAnimator=i},{}],45:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Renderer=void 0;var i=t(36),n=t(37),o=t(44),s=function(){function t(t,e,r){this.videoItem=t,this.ctx=e,this.canvas=r,this._dynamicImage={},this._dynamicText={}}return t.prototype.clear=function(){var t=this.ctx,e={x:0,y:0,width:this.canvas.width,height:this.canvas.height};t.clearRect(e.x,e.y,e.width,e.height)},t.prototype.drawFrame=function(t){var e=this,r=this.ctx,i={x:0,y:0,width:this.canvas.width,height:this.canvas.height};r.clearRect(i.x,i.y,i.width,i.height);var n={},o=!1,s=this.videoItem.sprites;s.forEach((function(i,a){var u,h;if(-1!=(null===(u=s[0].imageKey)||void 0===u?void 0:u.indexOf(".matte")))if(-1==(null===(h=i.imageKey)||void 0===h?void 0:h.indexOf(".matte"))){var l=s[a-1];if(o&&(!i.matteKey||0==i.matteKey.length||i.matteKey!=l.matteKey)){o=!1;var f=n[i.matteKey];r.globalCompositeOperation="destination-in",e.drawSprite(f,t),r.globalCompositeOperation="source-over",r.restore()}null==i.matteKey||null!=l.matteKey&&0!=l.matteKey.length&&l.matteKey==i.matteKey||(o=!0,r.save()),e.drawSprite(i,t),o&&a==s.length-1&&(f=n.get(i.matteKey),r.globalCompositeOperation="destination-in",e.drawSprite(f,t),r.globalCompositeOperation="source-over",r.restore())}else f[i.imageKey]=i;else e.drawSprite(i,t)}))},t.prototype.drawSprite=function(t,e){var r,s,a,u=this,h=t.frames[e];if(!(h.alpha<.05)){var l=this.ctx;l.save(),this.globalTransform&&l.transform(this.globalTransform.a,this.globalTransform.b,this.globalTransform.c,this.globalTransform.d,this.globalTransform.tx,this.globalTransform.ty),l.globalAlpha=h.alpha,l.transform(h.transform.a,h.transform.b,h.transform.c,h.transform.d,h.transform.tx,h.transform.ty);var f=null===(r=t.imageKey)||void 0===r?void 0:r.replace(".matte","");if(f){var c=null!==(s=this._dynamicImage[f])&&void 0!==s?s:this.videoItem.decodedImages[f];void 0!==h.maskPath&&null!==h.maskPath&&(h.maskPath._styles=void 0,this.drawBezier(h.maskPath),l.clip()),c&&l.drawImage(c,0,0,c.width,c.height,0,0,h.layout.width,h.layout.height),h.shapes&&h.shapes.forEach((function(t){"shape"===t.type&&t.pathArgs&&t.pathArgs.d&&u.drawBezier(new i.BezierPath(t.pathArgs.d,t.transform,t.styles)),"ellipse"===t.type&&t.pathArgs&&u.drawEllipse(new n.EllipsePath(parseFloat(t.pathArgs.x)||0,parseFloat(t.pathArgs.y)||0,parseFloat(t.pathArgs.radiusX)||0,parseFloat(t.pathArgs.radiusY)||0,t.transform,t.styles)),"rect"===t.type&&t.pathArgs&&u.drawRect(new o.RectPath(parseFloat(t.pathArgs.x)||0,parseFloat(t.pathArgs.y)||0,parseFloat(t.pathArgs.width)||0,parseFloat(t.pathArgs.height)||0,parseFloat(t.pathArgs.cornerRadius)||0,t.transform,t.styles))}));var d=this._dynamicText[f];if(void 0!==d){l.font=d.size+"px "+(null!==(a=d.family)&&void 0!==a?a:"Arial");var p=l.measureText(d.text).width;l.fillStyle=d.color;var y=void 0!==d.offset&&void 0!==d.offset.x?isNaN(d.offset.x)?0:d.offset.x:0,m=void 0!==d.offset&&void 0!==d.offset.y?isNaN(d.offset.y)?0:d.offset.y:0;l.fillText(d.text,(h.layout.width-p)/2+y,h.layout.height/2+m)}l.restore()}}},t.prototype.playAudio=function(t){},t.prototype.resetShapeStyles=function(t){var e=this.ctx,r=t._styles;r&&(r&&r.stroke?e.strokeStyle="rgba("+(255*r.stroke[0]).toFixed(0)+", "+(255*r.stroke[1]).toFixed(0)+", "+(255*r.stroke[2]).toFixed(0)+", "+r.stroke[3]+")":e.strokeStyle="transparent",r&&(e.lineWidth=r.strokeWidth||void 0,e.lineCap=r.lineCap||void 0,e.lineJoin=r.lineJoin||void 0,e.miterLimit=r.miterLimit||void 0),r&&r.fill?e.fillStyle="rgba("+(255*r.fill[0]).toFixed(0)+", "+(255*r.fill[1]).toFixed(0)+", "+(255*r.fill[2]).toFixed(0)+", "+r.fill[3]+")":e.fillStyle="transparent",r&&r.lineDash&&e.setLineDash([r.lineDash[0],r.lineDash[1]],r.lineDash[2]))},t.prototype.drawBezier=function(t){var e=this,r=this.ctx;r.save(),this.resetShapeStyles(t),void 0!==t._transform&&null!==t._transform&&r.transform(t._transform.a,t._transform.b,t._transform.c,t._transform.d,t._transform.tx,t._transform.ty);var i={x:0,y:0,x1:0,y1:0,x2:0,y2:0};r.beginPath(),t._d.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ").split("|||").forEach((function(t){if(0!=t.length){var r=t.substr(0,1);if("MLHVCSQRZmlhvcsqrz".indexOf(r)>=0){var n=t.substr(1).trim().split(" ");e.drawBezierElement(i,r,n)}}})),t._styles&&t._styles.fill&&r.fill(),t._styles&&t._styles.stroke&&r.stroke(),r.restore()},t.prototype.drawBezierElement=function(t,e,r){var i=this.ctx;switch(e){case"M":t.x=Number(r[0]),t.y=Number(r[1]),i.moveTo(t.x,t.y);break;case"m":t.x+=Number(r[0]),t.y+=Number(r[1]),i.moveTo(t.x,t.y);break;case"L":t.x=Number(r[0]),t.y=Number(r[1]),i.lineTo(t.x,t.y);break;case"l":t.x+=Number(r[0]),t.y+=Number(r[1]),i.lineTo(t.x,t.y);break;case"H":t.x=Number(r[0]),i.lineTo(t.x,t.y);break;case"h":t.x+=Number(r[0]),i.lineTo(t.x,t.y);break;case"V":t.y=Number(r[0]),i.lineTo(t.x,t.y);break;case"v":t.y+=Number(r[0]),i.lineTo(t.x,t.y);break;case"C":t.x1=Number(r[0]),t.y1=Number(r[1]),t.x2=Number(r[2]),t.y2=Number(r[3]),t.x=Number(r[4]),t.y=Number(r[5]),i.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"c":t.x1=t.x+Number(r[0]),t.y1=t.y+Number(r[1]),t.x2=t.x+Number(r[2]),t.y2=t.y+Number(r[3]),t.x+=Number(r[4]),t.y+=Number(r[5]),i.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"S":t.x1&&t.y1&&t.x2&&t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=Number(r[0]),t.y2=Number(r[1]),t.x=Number(r[2]),t.y=Number(r[3]),i.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=Number(r[0]),t.y1=Number(r[1]),t.x=Number(r[2]),t.y=Number(r[3]),i.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"s":t.x1&&t.y1&&t.x2&&t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=t.x+Number(r[0]),t.y2=t.y+Number(r[1]),t.x+=Number(r[2]),t.y+=Number(r[3]),i.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=t.x+Number(r[0]),t.y1=t.y+Number(r[1]),t.x+=Number(r[2]),t.y+=Number(r[3]),i.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"Q":t.x1=Number(r[0]),t.y1=Number(r[1]),t.x=Number(r[2]),t.y=Number(r[3]),i.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"q":t.x1=t.x+Number(r[0]),t.y1=t.y+Number(r[1]),t.x+=Number(r[2]),t.y+=Number(r[3]),i.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"A":case"a":break;case"Z":case"z":i.closePath()}},t.prototype.drawEllipse=function(t){var e=this.ctx;e.save(),this.resetShapeStyles(t),void 0!==t._transform&&null!==t._transform&&e.transform(t._transform.a,t._transform.b,t._transform.c,t._transform.d,t._transform.tx,t._transform.ty);var r=t._x-t._radiusX,i=t._y-t._radiusY,n=2*t._radiusX,o=2*t._radiusY,s=n/2*.5522848,a=o/2*.5522848,u=r+n,h=i+o,l=r+n/2,f=i+o/2;e.beginPath(),e.moveTo(r,f),e.bezierCurveTo(r,f-a,l-s,i,l,i),e.bezierCurveTo(l+s,i,u,f-a,u,f),e.bezierCurveTo(u,f+a,l+s,h,l,h),e.bezierCurveTo(l-s,h,r,f+a,r,f),t._styles&&t._styles.fill&&e.fill(),t._styles&&t._styles.stroke&&e.stroke(),e.restore()},t.prototype.drawRect=function(t){var e=this.ctx;e.save(),this.resetShapeStyles(t),void 0!==t._transform&&null!==t._transform&&e.transform(t._transform.a,t._transform.b,t._transform.c,t._transform.d,t._transform.tx,t._transform.ty);var r=t._x,i=t._y,n=t._width,o=t._height,s=t._cornerRadius;n<2*s&&(s=n/2),o<2*s&&(s=o/2),e.beginPath(),e.moveTo(r+s,i),e.arcTo(r+n,i,r+n,i+o,s),e.arcTo(r+n,i+o,r,i+o,s),e.arcTo(r,i+o,r,i,s),e.arcTo(r,i,r+n,i,s),e.closePath(),t._styles&&t._styles.fill&&e.fill(),t._styles&&t._styles.stroke&&e.stroke(),e.restore()},t}();r.Renderer=s},{36:36,37:37,44:44}],44:[function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.RectPath=void 0;var o=function(t){function e(e,r,i,n,o,s,a){var u=t.call(this,"",s,a)||this;return u._x=e,u._y=r,u._width=i,u._height=n,u._cornerRadius=o,u._transform=s,u._styles=a,u}return n(e,t),e}(t(36).BezierPath);r.RectPath=o},{36:36}],46:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SpriteEntity=void 0;var i=t(38),n=function(t){var e,r;this.matteKey=t.matteKey,this.imageKey=t.imageKey,this.frames=null!==(r=null===(e=t.frames)||void 0===e?void 0:e.map((function(t){return new i.FrameEntity(t)})))&&void 0!==r?r:[]};r.SpriteEntity=n},{38:38}]},{},[39])(39)}));
````

## File: package.json
````json
{
  "name": "joymew-mp",
  "version": "1.0.0",
  "description": "joymew-mp\r # stage环境和线上环境切换\r   ```\r   检查当前环境:\r     全局搜索: hm.hudongmiao 如果包含stage则是stage环境，否则是线上环境\r   线上环境--->stage环境:\r     全局搜索：hm.hudongmiao,替换为 hmstage.hudongmiao\r   stage环境--->线上环境\r     全局搜索: hmstage.hudongmiao,替换为 hm.hudongmiao\r   切换为本地环境\r     全局搜索: https://shm.hudongmiao.com,替换为 http://dev.joymew.com\r   ```\r   * 注意：全局搜索要排除README.md",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "miniprogram-computed": "^4.4.0"
  }
}
````

## File: packageB/api/photoWall.js
````javascript
import { request } from "../../utils/request";

/** 上传照片墙数据
 * @param {string} images 图片地址
 * @param {string} constant 祝福语
 * @param {string} splid 活动id
 */
export const reqUploadPhotoWall = (images, constant, splid) => {
  return request("pair/uploadPhoto", "POST", {
    images,
    constant,
    splid,
  });
};

/** 获取照片墙列表
 * @param {string} splid 活动id
 */
export const reqGetPhotoWallList = (splid) => {
  return request(`pair/photoList?splid=${splid}`, "GET", {});
};
````

## File: packageB/pages/photoWallIndex/photoWallIndex.js
````javascript
import {
  reqGetPhotoWallList
} from '../../api/photoWall'
import defaultContent from '../../../assets/constant/default'

Page({
  data: {
    photoWallList: [], // 照片墙数据
    // 当前展示的数据
    currentData: {
      user_id: '',
      user_name: '',
      user_avator: '',
      type: '', // 1为男方；2为女方
      bless: '',
      date: '',
      time: '',
      photos: []
    },
    defaultDialogData: {
      user_id: '',
      user_name: '',
      user_avator: '',
      type: '',
      bless: '',
      date: '',
      time: '',
      photos: []
    },
    currentPhotoIndex: 1, // 当前详情展示的照片
    isShowDetail: false, // 是否显示详情弹窗
  },
  onLoad() {
    this.getDataList();
    wx.removeStorageSync('isNeedFreshList');
  },
  onShow() {
    const isNeedFresh = wx.getStorageSync('isNeedFreshList');
    if (isNeedFresh) {
      console.log('刷新了');
      this.getDataList();
      wx.removeStorageSync('isNeedFreshList');
    }
  },
  /** 跳转至上传照片墙页 */
  turnToUpload() {
    wx.navigateTo({
      url: '/packageB/pages/photoWallUpload/photoWallUpload',
    })
  },
  /** 获取照片墙数据 */
  async getDataList() {
    const liveId = wx.getStorageSync('liveId');
    const res = await reqGetPhotoWallList(liveId);
    console.log('照片墙数据：', res);
    if (res && res.data && res.data.list) {
      const list = res.data.list;
      let target = list.map(item => {
        const targetObj = JSON.parse(item);
        const {
          images,
          avator,
          constant,
          wxName,
          userId,
          dateTime,
          type
        } = targetObj;
        return {
          user_id: userId || '',
          user_avator: avator || defaultContent.defaultJoymewAvatar,
          user_name: wxName || '',
          bless: constant || '',
          type: type || '',
          photos: images ? images.split(',').filter(item => item !== '') : [],
          date: dateTime ? String(dateTime).split(' ')[0] : '',
          time: dateTime ? String(dateTime).split(' ')[1] : '',
        }
      })
      target = target.filter(item => item.photos.length > 0)
      this.setData({
        'photoWallList': target
      })
    }
  },
  /** 展示详情 */
  showDetail(e) {
    const index = e.currentTarget.dataset.index;
    const targetItem = this.data.photoWallList[index];
    this.setData({
      'currentData': targetItem,
      'isShowDetail': true
    })
  },
  /** 关闭弹窗 */
  closeDialog() {
    this.setData({
      'isShowDetail': false,
      'currentData': this.data.defaultDialogData
    })
  },
  /** 弹窗轮播图变化回调 */
  changeSwiper(e) {
    const index = e.detail.current;
    this.setData({
      'currentPhotoIndex': index + 1
    })
  }
})
````

## File: packageB/pages/photoWallIndex/photoWallIndex.json
````json
{
  "usingComponents": {},
  "navigationBarTitleText": "幸福瞬间"
}
````

## File: packageB/pages/photoWallIndex/photoWallIndex.wxml
````
<view class="page-container">
  <!-- 顶部海报 -->
  <image src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/banner-img.png" mode="widthFix" class="banner-img" />
  <view class="main-container">
    <!-- 内容区背景 -->
    <image src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/page-bg.png" mode="widthFix" class="container-bg" />
    <view class="main-content">
      <view class="photo-container">
        <view class="photo-item" wx:for="{{photoWallList}}" wx:key="user_id" data-index="{{index}}" bind:tap="showDetail">
          <image src="{{item.photos[0]}}" mode="aspectFill" class="item-img" />
          <view class="other-info">
            <view class="item-bless">{{item.bless}}</view>
            <view class="uploader">
              <image src="{{item.user_avator}}" mode="aspectFill" class="user-avator" />
              <view class="user-name">{{item.user_name || '嗨喵用户'}}</view>
              <view class="upload-time">
                <view class="date">{{item.date}}</view>
                <view class="time">{{item.time}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- 上传按钮 -->
  <image class="upload-btn" src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/upload-icon.png" mode="aspectFill" bind:tap="turnToUpload"></image>
  <!-- 详情弹窗 -->
  <view class="detail-dialog" wx:if="{{isShowDetail}}" catch:touchmove>
    <view class="detail-header">{{currentPhotoIndex + '/' + currentData.photos.length}}</view>
    <image bind:tap="closeDialog" src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/delete-icon.png" mode="aspectFill" class="close-icon"/>
    <view class="user-info">
      <image src="{{currentData.user_avator}}" mode="aspectFill" class="user-avator" />
      <view class="user-name">{{currentData.user_name || '嗨喵用户'}}</view>
      <view class="{{currentData.type === '1' ? 'user-relationship male' : 'user-relationship female'}}" wx:if="{{currentData.type}}">{{ currentData.type === '1' ? '男方亲友' : '女方亲友' }}</view>
    </view>
    <swiper style="width: 100%; height: 500px;" current="{{currentPhotoIndex - 1}}" bindchange="changeSwiper" circular>
      <swiper-item wx:for="{{currentData.photos}}" wx:key="item" class="swiper-img-item">
        <image src="{{item}}" mode="aspectFit" class="swiper-img"/>
      </swiper-item>
    </swiper>
    <view class="bless" wx:if="{{currentData.bless}}">{{currentData.bless}}</view>
  </view>
</view>
````

## File: packageB/pages/photoWallIndex/photoWallIndex.wxss
````
.page-container {
  width: 100vw;
  min-height: 100vh;
  height: 100%;
}
.page-container::before,
.page-container::after {
  content: '';
  display: table;
  clear: both;
}
.page-container .banner-img {
  width: 100%;
  height: 330.77rpx;
  position: fixed;
  z-index: -1;
}
.page-container .main-container {
  width: 100%;
  margin-top: 263.77rpx;
  padding: 38.46rpx 19.23rpx;
  padding-bottom: 0;
  box-sizing: border-box;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 1;
  overflow: hidden;
}
.page-container .main-container .container-bg {
  width: 100%;
  height: 100vh;
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
}
.page-container .main-container .main-content {
  width: 100%;
  height: 100vh;
  padding: 96.15rpx 0;
  box-sizing: border-box;
  overflow: hidden;
}
.page-container .main-container .main-content .photo-container {
  width: 100%;
  height: 100%;
  overflow-y: scroll;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
}
.page-container .main-container .main-content .photo-container .photo-item {
  width: 49%;
  margin-top: 19.23rpx;
  border-radius: 11.54rpx;
  background-color: #fff;
  overflow: hidden;
}
.page-container .main-container .main-content .photo-container .photo-item .item-img {
  width: 100%;
  height: 444.23rpx;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info {
  padding: 15.38rpx;
  padding-bottom: 23.08rpx;
  box-sizing: border-box;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .item-bless {
  width: 100%;
  margin-bottom: 15.38rpx;
  color: #333;
  line-height: 34.62rpx;
  font-size: 26.92rpx;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader .user-avator {
  width: 36.54rpx;
  height: 36.54rpx;
  flex-shrink: 0;
  margin-right: 11.54rpx;
  border-radius: 50%;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader .user-name {
  flex: 1;
  margin-right: 9.62rpx;
  color: rgba(0, 0, 0, 0.4);
  font-size: 23.08rpx;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader .upload-time {
  width: fit-content;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  color: rgba(0, 0, 0, 0.4);
}
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader .upload-time .date,
.page-container .main-container .main-content .photo-container .photo-item .other-info .uploader .upload-time .time {
  font-size: 19.23rpx;
}
.page-container .main-container .main-content .photo-container .photo-item:nth-of-type( -n + 2) {
  margin-top: 0;
}
.page-container .upload-btn {
  width: 192.31rpx;
  height: 190.38rpx;
  position: fixed;
  bottom: 100rpx;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}
.page-container .detail-dialog {
  width: 100vw;
  min-height: 100vh;
  height: 100%;
  padding: 23.08rpx 32.69rpx;
  box-sizing: border-box;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  flex-direction: column;
  align-items: center;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 4;
  color: #fff;
}
.page-container .detail-dialog .detail-header {
  margin-bottom: 9.62rpx;
  font-size: 40.38rpx;
}
.page-container .detail-dialog .close-icon {
  width: 40.38rpx;
  height: 40.38rpx;
  position: absolute;
  top: 32.69rpx;
  right: 32.69rpx;
}
.page-container .detail-dialog .user-info {
  width: 100%;
  margin-bottom: 32.69rpx;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.page-container .detail-dialog .user-info .user-avator {
  width: 80.77rpx;
  height: 80.77rpx;
  flex-shrink: 0;
  margin-right: 23.08rpx;
  border-radius: 50%;
}
.page-container .detail-dialog .user-info .user-name {
  margin-right: 15.38rpx;
  font-size: 40.38rpx;
}
.page-container .detail-dialog .user-info .user-relationship {
  width: fit-content;
  flex-shrink: 0;
  padding: 7.69rpx 23.08rpx;
  box-sizing: border-box;
  border-radius: 42.31rpx;
  font-size: 25rpx;
}
.page-container .detail-dialog .user-info .male {
  background-image: linear-gradient(to right, #565EF5, #31A3FD);
}
.page-container .detail-dialog .user-info .female {
  background-image: linear-gradient(to right, #F55670, #FD31F7);
}
.swiper-img-item {
  width: 100%;
  height: 100%;
  display: flex;
  border-radius: 7.69rpx;
  background-color: rgba(0, 0, 0, 0.6);
  overflow: hidden;
  align-content: center;
  justify-content: center;
}
.page-container .detail-dialog .swiper-img {
  width: 100%;
  height: 100%;
  border-radius: 7.69rpx;
  overflow: hidden;
}
.page-container .detail-dialog .bless {
  margin-top: 32.69rpx;
  width: 100%;
  font-size: 40.38rpx;
  text-align: left;
  overflow: hidden;
  word-wrap: break-word;
}
````

## File: packageB/pages/photoWallUpload/photoWallUpload.js
````javascript
import constant from '../../../assets/constant/default';
import qiniu from '../../../utils/qiniu/index';
import { reqUploadPhotoWall } from '../../api/photoWall';

Page({
  data: {
    userInfo: {
      avatarUrl: '',
      nickName: ''
    },
    uploadForm: {
      bless: '',
      photos: [],
    },
    defaultAvatar: constant.defaultJoymewAvatar,
  },
  onLoad() {
    const avatarUrl = wx.getStorageSync('avatarUrl');
    const nickname = wx.getStorageSync('nickName');

    this.setData({
      'userInfo.avatarUrl': avatarUrl,
      'userInfo.nickName': nickname,
    })
    // 初始化七牛云
    this.initQiniuInfo();
  },
  initQiniuInfo: function () {
    qiniu
      .getQiniuToken()
      .then((res) => {
        console.log(res.data.token);
        qiniu.initQiniu(res.data.token);
      })
      .catch((err) => {
        console.log(err);
      });
  },
  /** 修改祝福语 */
  changeBless(e) {
    const target = e.detail.value;
    this.setData({
      'uploadForm.bless': target
    })
  },
  /** 选择图片 */
  choosePhoto() {
    wx.chooseMedia({
      count: 3 - this.data.uploadForm.photos.length,
      mediaType: ['image'],
      sourceType: ['album'],
      sizeType: ['compressed'],
      success: (res) => {
        console.log('选择的图片', res);
        const imgs = res.tempFiles.map(item => item.tempFilePath);
        this.setData({
          'uploadForm.photos': [...this.data.uploadForm.photos, ...imgs]
        })
      },
      fail: (err) => {
        console.log('错误信息', err);
      },
    })
  },
  /** 删除选中的图片 */
  removeChoosedImg(e) {
    const index = e.currentTarget.dataset.index;
    const copy = this.data.uploadForm.photos;
    copy.splice(index, 1)
    this.setData({
      'uploadForm.photos': copy
    })
  },
  /** 提交 */
  async confirmHandler() {
    if (!this.data.uploadForm.bless) {
      wx.showToast({
        icon: 'none',
        title: '请输入你的祝福',
      });
      return;
    }
    if (!this.data.uploadForm.photos.length) {
      wx.showToast({
        icon: 'none',
        title: '请上传照片',
      });
      return;
    }
    // 上传图片
    const uploadRes = await qiniu.qiniuUploadFiles(this.data.uploadForm.photos);
    const imgUrls = uploadRes.map(item => item.imageURL);
    this.setData({
      'uploadForm.photos': imgUrls
    })
    // 上传数据
    const splid = wx.getStorageSync('liveId');
    const uploadDataRes = await reqUploadPhotoWall(this.data.uploadForm.photos.join(','), this.data.uploadForm.bless, splid);
    console.log('上传结果', uploadDataRes);
    if (uploadDataRes && uploadDataRes.msg && String(uploadDataRes.msg) === 'ok') {
      wx.showToast({
        icon: 'none',
        title: '上传成功，请等待审核，审核后自动发布',
        success: () => {
          wx.setStorageSync('isNeedFreshList', true);
          setTimeout(() => {
            wx.navigateBack();
          }, 1500)
        }
      })
    } else {
      wx.showToast({
        icon: 'none',
        title: '网络错误',
      });
      return;
    }
  }
})
````

## File: packageB/pages/photoWallUpload/photoWallUpload.json
````json
{
  "usingComponents": {},
  "navigationBarTitleText": "幸福上传"
}
````

## File: packageB/pages/photoWallUpload/photoWallUpload.wxml
````
<view class="upload-page">
  <!-- 用户信息 -->
  <view class="user-info-part">
    <image src="{{userInfo.avatarUrl || defaultAvatar}}" mode="aspectFill" class="user-avatar"/>
    <view class="user-name">{{ userInfo.nickName || '嗨喵用户' }}</view>
  </view>
  <!-- 标语 -->
  <view class="slogn">记录现场的幸福瞬间</view>
  <!-- 输入框 -->
  <view class="input-part">
    <textarea value="{{uploadForm.bless}}" bindinput="changeBless" class="bless-input" placeholder="写下你对此刻的祝福~" maxlength="50"/>
    <view class="len">{{ uploadForm.bless.length + ' / 50' }}</view>
  </view>
  <!-- 上传照片 -->
  <view class="upload-photo">
    <view class="upload-btn" bindtap="choosePhoto" wx:if="{{uploadForm.photos.length < 3}}">
      <image src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/camera-icon.png" mode="aspectFill" class="camera-icon"/>
      <text class="sub-txt">（最多3张）</text>
    </view>
    <view class="photo" wx:for="{{uploadForm.photos}}" wx:key="item">
      <image src="{{item}}" mode="aspectFill" class="photo-img"/>
      <image data-index="{{index}}" src="https://ustatic.hudongmiao.com/joymewMp/photoWallNew/delete-icon.png" mode="aspectFill" class="delete-icon" bindtap="removeChoosedImg"/>
    </view>
  </view>
  <!-- 提示 -->
  <view class="tip">Ps：幸福瞬间照片不会在大屏幕上出现哦！</view>
  <!-- 提交按钮 -->
  <view class="confirm-btn" bind:tap="confirmHandler">提交</view>
    <!-- 隐私授权弹窗 -->
    <privacyAuthorize></privacyAuthorize>
</view>
````

## File: packageB/pages/photoWallUpload/photoWallUpload.wxss
````
.upload-page {
  width: 100vw;
  min-height: 100vh;
  height: 100%;
  padding: 32.69rpx;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.upload-page .user-info-part {
  width: 100%;
  margin-bottom: 19.23rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}
.upload-page .user-info-part .user-avatar {
  width: 80.77rpx;
  height: 80.77rpx;
  margin-right: 23.08rpx;
  border-radius: 50%;
}
.upload-page .user-info-part .user-name {
  flex: 1;
  overflow: hidden;
  font-size: 40.38rpx;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.upload-page .slogn {
  width: 100%;
  height: 65.38rpx;
  margin-bottom: 32.69rpx;
  background-image: linear-gradient(to left, rgba(250, 69, 252, 0.1), rgba(252, 77, 136, 0.1));
  border-radius: 7.69rpx;
  text-align: center;
  line-height: 65.38rpx;
  color: #FA45FC;
  font-size: 23.08rpx;
}
.upload-page .input-part {
  width: 100%;
  height: 192.31rpx;
  margin-bottom: 65.38rpx;
  box-sizing: border-box;
  border-bottom: 1.92rpx solid #EFEFEF;
  position: relative;
}
.upload-page .input-part .bless-input {
  width: 100%;
  height: 100%;
}
.upload-page .input-part .len {
  color: rgba(0, 0, 0, 0.4);
  font-size: 23.08rpx;
  position: absolute;
  bottom: 17.31rpx;
  right: 0;
}
.upload-page .upload-photo {
  width: 100%;
  margin-bottom: 32.69rpx;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.upload-page .upload-photo .upload-btn {
  width: 163.46rpx;
  height: 163.46rpx;
  margin-right: 32.69rpx;
  border: 1.92rpx dashed #7E7E7E;
  box-sizing: border-box;
  border-radius: 11.54rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.upload-page .upload-photo .upload-btn .camera-icon {
  width: 44.23rpx;
  height: 38.46rpx;
  margin-bottom: 11.54rpx;
}
.upload-page .upload-photo .upload-btn .sub-txt {
  color: rgba(0, 0, 0, 0.4);
  font-size: 23.08rpx;
}
.upload-page .upload-photo .photo {
  width: 163.46rpx;
  height: 163.46rpx;
  margin-right: 32.69rpx;
  border-radius: 11.54rpx;
  position: relative;
}
.upload-page .upload-photo .photo .photo-img {
  width: 100%;
  height: 100%;
  border-radius: 11.54rpx;
}
.upload-page .upload-photo .photo .delete-icon {
  width: 40.38rpx;
  height: 40.38rpx;
  position: absolute;
  right: 0;
  top: 0;
  transform: translate(50%, -50%);
}
.upload-page .upload-photo .photo:last-of-type {
  margin-right: 0;
}
.upload-page .tip {
  margin-bottom: 192.31rpx;
  color: #FA45FC;
  font-size: 23.08rpx;
}
.upload-page .confirm-btn {
  width: 100%;
  height: 92.31rpx;
  border-radius: 11.54rpx;
  background-image: linear-gradient(90deg, #fc4d88, #fa45fc 100%);
  color: #fff;
  line-height: 92.31rpx;
  font-size: 32.69rpx;
  font-weight: 500;
  text-align: center;
}
````

## File: pages/ad/ad.js
````javascript
import {
  timeoutTask,
  showWxToast,
} from '../../utils/index';
import { getGiftList } from '../../api/index/index';
const { Parser, Player } = require('../../libs/svgaplayer.weapp');

// 非响应式数据
let adLoaded = false; // 广告是否已经加载完成
let hasWatchedAd = false; // 是否已经观看过广告
let videoAd = null; // 广告实例
let player = null; // svga动画播放器对象
let parser = null; // svga动画解析器对象
let svgaUrl = ''; // svga动画地址
let svgaTimeout = null; // svga动画播放超时定时器

Page({
  data: {
    tabs: [], // 标签列表
    allGiftList: [], // 所有礼物列表
    currentGiftListId: 0, // 当前礼物列表id
    giftSvgaShow: false, // 礼物动画是否显示
  },
  onLoad: function (options) {
    this.initGiftList();
    hasWatchedAd = false;
  },
  // XXX 微信开发者工具中会提示[Perf][pages/ad/ad] Page.onShow took 69ms，
  // 根据微信官方说明（https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips/start_optimizeB.html），需要在启动过程中尽量减少同步 API 的调用
  // 但创建广告实例就是需要在启动过程中进行的，所以暂时无法解决该提示
  onShow: function () {
    this.createAd();
  },
  // 页面卸载时
  onUnload: function () {
    // 销毁广告实例
    if (videoAd) {
      videoAd.destroy();
    }
    // 还原数据
    adLoaded = false;
    hasWatchedAd = false;
    videoAd = null;
    player = null;
    parser = null;
    svgaUrl = '';
    this.setData({
      tabs: [],
      allGiftList: [],
      currentGiftListId: 0,
      giftSvgaShow: false,
    });
  },
  // 初始化礼物列表
  initGiftList() {
    getGiftList().then((res) => {
      const { data } = res;
      console.dir(data);
      // 根据title设置tabs
      const tmpTabs = Object.keys(data.title).map((key, index) => {
        return {
          tag: key,
          name: data.title[key],
          id: index,
        };
      });
      // 根据temTabs中的tag获取对应的礼物列表
      const temAllGiftList = tmpTabs.map((tab) => {
        // list666的giftname和coupontype的对应关系
        const giftNameToCouponType = {
          '凤凰': 'https://static.hudongmiao.com/joymewH5/animation/enterPhoenix.svga',
          '神龙': 'https://static.hudongmiao.com/joymewH5/animation/enterDragon.svga',
          '崇明鸟': 'https://static.hudongmiao.com/joymewH5/animation/enterBirdNew.svga',
          '白羊': 'https://static.hudongmiao.com/joymewH5/animation/enterGoat.svga',
        };
        let temList = data.data[tab.tag];
        // 如果tab.tag为list666，则给其列表中的每个礼物添加coupontype属性
        if (tab.tag === 'list666') {
          temList = temList.map((item) => {
            return {
              ...item,
              coupontype: giftNameToCouponType[item.giftname],
            };
          });
        }

        return temList;
      });
      this.setData({
        tabs: tmpTabs,
        allGiftList: temAllGiftList,
      });
    });
  },
  // 点击tab切换礼物列表
  changeGiftList(e) {
    const { id } = e.currentTarget.dataset;
    this.setData({
      currentGiftListId: id,
    });
  },
  // 点击礼物图标
  giftTapHandle(e) {
    // 设置svga动画地址
    svgaUrl = e.currentTarget.dataset.svgaUrl;
    // 如果还没有观看过广告则弹出观看广告弹窗
    if (!hasWatchedAd) {
      this.openWatchAdTip();
      return;
    }
    // 如果已经观看过广告则直接播放礼物动画
    this.playGiftAnimation();
  },
  // 打开观看广告弹窗
  openWatchAdTip() {
    wx.showModal({
      title: '提示',
      content: '是否观看广告\r\n预览礼物特效？',
      cancelText: '不观看',
      cancelColor: '#ccc',
      confirmText: '观看',
      confirmColor: '#3CC51F',
      success: (res) => {
        // 选择观看则播放广告
        if (res.confirm) {
          this.playAd();
        }
      }
    });
  },
  // 创建广告实例
  createAd() {
    if (videoAd) {
      return;
    }
    if (!wx.createRewardedVideoAd) {
      showWxToast('广告视频加载失败!');
      console.log('!wx.createRewardedVideoAd');
      timeoutTask(() => {
        wx.navigateBack();
      }, 2000);
      return;
    }

    videoAd = wx.createRewardedVideoAd({
      adUnitId: 'adunit-f37a436ebe4d767d',
    });
    // videoAd加载成功的回调
    videoAd.onLoad(() => {
      adLoaded = true;
    });
    // videoAd加载失败的回调
    videoAd.onError((err) => {
      console.log('load fail', err);
    });
    // videoAd关闭的回调
    videoAd.onClose((res) => {
      console.log('onClose', res);
      // 如果看完了广告则播放礼物动画
      if (res && res.isEnded) {
        this.playGiftAnimation();
        hasWatchedAd = true;
      }
      adLoaded = false;
    });
    // 进行广告加载
    videoAd.load()
      .catch(err => {
        console.log('videoAd.load err', err);
      });
  },
  // 播放广告
  playAd() {
    if (videoAd && adLoaded) {
      videoAd.show()
        .catch(err => {
          console.log('videoAd.show err', err);
        });
    }
  },
  // 播放svga动画
  async playGiftAnimation() {
    // 将giftSvgaShow设置为true
    this.setData({
      giftSvgaShow: true
    });
    clearTimeout(svgaTimeout);

    try {
      player = new Player();
      parser = new Parser();

      player.loops = 1; // 动画只播放一次
      // 播放完成后隐藏礼物动画
      player.onFinished(() => {
        timeoutTask(() => {
          this.hiddenAnimation();
        }, 500);
      });
      // 15秒后隐藏礼物动画，防止用户网络不好，parser.load()一直没有成功
      svgaTimeout = setTimeout(() => {
        if (this.data.giftSvgaShow) {
          showWxToast('礼物特效加载失败!');
          this.hiddenAnimation();
        }
      }, 15000);

      await player.setCanvas('#giftSvga');
      const videoItem = await parser.load(svgaUrl);
      await player.setVideoItem(videoItem);
      player.startAnimation();
    } catch (error) {
      console.log('error', error);
      showWxToast('礼物特效加载失败!');
      this.hiddenAnimation(); // 捕获到错误后隐藏礼物动画
    }
  },
  // 隐藏礼物动画
  hiddenAnimation() {
    this.setData({
      giftSvgaShow: false
    });
  }
});
````

## File: pages/ad/ad.json
````json
{
    "navigationBarTitleText": "看广告得奖励"
}
````

## File: pages/ad/ad.less
````
.ad-container {
  width: 100%;
  height: 100%;
  min-height: 100vh; // 防止礼物列表填充不够一页时底部出现白色
  background-color: #010a17;

  // 送礼动画容器
  .gift-svga-container {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);

    .gift-svga {
      width: 100%;
      height: 100%;

      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  }

  // 送礼菜单
  .send-gift {
    width: 100%;

    // 顶部标签栏
    .tab-bar {
      // 位置固定在顶部，不随页面滚动
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
      background-color: #010a17;

      width: 100%;
      height: 15.641vw;

      display: flex;
      justify-content: space-around;
      align-items: center;
      .tab {
        width: 17.9487vw;
        height: 80%;

        font-size: 20px;
        line-height: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        color: #696969;

        &.activated {
          color: #fff;
          border-bottom: 1px solid #fff;
        }
        .tab-name {
          margin-bottom: 15px;
        }
      }
    }

    // 礼物列表
    .gift-list {
      margin-top: 15vw;

      width: 100%;
      height: calc(100% - 15.641vw);
      overflow: scroll;
      &::-webkit-scrollbar {
        display: none;
      }

      padding: 8px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-column-gap: 14px;
      grid-row-gap: 10px;

      .gift-item {
        height: 34.6154vw;

        display: flex;
        flex-direction: column;
        align-items: center;

        .gift-item-img {
          width: 21.2821vw;
        }

        .gift-item-name {
          width: 100%;
          height: 7.4359vw;
          color: #fff;
          font-size: 5.1282vw;
          line-height: 7.4359vw;
          text-align: center;
        }

        .gift-item-price {
          width: 100%;
          height: 7.9487vw;
          font-size: 20px;
          line-height: 7.9487vw;
          text-align: center;
          color: #fff;

          display: flex;
          justify-content: center;
          align-items: center;
          // 钻石图标
          .diamond {
            width: 26px;
            height: 23px;
            margin-right: 4px;
          }
        }
      }
    }
  }
}
````

## File: pages/ad/ad.wxml
````
<view class="ad-container">
  <!-- 礼物动画 -->
  <div class="gift-svga-container" wx:if="{{giftSvgaShow}}">
    <canvas id="giftSvga" class="gift-svga" wx-show type="2d"></canvas>
  </div>
  <!-- 送礼页面 -->
  <view class="send-gift">
    <!-- 标签栏 -->
    <view class="tab-bar">
      <view class="tab {{tab.id === currentGiftListId ? 'activated':''}}" wx:for="{{tabs}}" wx:for-item="tab"
        wx:key="id" data-id="{{tab.id}}" bind:tap="changeGiftList">
        <text class="tab-name" value="">
          {{tab.name}}
        </text>
      </view>
    </view>
    <!-- 礼物列表 -->
    <view class="gift-list">
      <view class="gift-item" wx:for="{{allGiftList[currentGiftListId]}}" wx:for-item="giftItem" wx:for-index="index"
        wx:key="index" data-svga-url="{{giftItem.coupontype}}" bind:tap="giftTapHandle">
        <image class="gift-item-img" src="{{ giftItem.imglink }}" mode="aspectFit" lazy-load="false" />
        <text class="gift-item-name">{{giftItem.giftname}}</text>
        <view class="gift-item-price">
          <!-- 钻石图标 -->
          <image class="diamond" src="/assets/image/ad/diamond.png" mode="aspectFit" lazy-load="false" />
          <span class="price">0.0</span>
        </view>
      </view>
    </view>
  </view>
</view>
````

## File: pages/ad/ad.wxss
````
.ad-container {
  width: 100%;
  height: 100%;
  min-height: 100vh;
  background-color: #010a17;
}
.ad-container .gift-svga-container {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}
.ad-container .gift-svga-container .gift-svga {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.ad-container .send-gift {
  width: 100%;
}
.ad-container .send-gift .tab-bar {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1;
  background-color: #010a17;
  width: 100%;
  height: 15.641vw;
  display: flex;
  justify-content: space-around;
  align-items: center;
}
.ad-container .send-gift .tab-bar .tab {
  width: 17.9487vw;
  height: 80%;
  font-size: 20px;
  line-height: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  color: #696969;
}
.ad-container .send-gift .tab-bar .tab.activated {
  color: #fff;
  border-bottom: 1px solid #fff;
}
.ad-container .send-gift .tab-bar .tab .tab-name {
  margin-bottom: 15px;
}
.ad-container .send-gift .gift-list {
  margin-top: 15vw;
  width: 100%;
  height: calc(100% - 15.641vw);
  overflow: scroll;
  padding: 8px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-column-gap: 14px;
  grid-row-gap: 10px;
}
.ad-container .send-gift .gift-list::-webkit-scrollbar {
  display: none;
}
.ad-container .send-gift .gift-list .gift-item {
  height: 34.6154vw;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.ad-container .send-gift .gift-list .gift-item .gift-item-img {
  width: 21.2821vw;
}
.ad-container .send-gift .gift-list .gift-item .gift-item-name {
  width: 100%;
  height: 7.4359vw;
  color: #fff;
  font-size: 5.1282vw;
  line-height: 7.4359vw;
  text-align: center;
}
.ad-container .send-gift .gift-list .gift-item .gift-item-price {
  width: 100%;
  height: 7.9487vw;
  font-size: 20px;
  line-height: 7.9487vw;
  text-align: center;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
}
.ad-container .send-gift .gift-list .gift-item .gift-item-price .diamond {
  width: 26px;
  height: 23px;
  margin-right: 4px;
}
````

## File: pages/agreement/agreement.js
````javascript
import { PAGE_HOST } from "../../assets/constant/host";
import { getCurrentTimestamp } from "../../utils/date";

Page({
  data: {
    h5Url: "",
    revertBtnVisible: false,
    showModal: false,
  },
  onLoad: function (options) {
    if (options.outerUrl) {
      this.setData({
        h5Url: options.outerUrl,
      });
      // 需要显示撤销按钮
      if (options.needRevert) {
        console.log("需要显示撤销按钮");
        this.setData({
          revertBtnVisible: true,
        });
      }
      return;
    }
    this.setData({
      h5Url: `${PAGE_HOST}agreement/index.html?time=${getCurrentTimestamp()}`,
    });
  },
  onShow: function () {},
  onUnload: function () {},
  onRevokeTap() {
    this.setData({ showModal: true });
  },
  onCancel() {
    // 撤销：清缓存并退出小程序
    try {
      wx.clearStorageSync();
    } catch (e) {}
    if (wx.exitMiniProgram) {
      wx.exitMiniProgram();
    }
    // 关闭弹窗
    this.setData({ showModal: false });
  },
  onConfirm() {
    // 不撤销：仅关闭弹窗
    this.setData({ showModal: false });
  },
});
````

## File: pages/agreement/agreement.json
````json
{
    "navigationBarTitleText": "充值服务协议"
}
````

## File: pages/agreement/agreement.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}">
</web-view>

<!-- 底部红色按钮 -->
<cover-view class="bottom-btn-wrap" wx:if="{{revertBtnVisible}}">
  <cover-view class="bottom-btn" bindtap="onRevokeTap">撤销并退出登录</cover-view>
</cover-view>

<!-- 自定义弹窗 -->
<cover-view wx:if="{{showModal}}" class="modal-mask">
  <cover-view class="modal-box">
    <cover-view class="modal-title">温馨提示</cover-view>
    <cover-view class="modal-content">
      您需要同意《嗨喵隐私政策》，方可继续使用嗨喵小程序，如果撤销将直接退出登录。
    </cover-view>
    <cover-view class="modal-btns">
      <cover-view class="modal-btn" bindtap="onCancel">撤销</cover-view>
      <cover-view class="modal-btn confirm" bindtap="onConfirm">不撤销</cover-view>
    </cover-view>
  </cover-view>
</cover-view>
````

## File: pages/agreement/agreement.wxss
````
view {
    margin: 20rpx 0;
}

.bottom-btn-wrap {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  z-index: 100;
  display: flex;
  justify-content: center;
  background: transparent;
}
.bottom-btn {
  width: 90vw;
  margin: 20rpx 0;
  background: #f44;
  color: #fff;
  text-align: center;
  border-radius: 12rpx;
  padding: 24rpx 0;
  font-size: 32rpx;
}

.modal-mask {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.4);
  z-index: 999;
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-box {
  width: 80vw;
  background: #fff;
  border-radius: 16rpx;
  padding: 40rpx 0 0 0;
  text-align: center;
}
.modal-title {
  font-size: 36rpx;
  font-weight: bold;
  margin-bottom: 24rpx;
}
.modal-content {
  font-size: 28rpx;
  color: #333;
  margin: 0 40rpx 40rpx 40rpx;
}
.modal-btns {
  display: flex;
  border-top: 1px solid #eee;
}
.modal-btn {
  flex: 1;
  padding: 28rpx 0;
  font-size: 32rpx;
  color: #333;
  border-right: 1px solid #eee;
}
.modal-btn:last-child {
  border-right: none;
}
.modal-btn.confirm {
  color: #f44;
}
````

## File: pages/debug/debug.js
````javascript
Page({
  data: {
    debugInfo: [],
  },
  onLoad() {
    this.getDebugInfo();
  },
  getDebugInfo() {
    this.setData({
      debugInfo: JSON.parse(wx.getStorageSync('debugInfo') || '[]').reverse(),
    });
  },
  async clearDebugInfo() {
    wx.showModal({
      title: '提示',
      content: '确定要清空调试信息吗？',
      success: (res) => {
        if (res.confirm) {
          wx.setStorageSync('debugInfo', '[]');
          this.setData({
            debugInfo: [],
          });
        }
      },
    });
  },
});
````

## File: pages/debug/debug.json
````json
{
  "navigationBarTitleText": "",
  "usingComponents": {}
}
````

## File: pages/debug/debug.scss
````scss
page {
  padding: 10px;
  .title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .btn {
    margin-bottom: 10px;
    width: calc(100% - 20px);
  }

  .item {
    margin-bottom: 10px;

    width: calc(100% - 20px);

    background-color: #39c5bb;
    border-radius: 5px;
    color: #fff;

    padding: 10px;
    display: flex;
    flex-direction: column;
    row-gap: 5px;

    .item-time {
      grid-area: time;

      font-size: 12px;
      line-height: 16px;
    }

    .item-title {
      grid-area: title;
      font-size: 16px;
      font-weight: bold;
      line-height: 1;
    }

    .item-content {
      grid-area: content;
      font-size: 14px;
    }
  }
}
````

## File: pages/debug/debug.wxml
````
<view>
  <view class="title">调试信息</view>
  <button class="btn" bind:tap="clearDebugInfo">清空</button>
  <view
    wx:for="{{ debugInfo }}"
    wx:key="index"
    class="item"
    style="{{ item.style }}"
  >
    <view class="item-time">{{ item.time }}</view>
    <view class="item-title">{{ item.title }}</view>
    <view class="item-content">{{ item.content }}</view>
  </view>
</view>
````

## File: pages/estimate/components/danmu/danmu.js
````javascript
import { getRandom, timeoutTask } from '../../../../utils/index';
import defaultContent from '../../../../assets/constant/default';

const danmusLen = defaultContent.commentDanmu.length;
let timer = undefined;
let indexArr = [];
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    // focus: {
    //   type: Boolean
    // },
    // initContent: {
    //   type: String,
    // },
    // username: {
    //   type: String,
    // }
  },

  /**
   * 组件的初始数据
   */
  data: {
    danmu: {
      avator: '',
      comment: '',
      moveDistance: 0,
      type: -1,
    },
  },
  lifetimes: {
    attached() {
      console.log('*********danmu attached方法内部**********');
      timer = undefined;
      indexArr = [];
      this.loopShowDanmu();
    },
  },
  /**
   * 组件的方法列表
   */
  methods: {
    loopShowDanmu() {
      if (timer) {
        return;
      }
      this.sendDanmu();
      timer = setInterval(() => {
        console.log('*****循环发送弹幕****');
        this.sendDanmu();
      }, 9000);
    },
    // 发送弹幕
    sendDanmu() {
      const danmuIndex = this.generateDanmuIndex();
      this.setData({
        ['danmu.avator']: defaultContent.commentDanmu[danmuIndex].avator,
        ['danmu.comment']: defaultContent.commentDanmu[danmuIndex].comment,
        ['danmu.moveDistance']: 0,
        ['danmu.type']: getRandom(1, 4),
      });
      timeoutTask(() => {
        this.setData({
          ['danmu.moveDistance']: -(
            defaultContent.commentDanmu[danmuIndex].comment.length * 17 +
            400
          ),
        });
        // console.log(this.data.danmu);
      }, 500);
      timeoutTask(() => {
        this.setData({
          ['danmu.avator']: '',
          ['danmu.comment']: '',
          ['danmu.moveDistance']: 0,
          ['danmu.type']: -1,
        });
      }, 8500);
    },
    // 创建一个打乱顺序的索引数组
    generateIndexArr() {
      const tmpIndexArr = [];
      for (let i = 0; i < danmusLen; i += 1) {
        tmpIndexArr.push(i);
      }
      tmpIndexArr.sort((a, b) => {
        return Math.random() > 0.5 ? -1 : 1;
      });
      return tmpIndexArr;
    },
    // 弹幕索引
    generateDanmuIndex() {
      let tmpIndex = -1;
      if (indexArr.length > 0) {
        tmpIndex = indexArr.pop();
      } else {
        indexArr = this.generateIndexArr();
        tmpIndex = indexArr.pop();
      }
      return tmpIndex;
    },
    endLoop() {
      console.log('***结束弹幕循环!***');
      clearInterval(timer);
      timer = undefined;
    },
  },
});
````

## File: pages/estimate/components/danmu/danmu.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/components/danmu/danmu.wxml
````
<view class="danmuArea">
  <view class="danmu {{danmu.type === 1 ? 't1' : ''}} {{danmu.type === 2 ? 't2' : ''}} {{danmu.type === 3 ? 't3' : ''}}" style="transform:translateX({{danmu.moveDistance}}px)" wx:if="{{danmu.comment}}">
    <image class="avator" src="{{danmu.avator}}"></image>
    <view class="content">{{danmu.comment}}</view>
  </view>
</view>
````

## File: pages/estimate/components/danmu/danmu.wxss
````
.danmuArea {
  position: fixed;
  width: 100%;
  height: 208rpx;
  top: 32rpx;
}

.danmu {
  height: 48rpx;
  background: rgba(255, 56, 56, 0.30);
  border: 2rpx solid #fff0f0;
  border-radius: 50rpx;
  display: flex;
  align-items: center;
  padding: 4rpx 16rpx 4rpx 0;
  position: absolute;
  left: 750rpx;
  transition: all 8s linear;
  transform: translateX(0);
}
.danmu.t1 {
  top: 26rpx;
}
.danmu.t2 {
  top: 96rpx;
}
.danmu.t3 {
  top: 170rpx;
}
.avator {
  width: 44rpx;
  height: 44rpx;
  border-radius: 50%;
}
.content {
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  margin-left: 4rpx;
  white-space: nowrap;
}
````

## File: pages/estimate/components/etTabBar/etTabBar.js
````javascript
// 评分、酒店预定、酒店评价底部导航栏组件

const computedBehavior = require('miniprogram-computed').behavior;
// 默认图标
const defaultIcon = {
  // 酒店现场回顾图标
  reviewIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/rev-icon.png',
  // 激活的酒店现场回顾图标
  activeReviewIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/hotel-rev-icon.png',

  // 酒店评价图标
  estimateIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/estimate-icon.png',
  // 激活的酒店评价图标
  activeEstimateIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/hotel-estimate-icon.png',

  // 预定图标
  hotelReservationIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/host-icon.png',
  // 激活的酒店预定图标
  activeHotelReservationIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/hotel-host-icon.png',

  // 激活的主持预定图标
  activeHostReservationIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/host-active-icon.png',
  // 主持评分图标
  hostEstimateIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/com-icon.png',
  // 激活的主持评分图标
  activeHostEstimateIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/com-active-icon.png',
  // 激活的主持人现场回顾图标
  activeHostReviewIcon: 'https://ustatic.hudongmiao.com/joymew-mp/review/rev-active-icon.png',
};

// 三种不同类型的底部导航栏
const tabBarDataAll = {
  // 主持人
  host: [{
      name: '主持评分',
      iconUrl: defaultIcon.hostEstimateIcon,
      iconActiveUrl: defaultIcon.activeHostEstimateIcon,
      pageUrl: '/pages/estimate/estimate',
    },
    {
      name: '现场回顾',
      iconUrl: defaultIcon.reviewIcon,
      iconActiveUrl: defaultIcon.activeHostReviewIcon,
      pageUrl: '/pages/estimate/review/review',
    },
    {
      name: '主持预定',
      iconUrl: defaultIcon.hotelReservationIcon,
      iconActiveUrl: defaultIcon.activeHostReservationIcon,
      pageUrl: '/pages/estimate/host/host',
    }
  ],
  // 酒店
  hotel: [{
      name: '酒店评价',
      iconUrl: defaultIcon.hotelReservationIcon,
      iconActiveUrl: defaultIcon.activeHotelReservationIcon,
      pageUrl: '/pages/estimate/estimate',
    },
    {
      name: '现场回顾',
      iconUrl: defaultIcon.reviewIcon,
      iconActiveUrl: defaultIcon.activeReviewIcon,
      pageUrl: '/pages/estimate/review/review',
    },
    {
      name: '酒店预定',
      iconUrl: defaultIcon.hotelReservationIcon,
      iconActiveUrl: defaultIcon.activeHotelReservationIcon,
      pageUrl: '/pages/estimate/hotel/hotel',
    }
  ],
  // 云境酒店
  yunJingHotel: [{
      name: '现场回顾',
      iconUrl: defaultIcon.reviewIcon,
      iconActiveUrl: defaultIcon.activeReviewIcon,
      pageUrl: '/pages/estimate/review/review'
    },
    {
      name: '酒店预定',
      iconUrl: defaultIcon.hotelReservationIcon,
      iconActiveUrl: defaultIcon.activeHotelReservationIcon,
      pageUrl: '/pages/estimate/hotel/hotel'
    },
    {
      name: '米纱婚纱',
      iconUrl: defaultIcon.hotelReservationIcon,
      iconActiveUrl: defaultIcon.activeHotelReservationIcon,
      pageUrl: '/pages/estimate/hotel/hotel',
      pageQuery: { // 米纱婚纱是云境都有的页面 并且和酒店预定公用一个页面 需要区分
        hltHotelId: '11', // 米纱婚纱的门店id值
      }
    }
  ],
};

const app = getApp();

Component({
  behaviors: [computedBehavior], // 引入计算属性
  properties: {
    activeTab: Number, // 当前选中的tab
    splid: String,
    uid: String,
    // 底部导航栏类型，host主持人，hotel酒店，yunJingHotel云境酒店
    type: {
      type: String,
      value: 'host',
    },
  },
  data: {
    // tabBar和底边的距离
    bottomLift: 0,
  },
  computed: {
    // 底部导航栏数据
    tabBarData(data) {
      // XXX 默认返回主持人的底部导航栏数据，因为一开始type是空字符串的，访问对应的tabBarData会报警告
      // 如果后续官方进行了修复，可以去掉这个判断
      return tabBarDataAll[data.type] ? tabBarDataAll[data.type] : tabBarDataAll.host;
    },
  },
  // 组件实例进入页面节点树
  attached() {
    this.setData({
      bottomLift: app.globalData.bottomLift
    });
  },
  methods: {
    // 跳转到点击的tab对应的页面
    tabTapHandle(e) {
      const {
        index
      } = e.currentTarget.dataset;
      const {
        pageUrl,
        pageQuery
      } = this.data.tabBarData[index];
      const {
        activeTab,
        splid,
        uid,
        type,
      } = this.data;

      if (activeTab === index) return;

      const query = pageQuery ? `&${Object.keys(pageQuery).map(key => `${key}=${pageQuery[key]}`).join('&')}` : '';
      console.log(`${pageUrl}?splid=${splid}&uid=${uid}&type=${type}${query}`);
      wx.redirectTo({
        url: `${pageUrl}?splid=${splid}&uid=${uid}&type=${type}${query}`,
      });
    },
  },
});
````

## File: pages/estimate/components/etTabBar/etTabBar.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/components/etTabBar/etTabBar.wxml
````
<!-- 评价模块底部导航栏组件 -->
<cover-view
  class="es-footer {{type !== 'host' ? 'hotel-es-footer' : ''}}"
  style="padding-bottom: {{ bottomLift }}px;"
>
  <!-- 单个tab -->
  <cover-view
    wx:for="{{ tabBarData }}"
    wx:key="key"
    class="es-btn-wrap  {{ activeTab === index ? 'active' : '' }}"
    data-index="{{ index }}"
    bind:tap="tabTapHandle"
  >
    <!-- tab的图标 -->
    <cover-image
      class="com-icon icon"
      src="{{ activeTab === index ? item.iconActiveUrl : item.iconUrl }}"
    ></cover-image>
    <!-- tab的名称 -->
    <cover-view class="text">{{ item.name }}</cover-view>
  </cover-view>
</cover-view>
````

## File: pages/estimate/components/etTabBar/etTabBar.wxss
````
.es-footer{
  width: 750rpx;
  height: 98rpx;
  background: #ffffff;
  position: fixed;
  bottom:0;
  left: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
  box-sizing: content-box;

}

.es-footer-placeholder{
  width: 750rpx;
  height: 98rpx;
  box-sizing: content-box;
}
.es-footer .es-btn-wrap{
  width: 50%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 20rpx;
}

.es-footer .es-btn-wrap .icon{
  width: 48rpx;
  height: 48rpx;
  background-size: 100% 100%;
}

.es-footer.hotel-es-footer .es-btn-wrap.active {
  color: #298EFF;
}
.es-footer .es-btn-wrap.active {
  color: #FF2352;
}
````

## File: pages/estimate/components/hostEstimate/hostEstimate.js
````javascript
import { showWxToast } from '../../../../utils/index';

const FLAGNAMES = ['', '非常差', '差', '一般', '满意', '超赞']; // 所有的评分名称

Component({
  properties: {
    host: {
      type: Object
    }
  },
  data: {
    borderlist: new Array(26),
    danmuDom: null
  },
  observers: {
    host: function (newVal) {
      if(!newVal.sceneType) return;
      wx.nextTick(() => {
        this.setData({
          danmuDom: newVal.sceneType === '0' ? this.selectComponent('#danmuDom') : null
        });
      });
    },
  },
  attached() {
  },
  detached() {
    console.log('*********hostEstimate detached方法内部**********');
    if (!this.data.danmuDom) return;
    this.data.danmuDom.endLoop(); // 结束弹幕循环
  },
  methods: {
    showQrcode() {
      const { comment_json } = this.data.host;
      if (!comment_json) {
        return;
      }
      this.triggerEvent('dataupate', {
        qrcode: true
      });
    },
    hideQrcode() {
      this.triggerEvent('dataupate', {
        qrcode: false
      });
    },
    clickstar(e) {
      //获取当前点击的星星个数,因为index是从0开始所以需+1
      const rate = e.detail;
      this.triggerEvent('dataupate', {
        flag: rate,
        flagName: FLAGNAMES[rate]
      });
    },
    selectTag(e) {
      const { commented, tags } = this.data.host;
      if (commented) {
        return;
      }
      const i = e.currentTarget.dataset.index;
      tags[i].selected = !tags[i].selected;
      this.triggerEvent('dataupate', {
        tags
      });
    },
    inputText(e) {
      console.log(e);
      const { commented } = this.data.host;
      if (commented) {
        return;
      }
      this.triggerEvent('dataupate', {
        content: e.detail.value
      });
    },
    showDrawToast() {
      wx.showToast({
        title: 'title',
        title: '提交评价后可以参与抽奖',
      });
    },
    // 提交评价
    commitComment() {
      this.triggerEvent('commentCommit');
    },
    // 跳转抽奖页面
    showDraw() {
      wx.navigateTo({
        url: `/pages/estimate/draw/draw`,
      });
    },
    // 展示打赏弹窗
    showReward() {
      this.triggerEvent('dataupate', {
        step2: true
      });
    },
    // 隐藏打赏弹窗
    hideModal(e) {
      // 当前处于打赏第一步 关闭当前弹窗并显示第三步再次确认是否放弃打赏
      // 当前处于打赏第三步 直接跳转到抽奖页面
      // 当前处于打赏第二步 关闭当前弹窗
      const step = e.currentTarget.dataset.step;
      if (step === 'step1') {
        this.triggerEvent('dataupate', {
          step1: false,
          step3: true
        });
      } else if (step === 'step3') {
        this.showDraw();
      } else if (step === 'step2') {
        this.triggerEvent('dataupate', {
          step2: false
        });
      }
    },
    // 继续打赏
    showStep3() {
      this.triggerEvent('dataupate', {
        step1: false,
        step2: true,
        step3: false,
      });
    },
    // 关闭打赏弹窗第二步
    hideStep3() {
      this.triggerEvent('dataupate', {
        step2: false
      });
    },
    // 阻止冒泡
    prevent() {
      console.log('阻止冒泡');
    },
    // 选择打赏金额
    changeCharge(e) {
      const i = e.currentTarget.dataset.index;
      const list = this.data.host.charges;
      list.forEach((item, index) => {
        if (index === i) {
          item.selected = true;
        } else {
          item.selected = false;
        }
      });
      this.triggerEvent('dataupate', {
        charges: list,
        cusfocus: !!list[i].cus,
      });
    },
    // 打赏金额输入
    handleMoneyInput(e) {
      let tmpMoneyStr = e.detail.value;
      let r = /^\+?[1-9][0-9]*$/; //正整数
      let flag = r.test(tmpMoneyStr);
      if (flag || tmpMoneyStr === '0.01') {
        // 只能是正整数或者是0.01
        this.triggerEvent('dataupate', {
          moneyInput: tmpMoneyStr
        });
      } else {
        this.triggerEvent('dataupate', {  // 重置金额
          moneyInput: ''
        });
      }
    },
    // 打赏金额失去焦点
    handleMoneyBlur(e) {
      this.triggerEvent('dataupate', {
        cusfocus: false
      });
    },
    RewardIt() {
      let item = this.data.host.charges.find(i => {
        return i.selected;
      });
      if (!item) {
        showWxToast('请选择打赏金额');
        return;
      }

      if (item.cus && !this.data.host.moneyInput) {
        showWxToast('请输入自定义打赏金额');
        this.triggerEvent('dataupate', {
          cusfocus: true
        });
        return;
      } else if (item.cus && this.data.host.moneyInput) {
        this.pay(this.data.host.moneyInput);
      } else if (!item.cus) {
        this.pay(item.price);
      }
    },
    pay(choosedMoney) {
      this.triggerEvent('pay', choosedMoney);
    },
    hideInput() {
      this.triggerEvent('dataupate', {
        showReplyInput: false,
        focus: false,
      });
    },
    showInput() {
      this.triggerEvent('dataupate', {
        showReplyInput: true,
        focus: true,
      });
    },
    inputContent(e) {
      this.triggerEvent('dataupate', {
        newContent: e.detail
      })
    },
    sendContent() {
      this.triggerEvent('contentsend');
    }
  },
});
````

## File: pages/estimate/components/hostEstimate/hostEstimate.json
````json
{
  "component": true,
  "usingComponents": {
    "rateStar": "/components/rateStar/rateStar",
    "danmu": "../danmu/danmu",
    "replyInput": "../replyInput/replyInput"
  }
}
````

## File: pages/estimate/components/hostEstimate/hostEstimate.wxml
````
<!-- 主持人评价 -->
<view class="estimate" bindtap="hideInput">
  <view class="estimate-card">
    <view class="card-host">
      <view class="host-img" style="background-image: url({{host.hostHeadImg}})"></view>
      <view class="host-name">
        <view>{{host.hostName}}</view>
      </view>
      <view class="qrcodeAdd" bindtap="showQrcode" wx:if="{{host.comment_json}}">
        点击添加TA的微信
        <view class="qrcode"></view>
        <view class="more"></view>
      </view>
      <view class="satisfied-degree">
        <text>{{host.flagName}}</text>
        <view class="star-wrap">
          <rateStar rate="{{host.flag}}" bind:change="clickstar" edit="{{!host.commented}}" size="{{'bigger'}}"></rateStar>
        </view>
      </view>
    </view>
    <!-- 底部虚线 -->
    <view class="border-wrap">
      <view class="border" wx:for="{{borderlist}}" wx:key="index"></view>
    </view>
    <view class="card-tags" wx:if="{{!host.commented}}">
      <view class="tags-title">—— 请选择标签 ——</view>
      <view class="tags ">
        <view class="tag {{item.selected?'selected':''}}" wx:for="{{host.tags}}" wx:for-item="item" bindtap="selectTag" wx:for-index="index" wx:key="index" data-index="{{index}}">
          {{item.info}}
        </view>
      </view>
      <textarea placeholder="司仪小哥那么辛苦，鼓励一下吧，给主持人评价还可获得抽奖机会哦~" placeholder-class="textarea-p" class="textarea" value="{{content}}" bindinput="inputText" focus="{{commentFocus}}" />
    </view>
    <view class="card-tags" wx:if="{{host.commented}}">
      <view class="comment-item">
        <view class="my-c">
          <image src="{{host.myCommentInfo.avatar}}" class="my-avator"></image>
          <view class="nameAnddate">
            <view class="name">{{host.myCommentInfo.nickname}}</view>
            <view class="date">{{host.myCommentInfo.comment_time}}</view>
          </view>
        </view>
        <view class="content">{{host.myCommentInfo.content}}</view>
        <view class="sub-comment" wx:if="{{host.myCommentInfo.chat_list.length>0}}">
          <view class="sub-item" wx:for="{{host.myCommentInfo.chat_list}}" wx:key="index">
            <text class="sub-name">{{item.type==='5'?'我':item.nickname}}:</text>
            <text class="sub-content">{{item.content}}</text>
          </view>
        </view>
        <view class="reply-btn" catchtap="showInput">回复TA</view>
      </view>
    </view>
    <view class="btn-wrap" wx:if="{{!host.commented}}">
      <view class="submit disabled" bind:tap="showDrawToast">抽奖</view>
      <view class="submit half" bind:tap="commitComment">提交评价</view>
    </view>
    <view class="btn-wrap" wx:if="{{host.commented}}">
      <view class="submit" bind:tap="showDraw">抽奖</view>
      <view class="submit" bind:tap="showReward">打赏 </view>
    </view>
  </view>
  <view class="leave-wrap" wx:if="{{host.step3}}">
    <view class="leave-modal">
      <view class="emjoy"></view>
      <view class="leave">
        <view>司仪小哥哥这么辛苦</view>
        <view>确认要离开吗？</view>
      </view>
      <view class="btn-group">
        <view class="btn-leave" bindtap="hideModal" data-step='step3'>狠心离开</view>
        <view class="btn-encourage" bindtap="showStep3">继续鼓励</view>
      </view>
    </view>
  </view>
  <view class="feedback-wrap" wx:if="{{host.step1}}"> 
    <view class="feedback-modal">
      <view class="thanks">感谢您的评价！</view>
      <view class="tips">司仪小哥哥这么辛苦，打赏鼓励一下吗？</view>
      <view class="btn-group">
        <view class="btn-leave" bindtap="hideModal" data-step='step1'>取消</view>
        <view class="btn-encourage" bindtap="showStep3">鼓励他</view>
      </view>
    </view>
  </view>
  <view class="pay-wrap" wx:if="{{host.step2 && host.sceneType === '0'}}" bindtap="hideStep3">
    <view class="pay-modal  {{host.sceneType == '0'?'spe':''}}" catchtap="prevent">
      <view class="end-poem">
        <view class="p1">婚礼完美落幕</view>
        <view class="p2">我们始终相信，婚纱是属于每一个女人的童话</view>
        <view class="p3">
          资深主持人
          <view class="viewider"></view>
          已在婚礼一线奋战2012天
        </view>
      </view>
      <view class="charge-wrap">
        <block wx:for="{{host.charges}}" wx:for-item="item" wx:for-index="index" wx:key="index">
          <view wx:if="{{!item.cus}}" class="charge {{item.selected?'chargeSelected':''}}" catchtap="changeCharge" data-index="{{index}}">
            <view class="solid">打赏</view>
            <view class="money" wx:if="{{!item.cus}}">
              <view class="unit">￥</view>
              {{item.price}}
            </view>
          </view>
          <view wx:if="{{item.cus}}" class="charge {{item.selected?'chargeSelected':''}}" catchtap="changeCharge" data-index="{{index}}">
            <view class="money cusmoney {{cusfocus?'focusmoney':''}}">
              <block wx:if="{{moneyInput&&!cusfocus}}">
                <view style="display:flex">
                  <view class="unit">￥</view>
                  {{moneyInput}}
                </view>
              </block>
              <block wx:if="{{!moneyInput&&!cusfocus}}">
                <view>土豪</view>
                <view>自定义</view>
              </block>
              <block wx:if="{{cusfocus}}">
                <view class="unit">￥</view>
                <input class="cusprice" type="number" maxlength="4" value="{{moneyInput}}" bindinput="handleMoneyInput" bindblur="handleMoneyBlur" focus="{{cusfocus}}" />
              </block>
            </view>
          </view>
        </block>
      </view>
      <view class="director">司仪小哥哥这么辛苦，打赏鼓励一下吗？</view>
      <view class="charge-btn" catchtap="RewardIt">确认打赏</view>
    </view>
  </view>
  <view class="pay-wrap" wx:if="{{host.step2 && host.sceneType !== '0'}}" bindtap="hideStep3">
    <view class="pay-modal other " catchtap="prevent" >
      <view class="end-poem">
        <view class="p1">活动完美结束!</view>
      </view>
      <view class="charge-wrap">
        <block wx:for="{{host.charges}}" wx:for-item="item" wx:for-index="index" wx:key="index">
          <view wx:if="{{!item.cus}}" class="charge {{item.selected?'chargeSelected':''}}" catchtap="changeCharge" data-index="{{index}}">
            <view class="solid">打赏</view>
            <view class="money" wx:if="{{!item.cus}}">
              <view class="unit">￥</view>
              {{item.price}}
            </view>
          </view>
          <view wx:if="{{item.cus}}" class="charge {{item.selected?'chargeSelected':''}}" catchtap="changeCharge" data-index="{{index}}">
            <view class="money cusmoney {{cusfocus?'focusmoney':''}}">
              <block wx:if="{{moneyInput&&!cusfocus}}">
                <view style="display:flex">
                  <view class="unit">￥</view>
                  {{moneyInput}}
                </view>
              </block>
              <block wx:if="{{!moneyInput&&!cusfocus}}">
                <view>土豪</view>
                <view>自定义</view>
              </block>
              <block wx:if="{{cusfocus}}">
                <view class="unit">￥</view>
                <input class="cusprice" type="number" maxlength="4" value="{{moneyInput}}" bindinput="handleMoneyInput" bindblur="handleMoneyBlur" focus="{{cusfocus}}" />
              </block>
            </view>
          </view>
        </block>
      </view>
      <view class="director">司仪小哥哥这么辛苦，打赏鼓励一下吗？</view>
      <view class="charge-btn" catchtap="RewardIt">确认打赏</view>
    </view>
  </view>
  <view class="qrcode-wrap" wx:if="{{host.qrcode}}" catchtap="hideQrcode">
    <view class="qrcode-modal">
      <image src="{{host.comment_json}}" class="qrcode-cus" show-menu-by-longpress='true'></image>
      <view class="save">如有主持需求，请长按二维码添加主持人微信。</view>
    </view>
    <view class="qrcode-close"></view>
  </view>
   <danmu id="danmuDom" wx:if="{{host.sceneType === '0'}}" />
   <replyInput wx:if="{{host.showReplyInput}}" focus="{{host.focus}}" initContent="{{host.newContent}}" bind:input="inputContent" bind:send="sendContent" username="{{host.hostName}}" />
</view>
````

## File: pages/estimate/components/hostEstimate/hostEstimate.wxss
````
.estimate {
  width: 100vw;
  min-height: 100vh;
  background-color: #edeeee;
  padding-top: 32rpx;
  overflow: hidden;
  padding-bottom: 140rpx;
}

.estimate-card {
  width: 682rpx;
  background-color: #fff;
  min-height: 80vh;
  padding-bottom: 40rpx;
  margin: 0 auto;
  border-radius: 12rpx;
}

.card-host {
  padding-top: 30rpx;
  padding-bottom: 30rpx;
  width: 100%;
  height: 35%;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.host-img {
  width: 148rpx;
  height: 148rpx;
  background-position: center;
  background-size: 100% 100%;
  border-radius: 50%;
}

.host-name {
  font-size: 36rpx;
  margin-top: 20rpx;
  color: #333333;
  font-weight: 400;
  display: flex;
  justify-content: center;
  align-items: center;
}

.qrcodeAdd {
  display: flex;
  align-items: center;
  font-size: 24rpx;
  color: #999999;
  margin-top: 16rpx;
}

.qrcode {
  width: 40rpx;
  height: 40rpx;
  margin-left: 12rpx;
  background-size: 100% 100%;
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/estimate/comment-qrcode.png');
  animation: swing 1s linear infinite;
}

.more {
  width: 10rpx;
  height: 18rpx;
  margin-left: 8rpx;
  background-size: 100% 100%;
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/estimate/comment-more.png');
}

.satisfied-degree {
  margin-top: 48rpx;
  color: #ff8d19;
  font-size: 24rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.star-wrap {
  margin-left: 20rpx;
}

.border-wrap {
  margin: 0 auto;
  width: 616rpx;
  height: 2rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
}

.border {
  width: 18rpx;
  flex-grow: 0;
  height: 2rpx;
  background: #dddddd;
}

.card-tags {
  width: 100%;
  height: 65%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 40rpx;
  flex-direction: column;
}

.tags-title {
  margin: 0 auto;
  font-size: 24rpx;
  font-weight: 400;
  color: #383838;
  display: flex;
  justify-content: center;
  align-items: center;
}

.tags {
  display: flex;
  justify-content: space-around;
  align-items: center;
  flex-wrap: wrap;
  padding: 20rpx 30rpx;
}

.tag {
  margin-top: 20rpx;
  margin-left: 10rpx;
  margin-right: 10rpx;
  height: 56rpx;
  padding: 10rpx 20rpx;
  box-sizing: border-box;
  border-radius: 28rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2rpx solid #eeeeee;
  color: #999999;
}

.selected {
  border: 2rpx solid #de2748;
  color: #de2748;
}

.textarea {
  width: 580rpx;
  height: 250rpx;
  height: 150rpx;
  padding-top: 18rpx;
  padding-left: 30rpx;
  font-size: 24rpx;
  color: #333;
  border: 2rpx solid #eeeeee;
  margin-top: 28rpx;
}

.textarea-p {
  color: #999999;
}

.qrcode-wrap {
  width: 100%;
  height: 100%;
  position: fixed;
  font-size: 32rpx;
  left: 0;
  top: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.qrcode-modal {
  width: 480rpx;
  height: 580rpx;
  padding: 20rpx;
  background-color: #fff;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
  border-radius: 8rpx;
}

.qrcode-cus {
  width: 440rpx;
  height: 440rpx;
}

.save {
  margin-top: 30rpx;
  font-size: 24rpx;
  padding: 0 10rpx;
}

.qrcode-close {
  width: 68rpx;
  height: 68rpx;
  margin-top: 63rpx;
  background-size: 100% 100%;
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/estimate/comment_close.png');
}

.btn-wrap {
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.btn-wrap .submit {
  margin-right: 20rpx;
  width: 230rpx;
  height: 80rpx;
}

.submit {
  margin-top: 28rpx;
  width: 462rpx;
  height: 80rpx;
  background: linear-gradient(180deg, #ff869c 0%, #dc2244 100%);
  border-radius: 40rpx;
  font-size: 32rpx;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
}

.disabled {
  width: 248rpx;
  height: 72rpx;
  color: #a42c21;
  background: #e7e7e7;
  border-radius: 50rpx;
}

.leave-wrap,
.feedback-wrap,
.pay-wrap {
  width: 100%;
  height: 100%;
  position: fixed;
  left: 0;
  top: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 100;
}

.leave-modal,
.feedback-modal {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 538rpx;
  height: 546rpx;
  background: #ffffff;
  border-radius: 16rpx;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.feedback-modal {
  background-size: 100% auto;
  background-position-y: -2rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/estimate/top.png');
  background-repeat: no-repeat;
}
.leave-modal .leave {
  width: 100%;
  margin-top: 20rpx;
  padding: 0 30rpx;
  font-size: 32rpx;
  font-weight: 400;
  color: #333333;
  letter-spacing: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}
.feedback-modal .thanks {
  width: 100%;
  margin-top: 220rpx;
  font-size: 34rpx;
  font-weight: 600;
  color: #e33555;
  letter-spacing: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.emjoy {
  width: 184rpx;
  height: 188rpx;
  background-image: url('https://ustatic.hudongmiao.com/joymewMp/joymewIndex/estimatehappy.png');
  background-size: 100% 100%;
}
.tips {
  margin-top: 20rpx;
  padding: 0 30rpx;
  font-size: 24rpx;
}
.btn-group {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-around;
}
.btn-leave,
.btn-encourage {
  margin-top: 40rpx;
  width: 218rpx;
  height: 72rpx;
  border-radius: 50rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}
.btn-leave {
  color: #a42c21;
  background: linear-gradient(180deg, #fff6f6 0%, #ffd4d7 100%);
}
.btn-encourage {
  color: #ffffff;
  background: linear-gradient(180deg, #ff869c 0%, #dc2244 100%);
}
.pay-modal {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 672rpx;

  box-sizing: content-box;
  background: #fff;
  border-radius: 24rpx 24rpx 0rpx 0rpx;
}
.pay-modal.spe{
  padding-bottom: 240rpx;
}
.end-poem {
  width: 100%;
  height: 210rpx;
  background: linear-gradient(133deg, #dc2244 0%, #ff869c 100%);
  border-radius: 24rpx 24rpx 0rpx 0rpx;
  color: white;
  padding-top: 30rpx;
  padding-left: 60rpx;
}
.pay-modal.other .end-poem {
  height: 100rpx;
}
.pay-modal.other .end-poem {
  height: 100rpx;
}
.p1 {
  font-size: 32rpx;
}
.p2 {
  margin-top: 16rpx;
  font-size: 24rpx;
}
.p3 {
  width: 60%;
  margin-top: 16rpx;
  font-size: 20rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.charge-wrap {
  padding: 48rpx 54rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.charge {
  width: 148rpx;
  height: 118rpx;
  background: linear-gradient(180deg, #fff6f6 0%, #ffd4d7 100%);
  border-radius: 8rpx;
  color: #a42c21;
  font-size: 32rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
.chargeSelected {
  color: white;
  background: linear-gradient(180deg, #ff869c 0%, #dc2244 100%);
}
.money {
  display: flex;
  justify-content: center;
  align-items: center;
}
.cusmoney {
  font-size: 24rpx;
  flex-direction: column;
}
.focusmoney {
  flex-direction: row;
  padding: 5rpx;
}
.solid {
  font-size: 24rpx;
}
.unit {
  font-size: 22rpx;
}
.director {
  font-size: 24rpx;
  margin: 0 auto;
  text-align: center;
}
.charge-btn {
  margin: 0 auto;
  width: 462rpx;
  height: 80rpx;
  background: linear-gradient(180deg, #ff869c 0%, #dc2244 100%);
  border-radius: 40rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 64rpx;
  font-size: 32rpx;
  font-weight: 400;
  color: #ffffff;
}
@import './item.wxss';
````

## File: pages/estimate/components/hostEstimate/item.wxss
````
.comment-item{
    margin: 0 auto;
    width: 616rpx;
    display: flex;
    flex-direction: column;
    
  }
  .my-c{
    display: flex;
    justify-content: flex-start;
  }
  .my-avator{
    width: 68rpx;
    height: 68rpx;
    border-radius: 50%;
    margin-right: 16rpx;
  }
  .nameAnddate{
    display: flex;
    flex-direction: column;
  }
  .nameAnddate .name{
    font-size: 26rpx;
  
    color: #333;
  }
  .nameAnddate .date{
    font-size: 24rpx;
    color: #999999;
  }
  .comment-item .content{
    font-size: 32rpx;
    margin-top: 22rpx;
  }
  .sub-comment{
    margin-top: 20rpx;
    background: #f5f5f3;
    border-radius: 4rpx;
    padding: 10rpx;
    padding-left: 24rpx;
    font-size: 24rpx;
  }
  .reply-btn{
    width: 100%;
    height: 50rpx;
    background: #f5f5f3;
    border-radius: 4rpx;
    font-size: 24rpx;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding-left: 24rpx;
    margin-top:20rpx;
  }
  .sub-item{
    margin-top: 8rpx;
  }
  .sub-name{
    margin-right: 20rpx;
    max-width: 200rpx;
    color: #333;
    font-weight: bold;
  }
  .sub-content{
    color: #666;
  }
````

## File: pages/estimate/components/hotelEstimate/hotelEstimate.js
````javascript
// pages/estimate/hotelEstimate/hotelEstimate.js
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    hotel: {
      type: Object
    },
    banner: {
      type: Array
    }
  },

  /**
   * 组件的初始数据
   */
  data: {
    borderlist: new Array(26),
  },

  /**
   * 组件的方法列表
   */
  methods: {
    //点击星星评分
    clickstar(e) {
      //获取当前点击的星星个数,因为index是从0开始所以需+1
      const rate = e.detail;
      const index = e.currentTarget.dataset.index
      this.triggerEvent('change', {
        rate: rate,
        index: index,
      })
    },
    changeRemark(e) {
      const remark = e.detail.value;
      // console.log(e)
      this.triggerEvent('update', {
        remark
      })

    },
    submit(){
      this.triggerEvent('submit', {})
    }
  }
})
````

## File: pages/estimate/components/hotelEstimate/hotelEstimate.json
````json
{
  "component": true,
  "usingComponents": {
    "rateStar": "/components/rateStar/rateStar"
  }
}
````

## File: pages/estimate/components/hotelEstimate/hotelEstimate.wxml
````
<view class="hotelEstimate">
  <swiper class="swiper" wx:if="{{banner.length>0}}">
    <swiper-item class="swiper-item" wx:for="{{banner}}">
    <!-- {{item}} -->
      <image src="{{item}}" alt="" srcset="" class="banner" />
    </swiper-item>
  </swiper>


  <view class="comment-box">
    <image src="{{hotel.avator}}" class="avatar"  ></image>

    <view class="hotel-name">{{hotel.name}}</view>
    <view class="border-wrap">
      <view class="border" wx:for="{{borderlist}}" wx:key="index"></view>
    </view>
    <view class="tags-wrap">
      <view class="tag-item" wx:for="{{hotel.list}}" wx:key="index">
        <view class="name">{{item.name}}:</view>
        <view class="rate">
          <rateStar rate="{{item.rate}}" bind:change="clickstar" edit="{{!hotel.id}}" size="{{'bigger'}}" data-index="{{index}}" ></rateStar>
        </view>

      </view>
    </view>

    <view class="content">
      <textarea name="" id="" cols="30" rows="10" class="textarea"
      placeholder="您如果有其他意见，请放心填写"
      value="{{hotel.remark}}"
      bindinput="changeRemark"
      disabled="{{!!hotel.id}}"
      ></textarea>
    </view>

    <view class="btn" catchtap="submit" wx:if="{{!hotel.id}}">提交评价</view>
  </view>
</view>
````

## File: pages/estimate/components/hotelEstimate/hotelEstimate.wxss
````
.hotelEstimate {
    width: 100vw;
    min-height: 100vh;
    background-color: #edeeee;
    padding-top: 32rpx;
    overflow: hidden;
    padding-bottom: 140rpx;
  }
  .hotelEstimate .swiper {
    width: 686rpx;
    height: 256rpx;
    margin: 0 auto;
    margin-top: 44rpx;
  }
  .hotelEstimate .swiper .swiper-item {
    width: 686rpx;
    height: 256rpx;
  }
  .hotelEstimate .swiper .swiper-item .banner {
    width: 686rpx;
    height: 256rpx;
    background-color: slateblue;
  }
  .hotelEstimate .comment-box {
    margin: 0 auto;
    margin-top: 24rpx;
    width: 686rpx;
    min-height: 946rpx;
    background: #fff;
    border-radius: 12rpx;
    box-sizing: border-box;
    padding: 0 32rpx;
    padding-bottom: 40rpx;
    padding-top: 32rpx;
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    flex-direction: column;
  }
  .hotelEstimate .comment-box .avatar {
    width: 148rpx;
    height: 148rpx;
    margin: 0 auto;
    background-color: #fff;
    border-radius: 50%;
    border: 2rpx solid #DCDCDC;
  }
  .hotelEstimate .comment-box .hotel-name {
    margin: 16rpx auto;
    height: 52rpx;
    font-size: 36rpx;
    color: #333333;
  }
  .hotelEstimate .comment-box .border-wrap {
    margin: 0 auto;
    width: 616rpx;
    height: 2rpx;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: nowrap;
  }
  .hotelEstimate .comment-box .border-wrap .border {
    width: 18rpx;
    flex-grow: 0;
    height: 2rpx;
    background: #dddddd;
  }
  .hotelEstimate .comment-box .tags-wrap {
    width: 616rpx;
    min-height: 386rpx;
  }
  .hotelEstimate .comment-box .tags-wrap .tag-item {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    height: 80rpx;
    margin-top: 20rpx;
  }
  .hotelEstimate .comment-box .tags-wrap .tag-item .name {
    color: rgba(0, 0, 0, 0.6);
    font-size: 32rpx;
  }
  .hotelEstimate .comment-box .content {
    width: 622rpx;
    height: 128rpx;
    border-radius: 12rpx;
    margin-top: 40rpx;
  }
  .hotelEstimate .comment-box .content .textarea {
    width: 622rpx;
    height: 128rpx;
    border: 2rpx solid #eeeeee;
    background-color: #fff;
    padding: 18rpx 32rpx;
    box-sizing: border-box;
    font-size: 28rpx;
    color: #999;
  }
  .hotelEstimate .comment-box .btn {
    width: 462rpx;
    height: 80rpx;
    background: linear-gradient(80deg, #298eff 100%, #6bc5ff 100%);
    border-radius: 40rpx;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #ffffff;
    font-size: 32rpx;
    margin: 0 auto;
    margin-top: 40rpx;
  }
````

## File: pages/estimate/components/replyInput/replyInput.js
````javascript
// components/replyInput/replyInput.js
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    focus: {
      type: Boolean
    },
    initContent: {
      type: String,
    },
    username: {
      type: String,
    }
  },

  /**
   * 组件的初始数据
   */
  data: {
    InputBottom: 0,
    content: '',
  },
  lifetimes: {
    attached(){
      console.log('attach')
      console.log(this.data.initContent)
      this.setData({
        content: this.data.initContent
      })
    }
  },
  /**
   * 组件的方法列表
   */
  methods: {
    preventBubble(){

    },
    InputFocus(e) {
      this.setData({
        InputBottom: e.detail.height
      })
    },
    InputBlur(e) {
      this.setData({
        InputBottom: 0
      })
    },
    InputChange(e){
      const {value} = e.detail
      this.setData({
        content: value
      })
      this.triggerEvent('input', value)
    },
    sendReply(){
      this.triggerEvent('send', this.data.content)
    }
  }
})
````

## File: pages/estimate/components/replyInput/replyInput.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/components/replyInput/replyInput.wxml
````
<!--components/replyInput/replyInput.wxml-->
<view class="cu-bar foot input {{InputBottom!=0?'cur':''}}" style="bottom:{{InputBottom}}px" catchtap="preventBubble">
  <view class="toPerson">
  回复  <view class="username">{{username}}</view>:
  </view>
  <input class="solid-bottom" bindfocus="InputFocus" bindblur="InputBlur" adjust-position="{{false}}" focus="{{focus}}" maxlength="300" cursor-spacing="10"
  bindinput="InputChange"
  bindconfirm="sendReply"
  value="{{content}}"
  ></input>
  <button class="cu-btn bg-green shadow" bindtap="sendReply">发送</button>
</view>
````

## File: pages/estimate/components/replyInput/replyInput.wxss
````
/* components/replyInput/replyInput.wxss */

.cu-bar.foot {
  --white: #fff;
  padding-right: 20rpx;
  background-color: var(--white);
  position: fixed;
  width: 100%;
  bottom: 0;
  z-index: 1024;
  box-shadow: 0 -1rpx 6rpx rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  min-height: 100rpx;
  justify-content: space-between;
}

.solid-bottom {
  position: relative;
  overflow: initial;
  line-height: 64rpx;
  height: 64rpx;
  min-height: 64rpx;
  flex: 1;
  font-size: 30rpx;
  margin: 0 20rpx;
  font-size: 24rpx;
}

.solid-bottom::after {
  content: " ";
  width: 200%;
  height: 200%;
  position: absolute;
  top: 0;
  left: 0;
  border-radius: inherit;
  transform: scale(0.5);
  transform-origin: 0 0;
  pointer-events: none;
  box-sizing: border-box;
}

.cu-btn {
  --white: #ffffff;
  --green: #39b54a;
  --ShadowSize: 6rpx 6rpx 8rpx;
  --greenShadow: rgba(48, 156, 63, 0.2);
  box-shadow: var(--ShadowSize) var(--greenShadow);
  background-color: var(--green);
  color: var(--white);
  position: relative;
  border: 0rpx;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  padding: 0 30rpx;
  font-size: 28rpx;
  height: 64rpx;
  line-height: 1;
  text-align: center;
  text-decoration: none;
  overflow: visible;
  margin-left: initial;
  transform: translate(0rpx, 0rpx);
  margin-right: initial;
}
.cu-btn.button-hover {
  transform: translate(1rpx, 1rpx);
}
.toPerson {
  font-size: 24rpx;
  margin-left: 20rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}
.username {
  max-width: 130rpx;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
````

## File: pages/estimate/draw/draw.js
````javascript
import {
  getLotteryInfo
} from '../../../api/comment/draw'
import { getToken, clearStorage } from "../../../utils/storage";

Page({
  data: {
    needAuth: false,
    drawList: []
  },
  onLoad: function (options) {
  },
  onReady: function () {
  },
  onShow: function () {
    let stToken = "";
    // 判断获取token
    stToken = getToken();
    if (!stToken) {
      // token不存在=>需要登录
      this.setData({
        needAuth: true,
      });
      console.log("none token");
    } else {
      this.setData({
        needAuth: false,
      });
      this.getDraw();
    }
 
  },
  getDraw() {
    getLotteryInfo().then(res => {
      console.log(res);
      if (res.data.list) {
        let drawList = res.data.list.map(this.handleRawDrawItem);
        this.setData({
          drawList: drawList,
        });
        getApp().globalData.drawList = drawList;
      }
    })
  },
  toDrawPage(e) {
    let id = e.currentTarget.dataset.id;
    console.log(id);
    // 活动抽奖页面
    wx.navigateTo({
      url: `/pages/estimate/draw/drawPage/drawPage?id=${id}`,
    });
  },
  handleRawDrawItem(e) {
    const {
      flag,
      sort,
      info,
      icon
    } = e;
    const joinUsers = icon.split(',');
    const detailInfo = JSON.parse(info);
    console.log(detailInfo);
    return {
      flag,
      sort,
      joinUsers,
      ...detailInfo,
    }
  },
  // 授权登录成功后的回调
  handleAuthSuccess() {
    this.setData({
      needAuth: false,
    });
    this.getDraw();
  },
  // 授权登录失败的回调
  handleAuthFail() {
    clearStorage();
    this.setData({
      needAuth: false,
    });
  },
})
````

## File: pages/estimate/draw/draw.json
````json
{
 
  "navigationBarTitleText": "活动抽奖",
  "navigationBarBackgroundColor":"#DC2244",
  "navigationBarTextStyle": "white"
}
````

## File: pages/estimate/draw/draw.wxml
````
<view class="draw">
  <view class="draw-card" wx:for="{{drawList}}" wx:for-item="item" bindtap="toDrawPage" wx:for-index="index" wx:key="index" data-index="{{index}}" bindtap="toDrawPage" data-id="{{item.lotteryId}}">
    <view class="thing">
      <view class="slogn" style="background-image:url({{item.img1}});"></view>
      <view class="draw-obj" style="background-image:url({{item.img2}});"></view>
    </view>
    <view class="line"></view>
    <view class="info-wrap">
      <view class="title">{{item.prize}}</view>
      <view class="bottom-say">
        <view class="store">
          <view class="storeImg" style="background-image:url({{item.img3}});"></view>
          <view class="name">{{item.desc3}}</view>
        </view>
        <view class="btn-join">点击参与</view>
      </view>
    </view>
  </view>
</view>

<authDialogNew dialogVisible="{{needAuth}}"  isJoymewIndex="{{false}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail"></authDialogNew>
````

## File: pages/estimate/draw/draw.wxss
````
.draw {
  width: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  background: #EDEEEE;
  padding-bottom: 120rpx;
  overflow: hidden;
}
.draw-card {
  width: 686rpx;
  min-height: 560rpx;
  background: #fff;
  margin-top: 20rpx;
}
.thing {
  height: 396rpx;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}
.slogn {
  position: absolute;
  top: 18rpx;
  left: 30rpx;
  width: 82rpx;
  height: 76rpx;
  background-size: 100% 100%;
}
.draw-obj {
  width: 312rpx;
  min-height: 312rpx;
  background-size: 100% 100%;
}
.line {
  width: 688rpx;
  height: 2rpx;
  background-color: #EEEEEE;
}
.info-wrap {
  min-height: 162rpx;
  padding: 0rpx 40rpx;
}
.title {
  font-size: 34rpx;
  font-weight: 600;
  color: #333;
  min-height: 40rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  margin-top: 30rpx;
}
.bottom-say {
  display: flex;
  align-items: center;
  justify-content: space-between;
  min-height: 94rpx;
}
.store {
  display: flex;
  align-items: center;
}
.storeImg {
  width: 48rpx;
  height: 48rpx;
  background-size: 100% 100%;
  border-radius: 50%;
  margin-right: 16rpx;
}
.name {
  font-size: 24rpx;
  font-weight: 400;
  color: #999999;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}
.btn-join {
  width: 160rpx;
  height: 56rpx;
  background: linear-gradient(165deg, #FF869C 0%, #DC2244 100%);
  border-radius: 28rpx;
  font-size: 24rpx;
  font-weight: 400;
  color: #FFFFFF;
  display: flex;
  justify-content: center;
  align-items: center;
}
````

## File: pages/estimate/draw/drawPage/drawPage.js
````javascript
import { getLotteryDetail, saveLotteryInfo } from '../../../../api/comment/draw';
import {
  showWxToast,
  showWxLoading,
  hideWxLoading,
} from '../../../../utils/index';
import { getToken, clearStorage } from '../../../../utils/storage';

let showVideoAdLock = false;
let videoAd = null;
Page({
  data: {
    flag: '0',
    id: null,
    joinSuccess: false,
    currentIndex: 0,
    joinUsers: [],
    time: '',
    outdate: false,
    drawItem: {},
    adCompleted: false,
    needAuth: false,
  },

  onLoad: function(options) {
    showVideoAdLock = false;
    if (options.id) {
      this.setData({
        id: options.id,
      });
    }
    if (options.scene) {
      this.setData({
        id: options.scene,
      });
    }
    let stToken = '';
    // 判断获取token
    stToken = getToken();
    if (!stToken) {
      // token不存在=>需要登录
      this.setData({
        needAuth: true,
      });
      console.log('none token');
    } else {
      this.setData({
        needAuth: false,
      });
      this.getDraw();
    }
  },
  onShow() {
  },
  getDraw() {
    getLotteryDetail({
      lotteryId: String(this.data.id),
    }).then(res => {
      if (res.data) {
        this.handleRawDrawItem(res.data);
        this.initVideo();
      }
    }).catch((err) => {
      console.log(err);
    });
  },
  handleRawDrawItem(e) {
    const { openLotteryTime, flag, info, icon } = e;
    const joinUsers = icon.split(',');
    const detailInfo = JSON.parse(info);
    let time = openLotteryTime + ' ' + detailInfo.time;
    let today = new Date();
    let tomorrow = new Date(time.replace(/\-/g, '/'));
    let outdate = false;
    if (today.getTime() > tomorrow.getTime()) {
      outdate = true;
    }
    if (detailInfo.desc1) {
      detailInfo.imgList = detailInfo.desc1.split(',');
    } else {
      detailInfo.imgList = [];
    }
    console.log(detailInfo);
    this.setData({
      flag: String(flag),
      drawItem: detailInfo,
      joinUsers,
      time,
      outdate,
    });
  },
  saveDraw() {
    this.setData({
      flag: '1',
      joinSuccess: true,
    });
    saveLotteryInfo({
      lotteryId: String(this.data.id),
    })
      .then(res => {
        console.log(res);
        this.setData({
          ['drawItem.flag']: '1',
          joinSuccess: true,
        });
        this.getDraw();
        showWxToast('参与成功');
      })
      .catch(err => {
        showWxToast('参与失败');
        console.log(err);
      });
  },
  initVideo() {
    if (showVideoAdLock) {
      return;
    }
    showVideoAdLock = true;
    if (wx.createRewardedVideoAd) {
      showWxLoading('加载中...');
      videoAd = wx.createRewardedVideoAd({
        adUnitId: 'adunit-f37a436ebe4d767d',
      });
      videoAd.onLoad(() => {
        console.log('onLoad');
        hideWxLoading();
      });
      videoAd.onError(() => {
        console.log('onError');
        console.log('广告视频加载出错');
        showVideoAdLock = false;
        hideWxLoading();
      });
      videoAd.onClose(res => {
        showVideoAdLock = false;
        console.log('onClose');
        if ((res && res.isEnded) || res === undefined) {
          console.log('领取奖励');
          this.setData({
            adCompleted: true,
          });
          this.saveDraw();
        } else {
          console.log('中途退出，没有奖励!');
        }
      });
    }
  },
  join() {
    if (videoAd) {
      console.log('videoAd');
      videoAd.show().catch(() => {
        // 失败重试
        videoAd
          .load()
          .then(res => {
            videoAd.show();
            console.log('videoAd show');
          })
          .catch(err => {
            console.log(err);
            console.log('激励视频 广告显示失败');
          });
      });
    }
  },
  showtip() {
    showWxToast('很遗憾!您未中奖');
  },
  wait() {
    this.setData({
      joinSuccess: true,
    });
  },
  hide() {
    this.setData({
      joinSuccess: false,
    });
  },
  onShareAppMessage: function() {
    return {
      path: `/page/draw/drawPage/drawPage?id=${this.data.id}`,
    };
  },
  onUnload() {
    if (videoAd) {
      videoAd.destroy();
    }
  },
  // 授权登录成功后的回调
  handleAuthSuccess() {
    this.setData({
      needAuth: false,
    });
    // 获取签到状态
    this.getDraw();
  },
  // 授权登录失败的回调
  handleAuthFail() {
    clearStorage();
    this.setData({
      needAuth: false,
    });
  },
});
````

## File: pages/estimate/draw/drawPage/drawPage.json
````json
{
  "usingComponents": {},
  "navigationBarTitleText": "抽奖助手",
  "navigationBarTextStyle": "white",
  "navigationBarBackgroundColor":"#DC2244"
}
````

## File: pages/estimate/draw/drawPage/drawPage.wxml
````
<view class="drawPage">
  <view class="draw-basic-card">
    <view class="show-card">
      <view class="draw-slogn" style="background-image:url({{drawItem.img1}})"></view>
      <view class="draw-obj" style="background-image:url({{drawItem.img2}})"></view>
    </view>
    <view class="line"></view>
    <view class="basic-card">
      <view class="reward">{{drawItem.prize}}</view>
      <view class="date">{{time}}  自动开奖</view>
      <view class="decorate">
        <view class="d1">商城奖品</view>
        <view class="d2">团</view>
      </view>
    </view>
  </view>
  <view class="draw-desc-card">
    <view class="swiper-toggle">
      <view class="swiper-toggle1 swiper-active">图文介绍</view>
    </view>
    <view class="swiper-item desc1">
      <image wx:for="{{drawItem.imgList}}" wx:for-item="img" src="{{img}}" mode="widthFix" class="img" wx:key="index"></image>
    </view>
  </view>
  <view class="join-card">
    <view class="join-btn-wrap" bindtap="showtip" wx:if="{{outdate}}">
      <view class="join-bk-wrap"></view>
      <view class="join-btn">
        <view> 已 </view>
        <view>开奖</view>
      </view>
    </view>  
    <view class="join-btn-wrap" bindtap="join" wx:if="{{!outdate && flag === '0'}}">
      <view class="po"> 观看视频广告 参与抽奖</view>
      <view class="join-bk-wrap"></view>
      <view class="join-btn">
        <view>点击</view>
        <view>抽奖</view>
      </view>
    </view>
    <view class="join-btn-wrap"  bindtap="wait"  wx:if="{{!outdate && flag !== '0'}}">
      <view class="join-bk-wrap"></view>
      <view class="join-btn">
        <view>等待</view>
        <view>开奖</view>
      </view>
    </view>    
    <view class="join-status">
      <view class="join-number">已有{{drawItem.person}}位用户参与活动</view>
      <view class="join-people">
        <view class="user" wx:for="{{joinUsers}}" wx:for-item="user" style="background-image:url({{user}})" wx:key="index"></view>
      </view>
    </view>
  </view>
</view>
<view class="success-wrap" wx:if="{{joinSuccess}}" bindtap="hide">
  <view class="success-card">
    <view class="content">
      <view class="success-date">开奖时间为{{time}}</view>
      <view class="success-tip">请留意开奖通知，不要错过哦～</view>
      <view class="react-btn-group">
        <view class="react-ok">好的</view>
      </view>
    </view>
  </view>
</view>
<authDialogNew dialogVisible="{{needAuth}}" isJoymewIndex="{{false}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail"></authDialogNew>
````

## File: pages/estimate/draw/drawPage/drawPage.wxss
````
.drawPage {
  width: 100vw;
  min-height: 100vh;
  background: #edeeee;
  padding-top: 20rpx;
  padding-bottom: 40rpx;
  overflow: hidden;
}
.draw-basic-card {
  width: 686rpx;
  min-height: 590rpx;
  background: #ffffff;
  border-radius: 12rpx;
  margin: 0 auto;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
}
.show-card {
  width: 100%;
  min-height: 396rpx;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}
.draw-obj {
  width: 312rpx;
  height: 312rpx;
  background-size: 100% 100%;
}
.draw-slogn {
  position: absolute;
  background-size: 100% 100%;
  width: 82rpx;
  height: 76rpx;
  top: 18rpx;
  left: 30rpx;
}
.line {
  width: 100%;
  height: 2rpx;
  background-color: #eeeeee;
}
.basic-card {
  width: 100%;
  box-sizing: border-box;
  display: flex;
  justify-content: space-around;
  align-items: flex-start;
  flex-direction: column;
  padding: 15rpx 40rpx;
}
.reward {
  width: 100%;
  padding: 20rpx 0;
  color: #333333;
  font-weight: 600;
  font-size: 34rpx;
}
.date {
  width: 100%;
  color: #999;
  font-size: 24rpx;
}
.decorate {
  width: 100%;
  margin-top: 20rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.decorate .d1 {
  color: #ea5f79;
  font-size: 20rpx;
  width: 100rpx;
  height: 36rpx;
  border-radius: 6rpx;
  border: 2rpx solid #e53b5a;
  display: flex;
  justify-content: center;
  align-items: center;
}
.decorate .d2 {
  width: 40rpx;
  height: 40rpx;
  background: linear-gradient(165deg, #ff869c 0%, #dc2244 100%);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20rpx;
  color: #fff;
}
.draw-desc-card {
  width: 686rpx;
  margin: 0 auto;
  margin-top: 20rpx;
  background: #fff;
  border-radius: 12rpx;
}
.swiper-toggle {
  border-bottom: 2rpx solid #eeeeee;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 102rpx;
}
.swiper-toggle1,
.swiper-toggle2 {
  width: 50%;
  height: 100%;
  font-size: 32rpx;
  color: #666666;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 600;
}
.swiper-active {
  color: #dc2244;
}
.join-card {
  width: 100%;
  margin: 0 auto;
  margin-top: 58rpx;
  margin-top: 60rpx;
  display: flex;
  justify-content: center;
  align-items: center;

  flex-direction: column;
}
.join-btn-wrap {
  width: 182rpx;
  height: 182rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  position: relative;
}
.po {
  width: 400rpx;
  height: 50rpx;
  background: #fff;
  z-index: 10;
  position: absolute;
  top: -30rpx;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 24rpx;
  color: #dc2244;
  letter-spacing: 2rpx;
}
.po::after {
  z-index: 12;
  content: ' ';
  position: absolute;
  width: 0rpx;
  height: 0rpx;
  top: 50rpx;
  left: 50%;
  border: 12rpx solid #fff;
  border-left-color: transparent;
  border-right-color: transparent;
  border-bottom-color: transparent;
  transform: translateX(-50%);
}
.join-bk-wrap {
  opacity: 0.2;
  width: 182rpx;
  height: 182rpx;
  background: linear-gradient(165deg, #ff869c 0%, #dc2244 100%);
  border-radius: 50%;
  position: absolute;
  animation: zoomInOut 1.5s infinite linear;
}
@keyframes zoomInOut {
  0% {
    width: 182rpx;
    height: 182rpx;
  }
  50% {
    width: 160rpx;
    height: 160rpx;
  }
  100% {
    width: 182rpx;
    height: 182rpx;
  }
}
.join-btn {
  position: absolute;
  width: 150rpx;
  height: 150rpx;
  background: linear-gradient(165deg, #ff869c 0%, #dc2244 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  flex-direction: column;
  font-size: 32rpx;
  font-weight: 600;
  color: #ffffff;
}
.join-status {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
.join-number {
  font-size: 24rpx;
  font-weight: 400;
  color: #abaaaa;
}
.join-people {
  margin-top: 26rpx;
  display: flex;
  width: 750rpx;
  margin-right: 30rpx;
  justify-content: flex-start;
  overflow-x: scroll;
}
.user {
  width: 52rpx;
  height: 52rpx;
  background-size: 100% 100%;
  border-radius: 50%;
  margin-left: 12rpx;
  flex-shrink: 0;
}
.success-wrap {
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.4);
  position: fixed;
  top: 0;
  left: 0;
}
.success-card {
  position: absolute;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  width: 686rpx;
  height: 742rpx;
  background-size: 100% 100%;
  background-image: url("https://static.hudongmiao.com/joymewMp/draw/attendSuccess.png");
}
.content {
  position: absolute;
  bottom: 0;
  width: 592rpx;
  height: 371rpx;
  left: 22px;
}
.success-date {
  font-size: 28rpx;
  color: #fff;
  width: 100%;
  text-align: center;
  margin: 20rpx 0;
}
.success-tip {
  font-size: 28rpx;
  color: #fff;
  width: 100%;
  text-align: center;
  margin: 20rpx 0;
}
.success-result {
  font-size: 28rpx;
  color: #fff664;
  width: 100%;
  text-align: center;
  margin: 20rpx 0;
  text-decoration: underline;
}
.react-btn-group {
  margin: 20rpx 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  align-items: center;
  position: absolute;
  bottom: 0;
  font-size: 32rpx;
}
.react-share {
  width: 304rpx;
  height: 72rpx;
  background: linear-gradient(180deg, #f6fff9 0%, #ffd4d7 100%);
  box-shadow: 0px 4rpx 18rpx 0px rgba(210, 33, 83, 1);
  border-radius: 50rpx;
  color: #a42c21;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 32rpx;
  margin: 0;
}
.react-ok {
  width: 162rpx;
  height: 72rpx;
  background: linear-gradient(180deg, #f6fff9 0%, #ffd4d7 100%);
  box-shadow: 0px 4rpx 18rpx 0rpx rgba(210, 33, 83, 1);
  border-radius: 50rpx;
  color: #a42c21;
  display: flex;
  justify-content: center;
  align-items: center;
}
.desc1,
.desc2 {
  padding: 30rpx 20rpx;
  min-height: 320rpx;
}
.desc1 .img {
  width: 100%;
}
````

## File: pages/estimate/estimate.js
````javascript
import { clearStorage, getToken, setUserPhone } from '../../utils/storage';
import { showWxToast, getCurrentDate } from '../../utils/index';
import {
  getHostInfo, commitComment, getSubscribeMessage, Reward, replyUser, saveVisitInfo
} from '../../api/comment/comment';
import { wxPay } from '../../api/pay';
import { securityMsgCheck } from '../../api/index/index';

const FLAGNAMES = ['', '非常差', '差', '一般', '满意', '超赞']; // 所有的评分名称
let requestLock = false; // 请求锁

// 创建主持人版本的评价标签
const createTags = (data) => {
  const tags = data?.labelList?.map?.(item => {
    return {
      info: item?.bg_name ?? '',
      id: item.id,
      selected: data?.myCommentInfo?.label?.includes?.(item.id) ?? false,
    };
  }) ?? [];
  return tags;
}

// 创建酒店版本的评价标签
const createListForHotel = (data) => {
  // 各评分项的id和rate
  const labelArr = data?.myCommentInfo?.label?.split?.(',')?.map?.(item => {
    return {
      id: Number(item.split('-')[0]),
      rate: Number(item.split('-')[1]),
    };
  }) ?? [];

  // 创建list
  const list = data?.labelList?.map?.(item => {
    return {
      name: item?.bg_name ?? '',
      id: item.id,
      rate: 0,
    };
  }) ?? [];

  // 根据id给list中的每一项添加rate
  list.forEach(item => {
    item.rate = labelArr?.find?.(i => i.id === item.id)?.rate ?? 0;
  });
  return list;
};

Page({
  data: {
    needAuth: false, // 是否需要授权
    splid: '', // 活动id
    uid: '', // 本场活动主持人的id
    type: 'host', // 本场活动的类型 host: 主持人 hotel: 酒店 yunJingHotel: 云镜酒店
    visitInfo: { // 访问记录 用于记录当前页面进入时间、离开时间、维持时长
      enterTimeInfo: {
        date: '',
        timestamp: '',
      },
      leaveTimeInfo: {
        date: '',
        timestamp: '',
      },
      duration: 0,
    },
    host: { // 存放主持人评价组件所需要的数据
      hostHeadImg: '', // 主持人头像
      hostName: '', // 主持人姓名
      comment_json: '', // 主持人二维码
      flag: 0, // 评分值
      flagName: '', // 评分名称
      commented: false, // 用户是否已经评价过
      tags: [], // 评价标签
      qrcode: false, // 是否显示二维码
      content: '', // 评价输入框内容
      commentFocus: false, // 评价内容是否获取焦点
      myCommentInfo: null, // 评论内容
      step1: false, // 打赏弹窗第一步是否显示(打赏前)
      step2: false, // 打赏弹窗第二步是否显示 (打赏中)
      step3: false, // 打赏弹窗第三步是否显示 (打赏后)
      commentIdForVisitRecord: '', // 评论id 访问记录用到 
      sceneType: '', // 本场活动类型
      charges: [
        {
          selected: false,
          price: 8.88,
        },
        {
          selected: false,
          price: 68.88,
        },
        {
          selected: false,
          price: 88.88,
        },
        {
          selected: false,
          price: null,
          cus: true,
        },
      ],// 打赏金额列表
      moneyInput: '', // 打赏金额输入框的值
      cusfocus: false, // 打赏金额输入框是否获取焦点
      newContent: '', // 回复的输入框内容
      showReplyInput: false, // 是否显示回复输入框
      focus: false, // 回复输入框是否获取焦点
    },
    hotel: {},
    banner_list: [], // 酒店评价页面的轮播图
  },
  onLoad: function (options) {
    this.setData({
      splid: options?.splid ?? options?.scene ?? '',
      visitInfo: {
        ...this.data.visitInfo,
        enterTimeInfo: {
          date: getCurrentDate('date'),
          timestamp: getCurrentDate('timestamp'),
        },
      }
    });
  },
  onShow() {
    this.getBaseInfo();
  },

  onUnload() {
  },
  onHide() {
  },
  // 授权登录成功后的回调
  handleAuthSuccess() {
    this.setData({
      needAuth: false,
    });
    this.getBaseInfo();
  },
  // 授权登录失败的回调
  handleAuthFail() {
    clearStorage();
    this.setData({
      needAuth: false,
    });
  },
  // 获取并设置基础信息
  getBaseInfo() {
    // 获取主持人信息
    getHostInfo({ splid: this.data.splid }).then((res) => {
      console.log('******getHostInfo方法回调********');
      console.log(res);
      // 解构出data
      const { data } = res;
      if (data?.tql_store_id === '39') {
        this.setData({
          type: 'yunJingHotel',
        });
        wx.redirectTo({
          url: `/pages/estimate/review/review?splid=${this.data.splid}&uid=${this.data.uid}&type=${this.data.type}`,
        });
      } else if (data?.tql_store_id) {
        this.setData({
          type: 'hotel',
        });
      } else {
        this.setData({
          type: 'host',
        });
      }
      this.setData({
        host: {
          ...this.data.host,
          hostHeadImg: data?.splidInfo?.avator ?? '',
          hostName: data?.splidInfo?.emcee_name ?? '',
          comment_json: data?.splidInfo?.comment_json ?? '',
          sceneType: data?.splidInfo?.scenario,
          flag: data?.myCommentInfo?.satisfaction ?? 0,
          flagName: FLAGNAMES[data?.myCommentInfo?.satisfaction ?? 0],
          commented: data?.myCommentInfo ? true : false,
          tags: createTags(data),
          myCommentInfo: data?.myCommentInfo ?? null
        },
        uid: data?.splidInfo?.userId ?? '',
        hotel: {
          ...this.data.hotel,
          remark: data?.myCommentInfo?.content ?? '',
          id: data?.myCommentInfo?.album_comment_id ?? '',
          avator: data?.splidInfo?.avator ?? '',
          name: data?.splidInfo?.hotel_name ?? '',
          list: createListForHotel(data),
        },
        banner_list: JSON.parse(data?.shopInfo || '{}')?.data?.banner_list?.map?.(item => item?.img_url) ?? [],
      });

      if (res.data.phone) { setUserPhone(res.data.phone) };

      console.log(this.data)
    }).catch((err) => {
      console.log(err);
      this.setData({
        needAuth: err === '401' ? true : false,
      });
    });
  },
  // 主持人评价数据更新事件处理函数
  handleHostDataUpdate(e) {
    console.log(e.detail);
    this.setData({
      host: {
        ...this.data.host,
        ...e.detail,
      }
    });
  },
  // 主持人评价提交事件处理函数
  handleHostCommentCommit() {
    let label = this.data.host.tags
      .filter(item => item.selected)
      .map(item => item.id)
      .join(',');
    let params = {
      splid: this.data.splid,
      content: this.data.host.content,
      label: label,
      satisfaction: this.data.host.flag,
    };
    if (!params.content || params.content.trim().length < 1) {
      showWxToast('评价一下吧');
      this.setData({
        host: {
          ...this.data.host,
          commentFocus: true,
        }
      });
      return;
    }
    if (!params.satisfaction) {
      showWxToast('给主持人打个星吧');
      return;
    }
    if (params.satisfaction <= 3 && params.content.trim().length < 10) {
      wx.showToast({
        title: '您的评价不足10个字，详细的说明能帮助主持人更好的为您服务。',
        icon: 'none',
        duration: 3000,
      });
      return;
    }
    console.log(params);
    securityMsgCheck(params.content)
      .then(res => {
        const tmpResult = JSON.parse(res.data.msg_sec_check);
        if (tmpResult.result.suggest === 'pass') {
          commitComment(params)
            .then(res => {
              console.log(res);
              if (res.code === 200) {
                showWxToast('评价成功');
                this.subscribeMessage();
                this.getBaseInfo();
                this.setData({
                  host: {
                    ...this.data.host,
                    step1: true,
                    commented: true,
                    commentIdForVisitRecord: res.data.album_comment_id,
                  }
                });
              } else {
                showWxToast('评价失败');
              }
            })
            .catch(err => {
              console.log(err);
              showWxToast('评价失败');
            });
        } else {
          wx.showToast({
            title: '评论内容非法!',
            icon: 'none',
            duration: 3000,
          });
        }
      })
      .catch(err => {
        console.log(err);
        commitComment(params)
          .then(res => {
            console.log(res);
            if (res.code === 200) {
              showWxToast('评价成功');
              this.subscribeMessage();
              this.setData({
                host: {
                  ...this.data.host,
                  step1: true,
                  commented: true,
                  commentIdForVisitRecord: res.data.album_comment_id,
                }
              });
            } else {
              showWxToast('评价失败');
            }
          })
          .catch(err => {
            console.log(err);
            showWxToast('评价失败');
          });
      });
  },
  subscribeMessage() {
    console.log('订阅通知');
    getSubscribeMessage()
      .then(res => {
        console.log(res);
        if (res === 'accept') {
          wx.showToast({
            title: '订阅回复通知成功',
            icon: 'none',
          });
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  handleHostPay(e) {
    if (requestLock) {
      return;
    }
    requestLock = true;
    const choosedMoney = e.detail;
    Reward({
      splid: this.data.splid,
      totalfee: choosedMoney,
    })
      .then(res => {
        console.log(res);
        return wxPay(res);
      })
      .then(res2 => {
        console.log(res2);
        showWxToast('打赏成功!');
        if (this.data.host.commented) {
          this.showDraw();
        } else {
          showWxToast('给主持人评价一下吧');
        }
        this.setData({
          host: {
            ...this.data.host,
            step2: false
          }
        });
        requestLock = false;
      })
      .catch(err => {
        console.log(err);
        showWxToast('打赏失败!');
        requestLock = false;
      });
  },
  // 评论回复
  handleHostContentSend() {
    if (!this.data.host.newContent) {
      wx.showToast({
        title: '请填写评论内容',
        icon: 'none',
      });
      return;
    }
    securityMsgCheck(this.data.newContent)
      .then(res => {
        console.log(res);
        const tmpResult = JSON.parse(res.data.msg_sec_check);
        if (tmpResult.result.suggest === 'pass') {
          this.fetchReplyUser({
            splid: this.data.splid,
            content: this.data.host.newContent,
            album_comment_id: this.data.host.myCommentInfo.album_comment_id,
          });
        } else {
          wx.showToast({
            title: '评论内容非法!',
            icon: 'none',
            duration: 3000,
          });
        }
      })
      .catch(err => {
        console.log(err);
        this.fetchReplyUser({
          splid: this.data.splid,
          content: this.data.host.newContent,
          album_comment_id: this.data.host.myCommentInfo.album_comment_id,
        });
      });
  },
  // 评论回复接口调用
  fetchReplyUser({ splid, content, album_comment_id }) {
    replyUser({
      album_comment_id,
      content,
      splid,
    })
      .then(res => {
        this.subscribeMessage();
        setTimeout(() => {
          // 隐藏回复输入框
          this.setData({
            host: {
              ...this.data.host,
              showReplyInput: false,
              focus: false
            }
          });
          this.getBaseInfo();
        }, 600);
      })
      .catch(err => {
        console.log(err);
      });
  },
  // 修改酒店评分的星星
  changeList(e) {
    console.log(e);
    const { rate, index } = e.detail;
    const { list } = this.data.hotel;
    const targetProp = `hotel.list`;
    list[index].rate = Number(rate);
    this.setData({
      [targetProp]: list,
    });
  },
  // 修改酒店评分的文本输入内容
  changeRemark(e) {
    let { hotel } = this.data;
    hotel.remark = e.detail.remark;
    this.setData({
      hotel,
    });
  },
  // 提交酒店评价内容
  submitHotelInfo() {
    const { list, remark } = this.data.hotel;
    for (let i = 0; i < list.length; i++) {
      if (Number(list[i].rate) === 0) {
        wx.showToast({
          title: '有未评分的项目',
          icon: 'none',
        });
        console.log('未评分');
        return;
      }
    }
    console.log(remark);
    if (!remark) {
      wx.showToast({
        title: '未填写建议',
        icon: 'none',
      });
      return;
    }
    let params = {
      splid: this.data.splid,
      content: remark,
      label: list.map(item => `${item.id}-${item.rate}`).join(','),
      satisfaction: '5',
    };
    securityMsgCheck(params.content)
      .then(res => {
        const tmpResult = JSON.parse(res.data.msg_sec_check);
        if (tmpResult.result.suggest === 'pass') {
          commitComment(params)
            .then(res => {
              console.log(res);
              if (res.code === 200) {
                showWxToast('评价成功');
                this.subscribeMessage();
                this.getBaseInfo();
              } else {
                showWxToast('评价失败');
              }
            })
            .catch(err => {
              console.log(err);
              showWxToast('评价失败');
            });
        } else {
          wx.showToast({
            title: '评论内容非法!',
            icon: 'none',
            duration: 3000,
          });
        }
      })
      .catch(err => {
        console.log(err);
        commitComment(params)
          .then(res => {
            console.log(res);
            if (res.code === 200) {
              showWxToast('评价成功');
              this.subscribeMessage();
            } else {
              showWxToast('评价失败');
            }
          })
          .catch(err => {
            console.log(err);
            showWxToast('评价失败');
          });
      });
  }
});
````

## File: pages/estimate/estimate.json
````json
{
  "usingComponents": {
    "etTabBar":"./components/etTabBar/etTabBar",
    "hostEstimate": "./components/hostEstimate/hostEstimate",
    "hotelEstimate": "./components/hotelEstimate/hotelEstimate"
  },
  "navigationBarTitleText": "评价"
}
````

## File: pages/estimate/estimate.wxml
````
<!-- 主持人评价 -->
<hostEstimate wx:if="{{type === 'host'}}" host="{{host}}" bind:dataupate="handleHostDataUpdate" bind:commentCommit="handleHostCommentCommit" bind:pay="handleHostPay" bind:contentsend="handleHostContentSend"/>
<!-- 酒店评价 -->
<hotelEstimate wx:else hotel="{{hotel}}" bind:change="changeList" bind:update="changeRemark" bind:submit="submitHotelInfo" bind:update="changeRemark" banner="{{banner_list}}" />
<!-- 授权登录弹窗 -->
<authDialog dialogVisible="{{needAuth}}" isJoymewIndex="{{false}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail"></authDialog>
<!-- 底部tabBar -->
<etTabBar activeTab="{{0}}" splid="{{splid}}" uid="{{uid}}" type="{{type}}" />
````

## File: pages/estimate/host/components/cases/cases.js
````javascript
Component({
	properties: {
		caseList: {
			value: [],
			type: Array,
		},
		caseLen: {
			type: Number,
			default: 0,
		},
		name: {
			value: '',
			type: String
		},
		userId: {
			value: '',
			type: String
		},
		phone: {
			value: '',
			type: String
		}
	},
	data: {
	},
	attached() {},
	/**
	 * 组件的方法列表
	 */
	methods: {
		toMore() {
			wx.navigateTo({
				url: '/pages/weddingMan/personal/cases/caseList/caseList?name=' + this.properties.name + '&userId=' +
					this.properties.userId + '&phone=' + this.properties.phone
			});
		},
		toCaseDetail(e) {
			wx.navigateTo({
				url: '/pages/weddingMan/personal/cases/caseDetail/caseDetail?caseId=' + e.currentTarget.dataset.caseid +
					'&userId=' + this.properties.userId + '&phone=' + this.properties.phone + '&name=' +
					this.properties.name
			});
		}
	}
})
````

## File: pages/estimate/host/components/cases/cases.json
````json
{
    "component": true
}
````

## File: pages/estimate/host/components/cases/cases.wxml
````
<view class="casesContent">
		<view class="noCaseBlock" wx:if="{{caseLen === 0}}">
			<image src="https://ustatic.joymew.com/joymewApp/home/emptyCase.png" class="emptyCase"></image>
			<view class="tip">
				暂无作品
			</view>
		</view>
		<view class="casesBlock" wx:if="{{caseLen > 0}}">
			<view class="casesNav">
				<view class="title">
					代表作品 <text class="numStastic">({{caseLen}})</text>
				</view>
				<view class="more"  >
					MORE <image src="https://static.joymew.com/joymewApp/mp/rightArrow.png" class="arrowIcon"></image>
				</view>
			</view>
			<view class="casesList">
				<view class="casesItem" wx:for="{{caseList}}" wx:key="case_id">
					<view class="cover" style="background-image: url({{item.case_cover}})" data-caseId="{{item.case_id}}"
					 >
					</view>
					<view class="ct">
						<view class="title">
							{{item.case_name}}
						</view>
						<view class="location" wx:if="{{item.more_information_json}}">
							{{item.more_information_json}}
						</view>
					</view>
					<view class="bt">
						<view class="tags">
							#{{item.case_type}} #{{item.case_style}}
						</view>
						<view class="icons">
							<image src="https://ustatic.joymew.com/joymewApp/mp/loveIcon.png" class="loveIcon"></image>
							<text class="loveNum">{{item.likes}}</text>
						</view>
					</view>
				</view>
			</view>
		</view>
	</view>
````

## File: pages/estimate/host/components/cases/cases.wxss
````
.noCaseBlock {
	display: flex;
	flex-direction: column;
	align-items: center;
	padding-top: 70rpx;
	padding-bottom: 180rpx;
}

.noCaseBlock .emptyCase {
	width: 440rpx;
	height: 284rpx;
}

.noCaseBlock .tip {
	margin-top: 75rpx;
	font-size: 28rpx;
	font-weight: 400;
	color: #868c9b;
	line-height: 28rpx;
}

.casesBlock {
	padding: 0 40rpx;
	padding-top: 40rpx;
}

.casesBlock .casesNav {
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.casesBlock .casesNav .title {
	font-size: 28rpx;
	font-weight: 600;
	color: #010101;
	line-height: 72rpx;
}
.casesBlock .casesNav .title .numStastic{
	color: #848A9A;
	font-size: 24rpx;
	font-weight: 400;
	margin-left: 10rpx;
}
.casesBlock .casesNav .more {
	display: flex;
	align-items: center;
	font-size: 28rpx;
	font-weight: 400;
	color: #010101;
	line-height: 72rpx;
}

.casesBlock .casesNav .more .arrowIcon {
	margin-left: 10rpx;
	width: 26rpx;
	height: 32rpx;
}

.casesItem {
	margin-bottom: 65rpx;
}

.casesItem .cover {
	height: 344rpx;
	position: relative;
	background-color: #000000;
	background-size: cover;
	background-position: center;
}

.casesItem .ct {
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.casesItem .ct .title {
	font-size: 28rpx;
	font-weight: 400;
	color: #010101;
	line-height: 72rpx;
	width: 370rpx;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.casesItem .ct .location {
	font-size: 24rpx;
	font-weight: 400;
	color: #868C9B;
	line-height: 34rpx;
	width: 230rpx;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.casesItem .bt {
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.casesItem .bt .tags {
	background: rgba(229, 233, 240, 0.5);
	border-radius: 4rpx;
	padding: 6rpx 12rpx;
	font-size: 20rpx;
	font-weight: 400;
	color: #868C9B;
}

.casesItem .bt .icons {
	display: flex;
	align-items: center;
}

.casesItem .bt .icons .loveIcon {
	width: 32rpx;
	height: 32rpx;
}

.casesItem .bt .icons .loveNum {
	font-size: 32rpx;
	color: #000000;
	margin-right: 20rpx;
	margin-left: 5rpx;
}
````

## File: pages/estimate/host/components/ReserveBtn/ReserveBtn.js
````javascript
// pages/estimate/host/components/ReserveBtn/ReserveBtn.js
const app = getApp();

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    visible: {
      type: Boolean,
      value: true,
    },
    // bottom: {
    //   type: Number,
    // }
  },

  /**
   * 组件的初始数据
   */
  data: {
    isReserveSuccessBoxShow:false,
    bottom: 0,
  },
  // 组件实例进入页面节点树
  attached() {
    this.setData({
      bottom: app.globalData.bottomLift
    });
  },
  /**
   * 组件的方法列表
   */
  methods: {
    showReseveModal() {
      const keyframes = [{
        opacity: 1,
      }, {
        opacity: 0.1,
        translateY: '150%'
      }]
      this.animate('.reserve-btn', keyframes, 300, () => {
        console.log('animate done')

        this.triggerEvent('update', {
          boxVisible: true
        })
        this.clearAnimation('.reserve-btn', { opacity: true, translateY: true }, function () {
          console.log("清除了.reserve-btn opacity translateY属性")
        })
      })

    }
  }
})
````

## File: pages/estimate/host/components/ReserveBtn/ReserveBtn.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/host/components/ReserveBtn/ReserveBtn.wxml
````
<view class="placeDiv"  wx:if="{{visible}}"></view>
<view class="reserve-btn-wrap" style="transform: translateY(-{{bottom+5}}px);" >
  <!-- <transition
        enter-active-class="slideInUp faster animated"
        leave-active-class="slideOutDown faster animated"
      > -->
  <view class="reserve-btn" catchtap="showReseveModal"  wx:if="{{visible}}"> <view class="add"></view>预定</view>
  <!-- </transition> -->
  <!-- {{bottom}} -->
</view>

<view class="reserveSuccess" wx:if="{{isReserveSuccessBoxShow}}">
    <view class="reserveSuccessBox">
      <image src='https://static.joymew.com/joymewMp/reserveDetail/successIconReserveDetail.png' class="successIconReserveDetail"></image>
      <view class="tip1">预定成功</view>
      <view class="tip2">请等待主持人与您联系</view>
      <view class="exitBtn" bindtap="exitReserve">退出</view>
    </view>
  </view>
````

## File: pages/estimate/host/components/ReserveBtn/ReserveBtn.wxss
````
@import './ReverseBtn.min.wxss'
````

## File: pages/estimate/host/components/ReserveBtn/ReverseBtn.less
````
.placeDiv {
  width: 750rpx;
  height: 76rpx;
  box-sizing: content-box;
}
.reserve-btn-wrap {
  position: fixed;
  width: 750rpx;
  bottom: 98rpx;
  left: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  .reserve-btn {
    width: 606rpx;
    height: 76rpx;
    background: linear-gradient(97deg,#ffbfb7, #ff2352 100%);
    border-radius: 78rpx;
    font-size: 32rpx;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    .add{
      width: 24rpx;
      height: 24rpx;
      margin-right: 16rpx;
      background-size: 100% 100%;
      background-image: url(https://ustatic.hudongmiao.com/joymew-mp/review/reserve-add.png);
    }
  }
}
````

## File: pages/estimate/host/components/ReserveBtn/ReverseBtn.min.wxss
````
.placeDiv {
  width: 750rpx;
  height: 76rpx;
  box-sizing: content-box;
}
.reserve-btn-wrap {
  position: fixed;
  width: 750rpx;
  bottom: 98rpx;
  left: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
}
.reserve-btn-wrap .reserve-btn {
  width: 606rpx;
  height: 76rpx;
  background: linear-gradient(97deg, #ffbfb7, #ff2352 100%);
  border-radius: 78rpx;
  font-size: 32rpx;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}
.reserve-btn-wrap .reserve-btn .add {
  width: 24rpx;
  height: 24rpx;
  margin-right: 16rpx;
  background-size: 100% 100%;
  background-image: url(https://ustatic.hudongmiao.com/joymew-mp/review/reserve-add.png);
}
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.js
````javascript
// pages/estimate/host/components/ReverseBox/ReverseBox.js
import {
  showWxToast,
  showWxLoading,
  hideWxLoading,
  timeoutTask,
} from '../../../../../utils/index';

import {
  authGetPhoneByCode,
} from '../../../../../api/login';
import {
  getUserInfo
} from '../../../../../utils/storage.js';
import {
  reserveHost,
  getReserveInfo,
} from '../../../../../api/comment/comment';
const app = getApp();

Component({
  /**
   * 组件的属性列表
   */
  properties: {
    visible: {
      type: Boolean,
      value: true,
    },
    splid: {
      type: String,
    }
  },
  /**
   * 组件的初始数据
   */
  data: {
    hasReserve: false,
    reserveTime: '',
    reserveTimeReal: '',
    remark: '',
    time: '',
    timeLable: '',
    name: '',
    phone: '',
    date: '',
    currentTimeIndex: '',
    headimg: '',
    timeList: [{
        id: '1',
        name: '午宴',
      },
      {
        id: '2',
        name: '晚宴',
      },
    ],
    needInputPhone: false,
    phoneInputFocus: false,
    bottom: 0,
  },
  lifetimes: {
    attached() {
      this.setData({
        name: getUserInfo().nickName,
        headimg: getUserInfo().avatarUrl,
        splid: this.data.splid,
        bottom: app.globalData.bottomLift
      });
    },
  },
  pageLifetimes: {
    show() {
      console.log('splid', this.data.splid);
      this.initData();
    },
  },
  /**
   * 组件的方法列表
   */
  methods: {
    initData() {
      console.log('splid', this.data.splid);
      // return ;

      getReserveInfo(this.data.splid)
        .then(res => {
          console.log(res);
          if (res.data.size === 0) {
            this.setData({
              hasReserve: false,
            });
          } else {
            this.setData({
              hasReserve: true,
            });
            const reserveInfo = res.data.list[0];
            this.setData({
              date: reserveInfo.date,
              reserveTime: reserveInfo.time_interval === '1' ? '午宴' : '晚宴',
              reserveTimeReal: reserveInfo.time_interval,
              name: reserveInfo.customer_name,
              phone: reserveInfo.customer_phone,
              remark: reserveInfo.remark,
            });
          }
        })
        .catch(err => {
          console.log(err);
        });
    },
    cancel() {
      this.triggerEvent('update', {
        boxVisible: false,
      });
    },
    submit() {
      const {
        name,
        phone,
        reserveTimeReal,
        remark,
        date,
        hasReserve,
      } = this.data;
      if (hasReserve) {
        wx.showToast({
          title: '已经预订过了',
          icon: 'none',
        });
        // this.triggerEvent('update', {
        //   boxVisible: false
        // })
        return;
      }
      console.log(name);
      if (!name) {
        wx.showToast({
          title: '请输入您的姓名',
          icon: 'none',
        });
        return;
      }
      if (!phone) {
        wx.showToast({
          title: '请选择您的联系方式',
          icon: 'none',
        });
        this.setData({
          needInputPhone: true,
          phoneInputFocus: true
        });
        return;
      }
      if(phone.length !== 11) {
        wx.showToast({
          title: '请输入正确的手机号码',
          icon: 'none',
        });
      }
      if (!date) {
        wx.showToast({
          title: '请选择预定日期',
          icon: 'none',
        });
        return;
      }
      if (!reserveTimeReal) {
        wx.showToast({
          title: '请选择预定时段',
          icon: 'none',
        });
        return;
      }
      if (!remark) {
        wx.showToast({
          title: '请输入备注',
          icon: 'none',
        });
        return;
      }

      console.log(name, phone);
      this.fetchReserveHost();
    },
    phoneBlur() {
      this.setData({
        phoneInputFocus: false,
      })
    },
    changeInputData(e) {
      const {
        prop
      } = e.currentTarget.dataset;
      const {
        value
      } = e.detail;
      console.log(prop, value);
      this.setData({
        [prop]: value,
      });
      console.log(value, this.data);
    },
    bindDateChange(e) {
      this.setData({
        date: e.detail.value,
      });
    },
    bindTimeChange(e) {
      const {
        timeList
      } = this.data;
      console.log(e, typeof e);
      this.setData({
        reserveTime: timeList[e.detail.value].name,
        reserveTimeReal: timeList[e.detail.value].id,
      });
    },
    personInputPhone() {
      showWxToast('请输入手机号!');
      // 手机输入框显示
      this.setData({
        needInputPhone: true,
      })
      // 延迟0.3s输入框聚焦
      timeoutTask(() => {
        this.setData({
          phoneInputFocus: true
        })
      }, 300);
    },
    getPhoneNumber(e) {
      console.log('*******getPhoneNumber方法内部*******');
      console.log(e.detail.code);
      console.log(e.detail.errno);
      if (e.detail.errno === 1400001 || !e.detail.code) {
        this.personInputPhone();
        return;
      }
      try {
        authGetPhoneByCode({
            code: e.detail.code
          })
          .then(res => {
            console.log(res);
            if (res && res.phone_info && res.phone_info.phoneNumber) {
              this.setData({
                phone: res.phone_info.phoneNumber,
              });
            } else {
              this.personInputPhone();
            }
          })
          .catch(err => {
            console.log(err);
            this.personInputPhone();
          });
      } catch (err) {
        console.log(err);
        this.personInputPhone();
      }
    },
    fetchReserveHost() {
      showWxLoading('预定中...');
      const {
        name,
        phone,
        splid,
        date,
        remark,
        headimg,
        reserveTimeReal,
      } = this.data;
      const params = {
        splid,
        date,
        time_interval: reserveTimeReal,
        customer_name: name,
        customer_phone: phone,
        remark: remark,
        kind: '2',
      };
      if (headimg) {
        params.headimg = headimg;
      }

      reserveHost(params)
        .then(res => {
          hideWxLoading();
          this.triggerEvent('update', {
            boxVisible: false,
          });
          this.setData({
            hasReserve: true,
          });
          setTimeout(() => {
            wx.showToast({
              title: '预定成功',
              icon: 'none',
            });
          }, 800);
          console.log(res);
        })
        .catch(err => {
          console.log(err);
          hideWxLoading();
        });
    },
  },
});
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.less
````
.reverse-box-placeholder {
  width: 750rpx;
  height: 76rpx;
  box-sizing: content-box;
}
.reserve-box-wrap {
  position: fixed;
  width: 750rpx;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  bottom: 0rpx;
  left: 0;
  z-index: 10;

  .reserve-box {
    width: 750rpx;
    min-height: 814rpx;
    bottom: 0rpx;
    position: fixed;
    
    padding-top: 62rpx;
    background: #fff;
    // background: blue;
    box-shadow: 0rpx -4rpx 8rpx 0rpx rgba(0, 0, 0, 0.1);
    border-radius: 0rpx;
    border-top-left-radius: 30rpx;
    border-top-right-radius: 30rpx;
    font-size: 32rpx;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    transform: translateY(-98rpx);
    .input-wrap {
      width: 686rpx;
      height: 108rpx;
      &.text-area-wrap{
        height: 208rpx;
        align-items: center;
        .name-wrap {
          width: 180rpx;
          height: 108rpx;
          font-size: 32rpx;
          color: #333333; 
        }
      }
      display: flex;
      justify-content: flex-start;
      align-items: center;
      border-bottom: 2rpx solid #f0f0f0;
      .name-wrap {
        width: 180rpx;
        font-size: 32rpx;
        color: #333333; 
      }
      .content-wrap {
        flex-grow: 1;
        box-sizing: border-box;
        .input {
          color: rgba(0, 0, 0, 0.25);
          width: 100%;
          height: 108rpx;
          border: 0;
        }
      }
      .picker-wrap{
        flex-grow: 1;
        height: 108rpx;
        box-sizing: border-box;
        .picker-content{
          color:rgba(0, 0, 0);
          display: flex;
          align-items: center;
          justify-content: flex-start;
          font-size: 28rpx;
        color: #333333; 

          padding-left: 10rpx;
          height: 108rpx;

          flex-grow: 1;

        }
      }
    }
    .btn-group {
      width: 750rpx;
      height: 128rpx;
      background: #ffffff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      .sure-btn,
      .cancel-btn {
        width: 330rpx;
        height: 76rpx;
        border-radius: 8rpx;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 28rpx;
      }
      .sure-btn {
        background: #ff457a;
        color: #fff;
        &.finash{
        background: #DCDCDC;

        }
      }
      .cancel-btn {
        background: transparent;
        color: rgba(0, 0, 0, 0.4);
      }
    }
  }
}

.hm-btn {
  background-color: transparent;
  border: none;
  margin: 0;
  padding:0;
  color:rgba(0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: flex-start;
  font-size: 28rpx;
  color: #333333; 

  padding-left: 10rpx;
  &::after{
    border:none;
  }
}
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.min.wxss
````
.reverse-box-placeholder {
  width: 750rpx;
  height: 76rpx;
  box-sizing: content-box;
}
.reserve-box-wrap {
  position: fixed;
  width: 750rpx;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  bottom: 0rpx;
  left: 0;
  z-index: 10;
}
.reserve-box-wrap .reserve-box {
  width: 750rpx;
  min-height: 814rpx;
  bottom: 0rpx;
  position: fixed;
  padding-top: 62rpx;
  background: #fff;
  box-shadow: 0rpx -4rpx 8rpx 0rpx rgba(0, 0, 0, 0.1);
  border-radius: 0rpx;
  border-top-left-radius: 30rpx;
  border-top-right-radius: 30rpx;
  font-size: 32rpx;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  transform: translateY(-98rpx);
}
.reserve-box-wrap .reserve-box .input-wrap {
  width: 686rpx;
  height: 108rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  border-bottom: 2rpx solid #f0f0f0;
}
.reserve-box-wrap .reserve-box .input-wrap.text-area-wrap {
  height: 208rpx;
  align-items: center;
}
.reserve-box-wrap .reserve-box .input-wrap.text-area-wrap .name-wrap {
  width: 180rpx;
  height: 108rpx;
  font-size: 32rpx;
  color: #333333;
}
.reserve-box-wrap .reserve-box .input-wrap .name-wrap {
  width: 180rpx;
  font-size: 32rpx;
  color: #333333;
}
.reserve-box-wrap .reserve-box .input-wrap .content-wrap {
  flex-grow: 1;
  box-sizing: border-box;
}
.reserve-box-wrap .reserve-box .input-wrap .content-wrap .input {
  color: rgba(0, 0, 0, 0.25);
  width: 100%;
  height: 108rpx;
  border: 0;
}
.reserve-box-wrap .reserve-box .input-wrap .picker-wrap {
  flex-grow: 1;
  height: 108rpx;
  box-sizing: border-box;
}
.reserve-box-wrap .reserve-box .input-wrap .picker-wrap .picker-content {
  color: rgba(0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: flex-start;
  font-size: 28rpx;
  color: #333333;
  padding-left: 10rpx;
  height: 108rpx;
  flex-grow: 1;
}
.reserve-box-wrap .reserve-box .btn-group {
  width: 750rpx;
  height: 128rpx;
  background: #ffffff;
  display: flex;
  justify-content: space-around;
  align-items: center;
}
.reserve-box-wrap .reserve-box .btn-group .sure-btn,
.reserve-box-wrap .reserve-box .btn-group .cancel-btn {
  width: 330rpx;
  height: 76rpx;
  border-radius: 8rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 28rpx;
}
.reserve-box-wrap .reserve-box .btn-group .sure-btn {
  background: #ff457a;
  color: #fff;
}
.reserve-box-wrap .reserve-box .btn-group .sure-btn.finash {
  background: #DCDCDC;
}
.reserve-box-wrap .reserve-box .btn-group .cancel-btn {
  background: transparent;
  color: rgba(0, 0, 0, 0.4);
}
.hm-btn {
  background-color: transparent;
  border: none;
  margin: 0;
  padding: 0;
  color: rgba(0, 0, 0);
  display: flex;
  align-items: center;
  justify-content: flex-start;
  font-size: 28rpx;
  color: #333333;
  padding-left: 10rpx;
}
.hm-btn::after {
  border: none;
}
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.wxml
````
<view catchtap="cancel">
  <view class="reserve-box-placeholder" wx:if="{{visible}}"></view>
  <!-- <transition
      enter-active-class="slideInUp faster animated"
      leave-active-class="slideOutDown faster animated"
    > -->
  <view class="reserve-box-wrap" wx:if="{{visible}}">
    <view class="reserve-box" catchtap="()=>{}"  style="bottom: {{bottom}}px">
      <!-- :style="styleObj" -->
      <view class="input-wrap">
        <view class="name-wrap">您的姓名:</view>
        <view class="content-wrap" >
          <input 
          type="text" 
          value="{{name}}" 
          class="input" 
          bindinput="changeInputData" 
          data-prop="name" 
          placeholder="请输入姓名"
          disabled="{{hasReserve}}"
           />
        </view>

      </view>

      <view class="input-wrap">
        <view class="name-wrap">联系方式:</view>
        <view class="content-wrap">
          <button disabled="{{hasReserve}}" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="hm-btn input" wx:if="{{!needInputPhone}}">
            <view wx:if="{{!phone}}">获取手机号</view>
            <view wx:if="{{phone}}">{{phone}}</view>
          </button>
          <input type="text" class="input"  name="phone" 
          data-prop="phone" bindinput="changeInputData" maxlength="11" value="{{phone}}" focus="{{phoneInputFocus}}" type="number" bindblur="phoneBlur" wx:else/>
        </view>
      </view>

      <view class="input-wrap">
        <view class="name-wrap">预定日期:</view>
        <view class="picker-wrap">
          <picker mode="date" bindchange="bindDateChange" disabled="{{hasReserve}}">
            <view class="picker-content">
              {{date?date:'请选择日期'}}
            </view>
          </picker>
        </view>
      </view>
      <view class="input-wrap">
        <view class="name-wrap">预定时段:</view>
        <view class="picker-wrap">
          <picker mode="selector" disabled="{{hasReserve}}" bindchange="bindTimeChange" value="{{currentTimeIndex}}" range="{{timeList}}" range-key="name">
            <view class="picker-content">
              {{reserveTime === '' ? '请选择时段' : reserveTime}}
            </view>
          </picker>
        </view>
      </view>
      <view class="input-wrap text-area-wrap" >
        <view class="name-wrap">留言备注:</view>
        <view class="content-wrap">
          <textarea 
          disabled="{{hasReserve}}"
          placeholder="请输入内容" 
          class="input" value="{{remark}}"  maxlength="140" placeholder-style="color:rgba(0, 0, 0, 0.25)"
          bindinput="changeInputData" data-prop="remark"/>

          <!-- <input type="text" class="input" /> -->
        </view>
      </view>
      <view class="btn-group">
        <view class="cancel-btn" catchtap="cancel">取消</view>
        <view class="sure-btn" catchtap="submit" wx:if="{{!hasReserve}}">确定</view>
        <view class="sure-btn finash"  catchtap="submit" wx:if="{{hasReserve}}">已预订</view>
      </view>
    </view>
  </view>
  <!-- </transition> -->
</view>
````

## File: pages/estimate/host/components/ReverseBox/ReverseBox.wxss
````
/* pages/estimate/host/components/ReverseBox/ReverseBox.wxss */
@import './ReverseBox.min.wxss'
````

## File: pages/estimate/host/host.js
````javascript
import {
  getUserInfo,
  getCaseList,
} from '../../../api/weddingMan/index';
import { getToken, clearStorage } from '../../../utils/storage';
import {
  getHostInfo,
} from '../../../api/comment/comment';
import { showWxToast } from '../../../utils/index';
const NAVLIST = [{
    id: 0,
    name: '作品',
  },
  {
    id: 1,
    name: '评价',
  },
];
Page({
  data: {
    type:'host',
    needAuth:false,
    splid: '',
    navList: NAVLIST,
    activeNavId: 0,
    caseList: [],
    commentList: [],
    isPlay: true,
    homeCarouseList: [],
    userType: '',
    avator: '',
    browses: 0,
    name: '',
    description: '',
    city: '',
    phone: '',
    wechat: '',
    pHeight: '',
    pWeight: '',
    pYear: '',
    birthday: '',
    userId: '',
    team_name: '',
    shareType: '2',
    infoPopupVisible: false,
    caseLen: 0,
    commentsLen: 0,
    playIconVisible: true,
    splid: '',
    boxVisible: false,
    fromHdType: '', // 从互动界面直接进入? 取值:addWechat、hostReserve、''
    qrcode: false,
    comment_json: '',
  },
  onLoad: function (options) {
    console.log(options);
    if (options.fromHdType) {
      this.hdEnterLogic(options);
      return;
    }
    if(options.splid){
      this.setData({
        splid: options.splid,
      });
    }
    if (options.uid) {
      this.setData({
        userId: options.uid,
        shareType: '1',
      });
    } 
    if (options.type) {
      this.setData({
        type: options.type,
      });
    } 


    let stToken = '';
    // 判断获取token
    stToken = getToken();
    if (!stToken) {
      // token不存在=>需要登录
      this.setData({
        needAuth: true,
      });
    } else {
      this.setData({
        needAuth: false,
      });
      this.initData();
    }
   
  },
  onShow: function () {
  },
  onUnload: function () {},

  // chooseNav(e) {
  //   console.log(e.currentTarget.dataset.id);
  //   this.setData({
  //     activeNavId: e.currentTarget.dataset.id,
  //   });
  // },
  initData() {
    //
    getUserInfo(this.data.userId, '2')
      .then(res => {
        console.log(res);
        this.setData({
          avator: res.data.user_headimg,
          name: res.data.user_qm_name,
          homeCarouseList: this.getHomeCarouseList(res.data.user_lbt),
          userType: this.getUserType(res.data.user_type),
          browses: res.data.browses || '0',
          description: res.data.user_desc,
          city: res.data.user_city,
          phone: res.data.phonenumber,
          wechat: res.data.user_wx,
          pHeight: res.data.user_height,
          pWeight: res.data.user_weight,
          birthday: res.data.uesr_birthday,
          pYear: res.data.user_age,
        });
        if (res.data.teamInfo) {
          this.setData({
            team_name: res.data.teamInfo.team_name,
          });
        }
        wx.setNavigationBarTitle({
          title: `${this.data.name}的主页`,
        });
      })
      .catch(err => {
        console.log(err);
      });
    getCaseList(this.data.userId)
      .then(res => {
        console.log(res);
        this.setData({
          caseList: res.data.list,
          caseLen: Number(res.data.totalResult),
        });
      })
      .catch(err => {
        console.log(err);
      });
  },
  getHomeCarouseList(pLbt) {
    let tmpArr = [];
    if (pLbt) {
      try {
        tmpArr = JSON.parse(pLbt);
      } catch (err) {
        console.log(err);
      }
    }
    return tmpArr;
  },
  getUserType(pType) {
    const OCCUPATION = [{
        id: '1',
        name: '主持人',
      },
      {
        id: '2',
        name: '摄像师',
      },
      {
        id: '3',
        name: '摄影师',
      },
      {
        id: '4',
        name: '化妆师',
      },
      {
        id: '5',
        name: '婚礼机构',
      },
    ];
    const tmpIndex = OCCUPATION.findIndex(
      item => parseInt(item.id, 10) === parseInt(pType, 10),
    );
    let ocp = '主持人';
    if (OCCUPATION[tmpIndex]) {
      ocp = OCCUPATION[tmpIndex].name;
    }
    return ocp;
  },
  openFeedBackPage(){
    const {
      userId,
      splid
    } = this.data
    wx.navigateToMiniProgram({
      appId: 'wx6d95d8e3ffefac1d',
      path: `pages/hlr/home/index/index?userId=${userId}&reserveId=${splid}`,
      extraData: {
      },
      envVersion: "release",
      success(res) {
        // 打开成功
      },
      fail: function (err) {
        console.log(err);
      }
    })
  },
  changeData(e){
    console.log(e)
    const targetData = e.detail
    this.setData(targetData)
  },
  hideQrcode() {
    this.setData({
      qrcode: false,
    });
  },
  showQrcode() {
    if (!this.data.comment_json) {
      showWxToast('主持人未上传微信二维码！');
      return;
    }
    this.setData({
      qrcode: true,
    });
  },
  hdEnterLogic(options) {
    this.setData({
      fromHdType: options.fromHdType,
      userId: options.emceeId,
      splid: options.splid
    });
    this.initData();
    getHostInfo({
        splid: this.data.splid,
      })
      .then(res => {
        console.log(res);
        if (res.data.splidInfo) {
          let tmp = res.data.splidInfo;
          this.setData({
            comment_json: tmp.comment_json,
          });
          // addWechat、hostReserve
          if (this.data.fromHdType === 'hostReserve') {
            console.log('弹出主持预定弹窗');
            if (!this.data.boxVisible) {
              this.setData({
                boxVisible: true
              });
            }
          } else if (this.data.fromHdType === 'addWechat') {
            console.log('弹出主持添加微信弹窗');
            if (!this.data.qrcode) {
              this.showQrcode();
            }
          }
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  handleAuthSuccess(){
    this.setData({
      needAuth: false
    });
    // 获取签到状态
    // this.getDraw();
    this.initData();
  },
  handleAuthFail(){
    clearStorage();
    this.setData({
      needAuth: false,
    });
  },
  onShareAppMessage() {
    let shareobj = {
      title:'',
      path: `/pages/estimate/estimate?splid=${this.data.splid}`
      // imageUrl: "",//分享的图片
    }

    return shareobj
  }
});
````

## File: pages/estimate/host/host.json
````json
{
  "usingComponents": {
    "ReverseBox":"./components/ReverseBox/ReverseBox",
    "reserve-btn":"./components/ReserveBtn/ReserveBtn",
    "etTabBar": "../components/etTabBar/etTabBar",
    "cases": "./components/cases/cases"
  }
}
````

## File: pages/estimate/host/host.wxml
````
<view class="content" bindtap="openFeedBackPage">
  <view class="cover">
    <image src="{{homeCarouseList[0].mediaPath}}" class="coverImage" wx:if="{{homeCarouseList.length > 0 && homeCarouseList[0].type === 'image'}}"></image>
    <view class="coverVideo" bindtap="previewVideo" wx:if="{{homeCarouseList.length > 0 && homeCarouseList[0].type === 'video'}}">
      <image src="{{homeCarouseList[0].mediaPath+'?vframe/jpg/offset/0'}}" class="coverImage"></image>
      <image src="https://ustatic.hudongmiao.com/joymewApp/playIconBig.png" class="playIcon" wx:if="{{playIconVisible}}"></image>
    </view>
    <view class="coverDeco" wx:if="{{homeCarouseList.length === 0}}">
      <view class="noCover">
        <image src="https://static.joymew.com/joymewApp/mp/cases.png" class="noIcon"></image>
        <text class="noCoverTip">暂无封面</text>
      </view>
    </view>
    <cover-view class="visitNum">
      访问量: {{browses}}
    </cover-view>
  </view>
  <view class="userInfoWrap">
    <image src="{{avator}}" class="avator"></image>
    <view class="nickname">
      {{name}}
    </view>
    <view class="description">
      {{team_name}}
    </view>
    <view class="city">
      {{city}}<text wx:if="{{city && userType}}">/</text>{{userType}}
    </view>
    <view class="btnWrap">
      <view class="checkScheduleBtn">
        查询档期
      </view>
    </view>
    <view class="intro">
      {{description}}
    </view>
    <view class="infoCheckFuncs">
      <image src="https://ustatic.joymew.com/joymewApp/home/phoneIcon.png" mode="widthFix" class="funcIcon" data-type="0" bindtap="showFunc" wx:if="{{shareType === '1'}}">
      </image>
      <image src="https://ustatic.joymew.com/joymewApp/home/pIcon.png" mode="widthFix" class="funcIcon" data-type="1" bindtap="showFunc" wx:if="{{shareType === '1'}}">
      </image>
      <image src="https://ustatic.joymew.com/joymewApp/home/pcIcon.png" mode="widthFix" class="funcIcon" data-type="2" bindtap="showFunc">
      </image>
      <view class="shareFunc">
        <image src="https://ustatic.joymew.com/joymewApp/home/zfIcon.png" data-type="3" mode="widthFix" class="shareFuncIcon" bindtap="showFunc">
        </image>
        <!-- <button open-type="share" type="primary" class="shareBtn">
				</button> -->
      </view>
    </view>
  </view>
  <view class="bottom">
    <view class="nav">
      <view class="navItem {{activeNavId === item.id ? 'active' : ''}}" wx:for="{{navList}}" wx:key="id" data-id="{{item.id}}">
        {{item.name}}
      </view>
    </view>
    <cases wx:if="{{activeNavId === 0}}" caseList="{{caseList}}" name="{{name}}" userId="{{userId}}" phone="{{phone}}" caseLen="{{caseLen}}" />
  </view>

  <ReverseBox visible="{{boxVisible}}"  bind:update="changeData" splid="{{splid}}" />
  <reserve-btn visible="{{!boxVisible}}" bind:update="changeData"></reserve-btn>
  <view class="qrcode-wrap" wx:if="{{qrcode}}" catchtap="hideQrcode">
    <view class="qrcode-modal">
      <image src="{{comment_json}}" class="qrcode-cus" show-menu-by-longpress='true'></image>
      <view class="save">如有主持需求，请长按二维码添加主持人微信。</view>
    </view>
    <view class="qrcode-close"></view>
  </view>
</view>


<etTabBar type="{{type}}" activeTab="{{2}}" splid="{{splid}}" uid="{{userId}}" wx:if="{{!fromHdType}}" />

<authDialogNew dialogVisible="{{needAuth}}" isJoymewIndex="{{false}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail"></authDialogNew>
````

## File: pages/estimate/host/host.wxss
````
.cover {
  width: 750rpx;
  height: 422rpx;
  position: relative;
  background-color: #010101;
}

.cover .coverImage {
  width: 100%;
  height: 100%;
}

.cover .coverVideo {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
.cover .coverVideo .playIcon {
  width: 120rpx;
  height: 120rpx;
  position: absolute;
}

.cover .coverDeco {
  position: absolute;
  top: 0;
  left: 0;
  width: 750rpx;
  height: 422rpx;
}

.cover .coverDeco .noCover {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.cover .coverDeco .noCover .noIcon {
  width: 192rpx;
  height: 120rpx;
}

.cover .coverDeco .noCover .noCoverTip {
  margin-top: 22rpx;
  font-size: 20rpx;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.5);
  line-height: 20rpx;
}

.cover .visitNum {
  position: absolute;
  right: 60rpx;
  top: 106rpx;
  font-size: 20rpx;
  font-weight: 400;
  color: #ffffff;
  line-height: 20rpx;
  height: 30rpx;
}

.userInfoWrap {
  position: relative;
  padding-top: 48rpx;
  background-color: #ffffff;
  padding-top: 160rpx;
  padding-bottom: 26rpx;
  border-bottom: 1rpx solid #c7ccdb;
}

.userInfoWrap .avator {
  width: 128rpx;
  height: 128rpx;
  position: absolute;
  right: 84rpx;
  top: -64rpx;
  border-radius: 64rpx;
}

.userInfoWrap .nickname {
  font-size: 36rpx;
  font-weight: 600;
  color: #010101;
  line-height: 72rpx;
  position: absolute;
  right: 274rpx;
  top: 18rpx;
  width: 428rpx;
  text-align: right;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.userInfoWrap .description {
  width: 428rpx;
  position: absolute;
  right: 274rpx;
  top: 86rpx;
  text-align: right;
  text-overflow: ellipsis;
  overflow: hidden;
  font-size: 24rpx;
  font-weight: 400;
  color: #010101;
  white-space: nowrap;
  line-height: 24rpx;
}

.userInfoWrap .description {
  width: 428rpx;
  position: absolute;
  right: 274rpx;
  top: 86rpx;
  text-align: right;
  text-overflow: ellipsis;
  overflow: hidden;
  font-size: 24rpx;
  font-weight: 400;
  color: #010101;
  white-space: nowrap;
  line-height: 24rpx;
}

.userInfoWrap .city {
  font-size: 24rpx;
  font-weight: 400;
  color: #010101;
  position: absolute;
  right: 36rpx;
  top: 86rpx;
  width: 250rpx;
  text-align: center;
  line-height: 24rpx;
}

.userInfoWrap .btnWrap {
  display: flex;
  justify-content: center;
}

.userInfoWrap .btnWrap .checkScheduleBtn {
  width: 324rpx;
  height: 76rpx;
  background: #010101;
  border-radius: 12rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 24rpx;
  font-weight: 500;
  color: #ffffff;
}

.userInfoWrap .infoCheckFuncs {
  display: flex;
  justify-content: center;
  margin-top: 20rpx;
}
.userInfoWrap .infoCheckFuncs .shareFunc {
  width: 104rpx;
  height: 104rpx;
  position: relative;
}

.userInfoWrap .infoCheckFuncs .shareFunc  .shareFuncIcon {
  width: 100%;
  height: 100%;
}
.userInfoWrap .infoCheckFuncs .shareFunc .shareBtn {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  opacity: 0;
}
.userInfoWrap .infoCheckFuncs .funcIcon {
  width: 104rpx;
  height: 104rpx;
  margin-right: 10rpx;
}

/* .userInfoWrap .infoCheckFuncs .funcIcon:nth-child(6) {
	margin-right: 0;
} */

.userInfoWrap .intro {
  padding: 0 36rpx;
  font-size: 24rpx;
  font-weight: 400;
  color: #848a9a;
  line-height: 72rpx;
  margin-top: 18rpx;
  display: flex;
  justify-content: center;
}

.bottom {
  position: relative;
  background-color: #ffffff;
}

.bottom .nav {
  display: flex;
  padding-top: 30rpx;
  padding-left: 40rpx;
}

.bottom .nav .navItem {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 60rpx;
  font-size: 28rpx;
  font-weight: 400;
  color: #848a9a;
  line-height: 28rpx;
  margin-right: 40rpx;
  position: relative;
}

.bottom .nav .navItem.active {
  font-weight: 600;
  color: #010101;
}

.bottom .nav .navItem.active::after {
  content: '';
  display: block;
  width: 40rpx;
  height: 4rpx;
  background: #010101;
  position: absolute;
  bottom: 0;
}

.popCt {
  display: flex;
  justify-content: space-around;
}

.popCt .pctItem {
  padding-top: 45rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.popCt .pctItem .zfIcon {
  width: 140rpx;
  height: 140rpx;
}

.popCt .pctItem text {
  font-size: 20rpx;
  font-weight: 400;
  color: #656972;
  margin-top: 2rpx;
  line-height: 28rpx;
}
.qrcode-wrap {
  width: 100%;
  height: 100%;
  position: fixed;
  font-size: 32rpx;
  left: 0;
  top: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
.qrcode-modal {
  width: 480rpx;
  height: 580rpx;
  padding: 20rpx;
  background-color: #fff;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
  border-radius: 8rpx;
}
.qrcode-cus {
  width: 440rpx;
  height: 440rpx;
}
.save {
  margin-top: 30rpx;
  font-size: 24rpx;
  padding: 0 10rpx;
}
.qrcode-close {
  width: 68rpx;
  height: 68rpx;
  margin-top: 63rpx;
  background-size: 100% 100%;
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/estimate/comment_close.png');
}
````

## File: pages/estimate/hotel/hotel.js
````javascript
// pages/estimate/hotel/hotel.js
const app = getApp()
import {
  getToken,
  setLiveId,
  getUserPhone,
} from '../../../utils/storage';

import { getCurrentTimestamp } from '../../../utils/date';
import  { PAGE_HOST } from '../../../assets/constant/host';
Page({

  /**
   * 页面的初始数据
   */
  data: {
    splid: '',
    type: '',
    uid:'',
    activityTitle:'婚宴预定',
    myActiveTab: 2,
    bottomLift: 0,
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    const token = getToken()
    let userPhone = getUserPhone() || '';
    this.setData({
      bottomLift: app.globalData.bottomLift
    });
    if (options.uid) {
      this.setData({
        uid: options.uid,
      });
    } 
    if (options.type) {
      this.setData({
        type: options.type,
      });
    } 
    if(options.splid && token){
      this.setData({
        splid: options.splid,
      });
      setLiveId(options.splid);
      let h5Url = `${PAGE_HOST}?liveId=${options.splid}&token=${token}&bottom=${this.data.bottomLift}&enter=1&userphone=${userPhone}&time=${getCurrentTimestamp()}#/hotelReserve`;
      if(this.data.type === 'yunJingHotel'){
        if(options.hltHotelId){
          // 米纱婚纱
          h5Url = `${PAGE_HOST}?liveId=${options.splid}&token=${token}&hltHotelId=${options.hltHotelId}&bottom=${this.data.bottomLift}&enter=1&userphone=${userPhone}&time=${getCurrentTimestamp()}#/hotelReserve`;
          this.setData({
            myActiveTab: 2,
          });
        } else {
          // 酒店预定
          this.setData({
            myActiveTab: 1,
          });
        }
      }
      app.setH5Url(h5Url);
    }
 

    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `婚宴预定(${app.globalData.activityTitle})`
    });
    console.log(this.data.h5Url);
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady() {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow() {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide() {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload() {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh() {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom() {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage() {
    let shareobj = {
      title:'',
      path: `/pages/estimate/estimate?splid=${this.data.splid}`
      // imageUrl: "",//分享的图片
    }

    return shareobj
  }
})
````

## File: pages/estimate/hotel/hotel.json
````json
{
  "usingComponents": {
    "etTabBar": "../components/etTabBar/etTabBar"
  }
}
````

## File: pages/estimate/hotel/hotel.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
<etTabBar type="{{type}}"  activeTab="{{myActiveTab}}" splid="{{splid}}" uid="{{uid}}"  wx:if="{{!fromHdType}}" />
````

## File: pages/estimate/hotel/hotel.wxss
````
/* pages/estimate/hotel/hotel.wxss */
````

## File: pages/estimate/review/imgPreview/imgPreview.js
````javascript
Component({
  properties: {
    // 图片列表
    imgs: {
      type: Array,
    },
    // 当前图片索引
    pageIndex: {
      type: Number,
    }
  },
  methods: {
    // 点击关闭预览
    close() {
      this.triggerEvent('update', {
        activeImg: []
      });
    },
    // 滑动时修改当前图片索引
    changeSwiper(e) {
      let source = e.detail.source;
      if (source !== 'touch') {
        return;
      }
      let value = e.detail.current;
      this.triggerEvent('update', {
        imgIndex: Number(value)
      });

    }

  }
});
````

## File: pages/estimate/review/imgPreview/imgPreview.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/review/imgPreview/imgPreview.wxml
````
<view class="imgPreview" bind:tap="close">
  <swiper
    class="swiper"
    bind:change="changeSwiper"
    current="{{ pageIndex }}"
    circular
  >
    <swiper-item wx:for="{{ imgs }}" class="swiper-item" wx:key="item">
      <image src="{{ item }}" class="img" mode="widthFix"></image>
    </swiper-item>
  </swiper>
  <view class="pageNum">{{ pageIndex + 1 }} / {{ imgs.length }}</view>
</view>
````

## File: pages/estimate/review/imgPreview/imgPreview.wxss
````
.imgPreview {
  width: 100vw;
  height: 100vh;
  background: #000000;
  position: fixed;
  z-index: 1020;
  top: 0;
  left: 0;
  display: flex;
  overflow-x: hidden;
  justify-content: center;
  align-items: center;
}
.imgPreview .pageNum {
  position: absolute;
  bottom: 160rpx;
  right: 30rpx;
  width: 100rpx;
  height: 60rpx;
  border-radius: 30rpx;
  color: #fff;
  border: 2rpx solid #dcdcdc;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 28rpx;
  z-index: 20;
}
.imgPreview .swiper {
  width: 730rpx;
  height: 100vh;
  margin: 0 auto;
}
.imgPreview .swiper .swiper-item {
  width: 730rpx;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.imgPreview .swiper .swiper-item .img {
  width: 730rpx;
}
````

## File: pages/estimate/review/rankInfo/rankInfo.js
````javascript
const testImg = 'https://i0.hdslb.com/bfs/archive/2c0c8a2be1c06a284165f1a3d019a8e4e38f1713.jpg@640w_400h_1e_1c.webp';
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    info: {
      type: Object,
    }
  },

  /**
   * 组件的初始数据
   */
  data: {

    name: wx.getStorageSync('nickName'),
    avatar: wx.getStorageSync('avatarUrl'),
  },
  lifetimes: {
    attached() {
    }
  },
  /**
   * 组件的方法列表
   */
  methods: {
    showRank() {
      this.triggerEvent('update', {
        rankVisible: true
      });
    }
  }
});
````

## File: pages/estimate/review/rankInfo/rankInfo.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/review/rankInfo/rankInfo.wxml
````
<view class="rankInfo">
  <view class="left">
    <view
      class="avatar"
      style="background-image: url({{ info.avatar || avatar }})"
    ></view>
    <view class="name">{{ info.name || name || "-" }}</view>
  </view>

  <view class="right">
    <view class="value-wrap com-wrap">
      <view class="title">幸福贡献值</view>
      <view class="value">{{ info.value || "0" }}</view>
    </view>

    <view class="rank-wrap com-wrap" bindtap="showRank">
      <view class="title">
        <view>排名</view>
        <view class="more"></view>
      </view>
      <view class="rank">{{ info.rank || "-" }}</view>
    </view>
  </view>
</view>
````

## File: pages/estimate/review/rankInfo/rankInfo.wxss
````
.rankInfo{
  width: 686rpx;
  height: 128rpx;
  background: #ffffff;
  border-radius: 16rpx;
  margin: 0 auto;
  margin-top: 56rpx;
  display: flex;
  justify-content:space-between;
  align-items: center;
}
.rankInfo .left{
  display: flex;
  justify-content: flex-start;
  align-items: center;
}
.rankInfo .avatar{
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  background-size: cover;
  margin-left: 24rpx;
  flex-shrink: 0;
  border: 2rpx solid #DCDCDC;
}
.rankInfo .name{
  width: 200rpx;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  margin-left: 16rpx;
  flex-shrink: 0;
  color: #333333;
  font-size: 28rpx;
  font-weight: 500;
}

.rankInfo .right{
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.com-wrap{
  width: 160rpx;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
  height: 128rpx;
}
.com-wrap .title{
  margin-top: 20rpx;
  font-size: 24rpx;
  color: rgba(0,0,0,0.40);

  display: flex;
  justify-content: flex-start;
  align-items: center;
}
.value-wrap .value{
  margin-top: 10rpx;
  font-size: 32rpx;
  color: #FF2352;
}
.rank-wrap .rank{
  font-size: 48rpx;
  color: #FF2352;
}
.com-wrap .title .more{
  margin-left: 10rpx;
  width: 10rpx;
  height: 16rpx;
  /* background-color: rgba(0,0,0,0.40); */
  background-image: url(https://ustatic.hudongmiao.com/joymew-mp/review/more.png);
  background-size: 100% 100%;
}
````

## File: pages/estimate/review/review.js
````javascript
import { getCurrentDate } from '../../../utils/index';
import {
  getToken,
  clearStorage,
  setUserPhone
} from '../../../utils/storage';
import {
  getReview,
  getHostInfo,
  saveVisitInfo
} from '../../../api/comment/comment';

// 非响应式数据
// 婚礼背景图
const WEDDINGBG = 'https://static.joymew.com/joymewScreen/img/background/weddingBg02.png';
// 转换时间格式
const dateTransform = (timedata) => {
  let target = 4;
  const date = new Date(timedata.substr(0, 19));
  const currentTime = date.getTime();
  const offset = date.getTimezoneOffset() * 60000;
  const utcTime = currentTime + offset;
  const newDate = new Date(utcTime + target * 3600000);
  const Year = newDate.getFullYear();
  const Month = newDate.getMonth() + 1 < 10 ? `0${newDate.getMonth() + 1}` : newDate.getMonth() + 1;
  const d = newDate.getDate() < 10 ? `0${newDate.getDate()}` : newDate.getDate();
  const Hours = newDate.getHours() < 10 ? `0${newDate.getHours()}` : newDate.getHours();
  const Minutes = newDate.getMinutes() < 10 ? `0${newDate.getMinutes()}` : newDate.getMinutes();
  const Seconds = newDate.getSeconds() < 10 ? `0${newDate.getSeconds()}` : newDate.getSeconds();
  const overTime = `${Year}/${Month}/${d} ${Hours}:${Minutes}:${Seconds}`;
  return overTime;
};
// 嘉宾发布的信息的数据结构
const guestMessage = {
  id: '', // 评价id
  name: '', // 嘉宾名称
  avatar: '', // 嘉宾头像
  count: 1, // 发送图片数量或弹幕数量
  action: 1, // 信息类型 1:图片 2:弹幕
  dm: '', // 弹幕内容
  imgs: [], // 图片列表
  datetime: '', // 发送时间
  userType: '', // 1:男方亲友 2:女方亲友
};
// 开始访问时间
const enterTimeInfo = {
  date: '',
  timestamp: '',
};

const app = getApp();

Page({
  data: {
    // TEST estimate的数据，迁移用
    optionsType: '', // 接收options的type
    type: '', // host: 主持人 hotel: 酒店 yunJingHotel: 云镜酒店
    hotel: false, // 是否是酒店
    // 访问信息
    uid: '', // 用户id
    hotelData: null, // 酒店信息
    scene: '', // 场景

    // TEST 原review的数据，迁移用
    splid: '', // liveId
    theme: '', // 主题 分享时会用到
    bottomLift: 0,
    currentPage: 1,
    showCount: 10,
    totalPage: 1,
    // 排名信息
    rankInfo: {
      name: '', // 姓名
      avatar: '', // 头像
      value: '', // 幸福贡献值
      rank: '', // 排名
    },
    bgImg: '', // 背景图
    statusBarHeight: 44, // 状态栏高度
    titleBarHeight: 48, // 标题栏高度
    recorderList: [], // 现场回顾的信息列表
    activeImg: [], // 进行大图预览的图片列表
    imgIndex: 0, // 当前预览的图片的索引
    // 主持人发布的信息
    hostReview: {
      name: '', // 主持人名称
      avatar: '', // 主持人头像
      count: 1, // 发送图片数量或弹幕数量
      action: 1, // 发送的是图片还是弹幕 1:图片 2:弹幕
      imgs: [], // 图片列表
      datetime: '', // 发送时间
      userType: 0, // 0:主持人 1:嘉宾
    },
    stToken: '', // 授权token
    needAuth: false, // 是否需要授权
    myActiveTab: 0, // 当前页面所属tab栏的位置 云境取值0 其他婚礼堂和普通用户取值1
  },

  // 生命周期函数--监听页面加载
  onLoad: function (options) {
    // 根据options初始化数据
    this.setData({
      splid: options.scene ? options.scene : options.splid ? options.splid : '',
      scene: options.scene ? options.scene : '',
      uid: options.uid ? options.uid : '',
      optionsType: options.type,
      myActiveTab: options.type === 'yunJingHotel' ? 0 : 1,
      visitInfo: Object.assign({}, this.data.visitInfo, {
        enterTimeInfo: {
          date: getCurrentDate('date'),
          timestamp: getCurrentDate('timestamp'),
        },
      }),
    });
    // 设置开始访问时间
    enterTimeInfo.date = getCurrentDate('date');
    enterTimeInfo.timestamp = getCurrentDate('timestamp');
  },
  // 生命周期函数--监听页面显示
  onShow() {
    // 设置状态栏高度、标题栏高度、底部安全距离等尺寸信息
    this.setSizeInfo();
    this.getBaseInfo();
    this.setHostInfo();
  },
  onUnload() {
    console.log('onUnload');
    this.saveMyVisitInfo();
  },
  onHide() {
    console.log('onHide');
    this.saveMyVisitInfo();
  },
  // 页面上拉触底事件的处理函数
  onReachBottom() {
    const {
      currentPage,
      totalPage
    } = this.data;

    if (Number(currentPage) < Number(totalPage)) {
      this.setData({
        currentPage: Number(currentPage) + 1
      });
      this.getBaseInfo();
    } else {
      wx.showToast({
        title: '没有更多了,快去送去您的祝福吧',
        icon: 'none'
      });
    }
  },
  // 点击“发送给朋友”或其他分享动作时调用
  onShareAppMessage() {
    const {
      theme, splid, uid
    } = this.data;
    return {
      title: `${theme || '活动'}的精彩现场瞬间`,
      path: `/pages/review/review?splid=${splid}&uid=${uid}`, // 默认是当前页面，必须是以‘/'开头的完整路径
      imageUrl: this.data.bgImg,
    };

  },
  // 设置状态栏高度、标题栏高度、底部安全距离等尺寸信息
  setSizeInfo() {
    this.setData({
      bottomLift: app.globalData.bottomLift,
      statusBarHeight: app.globalData.statusBarHeight,
      titleBarHeight: app.globalData.titleBarHeight,
    })
  },
  // 授权登录成功后的回调
  handleAuthSuccess() {
    this.setData({
      needAuth: false,
      stToken: getToken()
    });
    // 获取签到状态
    this.getBaseInfo();
  },
  // 授权登录失败的回调
  handleAuthFail() {
    clearStorage();
    this.setData({
      needAuth: false,
      stToken: getToken()
    });
  },
  // 修改数据，用于子组件修改父组件的数据
  changeData(e) {
    const targetData = e.detail;
    this.setData({
      ...targetData
    });
  },
  // 初始化数据
  initBaseInfo() {
    this.setData({
      recorderList: [],
      currentPage: 1,
      totalPage: 1,
      showCount: 10,
    });
    this.getBaseInfo();
  },
  // 获取基础信息
  getBaseInfo() {
    const {
      splid,
      currentPage,
      showCount,
    } = this.data;

    // 获取现场回顾信息
    getReview({
      splid,
      num: currentPage,
      size: showCount,
    }).then(res => {
      console.log('getReview', res);
      // 临时存储需要设置的参数
      let params = {};
      const {
        backInfo,
        size,
        loveVal,
        messageMap,
        user,
      } = res.data;
      const theme = backInfo.splidInfo.theme;
      params.theme = theme;
      // 设置背景
      params.bgImg = backInfo?.phone_piclink ?
        backInfo.phone_piclink :
        'https://ustatic.hudongmiao.com/joymew-mp/review/weddingBg.png';
      // 设置总页数
      params.totalPage = messageMap?.totalPages ? messageMap.totalPages : 1;
      // 设置嘉宾发布的信息的列表
      if (messageMap?.chat_list) {
        let guestMsgList = messageMap.chat_list.map((item) => {
          const temGuestMessage = Object.assign({}, guestMessage, {
            id: item.id,
            name: item.miaoName,
            avatar: item.miaoTxUrl,
            count: 1,
            action: item.miaoTpUrl ? 1 : 0,
            dm: item.miaoContent,
            imgs: [item.miaoTpUrl],
            datetime: dateTransform(item.sendTime),
            userType: item.miaoType,
          });
          return temGuestMessage;
        });
        // XXX 为什么这里是拼接到原数组上，而下面又是直接设置为空数组？
        params.recorderList = this.data.recorderList.concat(guestMsgList);
      } else {
        params.recorderList = [];
      }

      // 生成主持人发布的信息
      const createHostReview = () => {
        // 需要修改的主持人发布的信息
        const modifiedHostReview = {
          // 名称
          name: backInfo?.siyi_info?.emcee_name ?
            backInfo.siyi_info.emcee_name : '',
          // 头像
          avatar: backInfo?.siyi_info?.avator ?
            backInfo.siyi_info.avator : '',
          // 图片数量
          count: backInfo?.list?.length > 0 ?
            backInfo.list.length : 1,
          // 图片列表
          imgs: backInfo?.list?.length > 0 ?
            backInfo.list.map(item => `https://ustatic.hudongmiao.com/${item.piclink}`)
            : [WEDDINGBG],
          // 发布时间
          datetime: backInfo?.list?.length > 0 ?
            dateTransform(backInfo.list[0].create_time) : '',
        };

        if (params.bgImg) {
          modifiedHostReview.imgs.push(params.bgImg);
          modifiedHostReview.count += 1;
        }
        // 将需要修改的信息合并到原信息中
        return Object.assign({}, this.data.hostReview, modifiedHostReview);
      };
      // 设置主持人评论信息
      params.hostReview = createHostReview();

      // 设置排行榜信息
      params.rankInfo = Object.assign({}, this.data.rankInfo, {
        name: user ? user.wx_name : '', // 名字
        avatar: user ? user.avator : '', // 头像
        value: loveVal ? loveVal : '', // 幸福贡献值
        rank: size ? size : '', // 排名
      });

      this.setData({
        ...params
      });
    })
      .catch(err => {
        console.log(err);
      });
  },
  // 设置基础信息
  setHostInfo() {
    getHostInfo({
      splid: this.data.splid,
    })
      .then(res => {
        // 设置用户手机号
        if (res.data.phone) setUserPhone(res.data.phone);

        // 设置uid、type、hotel
        this.setData({
          uid: res?.data?.splidInfo?.uid ? res.data.splidInfo.uid : this.data.uid,
          hotel: res?.data?.spl_type === '1' ? true : false,
          type: res?.data?.spl_type === '1' ? (this.data.optionsType ? this.data.optionsType : 'hotel') : 'host',
        });
      })
      .catch(err => {
        console.log(err);
        this.setData({
          needAuth: err === '401' ? true : false,
        });
      });
  },
  // 保存访问信息
  saveMyVisitInfo() {
    // 获取当前时间
    const leaveTimeInfo = {
      date: getCurrentDate('date'),
      timestamp: getCurrentDate('timestamp'),
    };
    // 获取停留在该页面的时间
    const duration = Math.round(
      (leaveTimeInfo.timestamp - enterTimeInfo.timestamp) / 1000,
    );

    // 保存访问信息
    saveVisitInfo({
      splid: this.data.splid,
      album_comment_id: '',
      start_time: enterTimeInfo.date,
      end_time: leaveTimeInfo.date,
      time_length: duration,
    })
      .then(res => {
        console.log('saveVisitInfo success', res);
      })
      .catch(err => {
        console.log('saveVisitInfo fail', err);
      });
  },
  // 授权登录
  judgeStToken() {
    const token = getToken();
    if (token) {
      return;
    }
    else {
      this.setData({
        needAuth: true,
        stToken: token
      });
    }
  }
});
````

## File: pages/estimate/review/review.json
````json
{
  "usingComponents": {
    "etTabBar": "../components/etTabBar/etTabBar",
    "rankInfo": "./rankInfo/rankInfo",
    "reviewItem": "./reviewItem/reviewItem",
    "imgPreview":"./imgPreview/imgPreview"
  },
  "navigationStyle": "custom"
}
````

## File: pages/estimate/review/review.wxml
````
<view class="main">
  <view class="bg" style="background-image: url({{bgImg}})"></view>
  <!-- 自定义内容及样式的标题 -->
  <view class="title" style="height: {{titleBarHeight}}px; padding-top:{{statusBarHeight}}px">现场回顾</view>
  <!-- 个人排名信息 -->
  <rankInfo bind:update="changeData" info="{{rankInfo}}"></rankInfo>
  <!-- 主持人发表的内容 -->
  <reviewItem key="user-0" recorder="{{hostReview}}" bind:update="changeData" />
  <!-- 其他人发表的内容 -->
  <reviewItem wx:for="{{recorderList}}" wx:for-item="recorder" wx:key="id" recorder="{{recorder}}" bind:update="changeData"></reviewItem>
  <!-- 按钮菜单 -->
  <view class="action-op" style="transform: translateY(-{{bottomLift}}px);">
    <button class="op-btn share" open-type="share" wx:if="{{stToken}}">分享好友</button>
    <view class="op-btn share" bind:tap="judgeStToken" wx:if="{{!stToken}}">授权登录</view>
  </view>
  <!-- 授权窗口 -->
  <authDialog dialogVisible="{{needAuth}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail">
  </authDialog>
  <!-- 底部安全区域 -->
  <view class="safeArea" style="width: 740rpx; height: {{bottomLift}}px;"></view>
</view>
<!-- 自定义tabBar -->
<etTabBar type="{{type}}" activeTab="{{myActiveTab}}" splid="{{splid}}" uid="{{uid}}" />
<!-- 大图预览 -->
<imgPreview imgs="{{activeImg}}" wx:if="{{activeImg.length > 0}}" bind:update="changeData" pageIndex="{{imgIndex}}" />
  <authDialogNew dialogVisible="{{needAuth}}" isJoymewIndex="{{false}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail"></authDialogNew>
````

## File: pages/estimate/review/review.wxss
````
.main {
  width: 750rpx;
  min-height: 100vh;
  overflow-x: hidden;
  padding-bottom: 120rpx;
  padding-bottom: 220rpx;
  position: relative;
}
.main .bg {
  overflow-x: hidden;
  width: 100%;
  height: 100%;
  position: absolute;
  z-index: -1;
  background-repeat: no-repeat;
  background-size: cover;
  background-position: 50%;
  filter: blur(4px);
}
.main .title {
  width: 750rpx;
  height: 44rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  box-sizing: content-box;
  color: #ffffff;
  font-size: 34rpx;
}
.main .action-op {
  width: 750rpx;
  padding: 0 32rpx;
  box-sizing: border-box;
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  bottom: 130rpx;
}
.main .action-op .op-btn {
  width: 316rpx;
  height: 78rpx;
  background: linear-gradient(103deg, #ffbfb7, #ff2352 100%);
  border-radius: 114rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 32rpx;
  font-weight: 500;
  color: #ffffff;
}
.main .action-op .op-btn.share {
  margin: 0;
  padding: 0;
}
.main .action-op .op-btn.share::before {
  margin: 0;
  padding: 0;
}
.main .action-op .op-btn.share::after {
  border: none;
}
````

## File: pages/estimate/review/reviewItem/reviewItem.js
````javascript
Component({
  properties: {
    recorder: {
      type: Object
    }
  },
  methods: {
    // 点击预览图片
    preview(e) {
      this.triggerEvent('update', {
        activeImg: this.data.recorder.imgs,
        imgIndex: e.currentTarget.dataset.index || 0
      });
    }
  }
});
````

## File: pages/estimate/review/reviewItem/reviewItem.json
````json
{
  "component": true,
  "usingComponents": {}
}
````

## File: pages/estimate/review/reviewItem/reviewItem.wxml
````
<view class="reviewItem">
  <view class="reviewHeader">
    <view class="left">
      <view
        class="avatar"
        style="background-image: url({{ recorder.avatar }});"
      ></view>
      <view class="name">{{ recorder.name }}</view>
      <view class="action">
        {{ recorder.action === 1 ? "发布了" : "发表了" }}
      </view>
      <view class="name" wx:if="{{ recorder.action === 1 }}"
        >{{ recorder.count }}张图片</view
      >
      <view class="name" wx:if="{{ recorder.action !== 1 }}"
        >{{ recorder.count }}条弹幕</view
      >
    </view>

    <view class="right">
      <view class="badge host" wx:if="{{ recorder.userType === 0 }}"
        >主持人</view
      >
      <view class="badge red" wx:if="{{ recorder.userType == 2 }}"
        >女方亲友</view
      >
      <view class="badge blue" wx:if="{{ recorder.userType == 1 }}"
        >男方亲友</view
      >
    </view>
  </view>
  <view class="dmContent" wx:if="{{ recorder.dm }}">
    {{ recorder.dm }}
  </view>
  <swiper
    wx:if="{{ recorder.action === 1 && recorder.imgs.length > 0 }}"
    class="swiper"
  >
    <swiper-item
      class="swiper-item"
      wx:for="{{ recorder.imgs }}"
      wx:for-item="img"
      wx:key="img"
    >
      <image
        src="{{ img }}"
        alt=""
        srcset=""
        class="img"
        mode="aspectFill"
        bind:tap="preview"
        data-index="{{ index }}"
      ></image>
    </swiper-item>
  </swiper>

  <view class="reviewFooter">
    {{ recorder.datetime }}
  </view>
</view>
````

## File: pages/estimate/review/reviewItem/reviewItem.wxss
````
.reviewItem {
    width: 686rpx;
    margin: 0 auto;
    margin-top: 32rpx;
    background-color: #fff;
    border-radius: 16rpx;
  }
  .reviewItem .reviewHeader {
    height: 92rpx;
    display: flex;
    padding: 0 24rpx;
    box-sizing: border-box;
    justify-content: space-between;
    align-items: center;
  }
  .reviewItem .reviewHeader .left {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-grow: 1;
  }
  .reviewItem .reviewHeader .left .avatar {
    width: 48rpx;
    height: 48rpx;
    border-radius: 50%;
    background-size: cover;
    margin-right: 14rpx;
    border: 2rpx solid #DCDCDC;
    box-sizing: content-box;
  }
  .reviewItem .reviewHeader .left .name {
    color: #333333;
    font-size: 28rpx;
    margin-right: 16rpx;
    width: 160rpx;
    overflow: hidden;
    flex-grow: 1;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .reviewItem .reviewHeader .left .action {
    margin-right: 16rpx;
    font-size: 28rpx;
    color: rgba(0, 0, 0, 0.4);
  }
  .reviewItem .reviewHeader .right {
    flex-grow: 1;
  }
  .reviewItem .reviewHeader .right .badge {
    width: 100rpx;
    height: 40rpx;
    background: #010101;
    border-radius: 56rpx;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20rpx;
    color: #fff;
  }
  .reviewItem .reviewHeader .right .badge.host {
    background: #010101;
  }
  .reviewItem .reviewHeader .right .badge.red {
    background: linear-gradient(265deg, #fd31f7 0%, #f55670 100%);
  }
  .reviewItem .reviewHeader .right .badge.blue {
    background: linear-gradient(264deg, #31a3fd 0%, #565ef5 100%);
  }
  .reviewItem .dmContent {
    padding-left: 86rpx;
    padding-right: 86rpx;
    box-sizing: border-box;
    font-size: 40rpx;
    color: #333333;
    margin-top: 10rpx;
    margin-bottom: 16rpx;
  }
  .reviewItem .swiper {
    width: 750rpx;
    height: 360rpx;
    padding-left: 86rpx;
    margin: 0 auto;
    margin-top: 16rpx;
    margin-bottom: 24rpx;
    display: flex;
    justify-content: flex-start;
    align-items: center;
  }
  .reviewItem .swiper .swiper-item {
    width: 360rpx;
    height: 360rpx;
  }
  .reviewItem .swiper .swiper-item .img {
    width: 360rpx;
    height: 360rpx;
  }
  .reviewItem .reviewFooter {
    padding-left: 86rpx;
    height: 74rpx;
    font-size: 24rpx;
    color: rgba(0, 0, 0, 0.4);
  }
````

## File: pages/feedback/feedback.js
````javascript
import { submitFeedback, uploadFeedbackImg, wxChooseImage } from '../../api/feedback/feedback';
import { timeoutTask, showWxToast, showWxLoading, hideWxLoading } from '../../utils/index';
// 投诉页面需要传userId
let btnLock = false;
Page({

  /**
   * 页面的初始数据
   */
  data: {
    txtVal: 0,
    typeList: [{
      name: "支付未到账",
      isActive: false
    }, {
      name: "误点击支付",
      isActive: false
    }, {
      name: "不明的扣款",
      isActive: false
    }, {
      name: "红包未到账",
      isActive: false
    }, {
      name: "其他原因",
      isActive: false
    }],
    activeTypeStr: "",
    desc: "",
    phone: "",
    uploaderList: [],
    uploadImgUrlList: [],
    uploaderNum: 0,
    showUpload: true,
    userId: '',
  },

  onLoad: function (options) {
    console.log(options.userId);
    this.setData({
      userId: options.userId,
    });
  },
  phoneInput: function (e) {
    this.setData({
      phone: e.detail.value
    })
  },
  descInput: function (e) {
    this.setData({
      txtVal: e.detail.value.length,
      desc: e.detail.value
    })
    if (this.data.txtVal >= 120) {
      showWxToast('问题内容不能超过120字哦!');
      this.setData({
        desc: this.data.desc.slice(0, 120)
      })
    }
  },
  chooseType(e) {
    if (e.currentTarget.dataset.active) {
      this.resetTypeList();
    } else {
      let tmpCount = this.getTypeListActiveNum();
      if (tmpCount == 0) {
        this.updateTypeList(e.currentTarget.dataset.name);
      } else {
        this.resetTypeList();
        this.updateTypeList(e.currentTarget.dataset.name);
      }
    }
  },
  getTypeListActiveNum() {
    let tmpTypeList = this.data.typeList;
    let tmpCount = 0;
    for (let i = 0; i < tmpTypeList.length; i++) {
      if (tmpTypeList[i].isActive) {
        tmpCount++;
      }
    }
    return tmpCount;
  },
  updateTypeList(name) {
    let tmpTypeList = this.data.typeList;
    for (let i = 0; i < tmpTypeList.length; i++) {
      if (tmpTypeList[i].name == name) {
        tmpTypeList[i].isActive = !tmpTypeList[i].isActive
        break;
      }
    }
    this.setData({
      typeList: tmpTypeList
    })
  },
  resetTypeList() {
    let tmpTypeList = this.data.typeList;
    for (let i = 0; i < tmpTypeList.length; i++) {
      if (tmpTypeList[i].isActive) {
        tmpTypeList[i].isActive = false;
      }
    }
    this.setData({
      typeList: tmpTypeList
    })
  },

  submit() {
    if (btnLock) {
      return;
    }
    this.setData({
      activeTypeStr: ""
    })
    let tmpActiveTypeStr = "";
    let tmpImgUrlStr = "";
    let tmpImgUrlList = this.data.uploadImgUrlList;
    let tmpImgUrlListSub = [];
    let tmpTypeList = this.data.typeList;
    for (let i = 0; i < tmpImgUrlList.length; i++) {
      tmpImgUrlListSub.push(tmpImgUrlList[i].value);
    }
    for (let i = 0; i < tmpTypeList.length; i++) {
      if (tmpTypeList[i].isActive) {
        tmpActiveTypeStr += (tmpTypeList[i].name + " ");
      }
    }
    this.setData({
      activeTypeStr: tmpActiveTypeStr
    })
    if (!this.data.activeTypeStr) {
      showWxToast('至少选择一个问题类型哦!');
      return;
    }
    if (!this.data.desc) {
      showWxToast('请填写问题描述!');
      return;
    }
    if (!this.data.phone) {
      showWxToast('请填写手机号!');
      return;
    }

    if (!(this.data.phone.length == 11)) {
      showWxToast('手机号格式不正确!');
      return;
    }
    if (tmpImgUrlListSub.length > 0) {
      tmpImgUrlStr = tmpImgUrlListSub.join(',');
    }

    console.log(this.data.desc);
    console.log(this.data.phone);
    console.log(this.data.activeTypeStr);
    console.log(tmpImgUrlStr);
    btnLock = true;
    submitFeedback({
      desc: this.data.desc,
      phone: this.data.phone,
      type: this.data.activeTypeStr,
      imgurl: tmpImgUrlStr,
    }).then((res) => {
      console.log(res);
      showWxToast('投诉信息提交成功');
      timeoutTask(() => {
        btnLock = false;
        wx.navigateBack();
      }, 1000);
    }).catch((err) => {
      console.log(err);
      btnLock = false;
      showWxToast('投诉信息提交失败');
    });
  },
  // 删除图片
  clearImg: function (e) {
    var nowList = []; //新数据

    var uploaderList = this.data.uploaderList; //原数据
    for (let i = 0; i < uploaderList.length; i++) {
      if (i == e.currentTarget.dataset.index) {
        this.deleteImgUrlByKey(uploaderList[i])
        continue;
      } else {
        nowList.push(uploaderList[i])
        continue;
      }
    }
    this.setData({
      uploaderNum: this.data.uploaderNum - 1,
      uploaderList: nowList,
      showUpload: true
    })
  },
  deleteImgUrlByKey(key) {
    let tmpImgUrlList = this.data.uploadImgUrlList;
    for (let i = 0; i < tmpImgUrlList.length; i++) {
      if (tmpImgUrlList[i].key == key) {
        tmpImgUrlList.splice(i, 1);
        break;
      }
    }
    this.setData({
      uploadImgUrlList: tmpImgUrlList
    })
  },
  //展示图片
  showImg: function (e) {
    var that = this;
    wx.previewImage({
      urls: that.data.uploaderList,
      current: that.data.uploaderList[e.currentTarget.dataset.index]
    })
  },
  //上传图片
  upload: function (e) {
    let tempFilePaths;
    wxChooseImage(this.data.uploaderNum).then((res) => {
      console.log(res);
      showWxLoading('上传图片中...');
      tempFilePaths = res.tempFilePaths;
      return uploadFeedbackImg(tempFilePaths[0]);
    }).then((res2) => {
      hideWxLoading();
      console.log(res2);
      let tmpRes = JSON.parse(res2.data);
      console.log(tmpRes.data.filePath);
      let tmpImgUrlList = this.data.uploadImgUrlList;
      let uploaderList = this.data.uploaderList.concat(tempFilePaths);
      tmpImgUrlList.push({
        key: tempFilePaths[0],
        value: tmpRes.data.filePath
      })
      if (uploaderList.length == 3) {
        this.setData({
          showUpload: false
        });
      }
      this.setData({
        uploaderList: uploaderList,
        uploaderNum: uploaderList.length,
        uploadImgUrlList: tmpImgUrlList
      })
    }).catch((err) => {
      console.log(err);
      hideWxLoading();
    })
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  }

})
````

## File: pages/feedback/feedback.json
````json
{
  "navigationBarTitleText": "反馈投诉"
}
````

## File: pages/feedback/feedback.wxml
````
<view class="container">
  <view class="complaints-form">
    <view class="type-wrap">
      <view wx:for="{{typeList}}" wx:key="index" class="type-item">
        <view class="my-radio" style="{{item.isActive?'background-image:url(https://img.hidongtv.com/hidong-wechat/complaints-tick.png)':''}}" catchtap="chooseType" data-name="{{item.name}}" data-active="{{item.isActive}}"></view>
        <view class="radio-value">{{item.name}}</view>
      </view>
    </view>
    <view class="description-wrap">
      <view class="key">问题描述</view>
      <view class="desc-wrap">
        <textarea placeholder="请填写描述以便我们提供更好的帮助" maxlength="120" bindinput="descInput" />
        <view class="numberV">{{txtVal}}/120</view>
      </view>
    </view>
    <view class="img-wrap">
      <view class="key">相关截图</view>
      <view class="panel-title">{{title}}</view>
      <view class="{{uploaderList.length === 0 ? 'ui-uploader-cell':'ui-uploader-cell-other'}}">
        <!-- 根据已选择的图片临时路径数组展示图片-->
        <view class='ui-uploader-item' wx:for="{{uploaderList}}" wx:key="index">
          <!-- 删除-->
          <icon class='ui-uploader-item-icon' bindtap='clearImg' data-index="{{index}}" type="clear" size="20" color="#666666" />
          <!-- 图片-->
          <image bindtap='showImg' data-index="{{index}}" src='{{item}}'></image>
        </view>
        <!-- 上传按钮+框 -->
        <view class='ui-uploader' bindtap='upload' wx:if="{{showUpload}}">
          +
        </view>
      </view>
    </view>
    <view class="contact-wrap">
      <view class="phone-key">联系方式</view>
      <input bindinput='phoneInput' placeholder='请输入手机号' type="number" maxlength="11" />
    </view>
    <view class="contact-way">
      <view class="phoneItem">客服电话：19512368757</view>
      <view class="phoneItem">投诉电话：400-082-2298</view>
    </view>
    <view class="submit-btn-wrap">
        <view class="btn" catchtap="submit">提交</view>
    </view>
  </view>
</view>
````

## File: pages/feedback/feedback.wxss
````
.container {
  width: 100vw;
  background-color: #fff;
  position: relative;
  overflow: hidden;
}
.complaints-form>.type-wrap>.type-item {
  margin-left: 30rpx;
  height: 88rpx;
  border-bottom: 1rpx solid #e5e5e5;
  display: flex;
  align-items: center;
}

.complaints-form>.type-wrap>.type-item>.my-radio {
  width: 46rpx;
  height: 46rpx;
  border: 2rpx solid #c9c9c9;
  border-radius: 50%;
  margin-right: 20rpx;
  background-size: 100% 100%;
}

.complaints-form>.type-wrap>.type-item>.radio-value {
  color: #000;
  font-size: 34rpx;
}

.complaints-form>.description-wrap {
  margin-top: 20rpx;
}

.complaints-form>.description-wrap>.key {
  box-sizing: border-box;
  padding-left: 29rpx;
  font-size: 34rpx;
  color: #000;
}

.complaints-form>.description-wrap>.desc-wrap {
  display: flex;
  justify-content: center;
  position: relative;
  margin-top: 20rpx;
}

.complaints-form>.description-wrap>.desc-wrap>textarea {
  width: 690rpx;
  height: 140rpx;
  outline: none;
  border-radius: 4rpx;
  border: 1rpx solid #979797;
  box-sizing: border-box;
  padding: 12rpx;
}

.complaints-form>.description-wrap>.desc-wrap>.numberV {
  position: absolute;
  right: 5vw;
  bottom: 1vw;
  font-size: 3.2vw;
}

.complaints-form>.img-wrap {
  margin-top: 20rpx;
}

.complaints-form>.img-wrap>.key {
  box-sizing: border-box;
  padding-left: 29rpx;
  font-size: 34rpx;
  color: #000;
}

.complaints-form>.img-wrap .panel-title {
  margin-bottom: 20rpx;
}

.complaints-form>.img-wrap .ui-uploader-cell-other {
  width: 690rpx;
  /* padding: 40rpx 0; */
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  margin-left: 30rpx;
}

.complaints-form>.img-wrap .ui-uploader-cell {
  width: 690rpx;
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  margin-left: 30rpx;
}

.complaints-form>.img-wrap .ui-uploader-item {
  width: 118rpx;
  height: 118rpx;
  margin-right: 18rpx;
  margin-bottom: 18rpx;
  padding-bottom: 2rpx;
  padding-right: 2rpx;
  position: relative;
}

.complaints-form>.img-wrap .ui-uploader-item-icon {
  position: absolute;
  right: 0;
}

.complaints-form>.img-wrap .ui-uploader-item image {
  width: 100%;
  height: 100%;
}

.complaints-form>.img-wrap .ui-uploader {
  width: 135rpx;
  height: 135rpx;
  margin-right: 20rpx;
  background: #efefef;
  border-radius: 4rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #878787;
  font-size: 72rpx;
}

.complaints-form>.contact-wrap {
  margin-top: 20rpx;
  display: flex;
  align-items: center;
  margin-left: 29rpx;
}

.complaints-form>.contact-wrap>.phone-key {
  font-size: 34rpx;
  color: #000;
  margin-right: 17rpx;
}

.complaints-form>.contact-wrap>input {
  outline: none;
  width: 42vw;
  height: 9vw;
  border-radius: 1.067vw;
  border: 1px solid #dedede;
  box-sizing: border-box;
  padding: 2vw;
  font-size: 4vw;
  letter-spacing: 0.2vw;
}
.complaints-form>.contact-way {
  display: flex;
  width: 100%;
  justify-content: space-around;
  padding: 32rpx 12rpx;
}

.complaints-form>.contact-way>.phoneItem {
  font-size: 3.2vw;
  color: #878787;
}

.complaints-form>.submit-btn-wrap {
  display: flex;
  justify-content: center;
  position: fixed;
  bottom: -5rpx;
  width: 100%;
}

.complaints-form>.submit-btn-wrap>.btn {
  width: 100%;
  height: 94rpx;
  background: #1aad19;
  border-radius: 10rpx;
  font-size: 4vw;
  font-weight: 700;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
}
````

## File: pages/guessHb/guessHb.js
````javascript
import { timeoutTask, showWxToast, converNumToText } from '../../utils/index';
import { wxPay } from '../../api/pay';
import {
  getGuessInfo,
  attendGuess,
  guessHbRecharge,
} from '../../api/guessHb/guessHb';

let robLock = false;
let endLoop = false;
const app = getApp();
const IDENTITYLIST = [
  {
    id: '1',
    name: '新郎',
  },
  {
    id: '2',
    name: '新娘',
  },
  {
    id: '3',
    name: '亲友',
  },
];
let DMLIST = [];
let shineIndex = 0;
let danmuIndex = 0;
Page({
  data: {
    inputVal: '', // 输入的最终值
    interArray: [], // 整数
    decimalArray: [], // 小数
    resultNum: '',
    targetVal: '', // 答案
    hbVisible: false,
    hasHbPop: false, // 限制红包每轮只弹出一次
    // 红包动画控制
    isHbOpen: false,
    isLidUpAniStart: false,
    isLidDownAniStart: false,
    isPShowAniStart: false,
    isRobBtnAniStart: false,
    // 0: 等待 1：game界面
    guessStatus: 0,
    hbId: '',
    sort: '',
    sortUnuse: '',
    sortText: '',
    guessMoney: '',
    attendNum: 0,
    remainNum: 0,
    purchaseMoney: 0,
    userId: '',
    openId: '',
    isAnnounce: false, // 是否可以揭晓
    hasPrize: false, // 是否猜中
    prizeMoney: '', // 中奖金额
    hasPrizeRounds: false, // 本轮是否有猜中的人
    rankList: [],
    rankListVisible: false,
    isFocus: false,
    gapMax: '',
    gapMin: '',
    boxShowAni: false,
    boxShow: false,
    textShowAni: false,
    iptShowAni: false,
    activeShine: '',
    shineShow: false,
    danmuAniShow: false,
    activeDanmuCt: '',
    payUser: {
      avator: '',
      identity: '',
    },
    hasClickGoOn: false,
    hasClickShow: false,
    hasAutoPopHb: false,
  },
  onLoad: function(options) {
    robLock = false;
    this.setData({
      userId: options.userId,
      openId: options.openId,
    });
    this.initGuessInfo();
  },
  onShow: function() {},
  onUnload: function() {
    endLoop = true;
  },
  robHb: function() {
    if (robLock) {
      return;
    }
    robLock = true;
    this.openHbAniStart().then(() => {
      timeoutTask(() => {
        robLock = false;
      }, 1500);
      this.setData({
        isHbOpen: true,
      });
    });
  },
  openHbAniStart() {
    return new Promise((resolve, reject) => {
      try {
        // 按钮动画开始
        this.setData({
          isRobBtnAniStart: true,
        });
        timeoutTask(() => {
          // 按钮动画结束
          this.setData({
            isRobBtnAniStart: false,
          });
          // 红包盖子打开
          this.setData({
            isLidUpAniStart: true,
          });
          resolve(1);
          timeoutTask(() => {
            // 奖项露出
            this.setData({
              isPShowAniStart: true,
            });
            // 红包盖子关闭
            this.setData({
              isLidDownAniStart: true,
            });
          }, 500);
        }, 1000);
      } catch (err) {
        reject(err);
      }
    });
  },
  handleInterDecimalInput(e) {
    const tmpInterArray = this.data.interArray;
    const tmpDecimalArray = this.data.decimalArray;
    const InterArrayLen = tmpInterArray.length;
    const DecimalArrayLen = tmpDecimalArray.length;
    for (let i = 0; i < InterArrayLen; i += 1) {
      tmpInterArray[i] = e.detail.value.charAt(i) || '';
    }
    for (let i = 0; i < DecimalArrayLen; i += 1) {
      tmpDecimalArray[i] = e.detail.value.charAt(i + InterArrayLen) || '';
    }

    this.setData({
      interArray: tmpInterArray,
      decimalArray: tmpDecimalArray,
    });
  },
  convertEmptyToZero() {
    const tmpInterArray = this.data.interArray;
    const tmpDecimalArray = this.data.decimalArray;
    const InterArrayLen = tmpInterArray.length;
    const DecimalArrayLen = tmpDecimalArray.length;
    for (let i = 0; i < InterArrayLen; i += 1) {
      if (tmpInterArray[i] === '') {
        tmpInterArray[i] = 0;
      }
    }
    for (let i = 0; i < DecimalArrayLen; i += 1) {
      if (tmpDecimalArray[i] === '') {
        tmpDecimalArray[i] = 0;
      }
    }
    this.setData({
      interArray: tmpInterArray,
      decimalArray: tmpDecimalArray,
    });
  },
  removeHeadZero() {
    let tmpResultNum = this.data.resultNum;
    tmpResultNum = '';
    let firstUnZeroInterIndex = -1; // 记录第一个非0数字的整数数组索引
    const tmpInterArray = this.data.interArray;
    const tmpDecimalArray = this.data.decimalArray;
    const InterArrayLen = tmpInterArray.length;
    const DecimalArrayLen = tmpDecimalArray.length;
    for (let i = 0; i < InterArrayLen; i += 1) {
      if (tmpInterArray[i] !== 0 && tmpInterArray[i] !== '0') {
        firstUnZeroInterIndex = i;
        break;
      }
    }
    console.log(firstUnZeroInterIndex);
    if (firstUnZeroInterIndex === -1) {
      // 整数都为0
      tmpResultNum += '0';
    } else {
      tmpResultNum += tmpInterArray
        .slice(firstUnZeroInterIndex, InterArrayLen)
        .join('');
    }
    if (tmpDecimalArray.length === 2) {
      if (tmpDecimalArray[0] !== 0 && tmpDecimalArray[1] === 0) {
        tmpResultNum += `.${tmpDecimalArray[0]}`;
      } else if (tmpDecimalArray[0] === 0 && tmpDecimalArray[1] !== 0) {
        tmpResultNum += `.0${tmpDecimalArray[1]}`;
      } else if (tmpDecimalArray[0] !== 0 && tmpDecimalArray[1] !== 0) {
        tmpResultNum += `.${tmpDecimalArray[0]}${tmpDecimalArray[1]}`;
      }
    } else if (tmpDecimalArray.length === 1) {
      if (tmpDecimalArray[0] !== 0) {
        tmpResultNum += `.${tmpDecimalArray[0]}`;
      }
    }
    this.setData({
      resultNum: tmpResultNum,
    });
  },
  Tap(e) {
    console.log(e);
    this.setData({
      isFocus: true,
    });
  },
  parseTargetVal(targetVal) {
    let tmpInterArray = [];
    let tmpDecimalArray = [];
    if (targetVal.indexOf('.') > -1) {
      tmpInterArray = targetVal.split('.')[0].split('');
      tmpDecimalArray = targetVal.split('.')[1].split('');
    } else {
      tmpInterArray = targetVal.split('');
    }
    tmpInterArray = tmpInterArray.map(() => {
      return '';
    });
    tmpDecimalArray = tmpDecimalArray.map(() => {
      return '';
    });
    this.setData({
      interArray: tmpInterArray,
      decimalArray: tmpDecimalArray,
    });
  },
  parseMyVal(myVal) {
    let tmpInterArray = [];
    let tmpDecimalArray = [];
    if (myVal.indexOf('.') > -1) {
      tmpInterArray = myVal.split('.')[0].split('');
      tmpDecimalArray = myVal.split('.')[1].split('');
    } else {
      tmpInterArray = myVal.split('');
    }
    this.setData({
      interArray: tmpInterArray,
      decimalArray: tmpDecimalArray,
    });
  },
  handleAttend() {
    // 空字符串转成0
    this.convertEmptyToZero();
    // 整数前面，小数后面去0
    this.removeHeadZero();
    if (this.data.resultNum === '0') {
      showWxToast('金额不能为0');
      return;
    }
    console.log(this.data.resultNum);
    if (robLock) {
      return;
    }
    robLock = true;
    attendGuess({
      sort: this.data.sortUnuse,
      robSort: this.data.sort,
      guessMoney: this.data.resultNum,
      hbId: this.data.hbId,
    })
      .then(res => {
        console.log(res);
        if (res.data.code === '200') {
          showWxToast('购买成功!');
          robLock = false;
          this.updateGuessInfo();
        } else if (res.data.code === '202') {
          showWxToast('已经购买过啦!');
          robLock = false;
          this.updateGuessInfo();
        } else if (res.data.code === '203') {
          showWxToast('32个名额已经没啦!等待下一轮!');
          robLock = false;
        } else if (res.data.code === '204') {
          console.log('喵币不足');
          this.recharge();
        } else if (res.data.code === '201') {
          console.log('未开始或已结束');
          robLock = false;
          showWxToast('猜红包尚未开始或已经结束!');
        } else if (res.data.code === '205') {
          robLock = false;
          showWxToast('本轮已经揭晓!等待下一轮!');
        }
      })
      .catch(err => {
        console.log(res);
        robLock = false;
      });
  },
  initGuessInfo() {
    if (robLock) {
      return;
    }
    robLock = true;
    getGuessInfo()
      .then(res => {
        console.log(res);
        robLock = false;
        if (res.data.code === '201') {
          showWxToast('猜红包尚未开始或已经结束!');
        } else if (
          res.data.code === '200' ||
          res.data.code === '202' ||
          res.data.code === '203' ||
          res.data.code === '204' ||
          res.data.code === '205'
        ) {
          let tmpPayUser = this.data.payUser;
          let tmpPayUser2 = JSON.parse(res.data.guess_data_json);
          tmpPayUser.avator = tmpPayUser2.headimgurl;
          tmpPayUser.identity = IDENTITYLIST.find(
            item => item.id === tmpPayUser2.shen_fen
          ).name;
          this.setData({
            guessStatus: 1,
            sort: res.data.rob_sort,
            sortUnuse: res.data.sort,
            sortText: converNumToText(res.data.rob_sort),
            hbId: res.data.red_package_id,
            guessMoney:
              res.data.guess_status === '0' ? '' : res.data.guess_status,
            targetVal: res.data.guess_balance,
            attendNum: res.data.CanYuSize,
            remainNum: res.data.RemainCanYuSize,
            purchaseMoney: res.data.purchase_amount_val,
            payUser: tmpPayUser,
          });
          if (res.data.guess_status === '0') {
            // 还没猜
            // 标准答案解析为整数数组和小数数组
            this.parseTargetVal(this.data.targetVal);
            this.resetBoxAni();
            this.showBoxAni();
          } else {
            // 已经猜过了
            // 自己猜的金额解析为整数数组和小数数组
            this.parseMyVal(this.data.guessMoney);
          }
          endLoop = false;
          // 轮询获取信息
          this.loopGetGuessInfo();
        }
      })
      .catch(err => {
        console.log(err);
        robLock = false;
      });
  },
  updateGuessInfo() {
    getGuessInfo()
      .then(res => {
        console.log(res);
        if (
          res.data.code === '200' ||
          res.data.code === '202' ||
          res.data.code === '203' ||
          res.data.code === '204' ||
          res.data.code === '205'
        ) {
          this.setData({
            sort: res.data.rob_sort,
            sortUnuse: res.data.sort,
            sortText: converNumToText(res.data.rob_sort),
            hbId: res.data.red_package_id,
            guessMoney:
              res.data.guess_status === '0' ? '' : res.data.guess_status,
            targetVal: res.data.guess_balance,
            attendNum: res.data.CanYuSize,
            remainNum: res.data.RemainCanYuSize,
            purchaseMoney: res.data.purchase_amount_val,
          });
          if (this.data.guessMoney === '0') {
            // 还没猜
            // 标准答案解析为整数数组和小数数组
            this.parseTargetVal(this.data.targetVal);
          } else {
            // 已经猜过了
            // 自己猜的金额解析为整数数组和小数数组
            this.parseMyVal(this.data.guessMoney);
          }
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  // 轮询获取参与者信息
  loopGetGuessInfo() {
    if (endLoop) {
      return;
    }
    getGuessInfo(true)
      .then(res => {
        console.log(res);
        if (
          res.data.code === '200' ||
          res.data.code === '202' ||
          res.data.code === '203' ||
          res.data.code === '204' ||
          res.data.code === '205'
        ) {
          if (res.data.rob_sort !== this.data.sort) {
            // 新的一轮
            this.setData({
              isLidUpAniStart: false,
              isLidDownAniStart: false,
              isPShowAniStart: false,
              isRobBtnAniStart: false,
              hasHbPop: false,
              isHbOpen: false,
              hbVisible: false,
              rankListVisible: false,
              hasClickGoOn: false,
              hasClickShow: false,
              interArray: [],
              decimalArray: [],
              hasAutoPopHb: false,
            });
            danmuIndex = 0;
            DMLIST = [];
            if (res.data.guess_status === '0') {
              // 还没猜
              // 标准答案解析为整数数组和小数数组
              this.resetBoxAni();
              this.showBoxAni();
              this.parseTargetVal(this.data.targetVal);
            } else {
              // 已经猜过了
              // 自己猜的金额解析为整数数组和小数数组
              this.parseMyVal(this.data.guessMoney);
            }
          }
          if (this.data.hasClickGoOn) {
            this.setData({
              guessMoney: '',
            });
            if (!this.data.hasClickShow) {
              this.setData({
                hasClickShow: true,
              });
              this.resetBoxAni();
              this.showBoxAni();
            }

            timeoutTask(() => {
              this.loopGetGuessInfo();
            }, 2000);
            return;
          }
          if (res.data.robRecordList) {
            console.log('showDanmuAni');
            console.log(danmuIndex);
            DMLIST = res.data.robRecordList.list.map(item => {
              let tmpName =
                item.wx_name.length > 4
                  ? item.wx_name.slice(0, 4) + '......'
                  : item.wx_name;
              return tmpName + '猜' + item.guess_money;
            });
            this.showDanmuAni();
          }
          this.setData({
            sort: res.data.rob_sort,
            sortUnuse: res.data.sort,
            sortText: converNumToText(res.data.rob_sort),
            hbId: res.data.red_package_id,
            guessMoney:
              res.data.guess_status === '0' ? '' : res.data.guess_status,
            targetVal: res.data.guess_balance,
            attendNum: res.data.CanYuSize,
            remainNum: res.data.RemainCanYuSize,
            isAnnounce: res.data.play_status === '1' ? true : false,
            purchaseMoney: res.data.purchase_amount_val,
          });

          this.gapHandle(res.data.min_max_json);
          if (res.data.code === '205') {
            if (res.data.robInfo.luckyJson[this.data.userId]) {
              // 猜中
              this.setData({
                hasPrize: true,
                prizeMoney: res.data.robInfo.luckyJson.luckyLotteryMoney,
              });
            } else {
              // 没猜中
              this.setData({
                hasPrize: false,
                prizeMoney: '',
              });
            }
            // 明细列表
            this.setData({
              rankList: res.data.robInfo.infoList,
              hasPrizeRounds: res.data.robInfo.luckyJson.lottery_size >= 1,
            });
          }
          if (this.data.isAnnounce) {
            this.autoAnnounceHb();
          }
        } else if (res.data.code === '201') {
          this.setData({
            guessStatus: 0,
            isLidUpAniStart: false,
            isLidDownAniStart: false,
            isPShowAniStart: false,
            isRobBtnAniStart: false,
            hasHbPop: false,
            isHbOpen: false,
          });
          endLoop = true;
        }
        timeoutTask(() => {
          this.loopGetGuessInfo();
        }, 2000);
      })
      .catch(err => {
        console.log(err);
        endLoop = true;
      });
  },
  recharge() {
    guessHbRecharge({
      money: this.data.purchaseMoney,
      userId: this.data.userId,
      openid: this.data.openId,
    })
      .then(res => {
        console.log(res);
        if (res.status === 'success') {
          wxPay(res)
            .then(res2 => {
              console.log(res2);
              showWxToast('充值成功!');
              robLock = false;
              app.globalData.isH5NeedRefresh = true;
              //充值完成 等待后台加喵钻逻辑完成后 去猜红包
              timeoutTask(() => {
                this.handleAttend();
              }, 500);
            })
            .catch(err => {
              console.log(err);
              robLock = false;
              showWxToast('充值失败!');
            });
        }
      })
      .catch(err => {
        console.log(err);
        reject(err);
      });
  },
  // 自动揭晓红包
  autoAnnounceHb() {
    if (this.data.hasAutoPopHb) {
      return;
    }
    this.setData({
      hasAutoPopHb: true,
    });
    if (!this.data.hasHbPop) {
      this.setData({
        hbVisible: true,
      });
    } else {
      this.setData({
        rankListVisible: true,
      });
    }
  },
  // 揭晓红包
  announceHb() {
    if (!this.data.isAnnounce) {
      showWxToast('等待揭晓！');
      return;
    }
    if (!this.data.hasHbPop) {
      this.setData({
        hbVisible: true,
      });
    } else {
      this.setData({
        rankListVisible: true,
      });
    }
  },
  // 继续参与
  contiAttend() {
    this.resetBoxAni();
    this.setData({
      rankListVisible: false,
      hbVisible: false,
      hasHbPop: true,
      hasClickGoOn: true,
    });
  },
  checkResult() {
    this.setData({
      hbVisible: false,
      hasHbPop: true,
      rankListVisible: true,
    });
  },
  closeHb() {
    this.setData({
      hbVisible: false,
      hasHbPop: true,
    });
  },
  closeRank() {
    this.setData({
      rankListVisible: false,
    });
  },
  gapHandle(gapStr) {
    if (!gapStr) {
      return;
    }
    const gapObj = JSON.parse(gapStr);
    Object.keys(gapObj).forEach(item => {
      if (
        parseInt(item.split('_')[1], 10) ===
        parseInt(this.data.sort, 10) - 1
      ) {
        if (item.split('_')[0] === 'shang') {
          this.setData({
            gapMax: gapObj[item] === '0' ? '5000' : gapObj[item],
          });
        } else if (item.split('_')[0] === 'xia') {
          this.setData({
            gapMin: gapObj[item] === '0' ? '0' : gapObj[item],
          });
        }
      }
    });
  },
  showBoxAni() {
    this.setData({
      boxShowAni: true,
    });
    timeoutTask(() => {
      this.setData({
        boxShowAni: false,
        boxShow: true,
        iptShowAni: true,
      });
      timeoutTask(() => {
        this.shineAni();
        timeoutTask(() => {
          this.setData({
            isFocus: true,
          });
        }, 2000);
      }, 500);
    }, 2000);
    timeoutTask(() => {
      this.setData({
        textShowAni: true,
      });
    }, 1000);
  },
  resetBoxAni() {
    this.setData({
      boxShowAni: false,
      boxShow: false,
      textShowAni: false,
      iptShowAni: false,
      isFocus: false,
    });
  },
  shineAni() {
    this.setData({
      shineShow: true,
    });
    timeoutTask(() => {
      this.setData({
        shineShow: false,
      });
    }, 1000);
  },
  showDanmuAni() {
    if (danmuIndex >= DMLIST.length) {
      return;
    }
    console.log(DMLIST[danmuIndex]);
    this.setData({
      activeDanmuCt: DMLIST[danmuIndex],
      danmuAniShow: true,
    });
    timeoutTask(() => {
      this.setData({
        danmuAniShow: false,
      });
      timeoutTask(() => {
        danmuIndex += 1;
        this.showDanmuAni();
      }, 1000);
    }, 3000);
  },
});
````

## File: pages/guessHb/guessHb.json
````json
{
    "navigationBarTitleText": "猜红包",
    "disableScroll": true
  }
````

## File: pages/guessHb/guessHb.wxml
````
<view class="guessHbContainer">
    <!-- 等待界面 -->
    <view class="waitMod" wx:if="{{guessStatus === 0}}">
        <view class="mainBox">
            <image src="https://static.hudongmiao.com/joymewMp/guessHb/guessHbRuleTitle.png" class="guessHbRuleTitle"></image>
            <view class="ruleList">
                <view class="ruleItem">
                    <view class="num">1.</view>
                    等待新人充值红包才可开启猜红包
                </view>
                <view class="ruleItem">
                    <view class="num">2.</view>
                    每轮参与人数最多为32名来宾
                </view>
                <view class="ruleItem">
                    <view class="num">3.</view>
                    每轮参与金额不同，越往后参与金额越高
                </view>
                <view class="ruleItem">
                    <view class="num">4.</view>
                    每轮竞猜都会显示猜中或未猜中，如本轮 未猜中会显示最接近的区间范围
                </view>
                <view class="ruleItem">
                    <view class="num">5.</view>
                    如果本轮有多名来宾猜中，将平分红包
                </view>
                <view class="ruleItem">
                    <view class="num">6.</view>
                    猜中红包直接到账您的微信零钱
                </view>
            </view>
            <view class="attendBtn" bindtap="initGuessInfo">立即参与</view>
        </view>
    </view>
    <!-- 竞猜界面 -->
    <view class="guessMod" wx:if="{{guessStatus === 1 && !guessMoney}}">
        <!-- 竞猜弹幕模块 -->
        <view class="danmuModule">
            <view class="danmu {{danmuAniShow ? 'danmuAni' : ''}}">{{activeDanmuCt}}</view>
        </view>
        <image src="{{payUser.avator}}" class="avator"></image>
        <view class="gameTip">{{payUser.identity}}邀请你竞猜红包</view>
        <view class="mainBox {{boxShowAni ? 'boxShowAni' : ''}} {{boxShow ? 'boxShow' : ''}} {{textShowAni ? 'textShowAni' : ''}} {{iptShowAni ? 'iptShowAni' : ''}}">
            <image src="https://static.joymew.com/joymewMp/guessHb/shineAni.webp" class="shineImg {{shineShow ? 'active' : ''}}" />
            <view class="roundsNum">第{{sortText}}轮</view>
            <view class="guessTip" wx:if="{{sort === '1'}}">小提示：有几个框即为几位数字</view>
            <view class="guessTip" wx:if="{{sort !== '1'}}">上一轮竞猜区间为：{{gapMin}}~{{gapMax}}</view>
            <view class="iptGroup {{interArray.length + decimalArray.length === 1 || interArray.length + decimalArray.length === 2 || interArray.length + decimalArray.length === 3 || interArray.length + decimalArray.length === 4 ? 'one': ''}} {{interArray.length + decimalArray.length === 5? 'two': ''}}" wx:if="{{!hbVisible && !rankListVisible}}">
                <input type="number" value="{{item}}" wx:for="{{interArray}}" wx:key="index" data-index="{{index}}" catchtap='Tap' disabled="{{true}}" />
                <view class="dot" wx:if="{{decimalArray.length > 0}}"></view>
                <input type="number" value="{{item}}" wx:for="{{decimalArray}}" wx:key="index" data-index="{{index}}" catchtap='Tap' disabled="{{true}}" />
            </view>
            <input class="hideIpt" focus="{{isFocus}}" bindinput="handleInterDecimalInput" maxlength="{{interArray.length + decimalArray.length}}" type="number"/>
            <view class="attendInfo">
                本轮已有
                <view class="num">{{attendNum}}</view>
                人参与，剩余
                <view class="num">{{remainNum - attendNum}}</view>
                个名额
            </view>
            <view class="attendTip">抓紧时间参与吧~</view>
            <view class="confirmBtn" bindtap="handleAttend">立即参与</view>
            <view class="price">本轮竞猜金额：{{purchaseMoney}}元</view>
        </view>
    </view>
    <!-- 竞猜结束，等待揭晓界面 -->
    <view class="guessResultWaitMod" wx:if="{{guessStatus === 1 && guessMoney}}">
        <!-- 竞猜弹幕模块 -->
        <view class="danmuModule">
            <view class="danmu {{danmuAniShow ? 'danmuAni' : ''}}">{{activeDanmuCt}}</view>
        </view>
        <image src="{{payUser.avator}}" class="avator"></image>
        <view class="gameTip">{{payUser.identity}}邀请你竞猜红包</view>
        <view class="mainBox">
            <view class="myGuessTitle">我的竞猜数字</view>
            <view class="iptGroup {{interArray.length + decimalArray.length === 1 || interArray.length + decimalArray.length === 2 || interArray.length + decimalArray.length === 3 || interArray.length + decimalArray.length === 4 ? 'one': ''}} {{interArray.length + decimalArray.length === 5? 'two': ''}}" wx:if="{{!hbVisible && !rankListVisible}}" wx:if="{{!hbVisible && !rankListVisible}}">
                <input type="number" value="{{item}}" wx:for="{{interArray}}" wx:key="index" data-index="{{index}}" disabled="{{true}}" />
                <view class="dot" wx:if="{{decimalArray.length > 0}}"></view>
                <input type="number" value="{{item}}" wx:for="{{decimalArray}}" wx:key="index" data-index="{{index}}" disabled="{{true}}" />
            </view>
            <view class="waitResultTip">竞猜结果等待主持人揭晓</view>
            <view class="attendInfo">
                已竞猜人数：
                <view class="num">{{attendNum}}/{{remainNum}}</view>
                人
            </view>
            <view class="waitOpenBtn {{isAnnounce?'active':''}}" bindtap="announceHb">
                {{isAnnounce ? '查看结果' : '等待揭晓'}}
            </view>
        </view>
    </view>
    <!-- 弹出红包模块 -->
    <view class="hbModule" wx:if="{{hbVisible}}">
        <view class="shade" bindtap="closeHb"></view>
        <view class="hbBox">
            <view class="lidArea {{isLidUpAniStart?'up':''}} {{isLidDownAniStart?'down':''}}">
                <view class="wish">大吉大利</view>
                <view class="wish2">祝您一猜就对～</view>
            </view>
            <view class="prizeArea {{isPShowAniStart?'show':'' }}">
                <view class="prized" wx:if="{{hasPrize}}">
                    <view class="guessNum">精准数字{{targetVal}}</view>
                    <view class="congratuTip">恭喜您获得竞猜红包</view>
                    <view class="money">
                        {{prizeMoney}}
                        <view class="unit">元</view>
                    </view>
                    <view class="getMoneyTip1">红包已到账您的微信零钱</view>
                    <view class="getMoneyTip2">感谢您的参与</view>
                    <view class="continueBtn" bindtap="contiAttend">继续参与</view>
                    <view class="checkDetail" bindtap="checkResult">查看竞猜结果</view>
                </view>
                <view class="unprized" wx:if="{{!hasPrize}}">
                    <view class="pityTip">很遗憾</view>
                    <view class="pityTip2">只差一点点，本轮没有猜中</view>
                    <view class="continueBtn" bindtap="contiAttend">继续参与</view>
                    <view class="checkDetail" bindtap="checkResult">查看竞猜结果</view>
                </view>
            </view>
            <view class="openBtn {{!isRobBtnAniStart?'commonActive':''}} {{isRobBtnAniStart?'active':''}}" wx:if="{{!isHbOpen}}" bindtap="robHb">
                开
            </view>
        </view>
    </view>
    <!-- 弹出竞猜结果模块 -->
    <view class="resultModule" wx:if="{{rankListVisible}}">
        <view class="shade" bindtap="closeRank"></view>
        <view class="resultBox">
            <image src="https://static.hudongmiao.com/joymewMp/guessHb/guessResultTitle.png" class="guessResultTitle"></image>
            <view class="resultTip">{{hasPrizeRounds ? '本轮红包已被猜中' : '本轮无人猜中，排名按最接近展示'}}</view>
            <view class="guessList">
                <view class="guessItem" wx:for="{{rankList}}" wx:key="index">
                    <view class="num">{{index + 1}}</view>
                    <view class="avator">
                        <image class="avatorImg" src="{{item.avator}}"></image>
                    </view>
                    <view class="nickname">{{item.wx_name}}</view>
                    <view class="guessVal">{{item.guess_money}}</view>
                    <view class="guessRt {{item.lucky_dog === '1' ? 'right' : ''}}">
                        {{item.lucky_dog === '1' ? '已猜中' : '未猜中'}}
                    </view>
                </view>
            </view>
            <view class="continueBtn" bindtap="contiAttend">继续参与</view>
        </view>
    </view>
</view>
````

## File: pages/guessHb/guessHb.wxss
````
.guessHbContainer {
  position: absolute;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/guessHbBg2.png');
  background-size: 100% 100%;
}
/* 等待界面 */
.waitMod {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
.waitMod > .mainBox {
  width: 630rpx;
  height: 1000rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/guessHbBox2.png');
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 66rpx;
}
.waitMod > .mainBox > .guessHbRuleTitle {
  width: 422rpx;
  height: 88rpx;
}
.waitMod > .mainBox > .ruleList {
  width: 528rpx;
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  line-height: 60rpx;
  margin-top: 40rpx;
}
.waitMod > .mainBox > .ruleList > .ruleItem {
  width: 100%;
  position: relative;
  padding-left: 32rpx;
}
.waitMod > .mainBox > .ruleList > .ruleItem > .num {
  position: absolute;
  left: 0rpx;
}
.waitMod > .mainBox > .attendBtn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 462rpx;
  height: 80rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/confirmBg.png');
  background-size: 100% 100%;
  margin-top: 164rpx;
  font-size: 32rpx;
  font-weight: 400;
  color: #8d592f;
}
/* 竞猜界面 */
.guessMod {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 40rpx;
}
.guessMod > .danmuModule {
  width: 100%;
  height: 16%;
  position: absolute;
  top: 0;
  left: 0;
}
.guessMod > .danmuModule > .danmu {
  border-radius: 35rpx;
  text-align: center;
  width: 237rpx;
  padding: 0 20rpx;
  height: 65rpx;
  line-height: 65rpx;
  font-size: 23rpx;
  font-weight: 400;
  color: #ffffff;
  position: absolute;
  left: -235rpx;
  top: 50rpx;
  background-color: rgba(0, 0, 0, 0.6);
}
.guessMod > .danmuModule > .danmu.danmuAni {
  animation-name: danmuShowAni;
  animation-duration: 3s;
  animation-iteration-count: 1;
  animation-timing-function: ease-in;
}
.guessMod > .avator {
  width: 138rpx;
  height: 138rpx;
  border-radius: 50%;
}
.guessMod > .gameTip {
  font-size: 36rpx;
  font-weight: 500;
  color: #ffffff;
  margin-top: 16rpx;
}
.guessMod > .mainBox {
  width: 630rpx;
  height: 1000rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/guessHbBox2.png');
  background-size: 100% 100%;
  margin-top: 28rpx;
  padding-top: 40rpx;
  transform: scale(0.4) translateY(3056rpx);
  position: relative;
}
.guessMod > .mainBox > .shineImg {
  position: absolute;
  width: 119%;
  height: 136%;
  bottom: -4%;
  left: -10%;
  opacity: 0;
}
.guessMod > .mainBox > .shineImg.active {
  opacity: 1;
}
.guessMod > .mainBox > .roundsNum {
  width: 100%;
  text-align: center;
  font-size: 48rpx;
  color: #fdf1ac;
  font-weight: 500;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox > .guessTip {
  width: 100%;
  text-align: center;
  font-size: 24rpx;
  color: #ffffff;
  margin-top: 32rpx;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox > .iptGroup {
  width: 95%;
  margin: 0 auto;
  margin-top: 60rpx;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox > .iptGroup > input {
  width: 72rpx;
  height: 72rpx;
  background-color: #ffffff;
  border: none;
  outline: none;
  font-size: 32rpx;
  font-weight: 400;
  color: #8d592f;
  text-align: center;
  margin: 0 12rpx;
}
.guessMod > .mainBox > .iptGroup.one > input {
  width: 119rpx;
  height: 119rpx;
  font-size: 72rpx;
}
.guessMod > .mainBox > .iptGroup.two > input {
  width: 88rpx;
  height: 88rpx;
  font-size: 36rpx;
}
.guessMod > .mainBox > .hideIpt {
  width: 0;
  height: 0;
}
.guessMod > .mainBox > .iptGroup > .dot {
  width: 8rpx;
  height: 8rpx;
  background: #ffffff;
  border-radius: 50%;
}
.guessMod > .mainBox > .attendInfo {
  width: 100%;
  margin-top: 114rpx;
  font-size: 28rpx;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox > .attendInfo > .num {
  font-size: 48rpx;
  color: #fdf1ac;
  margin: 0 6rpx;
}
.guessMod > .mainBox > .attendTip {
  font-size: 28rpx;
  color: #ffffff;
  margin-top: 24rpx;
  padding-left: 102rpx;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox > .confirmBtn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 462rpx;
  height: 80rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/confirmBg.png');
  background-size: 100% 100%;
  margin: 0 auto;
  margin-top: 190rpx;
  font-size: 32rpx;
  font-weight: 400;
  color: #8d592f;
  opacity: 0;
  transition: all 1s ease-out;
  position: relative;
  z-index: 1;
}
.guessMod > .mainBox > .price {
  width: 100%;
  text-align: center;
  font-size: 28rpx;
  color: #ffffff;
  font-weight: 400;
  margin-top: 26rpx;
  opacity: 0;
  transition: all 1s ease-out;
}
.guessMod > .mainBox.boxShowAni {
  animation-name: boxShowAni;
  animation-duration: 2s;
  animation-iteration-count: 1;
  animation-timing-function: ease-in;
}
.guessMod > .mainBox.textShowAni > .roundsNum {
  opacity: 1;
}
.guessMod > .mainBox.textShowAni > .guessTip {
  opacity: 1;
}
.guessMod > .mainBox.textShowAni > .attendInfo {
  opacity: 1;
}
.guessMod > .mainBox.textShowAni > .attendTip {
  opacity: 1;
}
.guessMod > .mainBox.textShowAni > .confirmBtn {
  opacity: 1;
}
.guessMod > .mainBox.textShowAni > .price {
  opacity: 1;
}
.guessMod > .mainBox.iptShowAni > .iptGroup {
  opacity: 1;
}
.guessMod > .mainBox.boxShow {
  transform: scale(1) translateY(0rpx);
}
/* 竞猜结束，等待揭晓界面 */
.guessResultWaitMod {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 40rpx;
}
.guessResultWaitMod > .danmuModule {
  width: 100%;
  height: 16%;
  position: absolute;
  top: 0;
  left: 0;
}
.guessResultWaitMod > .danmuModule > .danmu {
  border-radius: 35rpx;
  text-align: center;
  width: 237rpx;
  padding: 0 20rpx;
  height: 65rpx;
  line-height: 65rpx;
  font-size: 23rpx;
  font-weight: 400;
  color: #ffffff;
  position: absolute;
  left: -235rpx;
  top: 50rpx;
  background-color: rgba(0, 0, 0, 0.6);
}
.guessResultWaitMod > .danmuModule > .danmu.danmuAni {
  animation-name: danmuShowAni;
  animation-duration: 3s;
  animation-iteration-count: 1;
  animation-timing-function: ease-in;
}
.guessResultWaitMod > .avator {
  width: 138rpx;
  height: 138rpx;
  border-radius: 50%;
}
.guessResultWaitMod > .gameTip {
  font-size: 36rpx;
  font-weight: 500;
  color: #ffffff;
  margin-top: 16rpx;
}
.guessResultWaitMod > .mainBox {
  width: 630rpx;
  height: 1000rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/guessHbBox2.png');
  background-size: 100% 100%;
  margin-top: 28rpx;
  padding-top: 112rpx;
}
.guessResultWaitMod > .mainBox > .shineImg {
  position: absolute;
  width: 119%;
  height: 136%;
  bottom: -4%;
  left: -10%;
  opacity: 0;
}
.guessResultWaitMod > .mainBox > .shineImg.active {
  opacity: 1;
}
.guessResultWaitMod > .mainBox > .myGuessTitle {
  width: 100%;
  text-align: center;
  font-size: 48rpx;
  color: #ffffff;
}
.guessResultWaitMod > .mainBox > .iptGroup {
  width: 90%;
  margin: 0 auto;
  margin-top: 109rpx;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}
.guessResultWaitMod > .mainBox > .iptGroup.one > input {
  width: 119rpx;
  height: 119rpx;
  font-size: 72rpx;
}
.guessResultWaitMod > .mainBox > .iptGroup.two > input {
  width: 88rpx;
  height: 88rpx;
  font-size: 36rpx;
}
.guessResultWaitMod > .mainBox > .iptGroup > input {
  width: 72rpx;
  height: 72rpx;
  background-color: #ffffff;
  border: none;
  outline: none;
  font-size: 32rpx;
  font-weight: 400;
  color: #8d592f;
  text-align: center;
  margin: 0 12rpx;
}
.guessResultWaitMod > .mainBox > .iptGroup > .dot {
  width: 8rpx;
  height: 8rpx;
  background: #ffffff;
  border-radius: 50%;
}
.guessResultWaitMod > .mainBox > .waitResultTip {
  font-size: 28rpx;
  color: #ffffff;
  margin-top: 118rpx;
  width: 100%;
  text-align: center;
}
.guessResultWaitMod > .mainBox > .attendInfo {
  width: 100%;
  margin-top: 40rpx;
  font-size: 28rpx;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}
.guessResultWaitMod > .mainBox > .attendInfo > .num {
  font-size: 48rpx;
  color: #fdf1ac;
  margin: 0 6rpx;
}
.guessResultWaitMod > .mainBox > .waitOpenBtn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 462rpx;
  height: 80rpx;
  background-color: #a0a0a0;
  margin: 0 auto;
  margin-top: 158rpx;
  font-size: 32rpx;
  font-weight: 400;
  color: #ffffff;
  border-radius: 8rpx;
}
.guessResultWaitMod > .mainBox > .waitOpenBtn.active {
  background-color: #fadaab;
  color: #8d592f;
}
.guessResultWaitMod > .mainBox.boxShowAni {
  animation-name: boxShowAni;
  animation-duration: 2s;
  animation-iteration-count: 1;
  animation-timing-function: ease-in;
}
.guessResultWaitMod > .mainBox.textShowAni > .myGuessTitle {
  opacity: 1;
}
.guessResultWaitMod > .mainBox.textShowAni > .waitResultTip {
  opacity: 1;
}
.guessResultWaitMod > .mainBox.textShowAni > .attendInfo {
  opacity: 1;
}
.guessResultWaitMod > .mainBox.textShowAni > .waitOpenBtn {
  opacity: 1;
}
.guessResultWaitMod > .mainBox.iptShowAni > .iptGroup {
  opacity: 1;
}
.guessResultWaitMod > .mainBox.boxShow {
  transform: scale(1) translateY(0rpx);
}
/* 弹出红包模块 */
.hbModule {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.6);
}
.hbModule > .shade {
  position: absolute;
  width: 100%;
  height: 100%;
}
.hbModule > .hbBox {
  width: 560rpx;
  height: 734rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/hbBg.png');
  background-size: 100% 100%;
  position: absolute;
  top: 320rpx;
  perspective: 400rpx;
}
.hbModule > .hbBox > .lidArea {
  width: 560rpx;
  height: 548rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/hbLid.png');
  background-size: 100% 100%;
  transition: all linear 0.5s;
  transform: translateY(0rpx);
  z-index: 2;
  padding-top: 94rpx;
}
.hbModule > .hbBox > .lidArea.up {
  transform: translateY(-240rpx);
  z-index: 1;
}
.hbModule > .hbBox > .lidArea.down {
  transform: translateY(0rpx);
  z-index: 1;
}
.hbModule > .hbBox > .lidArea > .wish {
  width: 100%;
  text-align: center;
  font-size: 48rpx;
  font-weight: 400;
  color: #ffffff;
}
.hbModule > .hbBox > .lidArea > .wish2 {
  width: 100%;
  text-align: center;
  font-size: 48rpx;
  font-weight: 400;
  color: #ffffff;
  margin-top: 126rpx;
}
.hbModule > .hbBox > .openBtn {
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/openBtnBg.png');
  background-size: 100% 100%;
  width: 328rpx;
  height: 320rpx;
  position: absolute;
  left: 112.5rpx;
  top: 390rpx;
  font-size: 88rpx;
  font-weight: 500;
  color: #9a5804;
  padding-top: 12vw;
  z-index: 2;
  display: flex;
  justify-content: center;
}
.hbModule > .hbBox > .openBtn.active {
  animation-name: rotateY;
  animation-duration: 1s;
  animation-timing-function: ease-out;
  animation-fill-mode: forwards;
}
.hbModule > .hbBox > .openBtn.commonActive {
  animation-name: scaleAni;
  animation-duration: 2s;
  animation-timing-function: ease-out;
  animation-fill-mode: forwards;
  animation-iteration-count: infinite;
}
.hbModule > .hbBox > .prizeArea {
  width: 528rpx;
  height: 620rpx;
  position: absolute;
  top: -70rpx;
  left: 15rpx;
  z-index: 1;
  transition: all linear 0.1s;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/prizeBg.png');
  background-size: 100% 100%;
  opacity: 0;
}
.hbModule > .hbBox > .prizeArea.show {
  opacity: 1;
}
.hbModule > .hbBox > .prizeArea > .unprized {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 178rpx;
}
.hbModule > .hbBox > .prizeArea > .unprized > .pityTip {
  font-size: 56rpx;
  color: #c87a3a;
  font-weight: 500;
}
.hbModule > .hbBox > .prizeArea > .unprized > .pityTip2 {
  font-size: 36rpx;
  color: #c87a3a;
  font-weight: 500;
  margin-top: 36rpx;
}

.hbModule > .hbBox > .prizeArea > .unprized > .continueBtn {
  width: 320rpx;
  height: 68rpx;
  background: linear-gradient(90deg, #fffeec, #ffde8d 100%);
  border-radius: 54rpx;
  font-size: 36rpx;
  font-weight: 500;
  color: #ca2e1b;
  position: absolute;
  bottom: -100rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
.hbModule > .hbBox > .prizeArea > .unprized > .checkDetail {
  position: absolute;
  font-size: 28rpx;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: center;
  bottom: -155rpx;
  left: 200rpx;
  padding-bottom: 4rpx;
}
.hbModule > .hbBox > .prizeArea > .unprized > .checkDetail::after {
  content: '';
  display: block;
  width: 100%;
  height: 2px;
  background-color: #ffffff;
  position: absolute;
  bottom: 0;
}

.hbModule > .hbBox > .prizeArea > .prized {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 94rpx;
}
.hbModule > .hbBox > .prizeArea > .prized > .guessNum {
  font-size: 36rpx;
  color: #c87a3a;
  font-weight: 500;
}
.hbModule > .hbBox > .prizeArea > .prized > .congratuTip {
  font-size: 36rpx;
  color: #c87a3a;
  font-weight: 500;
  margin-top: 64rpx;
}
.hbModule > .hbBox > .prizeArea > .prized > .money {
  margin-top: 28rpx;
  font-size: 56rpx;
  color: #f61e28;
  font-weight: 500;
  display: flex;
  align-items: flex-end;
}
.hbModule > .hbBox > .prizeArea > .prized > .money > .unit {
  font-size: 36rpx;
  color: #c87a3a;
  margin-left: 6rpx;
}
.hbModule > .hbBox > .prizeArea > .prized > .getMoneyTip1 {
  font-size: 28rpx;
  font-weight: 500;
  color: #c87a3a;
  margin-top: 106rpx;
}
.hbModule > .hbBox > .prizeArea > .prized > .getMoneyTip2 {
  font-size: 28rpx;
  font-weight: 500;
  color: #c87a3a;
}
.hbModule > .hbBox > .prizeArea > .prized > .continueBtn {
  width: 320rpx;
  height: 68rpx;
  background: linear-gradient(90deg, #fffeec, #ffde8d 100%);
  border-radius: 54rpx;
  font-size: 36rpx;
  font-weight: 500;
  color: #ca2e1b;
  position: absolute;
  bottom: -100rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
.hbModule > .hbBox > .prizeArea > .prized > .checkDetail {
  position: absolute;
  font-size: 28rpx;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: center;
  bottom: -155rpx;
  left: 200rpx;
  padding-bottom: 4rpx;
}
.hbModule > .hbBox > .prizeArea > .prized > .checkDetail::after {
  content: '';
  display: block;
  width: 100%;
  height: 2px;
  background-color: #ffffff;
  position: absolute;
  bottom: 0;
}
/* 弹出竞猜结果模块 */
.resultModule {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.6);
}
.resultModule > .shade {
  position: absolute;
  width: 100%;
  height: 100%;
}
.resultModule > .resultBox {
  width: 630rpx;
  height: 1000rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/guessHb/guessHbBox2.png');
  background-size: 100% 100%;
  position: absolute;
  top: 148rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 32rpx;
}
.resultModule > .resultBox > .continueBtn {
  width: 320rpx;
  height: 68rpx;
  background: linear-gradient(90deg, #fffeec, #ffde8d 100%);
  border-radius: 54rpx;
  font-size: 36rpx;
  font-weight: 500;
  color: #ca2e1b;
  position: absolute;
  bottom: -24rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
.resultModule > .resultBox > .guessResultTitle {
  width: 140rpx;
  height: 36rpx;
}
.resultModule > .resultBox > .resultTip {
  font-size: 32rpx;
  font-weight: 400;
  color: #fdf1ac;
  margin-top: 22rpx;
}
.resultModule > .resultBox > .guessList {
  width: 100%;
  margin-top: 30rpx;
  height: 809rpx;
  overflow-y: scroll;
}
.resultModule > .resultBox > .guessList > .guessItem {
  display: flex;
  align-items: center;
  padding: 0 32rpx;
  margin-bottom: 18rpx;
}
.resultModule > .resultBox > .guessList > .guessItem > .num {
  width: 49rpx;
  font-size: 36rpx;
  font-weight: 400;
  color: #ffffff;
}
.resultModule > .resultBox > .guessList > .guessItem > .avator {
  width: 64rpx;
  height: 64rpx;
  border-radius: 50%;
  background-color: #f8d9b5;
  margin-left: 15rpx;
}
.resultModule > .resultBox > .guessList > .guessItem > .avator > .avatorImg {
  width: 100%;
  height: 100%;
  border-radius: 50%;
}
.resultModule > .resultBox > .guessList > .guessItem > .nickname {
  width: 167rpx;
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-left: 14rpx;
}
.resultModule > .resultBox > .guessList > .guessItem > .guessVal {
  width: 112rpx;
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  margin-left: 15rpx;
}
.resultModule > .resultBox > .guessList > .guessItem > .guessRt {
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  margin-left: 30rpx;
}
.resultModule > .resultBox > .guessList > .guessItem > .guessRt.right {
  color: #26e900;
}
.resultModule > .resultBox > .guessList > .guessItem.meInfo > .nickname {
  color: #fdf1ac;
}
.resultModule > .resultBox > .guessList > .guessItem.meInfo > .guessVal {
  color: #fdf1ac;
}
.resultModule > .resultBox > .guessList > .guessItem.meInfo > .guessRt {
  color: #fdf1ac;
}
@keyframes rotateY {
  0% {
    transform: rotateY(0deg) translateZ(10px);
    opacity: 1;
  }

  70% {
    transform: rotateY(720deg) translateZ(10px);
    opacity: 1;
  }

  100% {
    transform: rotateY(720deg) translateZ(-400px);
    opacity: 0;
  }
}
@keyframes scaleAni {
  0% {
    transform: scale(1);
  }

  70% {
    transform: scale(0.8);
  }

  100% {
    transform: scale(1);
  }
}
@keyframes boxShowAni {
  0% {
    transform: scale(0.4) translateY(6112.5px);
  }
  60% {
    transform: scale(0.4) translateY(120px);
  }
  100% {
    transform: scale(1) translateY(0px);
  }
}

@keyframes danmuShowAni {
  0% {
    transform: translate(0, 0);
    opacity: 1;
  }
  10% {
    transform: translate(292rpx, 0);
    opacity: 1;
  }
  80% {
    transform: translate(292rpx, 0);
    opacity: 1;
  }
  100% {
    transform: translate(292rpx, -80rpx);
    opacity: 0;
  }
}
````

## File: pages/hbkdRecharge/hbkdRecharge.js
````javascript
import { rechageHbkd, getHbkdList } from '../../api/hbkdRecharge/hbkdRecharge';
import { wxPay } from '../../api/pay';
import { sendGiftBroadCast } from '../../api/recharge/recharge';
import { timeoutTask, showWxToast } from '../../utils/index';

const app = getApp();
const rechargeLocatInfo = [
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon6.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon5.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon1.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon2.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon3.png',
  },
  {
    price: '',
    txt: '自定义金额',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon4.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon6.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon5.png',
  },
  {
    price: 0,
    txt: '充值',
    bg: 'https://static.hudongmiao.com/joymewMp/hbkdRecharge/coupon1.png',
  },
];
let requestLock = false;
Page({
  data: {
    userId: '',
    openId: '',
    remainMoney: 0,
    hbkdRechargeList: [],
    hbkdList: [],
    moneyInput: '',
    inputVisible: false,
    isFocus: false,
    prizeSize: 0,
    hbkdRemainVisible: true,
  },
  onLoad: function(options) {
    this.setData({
      userId: options.userId,
      openId: options.openId,
      remainMoney: options.remainMoney,
      hbkdRemainVisible: options.hbkdRemainVisible === 'false' ? false : true,
    });
    this.handleHbkdRechargeList(options.hbkdRechargeListStr);
    this.getHbkdList();
  },
  onShow: function() {},
  onUnload: function() {},
  handleHbkdRechargeList: function(arrStr) {
    const arr = arrStr.split(',');
    const tmpHbkdRechargeList = [];
    const len = rechargeLocatInfo.length;
    if (!arr || arr.length === 0) {
      showWxToast('参数异常!');
      timeoutTask(() => {
        wx.navigateBack();
      }, 500);
    }
    for (let i = 0; i < len; i += 1) {
      if (i <= 4) {
        tmpHbkdRechargeList.push({
          price: arr[i],
          bg: rechargeLocatInfo[i].bg,
          txt: rechargeLocatInfo[i].txt,
          isCustom: false,
        });
      } else if (i === 5) {
        tmpHbkdRechargeList.push({
          price: '土豪随意',
          bg: rechargeLocatInfo[i].bg,
          txt: rechargeLocatInfo[i].txt,
          isCustom: true,
        });
      } else {
        tmpHbkdRechargeList.push({
          price: arr[i - 1],
          bg: rechargeLocatInfo[i].bg,
          txt: rechargeLocatInfo[i].txt,
          isCustom: false,
        });
      }
    }

    this.setData({
      hbkdRechargeList: tmpHbkdRechargeList,
    });
  },
  handleTap: function(e) {
    if (e.currentTarget.dataset.custom) {
      // 自定义价格 input显现
      this.setData({
        isFocus: true,
        inputVisible: true,
      });
      console.log(e);
    } else {
      // 固定价格 input隐藏 直接调用支付
      this.setData({
        inputVisible: false,
      });
      this.pay(e.currentTarget.dataset.money);
    }
  },
  handleMoneyInput: function(e) {
    let tmpMoneyStr = e.detail.value;
    let r = /^\+?[1-9][0-9]*$/; //正整数
    let flag = r.test(tmpMoneyStr);
    if (flag || tmpMoneyStr === '0.01') {
      // 只能是正整数或者是0.01
      this.setData({
        moneyInput: tmpMoneyStr,
      });
    } else {
      this.setData({
        moneyInput: '',
      });
    }
  },
  handleMoneyBlur: function(e) {
    if (!this.data.moneyInput) {
      showWxToast('请输入或者选择充值金额!');
      return;
    }
    if (this.data.moneyInput === '0') {
      showWxToast('充值金额不能为0!');
      return;
    }
    this.pay(this.data.moneyInput);
  },
  pay: function(choosedMoney) {
    if (!requestLock) {
      requestLock = true;
      rechageHbkd({
        total: choosedMoney,
        userId: this.data.userId,
        openId: this.data.openId,
      })
        .then(res => {
          console.log(res);
          return wxPay(res);
        })
        .then(res2 => {
          console.log(res2);
          // 前端处理红包口袋余额增加
          const tmpMoney =
            parseFloat(this.data.remainMoney) + parseFloat(choosedMoney);
          this.setData({
            remainMoney: tmpMoney,
          });
          showWxToast('充值成功!');
          requestLock = false;
          app.globalData.isH5NeedRefresh = true;
          return sendGiftBroadCast({
            giftId: 'hbkd',
            content: choosedMoney,
          });
          timeoutTask(() => {
            wx.navigateBack();
          }, 500);
        })
        .catch(err => {
          console.log(err);
          showWxToast('充值失败!');
          requestLock = false;
        });
    }
  },
  getHbkdList: function() {
    getHbkdList()
      .then(res => {
        console.log('***getHbkdList***');
        console.log(res);
        const tmpList = res.data.list;
        const tmpLen = tmpList.length;
        for (let i = 0; i < tmpLen; i += 1) {
          tmpList[i].num = i + 1 < 10 ? '0' + (i + 1) : i + 1;
          tmpList[i].wx_name =
            tmpList[i].wx_name.length <= 6
              ? tmpList[i].wx_name
              : tmpList[i].wx_name.substr(0, 6) + '...';
        }
        this.setData({
          hbkdList: tmpList,
          prizeSize: tmpLen,
          remainMoney: res.data.money,
        });
      })
      .catch(err => {
        console.log(err);
      });
  },
  toAgreement: function() {
    wx.navigateTo({
      url: '/pages/agreement/agreement',
    });
  },
});
````

## File: pages/hbkdRecharge/hbkdRecharge.json
````json
{
  "navigationBarTitleText": "红包口袋",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  }
}
````

## File: pages/hbkdRecharge/hbkdRecharge.wxml
````
<view class="hbkdRechargeContainer">
    <image src="https://static.hudongmiao.com/joymewMp/hbkdRecharge/bg2-01.png" class="bg" mode="widthFix"></image>
    <view class="remainArea {{hbkdRemainVisible ? '' : 'spec'}}">
        <view class="hbkdTitle">红包口袋</view>
        <view class="remainMoney" wx:if="{{hbkdRemainVisible}}">{{remainMoney}}元</view>
        <view class="tip">
            <view>口袋内金额将用于红包雨等全场互动</view>
        </view>
    </view>
    <view class="rechargeArea">
        <view class="rechargeListWrap">
            <view class="rechargeItem" style="background-image:url('{{item.bg}}')" wx:for="{{hbkdRechargeList}}" wx:key="index" bindtap="handleTap" data-money="{{item.price}}" data-custom="{{item.isCustom}}">
                <view class="price" wx:if="{{!item.isCustom}}">{{item.price}}元</view>
                <view class="price" wx:if="{{item.isCustom && !inputVisible}}">{{item.price}}</view>
                <input type="number" maxlength="4" value="{{moneyInput}}" bindinput="handleMoneyInput" bindblur="handleMoneyBlur" wx:if="{{item.isCustom && inputVisible}}" focus="{{isFocus}}" />
                <view class="unit" wx:if="{{item.isCustom && inputVisible}}">元</view>
                <view class="tip" wx:if="{{item.isCustom && !inputVisible}}">{{item.txt}}</view>
            </view>
        </view>
    </view>
    <view class="agreement" bindtap='toAgreement'>阅读并同意《充值服务协议》</view>
    <view class="rewardSheetTitle">
        <image src="https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png" class="loveIcon"></image>
        <view class="title">{{prizeSize}}次赞赏</view>
        <image src="https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png" class="loveIcon"></image>
    </view>
    <view class="rewardSheetList">
        <view class="item" wx:for="{{hbkdList}}" wx:key="index">
            <view class="leftCt">
                <image src="https://static.hudongmiao.com/joymewMp/recharge/firstMedal.png" class="medalImg" wx:if="{{index === 0}}"></image>
                <image src="https://static.hudongmiao.com/joymewMp/recharge/secondMedal.png" class="medalImg" wx:if="{{index === 1}}"></image>
                <image src="https://static.hudongmiao.com/joymewMp/recharge/thirdMedal.png" class="medalImg" wx:if="{{index === 2}}"></image>
                <view class="num" wx:if="{{index > 2}}">{{item.num}}</view>
                <image src="{{item.avator}}" class="headImg"></image>
                <view class="name">{{item.wx_name}}</view>
            </view>
            <view class="wish">累计打赏{{item.allGold}}元</view>
        </view>
    </view>
    <!-- 反馈入口 -->
    <feedbackEntry userId="{{userId}}"></feedbackEntry>
</view>
````

## File: pages/hbkdRecharge/hbkdRecharge.wxss
````
.hbkdRechargeContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.hbkdRechargeContainer>.bg {
    position: absolute;
    width: 100%;
}

.hbkdRechargeContainer>.remainArea {
    width: 100%;
    height: 435rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/hbkdRecharge/rainbow-01.png');
    background-size: 100% 100%;
    position: absolute;
    top: 83rpx;
    color: #FFFFFF;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
}

.hbkdRechargeContainer>.remainArea>.hbkdTitle {
    font-size: 34rpx;
    font-weight: 400;
    margin-top: 73rpx;
}

.hbkdRechargeContainer>.remainArea>.remainMoney {
    font-size: 66rpx;
    font-weight: bold;
}

.hbkdRechargeContainer>.remainArea>.tip {
    font-size: 20rpx;
    font-weight: 400;
    margin-top: 5rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.hbkdRechargeContainer>.remainArea.spec>.hbkdTitle {
    font-size: 62rpx;
    margin-top: 96rpx;
}
.hbkdRechargeContainer>.remainArea.spec>.tip {
    font-size: 32rpx;
    margin-top: 27rpx;
}
.hbkdRechargeContainer>.rechargeArea {
    width: 660rpx;
    height: 746rpx;
    background: #FFFFFF;
    border-radius: 72rpx;
    position: absolute;
    top: 288rpx;
}

.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap {
    width: 100%;
    position: absolute;
    top: 191rpx;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap>.rechargeItem {
    width: 191rpx;
    height: 124rpx;
    background-size: 100% 100%;
    color: #FFFFFF;
    font-weight: 400;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 23rpx 0;
    position: relative;
}
.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap>.rechargeItem>input {
    width: 95rpx;
    height: 80rpx;
    color: #FFFFFF;
    font-size: 34rpx;
    margin-right: 25rpx;
}
.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap>.rechargeItem>.price {
    font-size: 34rpx;
    text-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
}

.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap>.rechargeItem>.tip {
    font-size: 19rpx;
}
.hbkdRechargeContainer>.rechargeArea>.rechargeListWrap>.rechargeItem>.unit {
    font-size: 32rpx;
    position: absolute;
    color: #FFFFFF;
    right: 23rpx;
}
.hbkdRechargeContainer>.rewardSheetTitle {
    display: flex;
    align-items: center;
    position: absolute;
    top: 1288rpx;
    font-size: 36rpx;
    font-weight: 500;
    color: #FFFFFF;
    top: 1137rpx;
}

.hbkdRechargeContainer>.rewardSheetTitle>.loveIcon {
    width: 30rpx;
    height: 26rpx;
    margin: 0 30rpx;
}

.hbkdRechargeContainer>.rewardSheetList {
    position: absolute;
    top: 1223rpx;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #8A1DD3;
}

.hbkdRechargeContainer>.rewardSheetList>.item {
    width: 695rpx;
    height: 114rpx;
    background: rgba(84, 59, 144, 0.3);
    border-radius: 8rpx;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 35rpx 0 28rpx;
}

.hbkdRechargeContainer>.rewardSheetList>.item>.leftCt {
    display: flex;
    align-items: center;
}

.hbkdRechargeContainer>.rewardSheetList>.item>.leftCt>.medalImg {
    width: 39rpx;
    height: 50rpx;
}

.hbkdRechargeContainer>.rewardSheetList>.item>.leftCt>.headImg {
    width: 64rpx;
    height: 64rpx;
    border-radius: 50%;
    margin: 0 22rpx 0 17rpx;
}

.hbkdRechargeContainer>.rewardSheetList>.item>.leftCt>.name {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFFF;
}

.hbkdRechargeContainer>.rewardSheetList>.item>.wish {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFF32E;
}
.hbkdRechargeContainer>.agreement {
    font-size: 24rpx;
    font-weight: 400;
    color: #FFD027;
    position: absolute;
    top: 1069rpx;
}
````

## File: pages/hbWall/hbWall.js
````javascript
import {
  timeoutTask,
  getRandom,
  showWxToast,
  showWxLoading,
  hideWxLoading,
} from '../../utils/index';
import {
  getGameState,
  sendBroadCast,
  getHbList,
  buyHb,
  hbqRecharge,
  getHbRankList,
} from '../../api/kbx/kbx';
import { wxPay } from '../../api/pay';
import defaultContent from '../../assets/constant/default';

const app = getApp();

// 礼物数组
const giftList = [
  {
    id: 1,
    gift: 'rocket1',
    name: '小号火箭',
    imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket1.png',
  },
  {
    id: 2,
    gift: 'rocket2',
    name: '中号火箭',
    imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket2.png',
  },
  {
    id: 3,
    gift: 'rocket3',
    name: '大号火箭',
    imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket3.png',
  },
];
const wishList = ['醉酒饱德，不胜感激', '美酒佳肴,不甚荣幸', '感谢招待,祝愿安康', '小小红包,感谢招待'];
let requestLock = false;
// 限制只有一个轮询存在
let tmpInterval = null; // 刚进入红包墙的轮询
let tmpInterval2 = null; // 点击开始红包墙中的轮询
let baseMoney = 0;
Page({
  data: {
    gameStatus: 1, // 红包墙状态(控制页面显示)
    myHbsVisible: false,
    isLuckyShow: false,
    luckyAni: '',
    hbs: [],
    chooseHbIds: [],
    remain: 3,
    activeGiftIndex: -1,
    gift_show: {
      //当前显示的礼物
      id: 3,
      gift: 'rocket3',
      name: '大号火箭',
      imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket3.png',
      price: 0,
    },
    userId: '',
    openId: '',
    name: '',
    headImg: '',
    isForbidBuyHbq: false,
    luckyHbs: [],
    sort: '',
    rankList1: [],
    rankList2: [],
    defaultHeadImg: defaultContent.defaultHeadImg,
  },
  onLoad: function(options) {
    requestLock = false;
    tmpInterval = null;
    tmpInterval2 = null;
    baseMoney = 0;
    this.setData({
      userId: options.userId,
      openId: options.openId,
      name: options.name,
      headImg: options.headImg,
      isForbidBuyHbq: options.isForbidBuyHbq === 'true' ? true : false,
    });
  },
  onShow: function() {
    getGameState(this.data.userId).then(res => {
      console.log(res);
      if (res.success) {
        if (res.data.status === '1') {
          if (this.data.hbs.length === 0) {
            this.getHbs();
          }
          clearInterval(tmpInterval2);
          tmpInterval2 = null;
          if (!tmpInterval) {
            // 轮询更新红包列表
            tmpInterval = setInterval(() => {
              this.updateHbs(true);
            }, 4000);
          }
        } else if (res.data.status === '2') {
          showWxToast('本轮红包墙已经结束');
          timeoutTask(() => {
            wx.navigateBack();
          }, 1500);
        }
      }
    });
  },
  onHide: function() {
    //清除定时器
    clearInterval(tmpInterval);
    clearInterval(tmpInterval2);
    tmpInterval = null;
    tmpInterval2 = null;
  },
  onUnload: function() {
    //清除定时器
    clearInterval(tmpInterval);
    clearInterval(tmpInterval2);
    tmpInterval = null;
    tmpInterval2 = null;
  },
  enterGame: function() {
    getGameState(this.data.userId)
      .then(res => {
        console.log('***获取红包墙状态***');
        console.log(res);
        if (res.success) {
          if (res.data.status === '0') {
            showWxToast('请等待大屏开启红包墙');
          } else if (res.data.status === '1') {
            // 红包墙进行中
            console.log('***获取红包列表***');
            this.getHbs();
            clearInterval(tmpInterval);
            tmpInterval = null;
            if (!tmpInterval2) {
              // 轮询更新红包列表
              tmpInterval2 = setInterval(() => {
                this.updateHbs(true);
              }, 4000);
            }
          } else if (res.data.status === '2') {
            showWxToast('本轮开红包已经结束');
            timeoutTask(() => {
              wx.navigateBack();
            }, 1500);
          } else {
            showWxToast('请等待大屏开启红包墙');
          }
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  chooseHbs: function(e) {
    const index = this.findHbIndexByHbId(e.currentTarget.dataset.id);
    const hbs = this.data.hbs;
    if (hbs[index].isOpen) {
      showWxToast('这个红包已经被拆开啦！');
      return;
    }
    if (hbs[index].isBuyed) {
      showWxToast('这个红包已经被抢走啦！');
      return;
    }
    if (hbs[index].canBuy) {
      // 如果选中 取消选中
      if (hbs[index].isChoosed) {
        hbs[index].isChoosed = false;
        this.setData({
          hbs,
        });
        this.updateGift();
        return;
      }
      // 最多3个红包 包括已经购买的
      const hasChoosedNum = this.getChoosedHbsNum(true);
      if (hasChoosedNum >= 3) {
        showWxToast('最多只能选择三个红包哦');
        return;
      }
      if (!hbs[index].isChoosed) {
        hbs[index].isChoosed = true;
        this.setData({
          hbs,
        });
        this.updateGift();
      }
    }
  },
  // 获取红包列表
  getHbs: function() {
    getHbList(false).then(res => {
      if (res.success) {
        console.log('***红包列表***');
        console.log(res);
        const tmpLen = res.data.list.length;
        const tmpHbs = [];
        let tmpNum = -1;
        let tmpState;
        let tmpIsOpen;
        let tmpIsBuyed;
        let tmpCanBuy;
        let tmpUserId;
        let tmpName;
        let tmpHeadImg;
        for (let i = 0; i < tmpLen; i += 1) {
          if (i < 3) {
            // +1
            tmpNum = i + 1;
          } else if (i < 12) {
            // +2
            tmpNum = i + 2;
          } else if (i < 21) {
            // +3
            tmpNum = i + 3;
          } else {
            // +4
            tmpNum = i + 4;
          }
          tmpIsOpen = false;
          tmpIsBuyed = false;
          tmpCanBuy = false;
          tmpState = res.data.list[i].userId;
          tmpUserId = '';
          tmpName = '';
          tmpHeadImg = '';
          if (tmpState === '0') {
            if (res.data.list[i].userInfo) {
              // 未打开已购买
              tmpIsBuyed = true;
              tmpUserId = res.data.list[i].userInfo.USER_ID;
              tmpName = res.data.list[i].userInfo.wx_name;
              tmpHeadImg = res.data.list[i].userInfo.avator;
            } else {
              // 未打开未购买
              tmpCanBuy = true;
            }
          } else if (tmpState === '100') {
            // 红包已经在大屏被拆开
            tmpIsOpen = true;
            // 且被人购买
            if (res.data.list[i].userInfo) {
              tmpIsBuyed = true;
              tmpUserId = res.data.list[i].userInfo.USER_ID;
              tmpName = res.data.list[i].userInfo.wx_name;
              tmpHeadImg = res.data.list[i].userInfo.avator;
            }
          } else {
            // 红包已经被别人购买
            tmpIsBuyed = true;
            tmpUserId = res.data.list[i].userInfo.USER_ID;
            tmpName = res.data.list[i].userInfo.wx_name;
            tmpHeadImg = res.data.list[i].userInfo.avator;
          }
          tmpHbs.push({
            id: res.data.list[i].eggId,
            gold: res.data.list[i].money,
            isOpen: tmpIsOpen,
            isBuyed: tmpIsBuyed,
            canBuy: tmpCanBuy,
            isChoosed: false,
            userId: tmpUserId,
            name: tmpName,
            headImg: tmpHeadImg,
            num: tmpNum,
          });
        }
        baseMoney = parseFloat(res.data.hbqMoney);
        this.setData({
          hbs: tmpHbs,
          gameStatus: 2,
          sort: res.data.sort,
        });
        this.updateGift();
      } else {
        showWxToast('获取红包信息失败');
      }
    });
  },
  // 更新红包列表
  updateHbs: function(cancelLoading) {
    return new Promise((resolve, reject) => {
      getHbList(cancelLoading).then(res => {
        if (res.success && res.data) {
          console.log('***红包列表***');
          console.log(res);
          if (res.data.finished === '1') {
            console.log('***结束递归***');
            clearInterval(tmpInterval2);
            clearInterval(tmpInterval);
            tmpInterval2 = null;
            tmpInterval = null;
            this.handleGameEnd();
            resolve();
            return;
          }
          const tmpLen = res.data.list.length;
          const tmpHbs = this.data.hbs;
          let tmpNum = -1;
          let tmpState;
          let tmpIsOpen;
          let tmpIsBuyed;
          let tmpCanBuy;
          let tmpUserId;
          let tmpName;
          let tmpHeadImg;
          for (let i = 0; i < tmpLen; i += 1) {
            if (i < 3) {
              // +1
              tmpNum = i + 1;
            } else if (i < 12) {
              // +2
              tmpNum = i + 2;
            } else if (i < 21) {
              // +3
              tmpNum = i + 3;
            } else {
              // +4
              tmpNum = i + 4;
            }
            tmpIsOpen = false;
            tmpIsBuyed = false;
            tmpCanBuy = false;
            tmpState = res.data.list[i].userId;
            tmpUserId = '';
            tmpName = '';
            tmpHeadImg = '';
            if (tmpState === '0') {
              if (res.data.list[i].userInfo) {
                // 未打开已购买
                tmpIsBuyed = true;
                tmpUserId = res.data.list[i].userInfo.USER_ID;
                tmpName = res.data.list[i].userInfo.wx_name;
                tmpHeadImg = res.data.list[i].userInfo.avator;
              } else {
                // 未打开未购买
                tmpCanBuy = true;
              }
            } else if (tmpState === '100') {
              tmpIsOpen = true;
              if (res.data.list[i].userInfo) {
                // 打开已购买
                tmpIsBuyed = true;
                tmpUserId = res.data.list[i].userInfo.USER_ID;
                tmpName = res.data.list[i].userInfo.wx_name;
                tmpHeadImg = res.data.list[i].userInfo.avator;
              } else {
                // 打开未购买
                // 空操作
              }
            }
            if (tmpHbs[i]) {
              tmpHbs[i].isOpen = tmpIsOpen;
              tmpHbs[i].isBuyed = tmpIsBuyed;
              tmpHbs[i].canBuy = tmpCanBuy;
              if (!tmpCanBuy && tmpHbs[i].isChoosed) {
                // 选中的红包已经不可以购买了
                tmpHbs[i].isChoosed = false;
                this.updateGift();
              }
              tmpHbs[i].userId = tmpUserId;
              tmpHbs[i].name = tmpName;
              tmpHbs[i].headImg = tmpHeadImg;
            }
          }
          this.setData({
            hbs: tmpHbs,
            sort: res.data.sort,
          });
          console.log(this.data.hbs);
          resolve();
        } else {
          reject();
        }
      });
    });
  },
  // 结束红包墙获取排行榜
  handleGameEnd: function() {
    getHbRankList()
      .then(res2 => {
        console.log('***排行榜****', res2);
        let tmpResultList = res2.data.list;
        let rankList1 = tmpResultList.slice(0, 3);
        let rankList2 = tmpResultList.slice(3, 10);
        // 红包墙已经结束
        this.setData({
          gameStatus: 3,
          rankList1,
          rankList2,
        });
      })
      .catch(err => {
        console.log(err);
      });
  },
  // 获取选择的红包数目时更新祝福列表
  updateGift: function() {
    const hasChoosedNum = this.getChoosedHbsNum(false);
    this.hbsMapGift(hasChoosedNum);
  },
  // 获取已经选择的红包id数组
  getChoosedHbIds: function() {
    const hbs = this.data.hbs;
    const len = hbs.length;
    const tmpChoosedHbIds = [];
    for (let i = 0; i < len; i += 1) {
      if (hbs[i].isChoosed) {
        tmpChoosedHbIds.push(hbs[i].id);
      }
    }
    return tmpChoosedHbIds;
  },
  // 获取选好的红包数目
  getChoosedHbsNum: function(isIncludeBuyed) {
    let tmpHbList = this.data.hbs;
    let tmpLen = tmpHbList.length;
    let tmpCount = 0;
    if (isIncludeBuyed) {
      for (let i = 0; i < tmpLen; i += 1) {
        if (
          tmpHbList[i].isChoosed ||
          tmpHbList[i].userId === this.data.userId
        ) {
          tmpCount += 1;
        }
      }
    } else {
      for (let i = 0; i < tmpLen; i += 1) {
        if (tmpHbList[i].isChoosed) {
          tmpCount += 1;
        }
      }
    }
    return tmpCount;
  },
  // 打开我的红包页面
  toMyHbs: function() {
    this.setData({
      myHbsVisible: true,
    });
  },
  // 打开红包购买页面
  toBuyHbs: function() {
    this.setData({
      myHbsVisible: false,
    });
  },
  // 红包选择个数映射礼物
  hbsMapGift: function(choosedNum) {
    const tmpMoney = baseMoney;
    giftList[0].price = tmpMoney.toFixed(2);
    giftList[1].price = (tmpMoney * 2).toFixed(2);
    giftList[2].price = (tmpMoney * 3).toFixed(2);
    if (choosedNum == 3) {
      //选了3个红包<--->大火箭
      this.setData({
        gift_show: giftList[2],
      });
    } else if (choosedNum == 2) {
      //选了2个红包<--->中火箭
      this.setData({
        gift_show: giftList[1],
      });
    } else {
      //选了1个红包或者还没有选红包<--->小火箭
      this.setData({
        gift_show: giftList[0],
      });
    }
  },
  // 通过hbId查找红包所在数组的索引
  findHbIndexByHbId: function(hbId) {
    let tmpIndex = -1;
    const tmpLen = this.data.hbs.length;
    for (let i = 0; i < tmpLen; i += 1) {
      if (this.data.hbs[i].id === hbId) {
        tmpIndex = i;
        break;
      }
    }
    return tmpIndex;
  },
  showLucky() {
    this.setData({
      luckyAni: 'showLuckyAni',
      isLuckyShow: true,
    });
    // 4s后消失
    timeoutTask(() => {
      this.setData({
        luckyAni: 'hideLuckyAni',
      });
      timeoutTask(() => {
        this.setData({
          isLuckyShow: false,
        });
      }, 100);
    }, 4000);
  },
  // 买红包
  buy: function() {
    if (this.data.isForbidBuyHbq) {
      showWxToast('您没有权限买红包!');
      return;
    }
    let choosed;
    this.updateHbs(false)
      .then(() => {
        // 获取选中的红包
        choosed = this.getChoosedHbIds();
        console.log('***choosed***');
        console.log(choosed);
        if (choosed.length == 0) {
          showWxToast('请先选一个红包');
          return;
        }
        if (requestLock) {
          return;
        }
        requestLock = true;
        const chooseIdsStr = choosed.join(',');
        return this.robHb(chooseIdsStr, this.data.sort);
      })
      .then(res => {
        console.log(res);
        if (!res) {
          return;
        }
        if (res.code === '200') {
          // 喵钻足正常抢红包
          if (res.resultList.length == 0) {
            // 一个红包都没抢到
            wx.showModal({
              showCancel: false,
              title: '温馨提示',
              content: '很遗憾您选择的红包都被抢走了\r\n已退回至您的账户中',
              confirmText: '确定',
              success: () => {
                this.updateHbs(false);
              },
            });
          } else {
            // 至少抢到了一个
            if (choosed.length > res.resultList.length) {
              wx.showModal({
                showCancel: false,
                title: '温馨提示',
                content:
                  '恭喜您,成功抢到了' +
                  res.resultList.length +
                  '个红包！ \r\n 未抢到的红包，已退回至您的账户中',
                confirmText: '确定',
                success: () => {
                  this.updateHbs(false);
                },
              });
            } else {
              wx.showModal({
                showCancel: false,
                title: '温馨提示',
                content: '恭喜您,成功抢到了' + res.resultList.length + '个红包!',
                confirmText: '确定',
                success: () => {
                  this.updateHbs(false);
                },
              });
            }
            console.log(res.resultList);
            let tmpCode = '';
            if (this.data.gift_show.id === 3) {
              tmpCode = 7002;
            } else if (this.data.gift_show.id === 2) {
              tmpCode = 6002;
            } else if (this.data.gift_show.id === 1) {
              tmpCode = 5002;
            }
            let c = JSON.stringify({
              code: tmpCode,
              param: {
                headImg: this.data.headImg,
                nickname: this.data.name,
                wish: wishList[getRandom(0, 4)],
              },
            });
            // 发送广播
            sendBroadCast({
              c,
            });
            app.globalData.isH5NeedRefresh = true;
          }
          requestLock = false;
        } else if (res.code === '304') {
          // 喵钻不足
          if (res.NeedMoney) {
            // 调起支付
            return this.recharge(res.NeedMoney);
          } else {
            showWxToast('购买失败');
          }
        } else if (res.code === '303') {
          // 用户信息异常
          showWxToast('用户信息异常');
          requestLock = false;
        } else if (res.code === '302') {
          // 一个人最多抢到3个红包
          showWxToast('一个人最多抢到3个红包');
          requestLock = false;
        } else if (res.code === '301') {
          // 不是最新的轮次
          showWxToast('不是最新的轮次');
          requestLock = false;
        } else {
          showWxToast('购买失败');
          requestLock = false;
        }
      })
      .catch(err => {
        console.log(err);
        requestLock = false;
      });
  },
  // 抢红包
  robHb: function(pHbIdStr, pSort) {
    return new Promise((resolve, reject) => {
      showWxLoading('奋力争抢中...');
      buyHb({
        hbIds: pHbIdStr,
        sort: pSort,
      })
        .then(res => {
          console.log(res);
          hideWxLoading();
          resolve(res);
        })
        .catch(err => {
          console.log(err);
          reject(err);
          hideWxLoading();
          showWxToast('抢购失败');
        });
    });
  },
  // 支付
  recharge: function(money) {
    return new Promise((resolve, reject) => {
      hbqRecharge({
        userId: this.data.userId,
        openid: this.data.openId,
        money,
      })
        .then(res => {
          console.log(res);
          if (res.status === 'success') {
            wxPay(res)
              .then(res2 => {
                console.log(res2);
                showWxToast('充值成功');
                resolve(res2);
                requestLock = false;
                app.globalData.isH5NeedRefresh = true;
                // 充值完成 等待后台加嗨币逻辑完成后 去买红包
                timeoutTask(() => {
                  this.buy();
                }, 500);
              })
              .catch(err => {
                console.log(err);
                showWxToast('充值失败');
                requestLock = false;
                reject(err);
              });
          }
        })
        .catch(err => {
          console.log(err);
          reject(err);
        });
    });
  },
  toAgreement: function() {
    wx.navigateTo({
      url: '/pages/agreement/agreement',
    });
  },
});
````

## File: pages/hbWall/hbWall.json
````json
{
    "navigationBarTitleText": "红包墙",
    "usingComponents": {
      "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
    },
    "disableScroll":true
  }
````

## File: pages/hbWall/hbWall.wxml
````
<view class="hbWallContainer">
    <view class="bgArea">
        <image src="https://static.hudongmiao.com/joymewMp/hbWall/waitBg.png" class="waitBg" mode="widthFix" wx:if="{{gameStatus === 1}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/zyz/zyzBg2.png" class="bg" mode="widthFix" wx:if="{{gameStatus === 2}}"></image>
        <image src="https://static.joymew.com/joymewMp/hbWall/rankBg.png" class="bg" mode="widthFix" wx:if="{{gameStatus === 3}}"></image>
        <image src="https://static.joymew.com/joymewMp/hbWall/shine.png" class="shine" mode="widthFix" wx:if="{{gameStatus === 3}}"></image>
        <view class="shade" wx:if="{{gameStatus === 2}}"></view>
    </view>
    <!-- 等待界面 -->
    <view class="waitContainer" wx:if="{{gameStatus === 1}}">
        <view class="ruleBox">
            <view class="title">
                <image src="https://static.hudongmiao.com/joymewMp/hbWall/cs.png" class="csImg" mode="widthFix"></image>
                <view class="text">活动规则</view>
            </view>
            <view class="ruleContent">
                <view class="para">1、只需送出弹幕礼物，免费获得一次夺取宝箱的机会；</view>
                <view class="para">2、送出小火箭：获取一个红包;送出中火箭：获取二个红包;送出大火箭：获取三个红包。</view>
                <view class="para">3、如果红包被抢完，您支付得金额将原路退回您得账户</view>
            </view>
        </view>
        <view class="startBtn" bindtap="enterGame"></view>
    </view>
    <!-- 红包墙界面 -->
    <view class="gameContainer" wx:if="{{gameStatus === 2}}">
        <view class="wall">
            <view class="hbListWrap">
                <view class="hbItem {{item.isChoosed?'choosed':''}} {{item.isOpen?'reverse':''}}" wx:for="{{hbs}}" data-id="{{item.id}}" wx:key="index" bindtap="chooseHbs">
                    <view class="FM">
                        <view class="num">{{ item.num}}</view>
                        <image src="{{item.headImg}}" class="headImg" wx-if="{{item.isBuyed}}"></image>
                    </view>
                    <view class="ZM">
                        <view class="headImgBox">
                            <image src="{{item.headImg}}" class="headImg" wx-if="{{item.isBuyed}}"></image>
                            <image src="{{defaultHeadImg}}" class="headImg" wx-if="{{!item.isBuyed}}"></image>
                        </view>
                        <view class="name" wx-if="{{item.isBuyed}}">{{item.name}}</view>
                        <view class="name" wx-if="{{!item.isBuyed}}">虚位以待</view>
                        <view class="money">￥{{item.gold}}</view>
                    </view>
                </view>
            </view>
        </view>
        <view class="agreement" bindtap='toAgreement'>阅读并同意《充值服务协议》</view>
        <!-- <view class="csTip">
            <image src="https://static.hudongmiao.com/joymewMp/hbWall/cs.png" class="csImg" mode="widthFix"></image>
            <view class="text">送出小火箭:获取一个红包;送出中火箭:获取二个红包;送出大火箭:获取三个红包。</view>
        </view> -->
        <!-- 中奖结果 -->
        <view class="luckyWrap {{luckyAni}}" wx:if="{{isLuckyShow}}">
            <view class="tit">中奖啦</view>
            <view class="congragulations">
                恭喜你! 获得
                <text>{{luckyMoney}}</text>
                元红包!
            </view>
            <view class="wechatTip">微信已实时到账</view>
            <view class="money">{{luckyMoney}}元</view>
        </view>
        <view class="giftListWrap">
            <view class="giftItem">
                <view class="fudai"></view>
                <image src="{{gift_show.imgUrl}}" class="giftImg g{{gift_show.id}}"></image>
            </view>
            <view class="money">￥{{gift_show.price}}</view>
        </view>
        <view class="startBtn">
            <view class="text" bindtap='buy'>获取红包</view>
        </view>
    </view>
    <!-- 排行榜界面 -->
    <view class="rankContainer" wx:if="{{gameStatus === 3}}">
        <view class="rankTitle">福运榜</view>
        <view class="first" wx:if="{{rankList1[0]}}">
            <view class="num">第一名</view>
            <view class="headImgBox">
                <image src="{{rankList1[0].avator}}" class="headImg"></image>
                <view class="leftDesc"></view>
                <view class="rightDesc"></view>
            </view>
            <view class="name">
                <view class="text">{{rankList1[0].wx_name}}</view>
            </view>
            <view class="money">{{rankList1[0].totalGold}}元</view>
        </view>
        <view class="topThree">
            <view class="ttItem" wx:if="{{rankList1[0]}}">
                <image src="https://static.joymew.com/joymewMp/hbWall/gold.png" class="goldImg"></image>
                <view class="headImgBox">
                    <image src="{{rankList1[0].avator}}" class="headImg"></image>
                </view>
                <view class="name">{{rankList1[0].wx_name}}</view>
                <view class="money">{{rankList1[0].totalGold}}元</view>
            </view>
            <view class="ttItem" wx:if="{{rankList1[1]}}">
                <image src="https://static.joymew.com/joymewMp/hbWall/silver.png" class="silverImg"></image>
                <view class="headImgBox">
                    <image src="{{rankList1[1].avator}}" class="headImg"></image>
                </view>
                <view class="name">{{rankList1[1].wx_name}}</view>
                <view class="money">{{rankList1[1].totalGold}}元</view>
            </view>
            <view class="ttItem" wx:if="{{rankList1[2]}}">
                <image src="https://static.joymew.com/joymewMp/hbWall/cron.png" class="cronImg"></image>
                <view class="headImgBox">
                    <image src="{{rankList1[2].avator}}" class="headImg"></image>
                </view>
                <view class="name">{{rankList1[2].wx_name}}</view>
                <view class="money">{{rankList1[2].totalGold}}元</view>
            </view>
        </view>
        <view class="otherLuckyList">
            <view class="item" wx:for="{{rankList2}}" wx:key="index">
                <view class="headImgBox">
                    <image src="{{item.avator}}" class="headImg"></image>
                    <view class="num">{{ index + 4}}</view>
                </view>
                <view class="name">
                    <view class="text">{{item.wx_name}}</view>
                </view>
                <view class="money">{{item.totalGold}}元</view>
            </view>
        </view>
    </view>
</view>
````

## File: pages/hbWall/hbWall.wxss
````
.hbWallContainer {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}

/* 公共背景区域 */
.hbWallContainer>.bgArea {
    position: absolute;
    width: 100%;
    height: 100%;
}

.hbWallContainer>.bgArea>.waitBg {
    position: absolute;
    width: 100%;
}

.hbWallContainer>.bgArea>.bg {
    position: absolute;
    width: 105%;
    height: 100%;
    position: absolute;
    left: -2%;
}

.hbWallContainer>.bgArea>.shade {
    width: 100vw;
    height: 100vh;
    opacity: 0.6;
    background-color: #000000;
    position: absolute;
    top: 0;
    left: 0;
}

.hbWallContainer>.bgArea>.shine {
    width: 595rpx;
    height: 691rpx;
    position: absolute;
    left: 78rpx;
    z-index: 1;
}

/* 等待界面 */
.hbWallContainer>.waitContainer {
    position: absolute;
    width: 100%;
    height: 100%;
}

.waitContainer>.ruleBox {
    width: 389rpx;
    height: 689rpx;
    position: absolute;
    top: 307rpx;
    left: 320rpx;
}

.waitContainer>.ruleBox>.title {
    width: 258rpx;
    height: 64rpx;
    background: #C41321;
    border-radius: 32rpx;
    position: absolute;
    left: 20rpx;
    top: -36rpx;
    display: flex;
    align-items: center;
    padding-left: 98rpx;
}

.waitContainer>.ruleBox>.title>.text {
    font-size: 30rpx;
    font-weight: normal;
    color: #7A0A0E;
    text-shadow: 0px 5rpx 5rpx rgba(132, 0, 15, 0.75);
    background: linear-gradient(0deg, #EFD178 0%, #FBF9B8 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.waitContainer>.ruleBox>.title>.csImg {
    width: 123rpx;
    height: 103rpx;
    position: absolute;
    left: -27rpx;
    top: -39rpx;
}

.waitContainer>.ruleBox>.ruleContent {
    position: absolute;
    width: 100%;
    top: 65rpx;
}

.waitContainer>.ruleBox>.ruleContent>.para {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFDA;
    width: 100%;
    margin: 20rpx 0;
    line-height: 44rpx;
}

.waitContainer>.startBtn {
    width: 390rpx;
    height: 114rpx;
    background-image: url('https://static.joymew.com/joymewMp/zyz/startBtn.png');
    background-size: 100% 100%;
    position: absolute;
    bottom: 0rpx;
    left: 322rpx;
}

/* 红包墙界面 */
.hbWallContainer>.gameContainer {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.gameContainer>.wall {
    position: absolute;
    width: 100%;
    height: 785rpx;
    top: 0rpx;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/wall.png');
    background-size: 100% 100%;
    display: flex;
    justify-content: center;
}

.gameContainer>.wall>.hbListWrap {
    width: 660rpx;
    height: 650rpx;
    position: absolute;
    top: 100rpx;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
}

.hbListWrap>.hbItem {
    position: relative;
    width: 90rpx;
    height: 131rpx;
    cursor: pointer;
}

.hbListWrap>.hbItem>.FM,
.hbListWrap>.hbItem>.ZM {
    position: absolute;
    width: 100%;
    height: 100%;
    transition: transform 0.8s ease-in-out;
    backface-visibility: hidden;
}

.hbListWrap>.hbItem>.FM {
    transform: rotateY(0deg);
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: url('https://static.hudongmiao.com/joymewMp/hbWall/hbF.png');
    background-size: 100% 100%;
}

.hbListWrap>.hbItem>.FM>.headImg {
    left: 0;
    width: 58rpx;
    height: 58rpx;
    border-radius: 50%;
    position: absolute;
    top: 25rpx;
}

.hbListWrap>.hbItem>.FM>.num {
    font-size: 28rpx;
    font-weight: bold;
    color: #EDD890;
    position: absolute;
    right: 12rpx;
    top: 6rpx;
}

.hbListWrap>.hbItem>.ZM {
    transform: rotateY(-180deg);
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: url('https://static.hudongmiao.com/joymewMp/hbWall/hbZ.png');
    background-size: 100% 100%;
}

.hbListWrap>.hbItem.reverse>.FM {
    transform: rotateY(180deg);
}

.hbListWrap>.hbItem.reverse>.ZM {
    transform: rotateY(0deg);
}

.hbListWrap>.hbItem.reverse>.ZM>.headImgBox {
    width: 61rpx;
    height: 61rpx;
    background: #650C15;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.hbListWrap>.hbItem.reverse>.ZM>.headImgBox>.headImg {
    width: 58rpx;
    height: 58rpx;
    border-radius: 50%;
}

.hbListWrap>.hbItem.reverse>.ZM>.name {
    font-size: 18rpx;
    font-weight: bold;
    color: #870F18;
    margin-top: 5rpx;
}

.hbListWrap>.hbItem.reverse>.ZM>.money {
    font-size: 18rpx;
    font-weight: bold;
    color: #870F18;
    margin-top: 5rpx;
}

.hbListWrap>.hbItem.choosed {
    transform: translateY(-40rpx) scale(1.1);
    z-index: 1;
}

.gameContainer>.agreement {
    font-size: 24rpx;
    font-weight: 400;
    color: #ffffff;
    position: absolute;
    bottom: 150rpx;
}

.gameContainer>.csTip {
    position: absolute;
    top: 824rpx;
    width: 584rpx;
    height: 78rpx;
    background: rgba(255, 238, 202, 0);
    border: 2rpx solid #D16239;
    border-radius: 10rpx;
    display: flex;
    align-items: center;
}

.gameContainer>.csTip>.csImg {
    width: 144rpx;
    position: absolute;
    top: -43rpx;
    left: -82rpx;
}

.gameContainer>.csTip>.text {
    font-size: 24rpx;
    font-weight: normal;
    color: #D96744;
    padding-left: 63rpx;
}

.gameContainer>.luckyWrap {
    width: 548rpx;
    height: 607rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: absolute;
    top: 176rpx;
    left: 85rpx;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/result.png');
    background-size: 100% 100%;
}

.gameContainer>.luckyWrap>.tit {
    font-size: 60rpx;
    font-weight: 400;
    color: #D5261D;
    -webkit-text-stroke: 1px #D32F10;
    text-stroke: 1px #D32F10;
    position: absolute;
    top: 85rpx;
}

.gameContainer>.luckyWrap>.congragulations {
    font-size: 30rpx;
    font-weight: 400;
    color: #5E493D;
    position: absolute;
    top: 188rpx;
}

.gameContainer>.luckyWrap>.congragulations>text {
    color: #D5261D;
    font-size: 48rpx;
}

.gameContainer>.luckyWrap>.wechatTip {
    font-size: 24rpx;
    font-weight: normal;
    color: #8C7E77;
    position: absolute;
    top: 251rpx;
}

.gameContainer>.luckyWrap>.money {
    font-size: 36rpx;
    font-weight: 400;
    color: #FBA140;
    position: absolute;
    bottom: 105rpx;
}

.showLuckyAni {
    animation: zoomIn 0.1s linear;
}

.hideLuckyAni {
    animation: zoomOut 0.1s linear;
}

@keyframes zoomIn {
    from {
        opacity: 0;
        -webkit-transform: scale3d(0.3, 0.3, 0.3);
        transform: scale3d(0.3, 0.3, 0.3);
    }

    50% {
        opacity: 1;
    }
}

@keyframes zoomOut {
    from {
        opacity: 1;
    }

    50% {
        opacity: 0;
        -webkit-transform: scale3d(0.3, 0.3, 0.3);
        transform: scale3d(0.3, 0.3, 0.3);
    }

    to {
        opacity: 0;
    }
}

.gameContainer>.giftListWrap {
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 826rpx;
}

.gameContainer>.giftListWrap>.giftItem {
    width: 135rpx;
    height: 158rpx;
    position: relative;
    display: flex;
    justify-content: center;
    opacity: 1;
}

.gameContainer>.giftListWrap>.giftItem>.fudai {
    width: 100%;
    height: 100%;
    position: absolute;
    background-image: url('https://static.joymew.com/joymewMp/zyz/fd1.png');
    background-size: 100% 100%;
}

.gameContainer>.giftListWrap>.giftItem>.giftImg {
    position: absolute;
    top: 41rpx;
}

.gameContainer>.giftListWrap>.giftItem>.giftImg.g1 {
    width: 45rpx;
    height: 108rpx;
}

.gameContainer>.giftListWrap>.giftItem>.giftImg.g2 {
    width: 38rpx;
    height: 109rpx;
}

.gameContainer>.giftListWrap>.giftItem>.giftImg.g3 {
    width: 43rpx;
    height: 110rpx;
}

.gameContainer>.giftListWrap>.money {
    font-size: 48rpx;
    font-weight: bold;
    color: #EDD890;
    position: relative;
}

.gameContainer>.startBtn {
    width: 390rpx;
    height: 114rpx;
    background-image: url('https://static.joymew.com/joymewMp/zyz/startBtn2.png');
    background-size: 100% 100%;
    position: absolute;
    bottom: 0rpx;
    display: flex;
    justify-content: center;
    align-items: center;
}

.gameContainer>.startBtn>.text {
    position: absolute;
    top: 19rpx;
    font-size: 48rpx;
    font-weight: 400;
    color: #C14532;
    background: linear-gradient(177deg, #FCD58E 0%, #F8A65D 99.31640625%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hbWallContainer>.myHbs {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.hbWallContainer>.myHbs>.myHbTitle {
    font-size: 38rpx;
    font-weight: normal;
    color: #7A0A0E;
    text-shadow: 0px 5rpx 5rpx rgba(132, 0, 15, 0.75);
    background: linear-gradient(0deg, #EFD178 0%, #FBF9B8 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    top: 211rpx;
    letter-spacing: 16rpx;
}

.hbWallContainer>.myHbs>.myHbList {
    display: flex;
    width: 80%;
    position: absolute;
    top: 358rpx;
    justify-content: space-around;
}

.myHbList>.hbItem {
    position: relative;
    width: 90rpx;
    height: 131rpx;
    cursor: pointer;
}

.myHbList>.hbItem>.FM,
.myHbList>.hbItem>.ZM {
    position: absolute;
    width: 100%;
    height: 100%;
    transition: transform 0.8s ease-in-out;
    backface-visibility: hidden;
}

.myHbList>.hbItem>.FM {
    transform: rotateY(0deg);
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: url('https://static.hudongmiao.com/joymewMp/hbWall/hbF.png');
    background-size: 100% 100%;
}

.myHbList>.hbItem>.FM>.num {
    font-size: 28rpx;
    font-weight: bold;
    color: #EDD890;
    position: absolute;
    right: 12rpx;
    top: 6rpx;
}

.myHbList>.hbItem>.ZM {
    transform: rotateY(-180deg);
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: url('https://static.hudongmiao.com/joymewMp/hbWall/hbZ.png');
    background-size: 100% 100%;
    padding-top: 8rpx;
}

.myHbList>.hbItem>.ZM>.headImgBox {
    width: 61rpx;
    height: 61rpx;
    background: #650C15;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.myHbList>.hbItem>.ZM>.headImgBox>.headImg {
    width: 58rpx;
    height: 58rpx;
    border-radius: 50%;
}

.myHbList>.hbItem>.ZM>.name {
    font-size: 18rpx;
    font-weight: bold;
    color: #870F18;
    margin-top: 5rpx;
}

.myHbList>.hbItem>.ZM>.money {
    font-size: 18rpx;
    font-weight: bold;
    color: #870F18;
    margin-top: 5rpx;
}

.myHbList>.hbItem.reverse>.FM {
    transform: rotateY(180deg);
}

.myHbList>.hbItem.reverse>.ZM {
    transform: rotateY(0deg);
}

.myHbList>.hbItem.choosed {
    transform: translate3d(0rpx, -11rpx, 100rpx);
}

.myHbs>.recordList {
    width: 702rpx;
    position: absolute;
    top: 570rpx;
}

.recordList>.recordItem {
    position: relative;
    width: 100%;
    height: 130rpx;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/jx.png');
    background-size: 100% 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-right: 88rpx;
    padding-left: 48rpx;
}

.recordList>.recordItem>.name {
    font-size: 29rpx;
    font-weight: 400;
    color: #FFC683;
}

.recordList>.recordItem>.result {
    font-size: 29rpx;
    font-weight: 400;
    color: #FC2C3D;
    text-shadow: 3rpx 5rpx 9rpx #E13120;
    background: linear-gradient(0deg, #FFFBC6 0%, #FFFFFF 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.myHbs>.backBtn {
    width: 390rpx;
    height: 114rpx;
    background-image: url('https://static.joymew.com/joymewMp/zyz/startBtn2.png');
    background-size: 100% 100%;
    position: absolute;
    bottom: 0rpx;
    display: flex;
    justify-content: center;
    align-items: center;
}

.myHbs>.backBtn>.text {
    position: absolute;
    top: 19rpx;
    font-size: 48rpx;
    font-weight: 400;
    color: #C14532;
    background: linear-gradient(177deg, #FCD58E 0%, #F8A65D 99.31640625%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

@keyframes scaleAni {

    0%,
    100% {
        transform: scale(1.1);
    }

    50% {
        transform: scale(1.3);
    }
}

.rankContainer {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.rankContainer>.rankTitle {
    font-size: 62rpx;
    font-weight: normal;
    color: #7A0A0E;
    text-shadow: 0px 5rpx 5rpx rgba(132, 0, 15, 0.75);
    background: linear-gradient(0deg, #EFD178 0%, #FBF9B8 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    top: 199rpx;
    letter-spacing: 16rpx;
}

.rankContainer>.first {
    width: 349rpx;
    height: 409rpx;
    position: absolute;
    top: 190rpx;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/firstBg.png');
    background-size: 100% 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.rankContainer>.first>.num {
    font-size: 28rpx;
    font-weight: 400;
    color: #fc2c3d;
    text-shadow: 3rpx 5rpx 9rpx #e13120;
    background: linear-gradient(0deg, #fffbc6 0%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    top: 54rpx;
}

.rankContainer>.first>.headImgBox {
    position: absolute;
    width: 108rpx;
    height: 108rpx;
    background: #fff0ce;
    border: 4rpx solid;
    border-image: linear-gradient(3deg, #d16f39, #fff1ae, #d16f39) 4 4;
    transform: rotate(45deg);
    top: 123rpx;
}

.rankContainer>.first>.headImgBox>.headImg {
    width: 106rpx;
    height: 103rpx;
    position: absolute;
    top: -2rpx;
    left: -1rpx;
}

.rankContainer>.first>.headImgBox>.leftDesc {
    position: absolute;
    width: 36rpx;
    height: 36rpx;
    background: rgba(255, 240, 206, 0);
    border: 4rpx solid;
    border-image: linear-gradient(3deg, #d16f39, #fff1ae, #d16f39) 4 4;
    left: -17rpx;
    top: 86rpx;
}

.rankContainer>.first>.headImgBox>.rightDesc {
    position: absolute;
    width: 36rpx;
    height: 36rpx;
    background: rgba(255, 240, 206, 0);
    border: 4rpx solid;
    border-image: linear-gradient(3deg, #d16f39, #fff1ae, #d16f39) 4 4;
    right: -19rpx;
    top: -21rpx;
}

.rankContainer>.first>.name {
    position: absolute;
    top: 248rpx;
    width: 212rpx;
    height: 88rpx;
    font-size: 30rpx;
    font-weight: 400;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/nameBox.png');
    background-size: 100% 100%;
    color: #ffc683;
    text-shadow: #b53b48 1rpx 0 0, #b53b48 0 1rpx 0, #b53b48 -1rpx 0 0, #b53b48 0 -1rpx 0, #b53b48 2rpx 0 0, #b53b48 0 2rpx 0,
        #b53b48 -2rpx 0 0, #b53b48 0 -2rpx 0, #b53b48 3rpx 0 0, #b53b48 0 3rpx 0, #b53b48 -3rpx 0 0, #b53b48 0 -3rpx 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

.rankContainer>.first>.name>.text {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rankContainer>.first>.money {
    font-size: 36rpx;
    font-weight: 400;
    color: #fc2c3d;
    text-shadow: 3rpx 5rpx 9rpx #e13120;
    background: linear-gradient(0deg, #fffbc6 0%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    top: 325rpx;
}

.rankContainer>.topThree {
    width: 702rpx;
    height: 360rpx;
    position: absolute;
    top: 597rpx;
}

.rankContainer>.topThree>.ttItem {
    position: relative;
    width: 100%;
    height: 130rpx;
    background-image: url('https://static.joymew.com/joymewMp/hbWall/jx.png');
    background-size: 100% 100%;
    display: flex;
    align-items: center;
}

.rankContainer>.topThree>.ttItem>.goldImg {
    width: 86rpx;
    height: 75rpx;
    position: absolute;
    left: 59rpx;
}

.rankContainer>.topThree>.ttItem>.silverImg {
    width: 84rpx;
    height: 76rpx;
    position: absolute;
    left: 59rpx;
}

.rankContainer>.topThree>.ttItem>.cronImg {
    width: 83rpx;
    height: 82rpx;
    position: absolute;
    left: 59rpx;
}

.rankContainer>.topThree>.ttItem>.headImgBox {
    width: 83rpx;
    height: 83rpx;
    background: #fff0ce;
    border: 4rpx solid;
    border-image: linear-gradient(3deg, #d16f39, #fff1ae, #d16f39) 4 4;
    position: absolute;
    left: 173rpx;
}

.rankContainer>.topThree>.ttItem>.headImgBox>.headImg {
    width: 79rpx;
    height: 79rpx;
}

.rankContainer>.topThree>.ttItem>.name {
    font-size: 29rpx;
    font-weight: 400;
    color: #ffc683;
    text-shadow: #b53b48 1rpx 0 0, #b53b48 0 1rpx 0, #b53b48 -1rpx 0 0, #b53b48 0 -1rpx 0, #b53b48 2rpx 0 0, #b53b48 0 2rpx 0,
        #b53b48 -2rpx 0 0, #b53b48 0 -2rpx 0, #b53b48 3rpx 0 0, #b53b48 0 3rpx 0, #b53b48 -3rpx 0 0, #b53b48 0 -3rpx 0;
    position: absolute;
    left: 301rpx;
    width: 174rpx;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rankContainer>.topThree>.ttItem>.money {
    font-size: 29rpx;
    font-weight: 400;
    color: #fc2c3d;
    text-shadow: 3rpx 5rpx 9rpx #e13120;
    background: linear-gradient(0deg, #fffbc6 0%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    left: 491rpx;
    width: 171rpx;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.rankContainer>.otherLuckyList {
    position: absolute;
    top: 1002rpx;
    width: 100%;
    display: flex;
    justify-content: space-around;
}

.rankContainer>.otherLuckyList>.item {
    width: 93rpx;
    flex-direction: column;
    position: relative;
    display: flex;
    align-items: center;
}

.rankContainer>.otherLuckyList>.item>.headImgBox {
    width: 80rpx;
    height: 80rpx;
    border-radius: 50%;
}

.rankContainer>.otherLuckyList>.item>.headImgBox>.headImg {
    width: 100%;
    height: 100%;
    border-radius: 50%;
}

.rankContainer>.otherLuckyList>.item>.headImgBox>.num {
    width: 34rpx;
    height: 34rpx;
    background: #682b1f;
    border-image: linear-gradient(125deg, #b24816, #762e22) 2 2;
    border-radius: 50%;
    font-size: 30rpx;
    font-weight: normal;
    color: #fded9e;
    position: absolute;
    left: -2rpx;
    top: -2rpx;
}

.rankContainer>.otherLuckyList>.item>.name {
    width: 90rpx;
    margin-top: 4rpx;
}

.rankContainer>.otherLuckyList>.item>.name>.text {
    color: #fee4de;
    font-size: 26rpx;
    font-weight: normal;
    background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 90rpx;
    white-space: nowrap;
    text-align: center;
}

.rankContainer>.otherLuckyList>.item>.money {
    font-size: 30rpx;
    font-weight: normal;
    color: #fded9e;
    white-space: nowrap;
}

@media screen and (min-height: 720px) {
    .gameContainer>.wall {
        top: 93rpx;
    }

    .gameContainer>.csTip {
        top: 957rpx;
    }

    .gameContainer>.giftListWrap {
        top: 1086rpx;
    }

    .gameContainer>.dec01 {
        top: 619rpx;
    }
}
````

## File: pages/hotelReserve/couponDetail/couponDetail.js
````javascript
import { getToken, getLiveId, setLiveId } from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: ' 优惠详情',
    token: ''
  },
  onLoad: function (options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      app.setH5Url(`${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}#/couponDetail`);
    } else {
      app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/couponDetail`);
    }
    console.log(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/couponDetail`);
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: ` 优惠详情(${app.globalData.activityTitle})`
    });
  },
  onShow: function () {
  },
  onShareAppMessage: function () {
    return {
      title: this.data.activityTitle,
      path: `/pages/couponDetail/couponDetail?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
})
````

## File: pages/hotelReserve/couponDetail/couponDetail.json
````json
{
    "navigationBarTitleText": "优惠详情"
  }
````

## File: pages/hotelReserve/couponDetail/couponDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/hotelReserve/couponDetail/couponDetail.wxss
````
page {
    background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/hotelReserve/hotelDetail/hotelDetail.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
import browseRecord from '../../../utils/browseRecord';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '宴会厅',
    token: '',
  },
  onLoad: function(options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/hotelDetail';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/hotelDetail';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `宴会厅(${app.globalData.activityTitle})`,
    });
    browseRecord.enterPage('2');
  },
  onShow: function() {},
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: `/pages/hotelDetail/hotelDetail?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
  handleMessage(e) {
    console.log(e.detail.data);
    const tmpMsgList = e.detail.data;
    const tmpLen = tmpMsgList.length;
    if (tmpLen > 0) {
      console.log(tmpMsgList[tmpLen - 1]);
      browseRecord.leavePage(tmpMsgList[tmpLen - 1]);
    }
  },
});
````

## File: pages/hotelReserve/hotelDetail/hotelDetail.json
````json
{
    "navigationBarTitleText": "宴会厅"
  }
````

## File: pages/hotelReserve/hotelDetail/hotelDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}" bindmessage="handleMessage"></web-view>
````

## File: pages/hotelReserve/hotelDetail/hotelDetail.wxss
````
page {
    background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
  }
````

## File: pages/hotelReserve/hotelReserve.js
````javascript
import { getToken, getLiveId, setLiveId, getIsHlt } from '../../utils/storage';
import { getCurrentTimestamp } from '../../utils/date';
import { PAGE_HOST } from '../../assets/constant/host';
import browseRecord from '../../utils/browseRecord';

const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '婚宴预定',
    token: '',
    bottomLift: 0,
  },
  onLoad: function(options) {    
    this.setData({
      bottomLift: app.globalData.bottomLift
    })
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&bottom=${this.data.bottomLift}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/hotelReserve';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&bottom=${this.data.bottomLift}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/hotelReserve';
      app.setH5Url(staicUrl + variableUrl);
    }
    console.log(app.globalData.h5Url);
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `婚宴预定(${app.globalData.activityTitle})`,
    });
    browseRecord.enterPage('1');
  },
  onShow: function() {},
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: `/pages/hotelReserve/hotelReserve?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
  handleMessage(e) {
    console.log(e.detail.data);
    const tmpMsgList = e.detail.data;
    const tmpLen = tmpMsgList.length;
    if (tmpLen > 0) {
      console.log(tmpMsgList[tmpLen - 1]);
      browseRecord.leavePage(tmpMsgList[tmpLen - 1]);
    }
  },
});
````

## File: pages/hotelReserve/hotelReserve.json
````json
{
  "navigationBarTitleText": "婚宴预定"
}
````

## File: pages/hotelReserve/hotelReserve.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}" bindmessage="handleMessage"></web-view>
````

## File: pages/hotelReserve/hotelReserve.wxss
````
page {
  background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/hotelReserve/menuDetail/menuDetail.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
import browseRecord from '../../../utils/browseRecord';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '婚宴菜单',
    token: '',
  },
  onLoad: function(options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/menuDetail';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/menuDetail';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `婚宴菜单(${app.globalData.activityTitle})`,
    });
    browseRecord.enterPage('3');
  },
  onShow: function() {},
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: `/pages/menuDetail/menuDetail?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
  handleMessage(e) {
    console.log(e.detail.data);
    const tmpMsgList = e.detail.data;
    const tmpLen = tmpMsgList.length;
    if (tmpLen > 0) {
      console.log(tmpMsgList[tmpLen - 1]);
      browseRecord.leavePage(tmpMsgList[tmpLen - 1]);
    }
  },
});
````

## File: pages/hotelReserve/menuDetail/menuDetail.json
````json
{
    "navigationBarTitleText": "婚宴菜单"
  }
````

## File: pages/hotelReserve/menuDetail/menuDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}" bindmessage="handleMessage"></web-view>
````

## File: pages/hotelReserve/menuDetail/menuDetail.wxss
````
page {
    background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
import browseRecord from '../../../utils/browseRecord';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '精选单品',
    token: '',
  },
  onLoad: function(options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/msWeddingDressDetail';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/msWeddingDressDetail';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `精选单品(${app.globalData.activityTitle})`,
    });
    browseRecord.enterPage('3');
  },
  onShow: function() {},
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: `/pages/msWeddingDressDetail/msWeddingDressDetail?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
  handleMessage(e) {
    console.log(e.detail.data);
    const tmpMsgList = e.detail.data;
    const tmpLen = tmpMsgList.length;
    if (tmpLen > 0) {
      console.log(tmpMsgList[tmpLen - 1]);
      browseRecord.leavePage(tmpMsgList[tmpLen - 1]);
    }
  },
});
````

## File: pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.json
````json
{
    "navigationBarTitleText": "精选单品"
  }
````

## File: pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}" bindmessage="handleMessage"></web-view>
````

## File: pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail.wxss
````
page {
    background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/hotelReserve/myPreferential/myPreferential.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
const app = getApp();
Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '优惠活动',
    token: '',
    bottomLift: 0,
  },
  onLoad: function(options) {
    this.setData({
      bottomLift: app.globalData.bottomLift
    })
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&bottom=${this.data.bottomLift}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/myPreferential';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&bottom=${this.data.bottomLift}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/myPreferential';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `奖品详情`,
    });
  },
  onShow: function() {},
});
````

## File: pages/hotelReserve/myPreferential/myPreferential.json
````json
{
  "navigationBarTitleText": "我的优惠"
}
````

## File: pages/hotelReserve/myPreferential/myPreferential.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/hotelReserve/myPreferential/myPreferential.wxss
````
/* pages/hotelReserve/myPreferential/myPreferential.wxss */
````

## File: pages/hotelReserve/packageDetail/packageDetail.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
import browseRecord from '../../../utils/browseRecord';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '优惠活动',
    token: '',
  },
  onLoad: function(options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/packageDetail';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/packageDetail';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `优惠活动(${app.globalData.activityTitle})`,
    });
    browseRecord.enterPage('2');
  },
  onShow: function() {},
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: `/pages/packageDetail/packageDetail?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
  handleMessage(e) {
    console.log(e.detail.data);
    const tmpMsgList = e.detail.data;
    const tmpLen = tmpMsgList.length;
    if (tmpLen > 0) {
      console.log(tmpMsgList[tmpLen - 1]);
      browseRecord.leavePage(tmpMsgList[tmpLen - 1]);
    }
  },
});
````

## File: pages/hotelReserve/packageDetail/packageDetail.json
````json
{
    "navigationBarTitleText": "优惠活动"
  }
````

## File: pages/hotelReserve/packageDetail/packageDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}" bindmessage="handleMessage"></web-view>
````

## File: pages/hotelReserve/packageDetail/packageDetail.wxss
````
page {
    background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/hotelReserve/preferentialDetail/preferentialDetail.js
````javascript
import {
  getToken,
  getLiveId,
  setLiveId,
  getIsHlt,
} from '../../../utils/storage';
import { getCurrentTimestamp } from '../../../utils/date';
import { PAGE_HOST } from '../../../assets/constant/host';
const app = getApp();
Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '优惠活动',
    token: '',
  },
  onLoad: function(options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      const staicUrl = `${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/preferentialDetail';
      app.setH5Url(staicUrl + variableUrl);
    } else {
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = '';
      const tmpIsHlt = getIsHlt();
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      variableUrl += '#/preferentialDetail';
      app.setH5Url(staicUrl + variableUrl);
    }
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `我的优惠`,
    });
  },
  onShow: function() {},
});
````

## File: pages/hotelReserve/preferentialDetail/preferentialDetail.json
````json
{
  "navigationBarTitleText": "奖品详情"
}
````

## File: pages/hotelReserve/preferentialDetail/preferentialDetail.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/hotelReserve/preferentialDetail/preferentialDetail.wxss
````
/* pages/hotelReserve/preferentialDetail/preferentialDetail.wxss */
````

## File: pages/index/index.json
````json
{
    "navigationBarTitleText": " 嗨喵互动",
    "backgroundColor": "#305068",
    "disableScroll": false
}
````

## File: pages/kbx/kbx.js
````javascript
import { getGameState, sendBroadCast, getBoxesList, robBox, kbxRecharge, getMyBoxes } from '../../api/kbx/kbx';
import { wxPay } from '../../api/pay';
import { timeoutTask, getRandom, showWxToast, showWxLoading, hideWxLoading } from '../../utils/index';

const app = getApp();
const BX = [
    {
        num: '01',
        left: 129,
        top: 168,
    }, {
        num: '02',
        left: 281,
        top: 168,
    }, {
        num: '03',
        left: 444,
        top: 168,
    }, {
        num: '05',
        left: 62,
        top: 330,
    }, {
        num: '06',
        left: 213,
        top: 330,
    }, {
        num: '07',
        left: 365,
        top: 330,
    }, {
        num: '08',
        left: 521,
        top: 330,
    }, {
        num: '09',
        left: 37,
        top: 508,
    }, {
        num: '10',
        left: 201,
        top: 508,
    }, {
        num: '11',
        left: 364,
        top: 508,
    }, {
        num: '12',
        left: 521,
        top: 508,
    }, {
        num: '13',
        left: 42,
        top: 662,
    }, {
        num: '15',
        left: 206,
        top: 662,
    }, {
        num: '16',
        left: 360,
        top: 662,
    }, {
        num: '17',
        left: 526,
        top: 662,
    }, {
        num: '18',
        left: 117,
        top: 814,
    }, {
        num: '19',
        left: 279,
        top: 814,
    }, {
        num: '20',
        left: 444,
        top: 814,
    },
];
const giftList = [
    {
        id: 1,
        gift: 'rocket1',
        name: '小号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket1.png',
    }, {
        id: 2,
        gift: 'rocket2',
        name: '中号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket2.png',
    }, {
        id: 3,
        gift: 'rocket3',
        name: '大号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket3.png',
    }
];
const wishList = [
    '醉酒饱德，不胜感激',
    '美酒佳肴,不甚荣幸',
    '感谢招待,祝愿安康',
    '小小红包,感谢招待'
];
let requestLock = false;
Page({
    data: {
        gameStatus: 1, // 开宝箱状态(控制页面显示)
        myBoxesVisible: false,
        boxes: [],
        chooseBoxIds: [],
        remain: 3,
        money: 0,
        gift_show: { //当前显示的礼物
            id: 3,
            gift: 'rocket3',
            name: '大号火箭',
            imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket3.png',
            price: 0,
        },
        userId: '',
        openId: '',
        name: '',
        headImg: '',
        isForbidBuyHbq: false,
        luckyBoxes: [],
    },
    onLoad: function (options) {
        requestLock = false;
        this.setData({
            userId: options.userId,
            openId: options.openId,
            name: options.name,
            headImg: options.headImg,
            isForbidBuyHbq: options.isForbidBuyHbq === 'true' ? true : false,
        });
        getGameState(this.data.userId).then((res) => {
            if (res.success) {
                if (res.data.status === '1') {
                    this.setData({
                        gameStatus: 2,
                    });
                    this.getBoxes();
                } else if (res.data.status === '2') {
                    showWxToast('本轮开宝箱已经结束');
                    timeoutTask(() => {
                        wx.navigateBack();
                    }, 1500);
                }
            }
        })

    },
    onShow: function () {

    },
    onUnload: function () {
    },
    // 获取宝箱列表
    getBoxes: function () {
        getBoxesList().then((res) => {
            if (res.success && res.data) {
                const tmpLen = res.data.length;
                const tmpBoxes = [];
                for (let i = 0; i < tmpLen; i += 1) {
                    tmpBoxes.push({
                        id: res.data[i].eggId,
                        isBuyed: res.data[i].userId === '0' ? false : true,
                        isChoosed: false,
                        buyerId: res.data[i].userId,
                        num: BX[i].num,
                        left: BX[i].left,
                        top: BX[i].top,
                    });
                }
                this.setData({
                    boxes: tmpBoxes,
                    money: parseFloat(res.message),
                });
                this.setRemain();
                this.updateGift();
                console.log('宝箱列表:', this.data.boxes);
            } else {
                showWxToast('获取宝箱信息失败');
            }
        })
    },
    // 获取已经选择宝箱的数目
    getChoosedBoxesNum: function (isIncludeBuyed) {
        const boxes = this.data.boxes;
        const len = boxes.length;
        let tmpNum = 0;
        if (isIncludeBuyed) {
            for (let i = 0; i < len; i += 1) {
                if (boxes[i].isChoosed || boxes[i].buyerId === this.data.userId) {
                    tmpNum += 1;
                }
            }
        } else {
            for (let i = 0; i < len; i += 1) {
                if (boxes[i].isChoosed) {
                    tmpNum += 1;
                }
            }
        }
        return tmpNum;
    },
    // 获取已经选择的宝箱列表
    getChoosedBoxesList: function () {
        const boxes = this.data.boxes;
        const len = boxes.length;
        const tmpChoosedBoxes = [];
        for (let i = 0; i < len; i += 1) {
            if (boxes[i].isChoosed) {
                tmpChoosedBoxes.push(boxes[i]);
            }
        }
        return tmpChoosedBoxes;
    },
    // 设置还可以购买的宝箱个数(一共可购买三个)
    setRemain: function () {
        let tmpRemain = 0;
        const tmpLen = this.data.boxes.length;
        for (let i = 0; i < tmpLen; i += 1) {
            if (this.data.boxes[i].buyerId === this.data.userId) {
                tmpRemain += 1;
            }
        }
        this.setData({
            remain: tmpRemain,
        });
    },
    // 获取选择的宝箱数目时更新祝福列表
    updateGift: function () {
        const hasChoosedNum = this.getChoosedBoxesNum(false);
        this.boxesMapGift(hasChoosedNum);
    },
    // 祝福和已选择的宝箱数的映射
    boxesMapGift: function (choosedNum) {
        const tmpMoney = this.data.money;
        giftList[0].price = tmpMoney.toFixed(2);
        giftList[1].price = (tmpMoney * 2).toFixed(2);
        giftList[2].price = (tmpMoney * 3).toFixed(2);
        if (choosedNum == 3) {
            //选了3个宝箱<---> 大火箭
            this.setData({
                gift_show: giftList[2],
            })
        } else if (choosedNum == 2) {
            //选了2个宝箱<---> 中火箭
            this.setData({
                gift_show: giftList[1],
            })
        } else {
            //选了1个宝箱或者还没有选蛋<--->小火箭
            this.setData({
                gift_show: giftList[0],
            })
        }
    },
    enterGame: function () {
        getGameState(this.data.userId).then((res) => {
            console.log('***获取开宝箱状态***');
            console.log(res);
            if (res.success) {
                if (res.data.status === '0') {
                    showWxToast('请等待大屏开启开宝箱');
                } else if (res.data.status === '1') {
                    // 开宝箱进行中
                    this.getBoxes();
                    this.setData({
                        gameStatus: 2,
                    })
                } else if (res.data.status === '2') {
                    showWxToast('本轮开宝箱已经结束');
                    timeoutTask(() => {
                        wx.navigateBack();
                    }, 1500);
                } else {
                    showWxToast('请等待大屏开启开宝箱');
                }
            }
        }).catch((err) => {
            console.log(err);
        });
    },
    // 选择宝箱
    chooseBoxes: function (e) {
        const index = this.findBoxIndexByBoxId(e.currentTarget.dataset.id);
        const boxes = this.data.boxes;
        if (boxes[index].isBuyed) {
            showWxToast('这个宝箱已经被抢走啦');
            return;
        }
        // 如果选中 取消选中
        if (boxes[index].isChoosed) {
            boxes[index].isChoosed = false;
            this.setData({
                boxes,
            });
            this.updateGift();
            return;
        }
        // 最多3个宝箱 包括已经购买的
        const hasChoosedNum = this.getChoosedBoxesNum(true);
        if (hasChoosedNum >= 3) {
            showWxToast('最多只能选择三个宝箱哦');
            return;
        }
        if (!boxes[index].isChoosed) {
            boxes[index].isChoosed = true;
            this.setData({
                boxes,
            })
            this.updateGift();
        }
    },
    // 通过boxesId查找宝箱所在数组的索引
    findBoxIndexByBoxId: function (boxId) {
        let tmpIndex = -1;
        const tmpLen = this.data.boxes.length;
        for (let i = 0; i < tmpLen; i += 1) {
            if (this.data.boxes[i].id === boxId) {
                tmpIndex = i;
                break;
            }
        }
        return tmpIndex;
    },
    // 打开我的宝箱页面
    toMyBoxes: function () {
        this.getLuckyBoxes();
        this.setData({
            myBoxesVisible: true,
        });
    },
    // 打开宝箱购买页面
    toBuyBoxes: function () {
        this.setData({
            myBoxesVisible: false,
        });
    },
    // 买宝箱
    buy: function () {
        // 获取选中的宝箱
        const choosed = this.getChoosedBoxesList();
        if (choosed.length == 0) {
            showWxToast('请先选一个宝箱');
            return;
        }
        if (requestLock) {
            return;
        }
        console.log(typeof this.data.isForbidBuyHbq);
        if(this.data.isForbidBuyHbq) {
            showWxToast('您没有权限买宝箱!');
            return;
        }
        requestLock = true;
        let choosedStr = choosed.map((item) => {
            return item.id;
        }).join(',');
        this.robBox(choosedStr, 0).then((res) => {
            console.log(res);
            if (res.code === 'success') {
                requestLock = false;
                if (res.resultList.length == 0) {
                    wx.showModal({
                        showCancel: false,
                        title: '温馨提示',
                        content: '很遗憾您选择的宝箱都被抢走了\r\n已退回至您的账户中',
                        confirmText: '确定',
                        success: () => {
                        }
                    });
                } else {
                    if (choosed.length > res.resultList.length) {
                        wx.showModal({
                            showCancel: false,
                            title: '温馨提示',
                            content: '恭喜您,成功抢到了' + res.resultList.length + '个宝箱！ \r\n 未抢到的宝箱，已退回至您的账户中',
                            confirmText: '查看宝箱',
                            success: () => {
                                this.getLuckyBoxes();
                                this.setData({
                                    myBoxesVisible: true,
                                });
                            }
                        })
                    } else {
                        wx.showModal({
                            showCancel: false,
                            title: '温馨提示',
                            content: '恭喜您,成功抢到了' + res.resultList.length + '个宝箱!',
                            confirmText: '查看宝箱',
                            success: () => {
                                this.getLuckyBoxes();
                                this.setData({
                                    myBoxesVisible: true,
                                });
                            }
                        })
                    }
                    console.log(res.resultList);
                    let tmpCode = '';
                    if (this.data.gift_show.id === 3) {
                        tmpCode = 7002;
                    } else if (this.data.gift_show.id === 2) {
                        tmpCode = 6002;
                    } else if (this.data.gift_show.id === 1) {
                        tmpCode = 5002;
                    }
                    let c = JSON.stringify({
                        code: tmpCode,
                        param: {
                            headImg: this.data.headImg,
                            nickname: this.data.name,
                            wish: wishList[getRandom(0, 4)],
                        }
                    });
                    // 发送广播
                    sendBroadCast({
                        c,
                    });
                    app.globalData.isH5NeedRefresh = true;
                }
                this.getBoxes();
            } else if (res.code === 'error3') {
                if (res.NeedMoney) {
                    // 调起支付
                    return this.recharge(res.NeedMoney);
                } else {
                    showWxToast('购买失败!');
                }
            } else if (res.code === 'error4') {
                    showWxToast('开宝箱已经结束!');
                    requestLock = false;
            } else {
                showWxToast('购买失败');
                requestLock = false;
            }
        }).catch((err) => {
            console.log(err);
        })
    },
    // 抢宝箱
    robBox: function (boxId, sort) {
        return new Promise((resolve, reject) => {
            showWxLoading('奋力争抢中...');
            robBox({
                boxIds: boxId,
                sort: 0,
            }).then((res) => {
                console.log(res);
                hideWxLoading();
                resolve(res);
            }).catch((err) => {
                console.log(err);
                reject(err);
                hideWxLoading();
                showWxToast('抢购失败!');
            })
        });
    },
    // 支付
    recharge: function (money) {
        return new Promise((resolve, reject) => {
            kbxRecharge({
                userId: this.data.userId,
                openid: this.data.openId,
                money,
            }).then((res) => {
                console.log(res);
                if (res.status === 'success') {
                    wxPay(res).then((res2) => {
                        console.log(res2);
                        resolve(res2);
                        showWxToast('充值成功!');
                        requestLock = false;
                        app.globalData.isH5NeedRefresh = true;
                        //充值完成 等待后台加喵钻逻辑完成后 去买宝箱
                        timeoutTask(() => {
                            this.buy();
                        }, 500);
                    }).catch((err) => {
                        console.log(err);
                        showWxToast('充值失败!');
                        requestLock = false;
                        reject(err);
                    })
                }
            }).catch((err) => {
                console.log(err);
                reject(err);
            })
        });
    },
    // 获取我的宝箱
    getLuckyBoxes: function () {
        getMyBoxes().then((res) => {
            console.log(res);
            if (res.success) {
                if (res.data && res.data.length > 0) {
                    const tmpBoxes = [];
                    const tmpLen = res.data.length;
                    for (let i = 0; i < tmpLen; i += 1) {
                        if (res.data[i].eggId) {
                            let tmpEggId = parseInt(res.data[i].eggId);
                            if (tmpEggId <= 3) {
                                res.data[i].num = `0${tmpEggId}`;
                            } else if (tmpEggId >= 4 && tmpEggId <= 8) {
                                res.data[i].num = `0${tmpEggId + 1}`;
                            } else if (tmpEggId >= 9 && tmpEggId <= 12) {
                                res.data[i].num = `${tmpEggId + 1}`;
                            } else {
                                res.data[i].num = `${tmpEggId + 2}`;
                            }
                            tmpBoxes.push(res.data[i]);
                        }
                    }
                    this.setData({
                        luckyBoxes: tmpBoxes
                    });
                }
            } else {
                showWxToast('获取宝箱信息失败!');
            }
        }).catch((err) => {
            console.log(err);
            showWxToast('获取宝箱信息失败!');
        })
    },
    toAgreement: function () {
        wx.navigateTo({
            url: '/pages/agreement/agreement'
        });
    },
});
````

## File: pages/kbx/kbx.json
````json
{
  "navigationBarTitleText": "开宝箱",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  },
  "disableScroll": true
}
````

## File: pages/kbx/kbx.wxml
````
<view class="kbxContainer">
    <!-- 等待界面 -->
    <view class="waitContainer" wx:if="{{gameStatus === 1}}">
        <image src="https://static.hudongmiao.com/joymewMp/img/kbx/kbxWaitBg.png" class="bg"></image>
        <image src="https://static.hudongmiao.com/joymewMp/img/kbx/kbxWaitBx.png" class="kbxWaitBx"></image>
        <view class="tip2">只需送出弹幕礼物，免费获得一次夺取宝箱的机会</view>
        <view class="sendGiftItem item1">送出小号火箭：获取一个宝箱</view>
        <view class="sendGiftItem item2">送出中号火箭：获取二个宝箱</view>
        <view class="sendGiftItem item3">送出大号火箭：获取三个宝箱</view>
        <view class="tip3">ps:如果宝箱被抢完，您支付得金额将原路退回您得账户</view>
        <view class="btn" bindtap="enterGame">开始</view>
    </view>
    <!-- 开宝箱界面 -->
    <view class="gameContainer" wx:if="{{gameStatus === 2 && !myBoxesVisible}}">
        <image src="https://static.hudongmiao.com/joymewMp/kbx/bg3-01.png" class="bg"></image>
        <image src="https://static.hudongmiao.com/joymewMp/kbx/title3-01.png" class="title"></image>
        <image src="https://static.hudongmiao.com/joymewMp/kbx/ribbonLeft.png" class="ribbonLeft"></image>
        <image src="https://static.hudongmiao.com/joymewMp/kbx/ribbonRigth.png" class="ribbonRight"></image>
        <view class="bx {{item.isChoosed?'active':''}}" data-id="{{item.id}}" wx:for="{{boxes}}" wx:key="index" style="left:{{item.left}}rpx;top:{{item.top}}rpx" bindtap="chooseBoxes">
            <image src="https://static.hudongmiao.com/joymewMp/kbx/bx3.png" class="bxImg {{item.isBuyed?'buyed':''}}"></image>
            <view class="num">{{item.num}}</view>
        </view>
        <view class="giftListWrap">
            <view class="giftItem">
                <image src="{{gift_show.imgUrl}}" class="giftImg g{{gift_show.id}}"></image>
            </view>
            <view class="money">￥{{gift_show.price}}</view>
        </view>
        <view class="btn" bindtap='buy'>获取宝箱</view>
        <view class="myBoxBtn" bindtap="toMyBoxes"></view>
        <view class="agreement" bindtap='toAgreement'>阅读并同意《充值服务协议》</view>
    </view>
    <!-- 我的宝箱界面 -->
    <view class="myBoxes" wx:if="{{gameStatus === 2 && myBoxesVisible}}">
        <image src="https://static.hudongmiao.com/joymewMp/kbx/bg4-01.png" class="bg"></image>
        <image src="https://static.hudongmiao.com/joymewMp/kbx/title2-01.png" class="title"></image>
        <view class="myBxList">
            <view class="bx" wx:for="{{luckyBoxes}}" key="index">
                <image src="{{item.open==='0'?'https://static.hudongmiao.com/joymewMp/kbx/bx3.png':'https://static.hudongmiao.com/joymewMp/kbx/bxOpen3.png'}}" class="bxImg"></image>
                <view class="num {{item.open==='0'?'':'active'}}">{{item.num}}</view>
            </view>
        </view>
        <view class="myWinRecord">
            <image src="https://static.hudongmiao.com/joymewMp/kbx/loveIcon.png" class="loveIcon"></image>
            <text>我的中奖记录</text>
            <image src="https://static.hudongmiao.com/joymewMp/kbx/loveIcon.png" class="loveIcon"></image>
        </view>
        <view class="winItem item{{index+1}}" wx:for="{{luckyBoxes}}" key="index">
            <view class="bxName">{{item.num}}号宝箱</view>
            <view class="bxStatus">
                {{item.open==='0'?'未开启':(item.money==='0'?'谢谢参与':item.money)}}
            </view>
        </view>
        <view class="btn" bindtap="toBuyBoxes">返回</view>
    </view>
    <!-- 反馈入口 -->
    <feedbackEntry userId="{{userId}}"></feedbackEntry>
</view>
````

## File: pages/kbx/kbx.wxss
````
/* 等待界面 */
.kbxContainer>.waitContainer {
    position: absolute;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.3s ease-out;
}

.kbxContainer>.waitContainer>.bg {
    width: 100%;
    height: 100%;
    position: absolute;
}

.kbxContainer>.waitContainer>.kbxWaitBx {
    width: 750rpx;
    height: 780rpx;
    position: absolute;
    top: -102rpx;
    left: 0;
}

.kbxContainer>.waitContainer>.bx {
    width: 536rpx;
    height: 361rpx;
    position: absolute;
    top: 584rpx;
}

.kbxContainer>.waitContainer>.tip2 {
    font-size: 22rpx;
    font-weight: 400;
    color: #FFFFFF;
    position: absolute;
    top: 680rpx;
}

.kbxContainer>.waitContainer>.tip3 {
    font-size: 24rpx;
    font-weight: 400;
    color: #FEFEFE;
    position: absolute;
    top: 1009rpx;
}

.kbxContainer>.waitContainer>.sendGiftItem {
    width: 618rpx;
    height: 70rpx;
    border-radius: 8rpx;
    position: absolute;
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFFF;
    text-align: center;
    line-height: 70rpx;
}

.kbxContainer>.waitContainer>.btn {
    width: 439rpx;
    height: 106rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/kbx/btn2.png');
    background-size: 100% 100%;
    position: absolute;
    top: 1060rpx;
    text-align: center;
    font-size: 40rpx;
    font-weight: 400;
    color: #FFFFFF;
    text-shadow: 0px 2px 1px #880C0C;
    line-height: 83rpx;
}

.kbxContainer>.waitContainer>.sendGiftItem.item1 {
    top: 737rpx;
    background: #D1000E;
}

.kbxContainer>.waitContainer>.sendGiftItem.item2 {
    top: 820rpx;
    background: #FCAB0F;
}

.kbxContainer>.waitContainer>.sendGiftItem.item3 {
    top: 909rpx;
    background: #63A8FF;
}

/* 开宝箱界面 */
.kbxContainer>.gameContainer {
    position: absolute;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.3s ease-out;
}

.kbxContainer>.gameContainer>.bg {
    width: 100%;
    height: 100vh;
    position: absolute;
}

.kbxContainer>.gameContainer>.title {
    width: 327rpx;
    height: 89rpx;
    position: absolute;
    top: 43rpx;
}

.kbxContainer>.gameContainer>.ribbonLeft {
    width: 117rpx;
    height: 124rpx;
    position: absolute;
    left: 51rpx;
    top: 225rpx;
}

.kbxContainer>.gameContainer>.ribbonRight {
    width: 117rpx;
    height: 124rpx;
    position: absolute;
    right: 51rpx;
    top: 225rpx;
}

.kbxContainer>.gameContainer>.bx {
    width: 200rpx;
    height: 139rpx;
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s linear;
}

.kbxContainer>.gameContainer>.bx.active {
    animation-name: bounce;
    transform-origin: center bottom;
    animation-duration: 1s;
    transform: scale(1.2);
}

.kbxContainer>.gameContainer>.bx>.bxImg {
    position: absolute;
    width: 100%;
    height: 100%;
}

.kbxContainer>.gameContainer>.bx>.bxImg.buyed {
    filter: grayscale(100%);
}

.kbxContainer>.gameContainer>.bx>.num {
    font-size: 20rpx;
    color: #B97601;
    position: relative;
    left: -21rpx;
    top: -21rpx;
    font-weight: bold;
}

.kbxContainer>.gameContainer>.giftListWrap {
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 937rpx;
}

.kbxContainer>.gameContainer>.giftListWrap>.giftItem {
    width: 78rpx;
    height: 92rpx;
    position: relative;
    display: flex;
    justify-content: center;
    opacity: 1;
}

.kbxContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg {
    position: absolute;
}

.kbxContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g1 {
    width: 45rpx;
    height: 92rpx;
}

.kbxContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g2 {
    width: 39rpx;
    height: 92rpx;
}

.kbxContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g3 {
    width: 43rpx;
    height: 92rpx;
}

.kbxContainer>.gameContainer>.giftListWrap>.money {
    font-size: 48rpx;
    font-weight: bold;
    color: #EDD890;
    position: relative;
}

.kbxContainer>.gameContainer>.btn {
    width: 439rpx;
    height: 106rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/kbx/btn2.png');
    background-size: 100% 100%;
    position: absolute;
    top: 1037rpx;
    text-align: center;
    font-size: 40rpx;
    font-weight: 400;
    color: #FFFFFF;
    text-shadow: 0px 2px 1px #880C0C;
    line-height: 83rpx;
}

.kbxContainer>.gameContainer>.myBoxBtn {
    width: 103rpx;
    height: 103rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/kbx/myBoxBtn.png');
    background-size: 100% 100%;
    position: absolute;
    right: 43rpx;
    top: 1037rpx;
    /* animation-name: scaleAni;
    animation-duration: 1s;
    animation-timing-function: ease-out;
    animation-iteration-count: infinite; */
    /* transform-origin: top center;
    animation-name: swing;
    animation-duration: 1s;
    animation-iteration-count: infinite; */
}

.kbxContainer>.gameContainer>.agreement {
    font-size: 24rpx;
    font-weight: 400;
    color: #FFD027;
    position: absolute;
    top: 1143rpx;
}

/* 我的宝箱界面 */
.kbxContainer>.myBoxes {
    position: absolute;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.3s ease-out;
}

.kbxContainer>.myBoxes>.bg {
    position: absolute;
    width: 100%;
    height: 100%;
}

.kbxContainer>.myBoxes>.title {
    position: absolute;
    width: 458rpx;
    height: 244rpx;
    top: 37rpx;
}

.kbxContainer>.myBoxes>.myBxList {
    position: absolute;
    width: 100%;
    display: flex;
    justify-content: center;
    top: 420rpx;
}

.kbxContainer>.myBoxes>.myBxList>.bx {
    width: 200rpx;
    height: 139rpx;
    position: relative;
}

.kbxContainer>.myBoxes>.myBxList>.bx>.bxImg {
    width: 100%;
    height: 100%;
}

.kbxContainer>.myBoxes>.myBxList>.bx>.num {
    font-size: 20rpx;
    color: #B97601;
    position: absolute;
    left: 69rpx;
    font-weight: bold;
    top: 36rpx;
}

.kbxContainer>.myBoxes>.myBxList>.bx>.num.active {
    top: 46rpx;
    left: 62rpx;
}

.kbxContainer>.myBoxes>.myWinRecord {
    position: absolute;
    top: 571rpx;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 36rpx;
    font-weight: 500;
    color: #FFFFFF;
}

.kbxContainer>.myBoxes>.myWinRecord>.loveIcon {
    width: 29rpx;
    height: 25rpx;
    margin: 20rpx;
}

.kbxContainer>.myBoxes>.winItem {
    width: 596rpx;
    height: 114rpx;
    background: rgba(255, 109, 119, 0.3);
    border-radius: 8rpx;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 60rpx 0 35rpx;
}

.kbxContainer>.myBoxes>.winItem.item1 {
    top: 716rpx;
}

.kbxContainer>.myBoxes>.winItem.item2 {
    top: 858rpx;
}

.kbxContainer>.myBoxes>.winItem.item3 {
    top: 1002rpx;
}


.kbxContainer>.myBoxes>.winItem>.bxName {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFFF;
}

.kbxContainer>.myBoxes>.winItem>.bxStatus {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFF32E;
}

.kbxContainer>.myBoxes>.btn {
    width: 439rpx;
    height: 106rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/kbx/btn2.png');
    background-size: 100% 100%;
    position: absolute;
    bottom: 12rpx;
    text-align: center;
    font-size: 40rpx;
    font-weight: 400;
    color: #FFFFFF;
    text-shadow: 0px 2px 1px #880C0C;
    line-height: 83rpx;
}


@keyframes bounce {

    from,
    20%,
    53%,
    80%,
    to {
        -webkit-animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
        animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
    }

    40%,
    43% {
        -webkit-animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        -webkit-transform: translate3d(0, -30px, 0);
        transform: translate3d(0, -30px, 0);
    }

    70% {
        -webkit-animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        -webkit-transform: translate3d(0, -15px, 0);
        transform: translate3d(0, -15px, 0);
    }

    90% {
        -webkit-transform: translate3d(0, -4px, 0);
        transform: translate3d(0, -4px, 0);
    }
}

@keyframes scaleAni {

    0%,
    100% {
        transform: scale(1.1);
    }

    50% {
        transform: scale(1.3);
    }
}

@keyframes swing {
    20% {
        -webkit-transform: rotate3d(0, 0, 1, 15deg);
        transform: rotate3d(0, 0, 1, 15deg);
    }

    40% {
        -webkit-transform: rotate3d(0, 0, 1, -10deg);
        transform: rotate3d(0, 0, 1, -10deg);
    }

    60% {
        -webkit-transform: rotate3d(0, 0, 1, 5deg);
        transform: rotate3d(0, 0, 1, 5deg);
    }

    80% {
        -webkit-transform: rotate3d(0, 0, 1, -5deg);
        transform: rotate3d(0, 0, 1, -5deg);
    }

    to {
        -webkit-transform: rotate3d(0, 0, 1, 0deg);
        transform: rotate3d(0, 0, 1, 0deg);
    }
}
````

## File: pages/live/live.wxss
````
page {
  background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/nyn/nyn.js
````javascript
import { timeoutTask, getRandom, showWxToast } from '../../utils/index';
import { getPoolMoney, getNynInfo, getNynRank, nynRecharge, startNyn, sendPrizeInfo, sendBroadCast } from '../../api/nyn/nyn';
import { wxPay } from '../../api/pay';
import defaultContent from '../../assets/constant/default';

const app = getApp();
// 蛋位置信息
const locatInfo = [
    {
        x: 118,
        y: 0,
        fallAniDelay: 0.2,
        rotateAniDelay: 0.1,
        upAniDelay: 1.6,
        rotateAniDelay2: 1.5,
    },
    {
        x: 258,
        y: 26,
        fallAniDelay: 0.4,
        rotateAniDelay: 0.3,
        upAniDelay: 1.4,
        rotateAniDelay2: 1.3,
    },
    {
        x: 392,
        y: 62,
        fallAniDelay: 0.6,
        rotateAniDelay: 0.5,
        upAniDelay: 1.2,
        rotateAniDelay2: 1.1,
    },
    {
        x: 0,
        y: 80,
        fallAniDelay: 0.8,
        rotateAniDelay: 0.7,
        upAniDelay: 1,
        rotateAniDelay2: 0.9,
    },
    {
        x: 124,
        y: 128,
        fallAniDelay: 1,
        rotateAniDelay: 0.9,
        upAniDelay: 0.8,
        rotateAniDelay2: 0.7,
    },
    {
        x: 264,
        y: 162,
        fallAniDelay: 1.2,
        rotateAniDelay: 1.1,
        upAniDelay: 0.6,
        rotateAniDelay2: 0.5,
    },
    {
        x: 412,
        y: 192,
        fallAniDelay: 1.4,
        rotateAniDelay: 1.3,
        upAniDelay: 0.4,
        rotateAniDelay2: 0.3,
    },
    {
        x: 8,
        y: 212,
        fallAniDelay: 1.6,
        rotateAniDelay: 1.5,
        upAniDelay: 0.2,
        rotateAniDelay2: 0.1,
    },
]
// 蛋类型
const eggType = [
    {
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/egg1-01.png',
        width: 141,
        height: 155,
        luckyBeginY: -148,
    }, {
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/egg2.png',
        width: 141,
        height: 140,
        luckyBeginY: -136,
    }, {
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/egg3.png',
        width: 141,
        height: 140,
        luckyBeginY: -136,
    }, {
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/egg4-01.png',
        width: 141,
        height: 141,
        luckyBeginY: -140,
    },
];
// 礼物数组
const giftList = [
    {
        id: 1,
        gift: 'rocket1',
        name: '小号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/rocket1.png',
        isChoosed: true
    }, {
        id: 2,
        gift: 'rocket2',
        name: '中号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/rocket2.png',
        isChoosed: false
    }, {
        id: 3,
        gift: 'rocket3',
        name: '大号火箭',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/nyn/rocket3.png',
        isChoosed: false
    }
];
const wishList = [
    '醉酒饱德，不胜感激',
    '美酒佳肴,不甚荣幸',
    '感谢招待,祝愿安康',
    '小小红包,感谢招待'
];

let tmpInterval; //用于倒计时
let tmpInterval2; //用于轮询
let lock = false; //锁，用于确保 倒计时方法 一轮只调用一次
let lock2 = false;//锁，用于确保 执行动画的过程中不可以点按钮
let lock3 = false;//锁，用于确保 开始按钮不能连续点击
Page({
    data: {
        gameStatus: 1, // 扭一扭状态(控制页面显示)
        eggList: [], // 扭蛋列表
        prizeItemList: [],// 奖项列表
        poolMoney: 0, //奖池金额
        countDownNum: 0,// 倒计时
        isEntry: false,// 充值入口
        rechargeTipList: [], //充值提示列表
        luckyTipList: [], //中奖提示列表
        topRankList: [],// 排行榜列表
        otherRankList: [],
        isRechargeTipShow: false, //控制充值提示显示隐藏
        isResultTipShow: false, //控制扭一扭结果提示显示隐藏
        user: {
            nickname: 'player',
            money: 0
        }, //充值用户
        resultTipContent: {
            resultImgSrc: '',
            para1: '',
            para2: '',
            result: '',
            ptVal: 44,
        }, //充值结果内容
        btnText: '发送礼物',
        userId: '',
        openId: '',
        name: '',
        headImg: '',
        turnId: '', //一场扭一扭的id 0代表要充值 否则代表这场扭一扭的id
        giftList: giftList,
        giftListShow: true,
        rechargeTipAni: '',
        resultTipAni: '',
        luckyEgg: {
            imgUrl: '',
            width: '',
            height: '',
            luckyBeginY: 0,
            luckyEndY: 0,
            isFallLuckyAni: false,
            isRotateAni: false,
            left: 22,
            top: -124,
        },
    },
    onLoad: function (options) {
        tmpInterval = null;
        tmpInterval2 = null;
        lock = false;
        lock2 = false;
        lock3 = false;
        this.setData({
            userId: options.userId,
            openId: options.openId,
            name: options.name,
            headImg: options.headImg,
            prizeItemList: app.globalData.nynList,
        });
        this.requestPoolMoney();
        this.initEggList();
    },
    onShow: function () {
        this.toGame();
    },
    onHide: function () {
        //清除定时器
        clearInterval(tmpInterval);
        clearInterval(tmpInterval2);
        tmpInterval = null;
        tmpInterval2 = null;
        lock = false;
    },
    onUnload: function () {
        //清除定时器
        clearInterval(tmpInterval);
        clearInterval(tmpInterval2);
        tmpInterval = null;
        tmpInterval2 = null;
    },
    initEggList() {
        let tmpEggList = [];
        const len = this.data.prizeItemList.length;
        console.log(this.data.prizeItemList);
        for (let i = 0; i < len; i += 1) {
            this.createEgg(tmpEggList, i);
        }
        this.setData({
            eggList: tmpEggList,
        });
    },
    createEgg(tmArr, num) {
        let typeIndex = num > 3 ? num - 4 : num;
        let tmpDesc;
        if (this.data.prizeItemList[num]) {
            tmpDesc = this.data.prizeItemList[num].desc;
        } else {
            tmpDesc = '谢谢参与';
        }
        console.log(eggType, typeIndex);
        const egg = {
            num: num + 1,
            imgUrl: eggType[typeIndex].imgUrl,
            width: eggType[typeIndex].width,
            height: eggType[typeIndex].height,
            left: locatInfo[num].x,
            bottom: locatInfo[num].y,
            fallAniDelay: locatInfo[num].fallAniDelay,
            rotateAniDelay: locatInfo[num].rotateAniDelay,
            isFallAni: false,
            aroundAni: '',
            isRotateAni: false,
            prize: tmpDesc,
        };
        tmArr.push(egg);
    },
    fallEgg() {
        let tmpEggList = this.data.eggList;
        for (let i = 0; i < 8; i += 1) {
            tmpEggList[i].isFallAni = true;
            tmpEggList[i].isRotateAni = true;
        }
        this.setData({
            eggList: tmpEggList
        });
        timeoutTask(() => {
            for (let i = 0; i < 8; i += 1) {
                tmpEggList[i].isFallAni = false;
                tmpEggList[i].isRotateAni = false;
            }
            this.setData({
                eggList: tmpEggList
            });
        }, 2000);
    },
    beginAroundAni() {
        let tmpEggList = this.data.eggList;
        for (let i = 0; i < 8; i += 1) {
            tmpEggList[i].fallAniDelay = locatInfo[i].upAniDelay;
            tmpEggList[i].rotateAniDelay = locatInfo[i].rotateAniDelay2;
            this.setData({
                eggList: tmpEggList
            });
            // timeoutTask(() => {
            tmpEggList[i].isRotateAni = true;
            tmpEggList[i].aroundAni = `aroundAni${tmpEggList[i].num}`;
            this.setData({
                eggList: tmpEggList
            });
            // }, 100);
        }
    },
    endAroudAni() {
        let tmpEggList = this.data.eggList;
        for (let i = 0; i < 8; i += 1) {
            tmpEggList[i].isRotateAni = false;
            tmpEggList[i].aroundAni = '';
        }
        this.setData({
            eggList: tmpEggList
        });
    },
    handleStartBtnTap() {
        if (this.data.btnText === '发送礼物') {
            //判断是否选中某个礼物
            const resultIndex = this.data.giftList.findIndex((item) => {
                return item.isChoosed;
            });
            if (resultIndex > -1) {
                console.log(resultIndex);
                if (this.data.isEntry) {
                    // 充值入口开着
                    this.recharge();
                } else {
                    // 最后十五秒购买入口关闭
                    showWxToast('购买入口关闭');
                }
            } else {
                showWxToast('请选择一个礼物');
            }
        }
    },
    tapstartNyn() {
        getNynInfo().then((res) => {
            console.log(res);
            this.setData({
                turnId: res.data.id
            });
            this.startGame();
        }).catch((err) => {
            console.log(err);
            showWxToast('网络异常');
        });
    },
    // 选择礼物
    chooseGift(e) {
        console.log(e)
        const choosedId = e.currentTarget.dataset.id;
        const tmpGiftList = this.data.giftList;
        tmpGiftList.forEach(item => {
            if (item.id === choosedId) {
                item.isChoosed = true;
            } else {
                item.isChoosed = false;
            }
        });
        this.setData({
            giftList: tmpGiftList
        });
    },
    // 扭一扭动画
    gameAniStart(endIndex, endMoney) {
        this.beginAroundAni();
        timeoutTask(() => {
            console.log('***5s后结束扭一扭动画 展示luckyEgg***');
            this.endAroudAni();
            this.showLuckyEgg(endIndex, endMoney);
        }, 5000);
        timeoutTask(() => {
            console.log('***6s后 展示resultTip***');
            this.showResultTip(endIndex, this.data.name, endMoney);
        }, 6000);
        timeoutTask(() => {
            console.log('***10s后恢复状态***');
            this.setData({
                btnText: '发送礼物',
                giftListShow: true,
            });
        }, 10000);
    },
    // 充钱玩扭一扭
    recharge() {
        if (lock2) {
            return;
        }
        lock2 = true;
        nynRecharge({
            userId: this.data.userId,
            openId: this.data.openId,
        }).then((res) => {
            console.log(res);
            return wxPay(res);
        }).then(() => {
            showWxToast('礼物发送成功!');
            this.sendGift(this.getChoosedGift());
            //充值成功按钮状态立即改变
            this.setData({
                btnText: '扭一扭',
                giftListShow: false,
            });
            // startGame
            timeoutTask(() => {
                // this.handleStartBtnTap();
                console.log('***2s后自动扭一扭***')
                this.tapstartNyn();
            }, 2000);

        }).catch((err) => {
            console.log(err);
            lock2 = false;
            showWxToast('支付失败!');
        });
    },
    getChoosedGift() {
        return this.data.giftList.find(item => {
            return item.isChoosed;
        });
    },
    sendGift(giftChoosed) {
        let tmpCode = '';
        if (giftChoosed.id == 1) {
            tmpCode = 5002;
        } else if (giftChoosed.id == 2) {
            tmpCode = 6002;
        } else if (giftChoosed.id == 3) {
            tmpCode = 7002;
        }
        const c = JSON.stringify({
            code: tmpCode,
            param: {
                headImg: this.data.headImg,
                nickname: this.data.name,
                wish: wishList[parseInt(Math.random() * 3)]
            }
        });
        sendBroadCast({
            c,
        });
    },
    // 扭一扭
    startGame() {
        startNyn({
            turnId: this.data.turnId,
        }).then((res) => {
            console.log('startNyn result:', res);
            //res.data.desc 奖项；endMoney中奖的金额；totalMoney 奖池金额
            //奖池金额刷新
            if (res.data.totalMoney.balance) {
                this.setData({
                    poolMoney: res.data.totalMoney.balance
                })
            }
            //扭一扭动画开始
            this.gameAniStart(res.data.lotteryType, res.data.endMoney);

            // 5s动画停止后发送广播(必须要中奖的情况)
            if (parseInt(res.data.endMoney) > 0) {
                timeoutTask(() => {
                    this.sendBroad(res.data.endMoney, res.data.totalMoney.balance);
                }, 5000);
            }
            timeoutTask(() => {
                lock2 = false;
            }, 5000);
        }).catch((err) => {
            console.log(err);
            lock2 = false;
        });
    },
    // 点击进入扭一扭
    toGame() {
        if (lock3) {
            return;
        }
        lock3 = true;
        this.requestGameInitInfo();
    },
    // 获取奖池金额
    requestPoolMoney() {
        getPoolMoney().then((res) => {
            console.log(res);
            this.setData({
                poolMoney: res.data.balance
            });
        }).catch((err) => {
            console.log(err);
        });
    },
    // 获取扭一扭相关信息
    requestGameInitInfo() {
        getNynInfo().then((res) => {
            console.log('***获取扭一扭基本信息***');
            console.log(res);
            //res.data.id 发送礼物 1扭一扭
            if (res.data.id == 0) {
                this.setData({
                    btnText: '发送礼物',
                    giftListShow: true,
                    turnId: res.data.id
                })
            } else {
                this.setData({
                    btnText: '扭一扭',
                    giftListShow: false,
                    turnId: res.data.id
                })
            }
            // 时间处理(用于倒计时) res.data.endTime
            if (res.data.endTime === '0') {
                // 扭一扭未开始的情况处理
                showWxToast('扭一扭尚未开始!');
            } else {
                let countTime = this.timeHandle(res.data.endTime);
                console.log('***接口返回endTime***');
                console.log(res.data.endTime);
                this.countDown(countTime);
                this.setData({
                    gameStatus: 2,
                });
                this.fallEgg();
                // 轮询获取充值和中奖列表
                if (!tmpInterval2) {
                    tmpInterval2 = setInterval(() => {
                        console.log('tmpInterval2');
                        this.noticeShow();
                    }, 4000);
                }
            }
            lock3 = false;
        }).catch((err) => {
            console.log(err);
            lock3 = false;
        });
    },
    // 获取充值和中奖列表
    requestTipList() {
        let tmpLuckyTipList = [];
        let tmpRechargeTipList = [];
        getPoolMoney().then((res) => {
            console.log('***getPoolMoney***', res);
            const subTime = this.timeHandle(res.data.endTime);
            if (subTime <= 0) {
                // 扭一扭提前结束
                this.requestRankList();
            }
            for (let i = 0; i < res.data.list.length; i += 1) {
                tmpRechargeTipList.push({
                    nickname: res.data.list[i].wx_name,
                    money: res.data.list[i].gsum,
                });
                if (parseInt(res.data.list[i].c01) > 0) { //确保 “谢谢参与的” 奖项不弹出
                    tmpLuckyTipList.push({
                        nickname: res.data.list[i].wx_name,
                        endMoney: res.data.list[i].c01
                    })
                }
            }
            this.setData({
                rechargeTipList: tmpRechargeTipList,
                luckyTipList: tmpLuckyTipList,
                poolMoney: res.data.balance
            });
        }).catch((err) => {
            console.log(err);
        })
    },
    // 时间戳处理
    timeHandle(endTime) {
        //获取当前时间戳
        var nowTime = (new Date()).getTime();
        var subTime = parseInt((parseInt(endTime) - parseInt(nowTime)) / 1000);
        if (subTime < 0) {
            subTime = 0;
        }
        return subTime;
    },
    // 不带毫秒的倒计时
    countDown(second) {
        if (lock == false && !tmpInterval) {
            lock = true;
            tmpInterval = setInterval(() => {
                console.log('tmpInterval');
                if (second <= 1) {
                    this.setData({
                        isEntry: false,
                        countDownNum: second
                    })
                    this.requestRankList();
                } else {
                    second -= 1;
                    if (second <= 7) {
                        this.setData({
                            isEntry: false
                        })
                    } else {
                        this.setData({
                            isEntry: true
                        })
                    }
                    this.setData({
                        countDownNum: second
                    })
                }

            }, 1000)
        }
    },
    // 弹出消息(包括充值和中奖)
    noticeShow() {
        if (this.data.rechargeTipList[app.globalData.nynRechargeIndex] && this.data.isRechargeTipShow == false) {
            //当前存在未弹出的充值消息
            let tmpObj = {};
            tmpObj.nickname = this.data.rechargeTipList[app.globalData.nynRechargeIndex].nickname;
            tmpObj.money = this.data.rechargeTipList[app.globalData.nynRechargeIndex].money;
            this.setData({
                user: tmpObj
            })
            //调用showRechargeTip方法
            this.showRechargeTip();
        } else {
            //更新数组
            this.requestTipList();
        }
        if (this.data.luckyTipList[app.globalData.nynLuckyIndex] && this.data.isResultTipShow == false) {
            //当前存在未弹出的中奖消息
            let tmpObj = {};
            tmpObj = this.data.luckyTipList[app.globalData.nynLuckyIndex];
            //loopShowResultTip
            this.loopShowResultTip(tmpObj.nickname, tmpObj.endMoney);
        } else {
            //更新数组
            this.requestTipList();
        }
    },
    // 获取排行榜列表
    requestRankList() {
        getNynRank().then((res) => {
            console.log(res);
            lock = false;
            let tmpTopRankArray = [];
            let tmpOtherRankArray = [];
            let count = 0;
            let tmpLen = res.data.list.length;
            // 限制中奖名单人数最多不超过10个
            if (tmpLen > 10) {
                tmpLen = 10;
            }
            while (count < tmpLen) {
                if (count < 3) {
                    tmpTopRankArray.push({
                        nickname: res.data.list[count].wx_name,
                        headimgurl: res.data.list[count].avator,
                        money: Math.floor(parseFloat(res.data.list[count].money))
                    });
                } else {
                    tmpOtherRankArray.push({
                        num: count < 0 ? `0${count + 1}` : (count + 1),
                        nickname: res.data.list[count].wx_name,
                        headimgurl: res.data.list[count].avator,
                        money: Math.floor(parseFloat(res.data.list[count].money))
                    });
                }
                count += 1;
            }
            if (tmpTopRankArray.length < 3) {
                const tmpLen2 = tmpTopRankArray.length;
                for (let i = tmpLen2; i < 3; i += 1) {
                    tmpTopRankArray.push({
                        nickname: 'Player',
                        headimgurl: defaultContent.defaultHeadImg,
                        money: 0,
                    });
                }
            }
            // 不足七个补齐
            if (tmpOtherRankArray.length < 7) {
                const tmpLen3 = tmpOtherRankArray.length;
                for (let i = tmpLen3; i < 7; i += 1) {
                    tmpOtherRankArray.push({
                        num: i + 3 < 0 ? `0${i + 4}` : (i + 4),
                        nickname: 'Player',
                        headimgurl: defaultContent.defaultHeadImg,
                        money: 0,
                    });
                }
            }

            console.log(tmpOtherRankArray);
            this.setData({
                topRankList: tmpTopRankArray,
                otherRankList: tmpOtherRankArray,
                gameStatus: 3,
            });
            // 停止轮询
            clearInterval(tmpInterval2);
            clearInterval(tmpInterval);
            tmpInterval = null;
            tmpInterval2 = null;
        }).catch((err) => {
            console.log(err);
        });
    },
    showRechargeTip() {
        this.setData({
            isRechargeTipShow: true
        });
        this.setData({
            rechargeTipAni: 'rechargeTipAni'
        });
        timeoutTask(() => {
            this.setData({
                rechargeTipAni: 'rechargeTipAni2'
            });
        }, 3000);
        timeoutTask(() => {
            this.setData({
                isRechargeTipShow: false
            });
            app.updateNynRechargeIndex();
        }, 4000);
    },
    loopShowResultTip(pNickname, money) {
        let nickname = pNickname || '匿名';
        if (parseInt(money) > 0) {
            //抽中
            let result = {
                resultImgSrc: 'https://static.hudongmiao.com/joymewMp/nyn/happyMew-01.png',
                para1: '恭喜' + nickname,
                para2: '获得' + money + '奖励',
                result: 1,
                ptVal: 34,
            };
            this.setData({
                resultTipContent: result,
                isResultTipShow: true,
                resultTipAni: 'resultTipAni',
            });
            timeoutTask(() => {
                this.setData({
                    resultTipAni: 'resultTipAni2'
                });
            }, 4000);
            timeoutTask(() => {
                this.setData({
                    isResultTipShow: false
                });
                app.updateNynLuckyIndex();
            }, 4000);
        } else {
            //未抽中
            let result = {
                resultImgSrc: 'https://static.hudongmiao.com/joymewMp/nyn/sadMew-01.png',
                para1: '很遗憾没有抽中',
                para2: '谢谢惠顾，再接再厉',
                result: 0,
                ptVal: 44,
            };
            this.setData({
                resultTipContent: result,
                isResultTipShow: true,
                resultTipAni: 'resultTipAni',
            });
            timeoutTask(() => {
                this.setData({
                    resultTipAni: 'resultTipAni2'
                });
            }, 4000);
            timeoutTask(() => {
                this.setData({
                    isResultTipShow: false
                });
            }, 4000);
        }
    },
    showResultTip(num, pNickname, money) {
        console.log('***showReusltTip***');
        console.log(this.data.prizeItemList);
        console.log(num);
        let desc;
        if (this.data.prizeItemList[parseInt(num)]) {
            desc = this.data.prizeItemList[parseInt(num)].desc;
        } else {
            desc = '谢谢参与';
        }
        let nickname = pNickname || '匿名';
        if (money) {
            desc = money;
        }
        if (num == 0) {
            //未抽中
            let result = {
                resultImgSrc: 'https://static.hudongmiao.com/joymewMp/nyn/sadMew-01.png',
                para1: '很遗憾没有抽中',
                para2: '谢谢惠顾，再接再厉',
                result: 0,
                ptVal: 44,
            };
            this.setData({
                resultTipContent: result,
                isResultTipShow: true,
                resultTipAni: 'resultTipAni',
            });
            timeoutTask(() => {
                this.setData({
                    resultTipAni: 'resultTipAni2'
                });
            }, 4000);
            timeoutTask(() => {
                this.setData({
                    isResultTipShow: false
                });
            }, 4000);
        } else {
            //抽中
            let result = {
                resultImgSrc: 'https://static.hudongmiao.com/joymewMp/nyn/happyMew-01.png',
                para1: '恭喜' + nickname,
                para2: '获得' + desc + '奖励',
                result: 1,
                ptVal: 34,
            };
            this.setData({
                resultTipContent: result,
                isResultTipShow: true,
                resultTipAni: 'resultTipAni',
            });
            timeoutTask(() => {
                this.setData({
                    resultTipAni: 'resultTipAni2'
                });
            }, 4000);
            timeoutTask(() => {
                this.setData({
                    isResultTipShow: false
                });
                app.updateNynLuckyIndex();
            }, 4000);
        }
    },
    // 发广播
    sendBroad(golds, remainCoins) {
        sendPrizeInfo({
            gold: golds,
            remainCoin: remainCoins,
            turnId: this.data.turnId,
        }).then((res) => {
            console.log(res);
        }).catch((err) => {
            console.log(err);
            showWxToast('网络异常');
        });
    },
    // 蛋掉落 从蛋下落并停留到消失 耗时 3s
    showLuckyEgg(endIndex, endMoney) {
        this.createLuckyEgg(endIndex, endMoney);
        const tmpLuckyEgg = this.data.luckyEgg;
        tmpLuckyEgg.top = this.data.luckyEgg.luckyBeginY;
        console.log('***蛋下落动画执行***');
        tmpLuckyEgg.isFallLuckyAni = true;
        tmpLuckyEgg.isRotateAni = true;
        this.setData({
            luckyEgg: tmpLuckyEgg,
        });
        // 下落后保持在终点位置
        timeoutTask(() => {
            tmpLuckyEgg.end = 208;
            tmpLuckyEgg.isRotateAni = false;
            console.log('***保持在终点位置***');
            this.setData({
                luckyEgg: tmpLuckyEgg,
            });
        }, 1000);
        timeoutTask(() => {
            console.log('***回到初始位置***');
            tmpLuckyEgg.isFallLuckyAni = false;
            tmpLuckyEgg.end = '';
            tmpLuckyEgg.top = this.data.luckyEgg.luckyBeginY;
            this.setData({
                luckyEgg: tmpLuckyEgg,
            });
        }, 4000);
    },
    // 创建中奖扭蛋
    createLuckyEgg(num, money) {
        console.log('***createLuckyEgg***');
        console.log(num, money);
        console.log(this.data.prizeItemList);
        const eggTypeIndex = getRandom(0, 4);
        const tmpLuckyEgg = this.data.luckyEgg;
        tmpLuckyEgg.imgUrl = eggType[eggTypeIndex].imgUrl;
        tmpLuckyEgg.width = eggType[eggTypeIndex].width;
        tmpLuckyEgg.height = eggType[eggTypeIndex].height;
        tmpLuckyEgg.luckyBeginY = eggType[eggTypeIndex].luckyBeginY;
        let desc;
        if (this.data.prizeItemList[parseInt(num)]) {
            desc = this.data.prizeItemList[parseInt(num)].desc;
        }
        if (money) {
            desc = money;
        }
        if (num == 0) {
            desc = '谢谢参与';
        }
        tmpLuckyEgg.prize = desc;
        this.setData({
            luckyEgg: tmpLuckyEgg,
        });
    },
    toAgreement: function () {
        wx.navigateTo({
            url: '/pages/agreement/agreement'
        });
    },
});
````

## File: pages/nyn/nyn.json
````json
{
  "navigationBarTitleText": "扭一扭",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  },
  "disableScroll": true
}
````

## File: pages/nyn/nyn.wxml
````
<view class="nynContainer {{gameStatus === 3 ? 'rankShow' : ''}}">
    <view class="bgArea">
        <image src="https://static.hudongmiao.com/joymewMp/nyn/bg-01.png" class="bg" mode="widthFix"></image>
        <image src="https://static.hudongmiao.com/joymewMp/nyn/star-01.png" class="star"></image>
        <image src="https://static.hudongmiao.com/joymewMp/nyn/dotFall-01.png" class="dotFall"></image>
    </view>
    <!-- 等待界面 -->
    <view class="waitContainer" wx:if="{{gameStatus === 1}}">
        <view class="prizePool">
            <image src="https://static.hudongmiao.com/joymewMp/nyn/marquee.png" class="bg"></image>
            <view class="ct">
                奖池总金额
                <text class="money">{{poolMoney}}元</text>
            </view>
        </view>
        <image src="https://static.hudongmiao.com/joymewMp/nyn/ruleBox-02.png" class="ruleBox"></image>
        <view class="gameBox">
            <image src="https://static.hudongmiao.com/joymewMp/nyn/stageNew2-01.png" class="gameBoxImg"></image>
            <view class="tip">
                购买任意一款弹幕礼物，将
                <text class="strong">免费赠送</text>
                一次抽奖
            </view>
            <view class="startBtn" bindtap="toGame">开始</view>
            <image src="https://static.hudongmiao.com/joymewMp/nyn/dmGift.png" class="dmGiftTitle"></image>
            <view class="giftListWrap">
                <view class="giftItem">
                    <image src="https://static.hudongmiao.com/joymewMp/nyn/locat.png" class="locatImg"></image>
                    <view class="giftImgList">
                        <view class="giftImg g{{index+1}}" wx:for="{{giftList}}" wx:key="id">
                            <image src="{{item.imgUrl}}"></image>
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>
    <!-- 扭一扭界面 -->
    <view class="gameContainer" wx:if="{{gameStatus === 2}}">
        <view class="rechargeTipWarp {{rechargeTipAni}}" wx:if="{{isRechargeTipShow}}">
            <span class="star">*</span>
            <span>{{user.nickname}}</span>
            充值了
            <span>{{user.money}}元</span>
        </view>
        <view class="eggBoxWrap" style="background-image:url('https://static.hudongmiao.com/joymewMp/nyn/eggBox.png')">
            <view class="prizePool">
                奖池总金额
                <view class="price">{{poolMoney}}元</view>
            </view>
            <view class="countDown">倒计时: {{countDownNum}}s</view>
            <view class="eggs">
                <view class="eggItem {{item.isFallAni?'fallAni':''}} {{item.aroundAni}}" wx:for="{{eggList}}" wx:key="index" style="width:{{item.width}}rpx;height:{{item.height}}rpx;left:{{item.left}}rpx;bottom:{{item.bottom}}rpx;animation-delay:{{item.fallAniDelay}}s">
                    <view class="egg {{item.isRotateAni?'rotateAni':''}}" style="animation-delay:{{item.rotateAniDelay}}s">
                        <view class="hb">
                            <text>{{item.prize}}</text>
                        </view>
                        <image src="{{item.imgUrl}}" class="eggImg"></image>
                    </view>
                </view>
            </view>
        </view>
        <view class="gameBox">
            <image src="https://static.hudongmiao.com/joymewMp/nyn/stageNew2-01.png" class="gameBoxImg"></image>
            <!-- <view class="tip" wx:if="{{giftListShow}}">
                购买任意一款弹幕礼物，将
                <text class="strong">免费赠送</text>
                一次抽奖
            </view> -->
            <view class="agreement" bindtap='toAgreement' wx:if="{{giftListShow}}">阅读并同意《充值服务协议》</view>
            <view class="giftListWrap" wx:if="{{giftListShow}}">
                <view class="giftItem">
                    <image src="https://static.hudongmiao.com/joymewMp/nyn/locat.png" class="locatImg"></image>
                    <view class="giftImgList">
                        <view class="giftImg g{{index+1}} {{item.isChoosed?'choosed':''}}" wx:for="{{giftList}}" wx:key="id" data-id="{{item.id}}" bindtap='chooseGift'>
                            <image src="https://static.hudongmiao.com/joymewMp/nyn/light2.png" class="lightImage lightAni" wx:if="{{item.isChoosed}}"></image>
                            <image src="{{item.imgUrl}}" class="giftImage"></image>
                        </view>
                    </view>
                </view>
            </view>
            <view class="startBtn" bindtap="handleStartBtnTap">{{btnText}}</view>
            <image src="https://static.hudongmiao.com/joymewMp/nyn/dmGift.png" class="dmGiftTitle" wx:if="{{giftListShow}}"></image>
            <view class="eggExit" wx:if="{{!giftListShow}}">
                <view class="luckyEggWrap">
                    <view class="luckyEgg {{luckyEgg.isFallLuckyAni?'fallLuckyAni':''}}" style="width: {{luckyEgg.width}}rpx;height: {{luckyEgg.height}}rpx;top: {{luckyEgg.top}}rpx;left: {{luckyEgg.left}}rpx;transform: translateY({{luckyEgg.end}}rpx)">
                        <view class="egg {{luckyEgg.isRotateAni?'rotateAni':''}}">
                            <view class="hb">
                                <text>{{luckyEgg.prize}}</text>
                            </view>
                            <image src="{{luckyEgg.imgUrl}}" class="eggImg"></image>
                        </view>
                    </view>
                </view>
            </view>
        </view>
        <view class="resultTipWarp {{resultTipAni}}" wx:if="{{isResultTipShow}}" style="padding-top:{{resultTipContent.ptVal}}rpx">
            <image class="bg" src="{{resultTipContent.resultImgSrc}}"></image>
            <view class="para1">{{resultTipContent.para1}}</view>
            <view class="para2">{{resultTipContent.para2}}</view>
        </view>
    </view>
    <!-- 扭一扭排行榜界面 -->
    <view class="rankContainer" wx:if="{{gameStatus === 3}}">
        <view class="topThree">
            <view class="second" wx:if="{{topRankList[1]}}">
                <image src="https://static.hudongmiao.com/joymewMp/nyn/secondRankBox1.png" class="rkSecond" mode="widthFix"></image>
                <image src="https://static.hudongmiao.com/joymewMp/nyn/rkSecondStage-01.png" class="rkSecondStage" mode="widthFix"></image>
                <view class="headImgBox">
                    <image src="{{topRankList[1].headimgurl}}" class="headImg"></image>
                </view>
                <view class="name">{{topRankList[1].nickname}}</view>
                <view class="money">{{topRankList[1].money}}元</view>
            </view>
            <view class="first" wx:if="{{topRankList[0]}}">
                <image src="https://static.hudongmiao.com/joymewMp/nyn/firstRankBox1.png" class="rkFirst" mode="widthFix"></image>
                <image src="https://static.hudongmiao.com/joymewMp/nyn/rkFirstStage-01.png" class="rkFirstStage" mode="widthFix"></image>
                <view class="headImgBox">
                    <image src="{{topRankList[0].headimgurl}}" class="headImg"></image>
                </view>
                <view class="name">{{topRankList[0].nickname}}</view>
                <view class="money">{{topRankList[0].money}}元</view>
            </view>
            <view class="third" wx:if="{{topRankList[2]}}">
                <image src="https://static.hudongmiao.com/joymewMp/nyn/thirdRankBox1.png" class="rkThird" mode="widthFix"></image>
                <image src="https://static.hudongmiao.com/joymewMp/nyn/rkThirdStage-01.png" class="rkThirdStage" mode="widthFix"></image>
                <view class="headImgBox">
                    <image src="{{topRankList[2].headimgurl}}" class="headImg"></image>
                </view>
                <view class="name">{{topRankList[2].nickname}}</view>
                <view class="money">{{topRankList[2].money}}</view>
            </view>
        </view>
        <view class="other">
            <view class="otherItem" wx:for="{{otherRankList}}" wx:key="index">
                <view class="num">{{ item.num }}</view>
                <image src="{{item.headimgurl}}" class="headImg" mode="widthFix"></image>
                <view class="name">{{item.nickname}}</view>
                <view class="money">{{item.money}}元</view>
            </view>
        </view>
    </view>
    <!-- 反馈入口 -->
    <feedbackEntry userId="{{userId}}"></feedbackEntry>
</view>
````

## File: pages/nyn/nyn.wxss
````
.nynContainer {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

.nynContainer.rankShow {
  overflow: unset;
}

/* 公共背景区域 */
.nynContainer>.bgArea {
  width: 100%;
  position: absolute;
}

.nynContainer>.bgArea>.bg {
  width: 100%;
  height: 100%;
  position: absolute;
}

.nynContainer>.bgArea>.star {
  position: absolute;
  width: 100%;
  height: 267rpx;
  top: 0;
}

.nynContainer>.bgArea>.dotFall {
  position: absolute;
  width: 100%;
  height: 663rpx;
  top: 266rpx;
}

/* 等待界面 */
.nynContainer>.waitContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.nynContainer>.waitContainer>.prizePool {
  position: absolute;
  top: 25rpx;
  width: 529rpx;
  height: 119rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1;
}

.nynContainer>.waitContainer>.prizePool>.bg {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

.nynContainer>.waitContainer>.prizePool>.ct {
  font-size: 37rpx;
  font-weight: 500;
  color: #FFFFFF;
  text-shadow: 0px 2px 2px rgba(209, 41, 41, 0.5);
  position: absolute;
}

.nynContainer>.waitContainer>.prizePool>.ct>.money {
  font-size: 37rpx;
  font-weight: 500;
  color: #FFEAC2;
  text-shadow: 0px 2px 2px rgba(209, 41, 41, 0.5);
  margin-left: 22rpx;
}

.nynContainer>.waitContainer>.ruleBox {
  width: 658rpx;
  height: 622rpx;
  position: absolute;
  bottom: 516rpx;
}

.nynContainer>.waitContainer>.gameBox {
  width: 769rpx;
  height: 548rpx;
  position: absolute;
  bottom: -33rpx;
  display: flex;
  justify-content: center;
}

.nynContainer>.waitContainer>.gameBox>.gameBoxImg {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.waitContainer>.gameBox>.tip {
  font-size: 27rpx;
  font-weight: 500;
  color: #FFFDF0;
  position: absolute;
  top: 29rpx;
}

.nynContainer>.waitContainer>.gameBox>.tip>.strong {
  color: #F7D063;
}

.nynContainer>.waitContainer>.gameBox>.startBtn {
  font-size: 38rpx;
  color: #FFFFFF;
  width: 282rpx;
  height: 92rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: 64rpx;
}

.nynContainer>.waitContainer>.gameBox>.dmGiftTitle {
  position: absolute;
  top: 277rpx;
  width: 358rpx;
  height: 83rpx;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap {
  position: absolute;
  top: 364rpx;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem {
  width: 512rpx;
  height: 136rpx;
  position: relative;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.locatImg {
  width: 100%;
  height: 100%;
  position: absolute;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg {
  height: 133rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g1 {
  left: 16rpx;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g2 {
  left: 203rpx;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g3 {
  left: 389rpx;
}

.nynContainer>.waitContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg>image {
  width: 108rpx;
  height: 108rpx;
}

/* 扭一扭界面 */
.nynContainer>.gameContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.nynContainer>.gameContainer>.rechargeTipWarp {
  position: absolute;
  left: 0;
  top: 20rpx;
  padding-left: 30rpx;
  padding-right: 30rpx;
  height: 64rpx;
  border-radius: 32rpx;
  background-color: #cd2bfb;
  color: #ffe590;
  font-size: 24rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
}

.nynContainer>.gameContainer>.rechargeTipWarp>.star {
  margin-top: 8rpx;
  margin-right: 8rpx;
}

.nynContainer>.gameContainer>.eggBoxWrap>.prizePool {
  width: 474rpx;
  height: 117rpx;
  background-image: linear-gradient(180deg, #FF908A 0%, #FF7876 6%, #E1525D 100%);
  box-shadow: 0rpx 10rpx 3rpx 0rpx rgba(255, 249, 242, 0.31);
  border-radius: 11rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36rpx;
  font-weight: 500;
  color: #FFFFFF;
  text-shadow: 0px 1rpx 1rpx rgba(209, 41, 41, 0.5);
  top: -122rpx;
  position: absolute;
  z-index: 1;
}

.nynContainer>.gameContainer>.eggBoxWrap>.prizePool>.price {
  font-size: 36rpx;
  font-family: PingFang-SC-Heavy, PingFang-SC;
  font-weight: 800;
  color: #FDEAB0;
  text-shadow: 0px 1rpx 1rpx rgba(209, 41, 41, 0.5);
  margin-left: 10rpx;
}

.nynContainer>.gameContainer>.eggBoxWrap>.countDown {
  width: 264rpx;
  height: 66rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/nyn/marquee.png');
  background-size: 100% 100%;
  position: absolute;
  top: 16rpx;
  font-size: 28rpx;
  font-weight: 800;
  color: #FDEAB0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.nynContainer>.gameContainer>.eggBoxWrap {
  position: relative;
  width: 658rpx;
  height: 611rpx;
  margin-top: -11rpx;
  background-size: 100% 100%;
  position: absolute;
  bottom: 453rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs {
  position: absolute;
  width: 557rpx;
  height: 449rpx;
  top: 81rpx;
  left: 51rpx;
  overflow: hidden;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs>.eggItem {
  position: absolute;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs>.eggItem>.egg {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs>.eggItem>.egg>.hb {
  width: 80rpx;
  height: 94rpx;
  position: absolute;
  left: 29rpx;
  top: 18rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/nyn/hb01.png');
  background-size: 100% 100%;
  display: flex;
  justify-content: center;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs>.eggItem>.egg>.hb>text {
  font-size: 24rpx;
  font-weight: bold;
  text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.5);
  color: #ffffff;
  position: absolute;
  top: 24rpx;
  white-space: nowrap;
}

.nynContainer>.gameContainer>.eggBoxWrap>.eggs>.eggItem>.egg>.eggImg {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.gameContainer>.gameBox {
  width: 769rpx;
  height: 548rpx;
  position: absolute;
  bottom: -34rpx;
  display: flex;
  justify-content: center;
}

.nynContainer>.gameContainer>.gameBox>.gameBoxImg {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.gameContainer>.gameBox>.tip {
  font-size: 27rpx;
  font-weight: 500;
  color: #FFFDF0;
  position: absolute;
  top: 30rpx;
}
.nynContainer>.gameContainer>.gameBox>.agreement {
  font-size: 24rpx;
  font-weight: 400;
  color: #fff;
  position: absolute;
  top: 30rpx;
}
.nynContainer>.gameContainer>.gameBox>.tip.strong {
  color: #F7D063;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap {
  position: absolute;
  top: 364rpx;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem {
  width: 512rpx;
  height: 136rpx;
  position: relative;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.locatImg {
  width: 100%;
  height: 100%;
  position: absolute;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList {
  position: absolute;
  width: 100%;
  height: 100%;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg {
  height: 115rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  margin-top: 12rpx;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g1 {
  left: 69rpx;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g2 {
  left: 259rpx;
}

.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.g3 {
  left: 444rpx;
}
.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.choosed {
  background-color: #e04b4e;
  border: 2rpx solid #e04b4e;
}
.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg>.giftImage {
  width: 108rpx;
  height: 108rpx;
  position: absolute;
}
.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg>.lightImage {
  width: 200rpx;
  height: 200rpx;
  position: absolute;
}
.nynContainer>.gameContainer>.gameBox>.giftListWrap>.giftItem>.giftImgList>.giftImg.choosed>.giftImage {
  width: 108rpx;
  height: 108rpx;
  transform: scale(1.4);
}

.nynContainer>.gameContainer>.gameBox>.startBtn {
  font-size: 38rpx;
  color: #FFFFFF;
  width: 282rpx;
  height: 92rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: 66rpx;
}

.nynContainer>.gameContainer>.gameBox>.dmGiftTitle {
  position: absolute;
  top: 270rpx;
  width: 358rpx;
  height: 83rpx;
}

.nynContainer>.gameContainer>.gameBox>.eggExit {
  width: 223rpx;
  height: 262rpx;
  position: absolute;
  background-image: url('https://static.hudongmiao.com/joymewMp/nyn/chukou.png');
  background-size: 100% 100%;
  top: 253rpx;
  left: 58rpx;
}

.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap {
  position: absolute;
  width: 177rpx;
  height: 213rpx;
  top: 26rpx;
  left: 22rpx;
  overflow: hidden;
}

.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap>.luckyEgg {
  position: absolute;
  left: 41rpx;
  top: -110rpx;
}

.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap>.luckyEgg>.egg {
  position: absolute;
  width: 100%;
  height: 100%;
}
.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap>.luckyEgg>.egg>.hb {
  width: 53rpx;
  height: 65rpx;
  position: absolute;
  left: 40rpx;
  top: 40rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/nyn/hb01.png');
  background-size: 100% 100%;
  display: flex;
  justify-content: center;
}

.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap>.luckyEgg>.egg>.hb>text {
  font-size: 13rpx;
  font-weight: bold;
  text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.5);
  color: #FEDA80;
  position: absolute;
  top: 30rpx;
  white-space: nowrap;
}

.nynContainer>.gameContainer>.gameBox>.eggExit>.luckyEggWrap>.luckyEgg>.egg>.eggImg {
  width: 100%;
  height: 100%;
  position: absolute;
}

.nynContainer>.gameContainer>.resultTipWarp {
  width: 586rpx;
  height: 269rpx;
  position: absolute;
  right: 66rpx;
  top: 342rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding-left: 157rpx;
  padding-top: 44rpx;
}

.nynContainer>.gameContainer>.resultTipWarp>.bg {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

.nynContainer>.gameContainer>.resultTipWarp>.para1 {
  color: #ffffff;
  font-size: 36rpx;
  font-weight: bold;
  position: relative;
}

.nynContainer>.gameContainer>.resultTipWarp>.para2 {
  color: #ffffff;
  font-size: 32rpx;
  font-weight: bold;
  margin-top: 5rpx;
  position: relative;
}

.nynContainer>.gameContainer .rechargeTipAni {
  animation: rechargeTipAni 1s ease-out;
}

.nynContainer>.gameContainer .rechargeTipAni2 {
  animation: rechargeTipAni2 1s ease-out;
}

.nynContainer>.gameContainer .resultTipAni {
  animation: resultTipAni 1s ease-out;
}

.nynContainer>.gameContainer .resultTipAni2 {
  animation: resultTipAni2 1s ease-out;
}

@keyframes rechargeTipAni {
  from {
    transform: translateX(-100rpx);
  }

  to {
    transform: translateX(0rpx);
  }
}

@keyframes rechargeTipAni2 {
  from {
    transform: translateY(0);
    opacity: 1;
  }

  to {
    transform: translateY(-80rpx);
    opacity: 0;
  }
}

@keyframes resultTipAni {
  from {
    transform: translateX(200rpx);
  }

  to {
    transform: translateX(0rpx);
  }
}

@keyframes resultTipAni2 {
  from {
    transform: translateY(0);
    opacity: 1;
  }

  to {
    transform: translateY(-80rpx);
    opacity: 0;
  }
}

/* 排行榜界面 */
.nynContainer>.rankContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.nynContainer>.rankContainer>.topThree {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 0rpx;
}

.nynContainer>.rankContainer>.topThree>.second {
  width: 205rpx;
  height: 377rpx;
  position: relative;
}

.nynContainer>.rankContainer>.topThree>.second>.rkSecond {
  width: 205rpx;
  height: 230rpx;
  position: absolute;
  top: 76rpx;
  z-index: 2;

}

.nynContainer>.rankContainer>.topThree>.second>.rkSecondStage {
  width: 204rpx;
  height: 456rpx;
  position: absolute;
  top: 190rpx;
}

.nynContainer>.rankContainer>.topThree>.second>.headImgBox {
  width: 160rpx;
  height: 160rpx;
  border-radius: 50%;
  overflow: hidden;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  left: 23rpx;
  top: 103rpx;
  z-index: 1;
}

.nynContainer>.rankContainer>.topThree>.second>.headImgBox>.headImg {
  width: 135rpx;
  height: 135rpx;
  border-radius: 50%;
  position: absolute;
  top: 14rpx;
}

.nynContainer>.rankContainer>.topThree>.second>.name {
  font-size: 28rpx;
  color: #FFFFFF;
  width: 100%;
  position: absolute;
  top: 359rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.topThree>.second>.money {
  font-size: 28rpx;
  color: #FFF2B4;
  width: 100%;
  position: absolute;
  top: 413rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.topThree>.first {
  width: 257rpx;
  height: 471rpx;
  position: relative;
}

.nynContainer>.rankContainer>.topThree>.first>.rkFirst {
  width: 250rpx;
  height: 267rpx;
  position: absolute;
  z-index: 2;
}

.nynContainer>.rankContainer>.topThree>.first>.rkFirstStage {
  width: 204rpx;
  height: 593rpx;
  position: absolute;
  left: 26rpx;
  top: 139rpx;
}

.nynContainer>.rankContainer>.topThree>.first>.headImgBox {
  width: 183rpx;
  height: 180rpx;
  border-radius: 50%;
  overflow: hidden;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  left: 36rpx;
  top: 17rpx;
  z-index: 1;
}

.nynContainer>.rankContainer>.topThree>.first>.headImgBox>.headImg {
  width: 156rpx;
  height: 156rpx;
  border-radius: 50%;
  position: absolute;
  top: 27rpx;
}

.nynContainer>.rankContainer>.topThree>.first>.name {
  font-size: 28rpx;
  color: #FFFFFF;
  width: 100%;
  position: absolute;
  top: 304rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.topThree>.first>.money {
  font-size: 28rpx;
  color: #FFF2B4;
  width: 100%;
  position: absolute;
  top: 356rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.topThree>.third {
  width: 191rpx;
  height: 367rpx;
  position: relative;
}

.nynContainer>.rankContainer>.topThree>.third>.rkThird {
  width: 188rpx;
  height: 202rpx;
  position: absolute;
  z-index: 2;
  top: 115rpx;
}

.nynContainer>.rankContainer>.topThree>.third>.rkThirdStage {
  width: 192rpx;
  height: 431rpx;
  position: absolute;
  top: 194rpx;
  left: 0rpx;
}

.nynContainer>.rankContainer>.topThree>.third>.headImgBox {
  width: 160rpx;
  height: 160rpx;
  border-radius: 50%;
  overflow: hidden;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  left: 14rpx;
  top: 103rpx;
  z-index: 1;
}

.nynContainer>.rankContainer>.topThree>.third>.headImgBox>.headImg {
  width: 135rpx;
  height: 135rpx;
  border-radius: 50%;
  position: absolute;
  top: 19rpx;
}

.nynContainer>.rankContainer>.topThree>.third>.name {
  font-size: 28rpx;
  color: #FFFFFF;
  width: 100%;
  position: absolute;
  top: 359rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.topThree>.third>.money {
  font-size: 28rpx;
  color: #FFF2B4;
  width: 100%;
  position: absolute;
  top: 413rpx;
  text-align: center;
}

.nynContainer>.rankContainer>.other {
  width: 670rpx;
  height: 978rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/nyn/rkBox-01.png');
  background-size: 100% 100%;
  position: absolute;
  z-index: 2;
  top:430rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 51rpx;
}

.nynContainer>.rankContainer>.other>.otherItem {
  width: 548rpx;
  height: 112rpx;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.5);
  width: 494rpx;
  align-items: center;
  position: relative;
  display: flex;
}

.nynContainer>.rankContainer>.other>.otherItem>.num {
  font-size: 34rpx;
  color: #FFFFFF;
}

.nynContainer>.rankContainer>.other>.otherItem>.headImg {
  width: 64rpx;
  height: 64rpx;
  margin-left: 15rpx;
  border-radius: 50%;
}

.nynContainer>.rankContainer>.other>.otherItem>.name {
  font-size: 30rpx;
  color: #FFFFFF;
  position: absolute;
  left: 154rpx;
}

.nynContainer>.rankContainer>.other>.otherItem>.money {
  font-size: 28rpx;
  color: #FFF2B4;
  position: absolute;
  right: 16rpx;
}

.fallAni {
  animation: fallAni 1s linear backwards;
}

.fallLuckyAni {
  animation: fallLuckyAni 1s linear backwards;
}

.rotateAni {
  animation: rotateAni 1s linear backwards infinite;
}
.lightAni {
  animation: lightAni 1s linear backwards infinite;
}
.aroundAni1 {
  animation: aroundAni1 2s linear infinite;
}

.aroundAni2 {
  animation: aroundAni2 2s linear infinite;
}

.aroundAni3 {
  animation: aroundAni3 2s linear infinite;
}

.aroundAni4 {
  animation: aroundAni4 2s linear infinite;
}

.aroundAni5 {
  animation: aroundAni5 2s linear infinite;
}

.aroundAni6 {
  animation: aroundAni6 2s linear infinite;
}

.aroundAni7 {
  animation: aroundAni7 2s linear infinite;
}

.aroundAni8 {
  animation: aroundAni8 2s linear infinite;
}
@keyframes fallLuckyAni {
  0% {
    transform: translateY(0);
  }

  40% {
    transform: translateY(208rpx);
  }

  50% {
    transform: translateY(150rpx);
  }

  60% {
    transform: translateY(208rpx);
  }

  70% {
    transform: translateY(175rpx);
  }

  80% {
    transform: translateY(208rpx);
  }

  90% {
    transform: translateY(199rpx);
  }

  100% {
    transform: translateY(208rpx);
  }
}

@keyframes fallAni {
  0% {
    transform: translateY(-300%);
    opacity: 0;
  }

  5% {
    transform: translateY(-300%);
  }

  15% {
    transform: translateY(0);
  }

  30% {
    transform: translateY(-100%);
  }

  40% {
    transform: translateY(0%);
  }

  50% {
    transform: translateY(-60%);
  }

  70% {
    transform: translateY(0%);
  }

  80% {
    transform: translateY(-30%);
  }

  90% {
    transform: translateY(0%);
  }

  95% {
    transform: translateY(-14%);
  }

  97% {
    transform: translateY(0%);
  }

  99% {
    transform: translateY(-6%);
  }

  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes rotateAni {
  0% {
    transform: rotate(0);
  }

  100% {
    transform: rotate(360deg);
  }
}

@keyframes aroundAni1 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(299rpx, -150rpx);
  }

  40% {
    transform: translate(100rpx, -300rpx);
  }

  60% {
    transform: translate(-115rpx, -150rpx);
  }

  80% {
    transform: translate(-85rpx, -52rpx);
  }

  100% {
    transform: translate(185rpx, -152rpx);
  }
}

@keyframes aroundAni2 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(158rpx, -222rpx);
  }

  40% {
    transform: translate(60rpx, -18rpx);
  }

  60% {
    transform: translate(-200rpx, -230rpx);
  }

  80% {
    transform: translate(-255rpx, -32rpx);
  }

  100% {
    transform: translate(0rpx, -132rpx);
  }
}

@keyframes aroundAni3 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(-360rpx, -185rpx);
  }

  40% {
    transform: translate(25rpx, -10rpx);
  }

  60% {
    transform: translate(-125rpx, -210rpx);
  }

  80% {
    transform: translate(-392rpx, -100rpx);
  }

  100% {
    transform: translate(-50rpx, 15rpx);
  }
}

@keyframes aroundAni4 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(416rpx, -162rpx);
  }

  40% {
    transform: translate(120rpx, -180rpx);
  }

  60% {
    transform: translate(0rpx, 20rpx);
  }

  80% {
    transform: translate(416rpx, -163rpx);
  }

  100% {
    transform: translate(216rpx, 76rpx);
  }
}

@keyframes aroundAni5 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(292rpx, -108rpx);
  }

  40% {
    transform: translate(30rpx, 132rpx);
  }

  60% {
    transform: translate(-125rpx, -110rpx);
  }

  80% {
    transform: translate(150rpx, -132rpx);
  }

  100% {
    transform: translate(290rpx, 60rpx);
  }
}

@keyframes aroundAni6 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(152rpx, -85rpx);
  }

  40% {
    transform: translate(-263rpx, 105rpx);
  }

  60% {
    transform: translate(152rpx, -50rpx);
  }

  80% {
    transform: translate(-160rpx, -100rpx);
  }

  100% {
    transform: translate(-263rpx, 105rpx);
  }
}

@keyframes aroundAni7 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(-412rpx, -55rpx);
  }

  40% {
    transform: translate(-190rpx, 196rpx);
  }

  60% {
    transform: translate(6rpx, -40rpx);
  }

  80% {
    transform: translate(-300rpx, -70rpx);
  }

  100% {
    transform: translate(-410rpx, 136rpx);
  }
}

@keyframes aroundAni8 {
  0% {
    transform: translate(0rpx, 0rpx);
  }

  20% {
    transform: translate(300rpx, -44rpx);
  }

  40% {
    transform: translate(408rpx, 90rpx);
  }

  60% {
    transform: translate(70rpx, 170rpx);
  }

  80% {
    transform: translate(270rpx, -40rpx);
  }

  100% {
    transform: translate(408rpx, 136rpx);
  }
}
@keyframes lightAni {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@media screen and (max-height: 580px) {
  .nynContainer>.waitContainer>.ruleBox {
    bottom: 433rpx;
  }
}

@media screen and (min-height: 720px) {
  .nynContainer>.gameContainer>.title {
    top: 65rpx;
  }
}
````

## File: pages/pay/pay.wxml
````
<!-- 此页面只用来调起支付 -->
<view></view>
````

## File: pages/photographerWall/photographerWall.js
````javascript
import { getToken, getLiveId } from '../../utils/storage';
import { getCurrentTimestamp } from '../../utils/date';
import { PAGE_HOST } from '../../assets/constant/host';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '现场照片',
    token: ''
  },
  onLoad: function () {
    app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photographerWall`);
    console.log(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photographerWall`);
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: app.globalData.activityTitle
    });
  },
  onShow: function () {
    if (app.globalData.isH5NeedRefresh) {
      console.log('***h5 needRefresh***');
      app.globalData.isH5NeedRefresh = false;
      app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photographerWall`);
      this.setData({
        h5Url: app.globalData.h5Url,
      });
    }
  },
  onShareAppMessage: function () {
    return {
      title: this.data.activityTitle,
      path: '/pages/joymewIndex/joymewIndex?liveId=' + this.data.liveId,
    };
  },
})
````

## File: pages/photographerWall/photographerWall.json
````json
{
  "navigationBarTitleText": "现场照片"
}
````

## File: pages/photographerWall/photographerWall.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/photographerWall/photographerWall.wxss
````
page {
  background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/photoWall/photoWall.js
````javascript
import { getToken, getLiveId, setLiveId } from '../../utils/storage';
import { getCurrentTimestamp } from '../../utils/date';
import { PAGE_HOST } from '../../assets/constant/host';
const app = getApp();

Page({
  data: {
    h5Url: '',
    liveId: '',
    activityTitle: '照片墙',
    token: ''
  },
  onLoad: function (options) {
    if (options.liveId && options.token) {
      // 分享进入
      setLiveId(options.liveId);
      app.setH5Url(`${PAGE_HOST}?liveId=${options.liveId}&token=${options.token}&time=${getCurrentTimestamp()}&photoWallShare=1#/photoWall`);
    } else {
      app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photoWall`);
    }
    console.log(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photoWall`);
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: `照片墙(${app.globalData.activityTitle})`
    });
  },
  onShow: function () {
    if (app.globalData.isH5NeedRefresh) {
      console.log('***h5 needRefresh***');
      app.globalData.isH5NeedRefresh = false;
      app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photoWall`);
      // app.setH5Url(`${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}#/photoWall`);
      this.setData({
        h5Url: app.globalData.h5Url,
      });
    }
  },
  onShareAppMessage: function () {
    return {
      title: this.data.activityTitle,
      path: `/pages/photoWall/photoWall?liveId=${getLiveId()}&token=${getToken()}`,
    };
  },
})
````

## File: pages/photoWall/photoWall.json
````json
{
  "navigationBarTitleText": "照片墙"
}
````

## File: pages/photoWall/photoWall.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/photoWall/photoWall.wxss
````
page {
  background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
}
````

## File: pages/recharge/recharge.js
````javascript
import { getGiftRankList, diamondRecharge, becomeVip } from '../../api/recharge/recharge';
import { wxPay } from '../../api/pay';
import { timeoutTask, showWxToast } from '../../utils/index';
import { setAdPopFlag, getAdPopFlag } from '../../utils/storage';

const app = getApp();
let requestLock = false;
// let showVideoAdLock = false;
// 在页面中定义激励视频广告
let videoAd = null
const couponUrl = ['https://static.hudongmiao.com/joymewMp/recharge/coupon.png', 'https://static.hudongmiao.com/joymewMp/recharge/coupon2.png']
Page({
    data: {
        userId: '',
        openId: '',
        moneyInput: '',
        money: 0,
        remainMoney: 0,
        nickname: '',
        headImg: '',
        rechargeList: [],
        activeDesc: '0',
        couponUrl: '',
        activeCouponUrl: '',
        giftRankList: [],
        isVipHeadBoxGetted: false,
        popupModVisible: false,
        isShowBagAni: false,
        isHideBagAni: false,
    },
    onLoad: function (options) {
        this.setData({
            userId: options.userId,
            openId: options.openId,
            remainMoney: options.money,
            rechargeList: options.rechargeListStr.split(','),
            nickname: options.name,
            headImg: options.headImg,
            couponUrl: couponUrl[0],
            activeCouponUrl: couponUrl[1],
            isVipHeadBoxGetted: options.isVipHeadBoxGetted === 'false' ? false : true,
        });
        // showVideoAdLock = false;
        this.getGiftRankList();
        // if (!this.data.isVipHeadBoxGetted) {
        //     if (wx.createRewardedVideoAd) {
        //         let tmpAdPopFlag = getAdPopFlag();
        //         if (!tmpAdPopFlag) {
        //             setAdPopFlag();
        //             // 弹出广告
        //             this.showPopupMod();
        //         }
        //         videoAd = wx.createRewardedVideoAd({
        //             adUnitId: 'adunit-bf5d5ab9f926a2de'
        //         });
        //         videoAd.onLoad(() => {
        //         });
        //         videoAd.onError(() => {
        //             console.log('广告视频加载出错');
        //             showVideoAdLock = false;
        //         });
        //         videoAd.onClose((res) => {
        //             showVideoAdLock = false;
        //             if (res && res.isEnded) {
        //                 console.log('领取奖励')
        //                 // 用户观看完广告视频领取奖励
        //                 becomeVip().then((res) => {
        //                     console.log(res);
        //                     app.globalData.isH5NeedRefresh = true;
        //                     timeoutTask(() => {
        //                         wx.navigateBack();
        //                     }, 1000);
        //                 }).catch((err) => {
        //                     console.log(err);
        //                 })
        //             } else {
        //                 console.log('中途退出，没有奖励!');
        //             }
        //         });
        //     }
        // }
    },
    onShow: function () {
    },
    onUnload: function () {
    },
    chooseMoney: function (e) {
        // 取消money输入区域的输入金额并设置输入的money值
        this.setData({
            moneyInput: '',
            money: e.currentTarget.dataset.desc,
            activeDesc: e.currentTarget.dataset.desc,
        });
        console.log(this.data.money);
    },
    handleMoneyInput: function (e) {
        let tmpMoneyStr = e.detail.value;
        let r = /^\+?[1-9][0-9]*$/;　　//正整数
        let flag = r.test(tmpMoneyStr);
        if (flag || tmpMoneyStr === '0.01') {
            // 只能是正整数或者是0.01
            this.setData({
                money: tmpMoneyStr,
            });
        } else {
            this.setData({
                money: '',
            });
        }
    },
    handleMoneyFocus: function () {
        // 取消money选择区域的active状态
        this.setData({
            activeDesc: '0',
        });
    },
    handleRecharge: function () {
        if (!this.data.money) {
            showWxToast('请输入或者选择充值金额!');
            return;
        }
        if (this.data.money === '0') {
            showWxToast('充值金额不能为0!');
            return;
        }
        this.recharge();
    },
    recharge: function () {
        if (!requestLock) {
            requestLock = true;
            diamondRecharge({
                total: this.data.money,
                userId: this.data.userId,
                openId: this.data.openId,
            }).then((res) => {
                console.log(res);
                return wxPay(res);
            }).then(() => {
                // 前端处理用户余额增加
                const tmpRemainMoney = (parseFloat(this.data.remainMoney) + parseFloat(this.data.money)).toFixed(2);
                this.setData({
                    remainMoney: tmpRemainMoney,
                });
                showWxToast('充值成功!');
                requestLock = false;
                app.globalData.isH5NeedRefresh = true;
                timeoutTask(() => {
                    wx.navigateBack();
                }, 1000);
            }).catch((err) => {
                console.log(err);
                showWxToast('充值失败!');
                requestLock = false;
            });
        }
    },
    getGiftRankList: function () {
        getGiftRankList().then((res) => {
            console.log(res);
            const tmpList = res.data.list;
            const tmpLen = tmpList.length;
            for (let i = 0; i < tmpLen; i += 1) {
                tmpList[i].num = (i + 1) < 10 ? '0' + (i + 1) : i + 1;
                tmpList[i].wx_name = tmpList[i].wx_name.length <= 6 ? tmpList[i].wx_name : tmpList[i].wx_name.substr(0, 6) + '...';
            }
            this.setData({
                giftRankList: tmpList,
            });
        }).catch((err) => {
            console.log(err);
        });
    },
    toAgreement: function () {
        wx.navigateTo({
            url: '/pages/agreement/agreement',
        });
    },
    showPopupMod: function () {
        this.setData({
            popupModVisible: true,
            isShowBagAni: true,
        });
        timeoutTask(() => {
            this.setData({
                isShowBagAni: false,
            });
        }, 300);
    },
    hidePopupMod: function () {
        this.setData({
            isHideBagAni: true,
        });
        timeoutTask(() => {
            this.setData({
                isHideBagAni: false,
                popupModVisible: false,
            });
        }, 300);
    },
    toGetHeadImgBox: function () {
        if (showVideoAdLock) {
            return;
        }
        // 用户触发广告后，显示激励视频广告
        if (videoAd) {
            showVideoAdLock = true;
            this.hidePopupMod();
            videoAd.show().catch(() => {
                // 失败重试
                videoAd.load()
                    .then(() => videoAd.show())
                    .catch(err => {
                        console.log('激励视频 广告显示失败');
                        showVideoAdLock = false;
                    })
            })
        }
    }
});
````

## File: pages/recharge/recharge.json
````json
{
  "navigationBarTitleText": "充值中心",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  }
}
````

## File: pages/recharge/recharge.wxml
````
<view class="rechargeContainer">
  <image src="https://static.hudongmiao.com/joymewMp/recharge/bg-01.png" class="bg" mode="widthFix"></image>
  <image src="{{headImg}}" class="headImg"></image>
  <!-- <view wx:if="{{!isVipHeadBoxGetted && !popupModVisible}}" class="getRewardBtn" bindtap="showPopupMod">领取奖励</view> -->
  <view class="nickname">{{nickname}}</view>
  <view class="remain">
    <image src="https://static.hudongmiao.com/joymewMp/recharge/diamonds.png" class="diamondIcon"></image>
    <view class="remainMoney">{{remainMoney}}</view>
  </view>
  <!-- 自定义充值区域 -->
  <view class="customRechargeArea">
    <view class="title">充值金额</view>
    <input placeholder="自定义充值金额" type="number" maxlength="4" value="{{moneyInput}}" bindinput="handleMoneyInput" bindfocus="handleMoneyFocus" />
  </view>
  <!-- 固定充值金额区域 -->
  <view class="limitRechargeArea">
    <view class="rechargeItem" style="background-image:url('{{activeDesc === item ? activeCouponUrl : couponUrl}}')" wx:for="{{rechargeList}}" wx:key="index" data-desc="{{item}}" bindtap="chooseMoney">
      <image src="https://static.hudongmiao.com/joymewMp/recharge/diamonds.png" class="diamondIcon"></image>
      <view class="num {{activeDesc === item?'active':''}}">{{item}}</view>
    </view>
  </view>
  <view class="rechargeBtn" bindtap="handleRecharge">立即充值</view>
  <view class="agreement" bindtap="toAgreement">阅读并同意《充值服务协议》</view>
  <view class="wishSheetTitle">
    <image src="https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png" class="loveIcon"></image>
    <view class="title">祝福榜单</view>
    <image src="https://static.hudongmiao.com/joymewMp/recharge/loveIcon.png" class="loveIcon"></image>
  </view>
  <view class="wishSheetList">
    <view class="item" wx:for="{{giftRankList}}" wx:key="index">
      <view class="leftCt">
        <image src="https://static.hudongmiao.com/joymewMp/recharge/firstMedal.png" class="medalImg" wx:if="{{index === 0}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/recharge/secondMedal.png" class="medalImg" wx:if="{{index === 1}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/recharge/thirdMedal.png" class="medalImg" wx:if="{{index === 2}}"></image>
        <view class="num" wx:if="{{index > 2}}">{{item.num}}</view>
        <image src="{{item.avator}}" class="headImg"></image>
        <view class="name">{{item.wx_name}}</view>
      </view>
      <view class="wish">送出价值{{item.size}}个钻礼物</view>
    </view>
  </view>
  <!-- 反馈入口 -->
  <feedbackEntry userId="{{userId}}"></feedbackEntry>
  <!-- 隐私授权弹窗 -->
  <privacyAuthorize></privacyAuthorize>
</view>
````

## File: pages/recharge/recharge.wxss
````
.rechargeContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.rechargeContainer>.bg {
    position: absolute;
    width: 100%;
}

.rechargeContainer>.headImg {
    position: absolute;
    width: 105rpx;
    height: 99rpx;
    top: 102rpx;
}

.rechargeContainer>.getRewardBtn {
    width: 130rpx;
    height: 36rpx;
    background: #FFDB27;
    border-radius: 18rpx 18rpx 18rpx 0rpx;
    position: absolute;
    top: 109rpx;
    right: 167rpx;
    font-size: 18rpx;
    font-weight: bold;
    color: #D8241D;
    display: flex;
    justify-content: center;
    align-items: center;
}

.rechargeContainer>.nickname {
    font-size: 30rpx;
    font-weight: 400;
    color: #FFFFFF;
    position: absolute;
    top: 222rpx;
}

.rechargeContainer>.remain {
    display: flex;
    align-items: center;
    font-size: 34rpx;
    font-weight: 500;
    position: absolute;
    color: #FFFFFF;
    top: 294rpx;
}

.rechargeContainer>.remain>.diamondIcon {
    width: 40rpx;
    height: 32rpx;
    margin-right: 13rpx;
}

.rechargeContainer>.customRechargeArea {
    width: 648rpx;
    height: 184rpx;
    background: #FEE857;
    border-radius: 15rpx 15rpx 0rpx 0rpx;
    position: absolute;
    top: 378rpx;
    display: flex;
    justify-content: center;
}

.rechargeContainer>.customRechargeArea>.title {
    font-size: 24rpx;
    font-weight: 400;
    color: #A24935;
    position: absolute;
    top: 32rpx;
    left: 44rpx;
}

.rechargeContainer>.customRechargeArea>input {
    width: 572rpx;
    height: 66rpx;
    font-size: 32rpx;
    font-weight: 400;
    color: #A24935;
    border-bottom: 1rpx solid rgba(162, 73, 53, 0.3);
    position: absolute;
    top: 78rpx;
}

.rechargeContainer>.limitRechargeArea {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    position: absolute;
    top: 615rpx;
    width: 641rpx;
}

.rechargeContainer>.limitRechargeArea>.rechargeItem {
    width: 187rpx;
    height: 180rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 32rpx 0;
    background-size: 100% 100%;
}

.rechargeContainer>.limitRechargeArea>.rechargeItem>.diamondIcon {
    width: 69rpx;
    height: 55rpx;
}

.rechargeContainer>.limitRechargeArea>.rechargeItem>.num {
    font-size: 55rpx;
    font-weight: 500;
    color: #9C2CF3;
    margin-top: 6rpx;
}

.rechargeContainer>.limitRechargeArea>.rechargeItem>.num.active {
    color: #FFFFFF;
}

.rechargeContainer>.rechargeBtn {
    position: absolute;
    width: 500rpx;
    height: 79rpx;
    border-radius: 6rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/recharge/btn.png');
    background-size: 100% 100%;
    top: 1101rpx;
    text-align: center;
    line-height: 79rpx;
    font-size: 34rpx;
    font-weight: 500;
    color: #A24935;
}

.rechargeContainer>.agreement {
    font-size: 24rpx;
    font-weight: 500;
    color: #9C2BF3;
    position: absolute;
    top: 1200rpx;
}

.rechargeContainer>.wishSheetTitle {
    display: flex;
    align-items: center;
    position: absolute;
    top: 1288rpx;
    font-size: 36rpx;
    font-weight: 500;
    color: #FFFFFF;
}

.rechargeContainer>.wishSheetTitle>.loveIcon {
    width: 30rpx;
    height: 26rpx;
    margin: 0 30rpx;
}

.rechargeContainer>.wishSheetList {
    position: absolute;
    top: 1355rpx;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #8A1DD3;
}

.rechargeContainer>.wishSheetList>.item {
    width: 695rpx;
    height: 114rpx;
    background: rgba(84, 59, 144, 0.3);
    border-radius: 8rpx;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 35rpx 0 28rpx;
}

.rechargeContainer>.wishSheetList>.item>.leftCt {
    display: flex;
    align-items: center;
}

.rechargeContainer>.wishSheetList>.item>.leftCt>.medalImg {
    width: 39rpx;
    height: 50rpx;
}

.rechargeContainer>.wishSheetList>.item>.leftCt>.headImg {
    width: 64rpx;
    height: 64rpx;
    border-radius: 50%;
    margin: 0 22rpx 0 17rpx;
}

.rechargeContainer>.wishSheetList>.item>.leftCt>.name {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFFF;
}

.rechargeContainer>.wishSheetList>.item>.leftCt>.num {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFFFFF;
}

.rechargeContainer>.wishSheetList>.item>.wish {
    font-size: 28rpx;
    font-weight: 400;
    color: #FFF32E;
}

.rechargeContainer>.adContainer {
    position: fixed;
    top: 125rpx;
    right: 8rpx;
    z-index: 2;
}

.rechargeContainer>.popupMod {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1;
}

.rechargeContainer>.popupMod>.bagBox {
    width: 670rpx;
    height: 938rpx;
    background-image: url('https://static.joymew.com/joymewMp/adReward/bag.png');
    background-size: 100% 100%;
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.rechargeContainer>.popupMod>.bagBox>.tit {
    font-size: 36rpx;
    font-weight: bold;
    color: #FFFFFF;
    background: linear-gradient(0deg, #F7FED2 0%, #FCED9B 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top: 404rpx;
    letter-spacing: 2rpx;
}

.rechargeContainer>.popupMod>.bagBox>.headImgBox {
    width: 177rpx;
    height: 155rpx;
    margin-top: 56rpx;
}

.rechargeContainer>.popupMod>.bagBox>.tip {
    font-size: 24rpx;
    font-weight: bold;
    color: #FFFFFF;
    background: linear-gradient(0deg, #F7FED2 0%, #FCED9B 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top: 40rpx;
}

.rechargeContainer>.popupMod>.bagBox>.getBtn {
    width: 360rpx;
    height: 90rpx;
    background: linear-gradient(166deg, #F5E8CE, #DBB782);
    box-shadow: 2rpx 14rpx 24rpx 0rpx #84010F;
    border-radius: 45rpx;
    margin-top: 24rpx;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 36rpx;
    font-weight: bold;
    color: #6B2B24;
}

.rechargeContainer>.popupMod>.bagBox>.getBtn>.videoIcon {
    width: 44rpx;
    height: 31rpx;
    position: absolute;
    left: 59rpx;
}

.rechargeContainer>.popupMod>.bagBox>.closeIcon {
    width: 82rpx;
    height: 82rpx;
    position: absolute;
    bottom: -60rpx;
}

.showBagAni {
    animation: zoomIn 0.3s linear;
}

.hideBagAni {
    animation: zoomOut 0.3s linear;
}

@keyframes zoomIn {
    from {
        opacity: 0;
        -webkit-transform: scale3d(0.3, 0.3, 0.3);
        transform: scale3d(0.3, 0.3, 0.3);
    }

    50% {
        opacity: 1;
    }
}

@keyframes zoomOut {
    from {
        opacity: 1;
    }

    50% {
        opacity: 0;
        -webkit-transform: scale3d(0.3, 0.3, 0.3);
        transform: scale3d(0.3, 0.3, 0.3);
    }

    to {
        opacity: 0;
    }
}
````

## File: pages/recharge2/recharge2.js
````javascript
import {
  getRoleGiftRankList,
  diamondRecharge,
  wxChooseImage,
  uploadHeadImg,
  editUserInfo,
} from "../../api/recharge/recharge";
import { wxPay } from "../../api/pay";
import { logOff } from "../../api/login";
import {
  timeoutTask,
  showWxToast,
  showWxLoading,
  hideWxLoading,
} from "../../utils/index";
import { getUserPhone, getLiveId } from "../../utils/storage";

const app = getApp();
let requestLock = false;
// let showVideoAdLock = false;
// 在页面中定义激励视频广告
// let videoAd = null;
Page({
  data: {
    userId: "",
    openId: "",
    money: 0,
    remainMoney: 0,
    nickname: "",
    headImg: "",
    rechargeList: [],
    giftRankListBoy: [],
    giftRankListGirl: [],
    popupModVisible: false,
    isShowBagAni: false,
    isHideBagAni: false,
    deskList: [],
    editPopupVisible: false,
    editPopupAni: false,
    vipLevel: "",
    relativeType: "",
    currentStatus: "",
    editUserInfoPrice: "0",
    deskNum: "",
    statusList: ["伴郎", "伴娘", "单身贵族", "高富帅", "白富美", "钻石王老五"],
    formData: {
      avator: "",
      wx_name: "",
      type: "",
      table_number: "",
      position: "",
      userPhone: "",
    },
    logoutPopupVisible: false,
    logoutAgreementChecked: false,
  },
  onLoad: function (options) {
    const tmpDeskList = [];
    for (let i = 0; i < 90; i += 1) {
      if (i < 3) {
        tmpDeskList.push(i + 1);
      } else if (i < 12) {
        tmpDeskList.push(i + 2);
      } else if (i < 21) {
        tmpDeskList.push(i + 3);
      } else if (i < 30) {
        tmpDeskList.push(i + 4);
      } else if (i < 39) {
        tmpDeskList.push(i + 5);
      } else if (i < 48) {
        tmpDeskList.push(i + 6);
      } else if (i < 57) {
        tmpDeskList.push(i + 7);
      } else if (i < 66) {
        tmpDeskList.push(i + 8);
      } else if (i < 75) {
        tmpDeskList.push(i + 9);
      } else if (i < 84) {
        tmpDeskList.push(i + 10);
      } else {
        tmpDeskList.push(i + 11);
      }
    }
    this.setData({
      deskList: tmpDeskList,
    });
    this.setData({
      userId: options.userId,
      openId: options.openId,
      remainMoney: options.money,
      rechargeList: options.rechargeListStr.split(","),
      nickname: options.name,
      headImg: options.headImg,
      vipLevel: options.vipLevel,
      relativeType: options.relativeType,
      currentStatus: options.currentStatus,
      editUserInfoPrice: options.editUserInfoPrice,
      deskNum: options.deskNum,
    });
    let userPhone = getUserPhone() || "";
    let tmpFormData = {
      avator: this.data.headImg || "",
      wx_name: this.data.nickname || "",
      type: this.data.relativeType || "",
      table_number: this.data.deskNum || "",
      position: this.data.currentStatus || "",
      userPhone: userPhone,
    };
    this.setData({
      formData: tmpFormData,
    });
    this.getGiftRankList();
  },
  onShow: function () {},
  onUnload: function () {},
  handleRecharge: function () {
    this.recharge();
  },
  recharge: function (e) {
    if (!requestLock) {
      requestLock = true;
      this.setData({
        money: e.currentTarget.dataset.desc,
      });
      diamondRecharge({
        total: this.data.money,
        userId: this.data.userId,
        openId: this.data.openId,
      })
        .then((res) => {
          console.log(res);
          return wxPay(res);
        })
        .then(() => {
          // 前端处理用户余额增加
          const tmpRemainMoney = (
            parseFloat(this.data.remainMoney) + parseFloat(this.data.money)
          ).toFixed(2);
          this.setData({
            remainMoney: tmpRemainMoney,
          });
          showWxToast("充值成功!");
          requestLock = false;
          app.globalData.isH5NeedRefresh = true;
        })
        .catch((err) => {
          console.log(err);
          showWxToast("充值失败!");
          requestLock = false;
        });
    }
  },
  getGiftRankList: function () {
    getRoleGiftRankList()
      .then((res) => {
        console.log("男方女方送礼物榜单");
        console.log(res);
        res.data.list1.map((item) => {
          return {
            ...item,
            wx_name:
              item.wx_name.length > 4
                ? item.wx_name.slice(0, 4) + "..."
                : item.wx_name,
          };
        });
        res.data.list2.map((item) => {
          return {
            ...item,
            wx_name:
              item.wx_name.length > 4
                ? item.wx_name.slice(0, 4) + "..."
                : item.wx_name,
          };
        });
        this.setData({
          giftRankListBoy: res.data.list1,
          giftRankListGirl: res.data.list2,
        });
      })
      .catch((err) => {
        console.log(err);
      });
  },
  toAgreement: function (e) {
    const type = e.currentTarget.dataset.type;
    if (type === "privacy") {
      const OUTER_URL =
        "https://ustatic.hudongmiao.com/joymewMp/agreement/privacy.html";
      wx.navigateTo({
        url: `/pages/agreement/agreement?outerUrl=${OUTER_URL}&needRevert=1`,
      });
    } else {
      wx.navigateTo({
        url: "/pages/agreement/agreement",
      });
    }
  },
  showPopupMod: function () {
    this.setData({
      popupModVisible: true,
      isShowBagAni: true,
    });
    timeoutTask(() => {
      this.setData({
        isShowBagAni: false,
      });
    }, 300);
  },
  hideEditPopup: function () {
    this.setData({
      editPopupAni: false,
    });
    timeoutTask(() => {
      this.setData({
        editPopupVisible: false,
      });
    }, 300);
  },
  showEditPopup: function () {
    this.setData({
      editPopupVisible: true,
    });
    timeoutTask(() => {
      this.setData({
        editPopupAni: true,
      });
    }, 100);
  },
  //上传图片
  upload: function () {
    let tempFilePaths;
    let tmpFormData = this.data.formData;
    wxChooseImage()
      .then((res) => {
        console.log(res);
        tempFilePaths = res.tempFilePaths;
        tmpFormData.avator = tempFilePaths[0];
        this.setData({
          formData: tmpFormData,
        });
      })
      .catch((err) => {
        console.log(err);
      });
  },
  chooseRelatives: function (e) {
    console.log(e.detail.value);
    let tmpFormData = this.data.formData;
    tmpFormData.type = e.detail.value;
    this.setData({
      formData: tmpFormData,
    });
  },
  handlePickerChange: function (e) {
    console.log(e.detail.value);
    let tmpFormData = this.data.formData;
    tmpFormData.table_number = this.data.deskList[e.detail.value];
    this.setData({
      formData: tmpFormData,
    });
  },
  chooseStatus: function (e) {
    console.log(e.currentTarget.dataset.status);
    let tmpFormData = this.data.formData;
    tmpFormData.position = e.currentTarget.dataset.status;
    this.setData({
      formData: tmpFormData,
    });
  },
  editRecharge: function (cb) {
    diamondRecharge({
      total: this.data.editUserInfoPrice,
      userId: this.data.userId,
      openId: this.data.openId,
    })
      .then((res) => {
        console.log(res);
        return wxPay(res);
      })
      .then(() => {
        cb();
      })
      .catch((err) => {
        console.log(err);
        showWxToast("修改失败!");
      });
  },
  handleNameBlur: function (e) {
    console.log(e.detail.value);
    let tmpFormData = this.data.formData;
    tmpFormData.wx_name = e.detail.value;
    this.setData({
      formData: tmpFormData,
    });
  },
  handlePhoneBlur: function (e) {
    const app = getApp();
    const phone = e.detail.value;
    // 更新 formData.userPhone
    let tmpFormData = this.data.formData;
    tmpFormData.userPhone = phone;
    this.setData({
      formData: tmpFormData,
    });
    app.setUserPhone(phone);
  },
  confirmEdit: function () {
    console.log(this.data.formData);
    let tmpFormData = this.data.formData;
    if (!tmpFormData.avator) {
      showWxToast("头像不能为空!");
      return;
    }
    if (!tmpFormData.wx_name) {
      showWxToast("姓名不能为空!");
      return;
    }
    if (!tmpFormData.type) {
      showWxToast("请选择亲友团!");
      return;
    }
    if (!tmpFormData.table_number) {
      showWxToast("请选择桌号!");
      return;
    }
    if (!tmpFormData.position) {
      showWxToast("请选择身份!");
      return;
    }
    // 手机号校验
    if (!/^1[3-9]\d{9}$/.test(tmpFormData.userPhone)) {
      showWxToast("请输入正确的手机号!");
      return;
    }
    if (tmpFormData.avator.indexOf("tmp") > -1) {
      // 需要上传图片后修改
      this.edit1(tmpFormData);
    } else {
      // 已经上传过图片
      this.edit2();
    }
  },
  edit1: function (tmpFormData) {
    showWxLoading("信息修改中...");
    uploadHeadImg(tmpFormData.avator)
      .then((res) => {
        let tmpRes = JSON.parse(res.data);
        tmpFormData.avator = tmpRes.data.filePath;
        this.setData({
          formData: tmpFormData,
        });
        return editUserInfo(this.data.formData);
      })
      .then((res2) => {
        console.log(res2);
        hideWxLoading();
        if (res2.data.code === "200") {
          showWxToast("修改成功!");
          app.globalData.isH5NeedRefresh = true;
          this.setData({
            headImg: this.data.formData.avator,
            nickname: this.data.formData.wx_name,
            relativeType: this.data.formData.type,
          });
          timeoutTask(() => {
            this.hideEditPopup();
          }, 1000);
        } else if (res2.data.code === "100") {
          this.editRecharge(() => {
            this.edit2();
          });
        }
      })
      .catch((err) => {
        console.log(err);
        hideWxLoading();
      });
  },
  edit2: function () {
    showWxLoading("信息修改中...");
    editUserInfo(this.data.formData)
      .then((res2) => {
        console.log(res2);
        hideWxLoading();
        if (res2.data.code === "200") {
          showWxToast("修改成功!");
          app.globalData.isH5NeedRefresh = true;
          this.setData({
            headImg: this.data.formData.avator,
            nickname: this.data.formData.wx_name,
            relativeType: this.data.formData.type,
          });
          timeoutTask(() => {
            this.hideEditPopup();
          }, 1000);
        } else if (res2.data.code === "100") {
          this.editRecharge(() => {
            this.edit2();
          });
        }
      })
      .catch((err) => {
        console.log(err);
        hideWxLoading();
      });
  },
  // 注销账号弹窗相关
  showLogoutPopup: function () {
    this.setData({ logoutPopupVisible: true });
  },
  hideLogoutPopup: function () {
    this.setData({ logoutPopupVisible: false });
  },
  onLogoutAgreementCheck: function (e) {
    this.setData({ logoutAgreementChecked: e.detail.value.length > 0 });
  },
  toLogoutAgreement: function () {
    const OUTER_URL =
      "https://ustatic.hudongmiao.com/joymewMp/agreement/logout.html";
    wx.navigateTo({
      url: `/pages/agreement/agreement?outerUrl=${OUTER_URL}`,
    });
  },
  onLogoutConfirm: function () {
    if (!this.data.logoutAgreementChecked) {
      wx.showToast({ title: "请先阅读并同意注销协议", icon: "none" });
      return;
    }
    wx.showModal({
      title: "再次确认",
      content: "注销账号后将无法恢复，确定要注销吗？",
      confirmText: "确定",
      cancelText: "取消",
      success: (res) => {
        if (res.confirm) {
          // 清空缓存并退出小程序
          logOff(getLiveId());
          showWxToast("账号已注销");
          wx.clearStorageSync();
          if (wx.exitMiniProgram) {
            wx.exitMiniProgram();
          }
        }
      },
    });
  },
});
````

## File: pages/recharge2/recharge2.json
````json
{
  "navigationBarTitleText": "充值中心",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  }
}
````

## File: pages/recharge2/recharge2.wxml
````
<view class="rechargeContainer">
  <image src="/assets/image/hd2/topBg.png" class="topBg"></image>
  <view class="userInfo">
    <view class="headImgBox">
      <image src="{{headImg}}" class="headImg {{miao_vip ? 'vipBox' : ''}}"></image>
      <!-- <view wx:if="{{!isVipHeadBoxGetted && !popupModVisible}}" class="getRewardBtn" bindtap="showPopupMod">
                领取奖励
            </view> -->
      <image src="/assets/image/hd2/pencil.png" class="pencilImg" bindtap="showEditPopup"></image>
    </view>
    <view class="accountInfo">
      <view class="top">
        <view class="nickname">{{nickname}}</view>
        <view class="level">
          <image src="/assets/image/hd2/crown.png" class="crownImg"></image>
          <view class="levelVal">Lv{{vipLevel}}</view>
        </view>
      </view>
      <view class="bottom">
        余额: {{remainMoney}}
        <image src="/assets/image/hd2/diamond.png" class="diamondImg"></image>
      </view>
    </view>
    <view class="relativeType">
      <image src="/assets/image/hd2/boyIcon.png" class="relativeIcon" wx:if="{{relativeType === '1'}}" bindtap="showEditPopup"></image>
      <image src="/assets/image/hd2/girlIcon.png" class="relativeIcon" wx:if="{{relativeType === '2'}}" bindtap="showEditPopup"></image>
      {{relativeType === '1' ? '男方亲友' : '女方亲友'}}
    </view>
  </view>
  <!-- 固定充值金额区域 -->
  <view class="limitRechargeArea">
    <view class="rechargeItem" wx:for="{{rechargeList}}" wx:key="index" data-desc="{{item}}" bindtap="recharge">
      <image src="/assets/image/hd2/diamond.png" class="diamondIcon"></image>
      <view class="num">{{item}}</view>
      <image src="/assets/image/hd2/th.png" class="thIcon" wx:if="{{index === rechargeList.length - 1}}"></image>
    </view>
  </view>
  <view class="agreement">
    阅读并同意
    <view class="bond" bindtap="toAgreement" data-type="recharge">《充值服务协议》</view>
    <view class="bond" bindtap="toAgreement" data-type="privacy">《嗨喵隐私政策》</view>
  </view>
  <view class="wishSheetList">
    <image src="/assets/image/hd2/bdTitle.png" class="bdTitle"></image>
    <view class="vsTitle">
      <view class="boy">
        <image src="/assets/image/hd2/boy.png" class="sexIcon"></image>
        男方亲友
      </view>
      <image src="/assets/image/hd2/vs.png" class="vsIcon"></image>
      <view class="girl">
        <image src="/assets/image/hd2/girl.png" class="sexIcon"></image>
        女方亲友
      </view>
    </view>
    <view class="gapLine"></view>
    <view class="listWrap">
      <view class="sexList boy">
        <view class="item" wx:for="{{giftRankListBoy}}" wx:key="index">
          <view class="user">
            <view class="baseInfo">
              <image src="{{item.avator}}" class="headImg"></image>
              <view class="name">{{item.wx_name}}</view>
            </view>
            <view class="level">
              <image src="/assets/image/hd2/crown.png" class="crownImg"></image>
              <view class="levelVal">Lv1</view>
            </view>
          </view>
          <view class="sendGiftNum">送出{{item.size}}个祝福</view>
        </view>
      </view>
      <view class="sexList girl">
        <view class="item" wx:for="{{giftRankListGirl}}" wx:key="index">
          <view class="user">
            <view class="baseInfo">
              <image src="{{item.avator}}" class="headImg"></image>
              <view class="name">{{item.wx_name}}</view>
            </view>
            <view class="level">
              <image src="/assets/image/hd2/crown.png" class="crownImg"></image>
              <view class="levelVal">Lv1</view>
            </view>
          </view>
          <view class="sendGiftNum">送出{{item.size}}个祝福</view>
        </view>
      </view>
    </view>
  </view>
  <!-- 反馈入口 -->
  <feedbackEntry userId="{{userId}}"></feedbackEntry>
  <!-- 弹出区域 -->
  <view class="popupArea" wx:if="{{editPopupVisible}}">
    <view class="shade" bindtap="hideEditPopup"></view>
    <view class="infoForm {{editPopupAni?'show':'hide'}}">
      <view class="formItem">
        <view class="key">头像</view>
        <view class="formCt">
          <image src="{{formData.avator}}" class="headImg" bindtap='upload'></image>
          <image src="/assets/image/hd2/arrowRight.png" class="arrowRight"></image>
        </view>
      </view>
      <view class="formItem">
        <view class="key">贵宾姓名</view>
        <view class="formCt">
          <input bindblur="handleNameBlur" value="{{formData.wx_name}}" placeholder="请输入贵宾姓名" placeholder-style="color:#5B5E63;font-size: 32rpx" class="nameIpt" maxlength="12" />
        </view>
      </view>
      <view class="formItem">
        <view class="key">手机号</view>
        <view class="formCt">
          <input 
            bindblur="handlePhoneBlur" 
            value="{{formData.userPhone}}" 
            placeholder="请输入手机号" 
            placeholder-style="color:#5B5E63;font-size: 32rpx" 
            class="nameIpt" 
            maxlength="11" 
            type="number"
          />
        </view>
      </view>
      <view class="formItem">
        <view class="key">亲友团</view>
        <view class="formCt">
          <radio-group class="relativeGroup" bindchange="chooseRelatives">
            <view class="radioItem">
              <view class="radioLabel boy">
                <image src="/assets/image/hd2/boy.png" class="sexIcon boy"></image>
                男方亲友
              </view>
              <radio value="1" checked="{{formData.type === '1'?true:false}}" class="relativesRadio"></radio>
            </view>
            <view class="radioItem">
              <view class="radioLabel girl">
                <image src="/assets/image/hd2/girl.png" class="sexIcon girl"></image>
                女方亲友
              </view>
              <radio value="2" class="relativesRadio" checked="{{formData.type === '2'?true:false}}"></radio>
            </view>
          </radio-group>
        </view>
      </view>
      <view class="formItem">
        <view class="key">桌号</view>
        <picker value="{{formData.table_number}}" range="{{deskList}}" bindchange="handlePickerChange">
          <view class="deskNumPicker">
            {{formData.table_number}}桌
            <image src="/assets/image/hd2/arrowRight.png" class="arrowRight"></image>
          </view>
        </picker>
      </view>
      <view class="formItem">
        <view class="key">身份</view>
        <view class="identyLabels">
          <view class="label {{item === formData.position ? 'active': ''}}" wx:for="{{statusList}}" wx:key="index" data-status="{{item}}" bindtap="chooseStatus">
            {{item}}
          </view>
        </view>
      </view>
      <view class="formConfirmItem">
        <view class="confirmBtn" bindtap="confirmEdit">确认修改</view>
        <view class="logoutBtn" bindtap="showLogoutPopup">注销账号</view>
        <view class="editTip">确认修改需要消耗{{editUserInfoPrice}}个喵钻</view>
      </view>
    </view>
  </view>
  <!-- 隐私授权弹窗 -->
  <privacyAuthorize></privacyAuthorize>
  <!-- 注销账号弹窗 -->
  <view class="logoutPopupArea" wx:if="{{logoutPopupVisible}}">
    <view class="logoutShade" bindtap="hideLogoutPopup"></view>
    <view class="logoutPopup">
      <view class="logoutTitle">账号注销提醒</view>
      <view class="logoutContent">
        您注销用户账号之后，我们将停止为您提供服务，按照法律法规和《用户注销协议》的规定处理您在本账号下所有的个人信息。请您在仔细阅读《用户注销协议》后慎重选择是否注销您的用户账号，
        <view class="logoutAgreement" bindtap="toLogoutAgreement">嗨喵用户账号注销协议</view>
      </view>
      <checkbox-group bindchange="onLogoutAgreementCheck">
        <label class="logoutCheckbox">
          <checkbox value="agree" checked="{{logoutAgreementChecked}}"/> 我已阅读并同意以上协议
        </label>
      </checkbox-group>
      <view class="logoutBtnWrap">
        <view class="logoutConfirmBtn" bindtap="onLogoutConfirm">确定</view>
      </view>
    </view>
  </view>
</view>
````

## File: pages/recharge2/recharge2.wxss
````
.rechargeContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #F4F7F9;
    height: 1624rpx;
}

.rechargeContainer>.topBg {
    width: 100%;
    height: 678rpx;
    position: absolute;
}

.rechargeContainer>.userInfo {
    width: 100%;
    display: flex;
    align-items: center;
    margin-top: 120rpx;
    padding: 0 40rpx;
    position: relative;
}

.userInfo>.headImgBox {
    position: relative;
    width: 110rpx;
    height: 110rpx;
}

.userInfo>.headImgBox>.headImg {
    width: 100%;
    height: 100%;
    border-radius: 50%;
}

.userInfo>.headImgBox>.getRewardBtn {
    width: 130rpx;
    height: 36rpx;
    background: #FFDB27;
    border-radius: 18rpx 18rpx 18rpx 0rpx;
    position: absolute;
    top: -61rpx;
    left: 16rpx;
    font-size: 18rpx;
    font-weight: bold;
    color: #D8241D;
    display: flex;
    justify-content: center;
    align-items: center;
}

.userInfo>.headImgBox>.pencilImg {
    width: 40rpx;
    height: 40rpx;
    position: absolute;
    top: -10rpx;
    right: -2rpx;
}

.userInfo>.accountInfo {
    margin-left: 36rpx;
}

.userInfo>.accountInfo>.top {
    display: flex;
    align-items: center;
}

.userInfo>.accountInfo>.top>.nickname {
    font-size: 36rpx;
    color: #FFFFFF;
    font-weight: 500;
}

.userInfo>.accountInfo>.top>.level {
    width: 48rpx;
    height: 42rpx;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-left: 20rpx;
}

.userInfo>.accountInfo>.top>.level>.crownImg {
    width: 100%;
    height: 100%;
}

.userInfo>.accountInfo>.top>.level>.levelVal {
    font-size: 20rpx;
    color: #fff;
    position: absolute;
    margin-top: 6rpx;
}

.userInfo>.accountInfo>.bottom {
    margin-top: 16rpx;
    color: rgba(255, 255, 255, 0.6);
    font-size: 24rpx;
    display: flex;
    align-items: center;
}

.userInfo>.accountInfo>.bottom>.diamondImg {
    width: 32rpx;
    height: 26rpx;
    margin-left: 14rpx;
}

.userInfo>.relativeType {
    width: 140rpx;
    height: 48rpx;
    background: rgba(255, 255, 255, 0.28);
    border-radius: 24rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20rpx;
    color: rgba(255, 255, 255, 0.6);
    position: absolute;
    right: 40rpx;
    bottom: 0;

}

.userInfo>.relativeType>.relativeIcon {
    width: 22rpx;
    height: 24rpx;
    margin-right: 10rpx;
}

.rechargeContainer>.limitRechargeArea {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 140rpx;
    position: relative;
}

.limitRechargeArea>.rechargeItem {
    width: 187rpx;
    height: 100rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 12rpx 12rpx;
    background-color: #EEE9FF;
    border-radius: 10rpx;
    position: relative;
}

.limitRechargeArea>.rechargeItem>.diamondIcon {
    width: 64rpx;
    height: 52rpx;
    margin-top: 12rpx;
}

.limitRechargeArea>.rechargeItem>.num {
    font-size: 42rpx;
    font-weight: 500;
    color: #9C2CF3;
    margin-left: 6rpx;
}
.limitRechargeArea>.rechargeItem>.thIcon {
    width: 74rpx;
    height: 32rpx;
    position: absolute;
    top: -16rpx;
    right: -16rpx;
}
.rechargeContainer>.agreement {
    font-size: 22rpx;
    font-weight: 500;
    color: #666666;
    margin-top: 12rpx;
    position: relative;
    display: flex;
}

.rechargeContainer>.agreement>.bond {
    color: #DC2F2F;
}

.rechargeContainer>.wishSheetList {
    position: relative;
    margin-top: 90rpx;
    width: 690rpx;
    height: 856rpx;
    background: #FFFFFF;
    box-shadow: 0rpx 4rpx 10rpx -2rpx rgba(0, 0, 0, 0.06);
    border-radius: 8rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.wishSheetList>.bdTitle {
    width: 372rpx;
    height: 86rpx;
    position: absolute;
    top: -42rpx;
}

.wishSheetList>.vsTitle {
    display: flex;
    align-items: center;
    width: 100%;
    justify-content: center;
    margin-top: 84rpx;
}

.wishSheetList>.vsTitle>.boy {
    display: flex;
    align-items: center;
    font-size: 32rpx;
    font-weight: 600;
    color: #4526C2;
}

.wishSheetList>.vsTitle>.boy>.sexIcon {
    width: 36rpx;
    height: 40rpx;
    margin-right: 8rpx;
}

.wishSheetList>.vsTitle>.girl {
    display: flex;
    align-items: center;
    font-size: 32rpx;
    font-weight: 600;
    color: #EA1877;
}

.wishSheetList>.vsTitle>.girl>.sexIcon {
    width: 32rpx;
    height: 44rpx;
    margin-right: 8rpx;
}

.wishSheetList>.vsTitle>.vsIcon {
    width: 52rpx;
    height: 52rpx;
    margin: 0 58rpx;
}

.wishSheetList>.gapLine {
    width: 636rpx;
    height: 2rpx;
    border: 1rpx solid #EEEEEE;
    margin-top: 24rpx;
}

.wishSheetList>.listWrap {
    display: flex;
    width: 100%;
    margin-top: 36rpx;
    justify-content: center;
    height: 800rpx;
    overflow-y: scroll;

}

.wishSheetList>.listWrap>.sexList {
    width: 35%;
    margin: 0 24rpx;
}

.sexList>.item {
    margin-bottom: 60rpx;
}

.sexList>.item>.user {
    display: flex;
    align-items: center;
    /* width: 240rpx; */
    justify-content: space-between;
}

.sexList>.item>.user>.baseInfo {
    display: flex;
    align-items: center;
    margin-right: 12rpx;
}

.sexList>.item>.user>.baseInfo>.headImg {
    width: 56rpx;
    height: 56rpx;
    margin-right: 14rpx;
    border-radius: 50%;
}

.sexList>.item>.user>.baseInfo>.name {
    font-size: 28rpx;
    color: #514E4E;
    font-weight: 400;
}

.sexList>.item>.user>.level {
    width: 36rpx;
    height: 30rpx;
    position: relative;
    display: flex;
    justify-content: center;
}

.sexList>.item>.user>.level>.crownImg {
    width: 100%;
    height: 100%;
}

.sexList>.item>.user>.level>.levelVal {
    font-size: 12rpx;
    color: #fff;
    position: absolute;
    top: 16rpx;
}

.sexList>.item>.sendGiftNum {
    font-size: 28rpx;
    font-weight: 400;
    color: #4526C2;
    margin-top: 12rpx;
}

.popupArea {
    position: fixed;
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
}

.popupArea>.shade {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.3);
    top: 0;
    left: 0;
}

.popupArea>.infoForm {
    width: 750rpx;
    min-height: 1130rpx;
    background: #FFFFFF;
    position: absolute;
    bottom: 0;
    border-top-right-radius: 20rpx;
    border-top-left-radius: 20rpx;
    padding: 30rpx 50rpx 30rpx 50rpx;
    transition: all 0.3s ease-out;
}

.popupArea>.infoForm.hide {
    transform: translateY(1130rpx);
}

.popupArea>.infoForm.show {
    transform: translateY(0rpx);
}

.infoForm>.formItem {
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 140rpx;

}

.infoForm>.formItem:nth-child(4) {
    position: relative;
}

.infoForm>.formItem>.key {
    font-size: 32rpx;
    font-weight: 400;
    color: #8F9297;
}

.infoForm>.formItem>.formCt {
    display: flex;
    align-items: center;
    position: relative;
}

.infoForm>.formItem>.formCt>.headImg {
    width: 76rpx;
    height: 76rpx;
    border-radius: 50%;
}

.infoForm>.formItem>.formCt>.arrowRight {
    width: 28rpx;
    height: 28rpx;
    margin-left: 30rpx;
}

.infoForm>.formItem>.formCt>.nameIpt {
    font-weight: 400;
    color: #5B5E63;
    font-size: 32rpx;
    text-align: right;
    width: 256rpx;
}

.infoForm>.formItem>.formCt>.relativeGroup {
    display: flex;
}

.relativeGroup>.radioItem {
    display: flex;
    align-items: center;
}

.relativeGroup>.radioItem:nth-child(1) {
    margin-right: 66rpx;
}

.relativeGroup>.radioItem>.radioLabel {
    display: flex;
    align-items: center;
    font-weight: 400;
    font-size: 28rpx;
    margin-right: 16rpx;
}

.relativeGroup>.radioItem>.radioLabel.boy {
    color: #6112B0;
}

.relativeGroup>.radioItem>.radioLabel.girl {
    color: #ED3488;
}

.relativeGroup>.radioItem>.radioLabel>.sexIcon.boy {
    width: 32rpx;
    height: 32rpx;
    margin-right: 8rpx;
}

.relativeGroup>.radioItem>.radioLabel>.sexIcon.girl {
    width: 28rpx;
    height: 34rpx;
    margin-right: 8rpx;
}

.formItem .deskNumPicker {
    display: flex;
    align-items: center;
}

.formItem .deskNumPicker>.arrowRight {
    margin-left: 30rpx;
    width: 28rpx;
    height: 28rpx;
}

.identyLabels {
    width: 520rpx;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 110rpx;
}

.identyLabels>.label {
    width: 135rpx;
    height: 64rpx;
    border-radius: 30rpx;
    border: 2rpx solid #EEEEEE;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28rpx;
    font-weight: 400;
    color: #5B5E63;
    margin: 25rpx 10rpx;
    white-space: nowrap;
}

.identyLabels>.label.active {
    background: linear-gradient(276deg, #71B3FF 0%, #2C82E4 100%);
    color: #FFFFFF;
}

.formConfirmItem {
    flex-direction: column;
    display: flex;
    align-items: center;
    margin-top: 40rpx;
    position: relative;
}

.formConfirmItem>.confirmBtn {
    width: 418rpx;
    height: 75rpx;
    border-radius: 20rpx;
    background: linear-gradient(300deg, #C76BFB 0%, #EA1775 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32rpx;
    font-weight: 400;
    color: #FFFFFF;
}

.formConfirmItem>.logoutBtn {
    color: #FF4B4B;
    font-size: 24rpx;
    font-weight: 400;
    position: absolute;
    right: 0;
    bottom: 53rpx;
}
.formConfirmItem>.editTip {
    font-size: 24rpx;
    font-weight: 400;
    color: #E14D4D;
    margin-top: 20rpx;
}

/* 注销账号弹窗样式 */
.logoutPopupArea {
    position: fixed;
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    z-index: 9999;
}

.logoutShade {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.3);
    top: 0;
    left: 0;
}

.logoutPopup {
    width: 600rpx;
    background: #fff;
    border-radius: 20rpx;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 8rpx 40rpx 0 rgba(0,0,0,0.18);
    padding: 48rpx 36rpx 36rpx 36rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.logoutTitle {
    font-size: 36rpx;
    font-weight: 600;
    color: #333;
    margin-bottom: 24rpx;
}

.logoutContent {
    font-size: 28rpx;
    color: #666;
    margin-bottom: 24rpx;
    text-align: left;
}

.logoutAgreement {
    color: #FF4B4B;
    text-decoration: underline;
    display: inline-block;
    margin-top: 8rpx;
    font-size: 28rpx;
}

.logoutCheckbox {
    font-size: 26rpx;
    color: #888;
    margin-bottom: 24rpx;
    display: flex;
    align-items: center;
}

.logoutBtnWrap {
    width: 100%;
    display: flex;
    justify-content: center;
}

.logoutConfirmBtn {
    width: 320rpx;
    height: 80rpx;
    background: #FF4B4B;
    color: #fff;
    border-radius: 16rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32rpx;
    font-weight: 500;
}
````

## File: pages/test/index/index.js
````javascript
const app = getApp();

Page({
  data: {
    h5Url: '',
  },
  onLoad: function(options) {
    this.setData({
      h5Url: 'https://www.hudongmiao.com/templeEscape/index.html?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHQiOjE2MzM0ODg0NTQzOTAsInVpZCI6IjAyYjdkY2ExOTdmODRjYmI4MmY2OTExNTY0MGU1N2Y5IiwiaWF0IjoxNjMyODgzNjU0MzkwfQ.ogbVJVTNlicAkyWiCwspatimPV3Pjjo3ilXAMlZImEY',
    });
  },
  onShow: function() {
  },
});
````

## File: pages/test/index/index.json
````json
{
    "navigationBarTitleText": "首页"
}
````

## File: pages/test/index/index.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/test/index/index.wxss
````
page {
	background: linear-gradient(139deg, #fec84e 0%, #feaf40 100%);
  }
````

## File: pages/test/login/login.js
````javascript
import { wxLogin, authUser } from '../../../api/login';

const app = getApp();

Page({
    data: {
    },

    onLoad: function (options) {
    },

    onShow: function () {

    },
    onShareAppMessage: function () {
        return {
            title: this.data.title,
            path: '/pages/test/login/login',
            success: function (res) { },
            fail: function (res) { }
        }
    },
    /**
     * 授权登录获取用户信息
     */
    getUserInfo: function (e) {
        console.log(e);
        wxLogin().then((res) => {
            console.log(res);
            return authUser({
                code: res.code,
                encryptedData: e.detail.encryptedData,
                iv: e.detail.iv,
            })
        }).then((res2) => {
            console.log('res2:', res2);
            console.log(`http://192.168.66.104/?liveId=692991d279f8411a98392ecb48ca4948&token=${res2.data.token}&time=1599788613040#/`);
        }).catch((err) => {
            console.log(err);
        })
    },
})
````

## File: pages/test/login/login.json
````json
{
    "navigationBarTitleText": "登录"
}
````

## File: pages/test/login/login.wxml
````
<!-- 登录 -->
<view class="login">
    <button class='btn' type='primary' open-type="getUserInfo" bindgetuserinfo="getUserInfo" lang="zh_CN">
        点击获取用户信息
    </button>
    <view class="userinfo-avatar">
        <open-data type="userAvatarUrl"></open-data>
    </view>
    <open-data type="userNickName"></open-data>
</view>
````

## File: pages/test/login/login.wxss
````
.userinfo-avatar {  
    overflow:hidden;  
    display: block;  
    width: 160rpx;  
    height: 160rpx;  
    margin: 20rpx;  
    margin-top: 50rpx;  
    border-radius: 50%;  
    border: 2px solid #fff;  
    box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);  
  }  
    
  .userinfo{  
    font-size: 14px;  
    background-color: #c0c0c0;  
    border-radius:40%;  
  }
````

## File: pages/test/pay/pay.js
````javascript
import { getSetting } from '../../../api/system.js'
import { recharge } from '../../../api/index/index.js'
import { timeoutTask, isNumber, showWxToast } from '../../../utils/index.js'
const app = getApp();

Page({
    data: {
        //是否授权
        isAuth: false,
        //授权询问弹窗
        authDialogVisible: false,
        headImg: '',
        nickname: '',
        userId: '',
        openId: '',
        money: 0,
    },

    onLoad: function (options) {
        //是否授权初始化
        this.initIsAuth();
        // 设置用户信息
        this.setUserInfo();
    },

    onShow: function () {

    },

    onShareAppMessage: function () {
        return {
            title: this.data.title,
            path: '/pages/index/index',
            success: function (res) { },
            fail: function (res) { }
        }
    },
    initIsAuth() {
        getSetting().then(res => {
            if (res.errMsg == 'getSetting:ok') {
                this.setData({
                    isAuth: res.authSetting['scope.userInfo'] || false
                })
            }
            if (!this.data.isAuth) {
                this.setData({
                    authDialogVisible: true
                });
            }
        }).catch(err => {
            console.log(err);
        });

    },
    authSuccessHandle() {
        this.setData({
            authDialogVisible: false
        });
        timeoutTask(() => {
            this.setUserInfo();
        }, 100);
    },
    setUserInfo() {
        this.setData({
            userId: wx.getStorageSync('userId'),
            openId: wx.getStorageSync('openId'),
            nickname: wx.getStorageSync('nickname'),
            headImg: wx.getStorageSync('headImg')
        });
    },
    pay() {
        if (!this.data.isAuth) {
            showWxToast('授权失败!');
            this.initIsAuth();
            return;
        }
        if (!isNumber(this.data.money) || !this.data.money) {
            showWxToast('请输入正确的金额!');
            return;
        }
        recharge(this.data.money).then(res => {
            console.log(res);
            showWxToast('支付成功!');
        }).catch(err => {
            console.log(err);
            showWxToast('支付失败!');
        })
    },
    moneyInput(e) {
        this.setData({
            money: e.detail.value
        });
    }
})
````

## File: pages/test/pay/pay.json
````json
{
    "navigationBarTitleText": "支付"
}
````

## File: pages/test/pay/pay.wxml
````
<!-- 首页 -->
<view class="payWrap">
    <view class="userInfo">
        <image class="headImg" src="{{headImg}}"></image>
        <view class="nickname">{{nickname}}</view>
    </view>
    <view class="price">
        <!-- {{money}} -->
        <input class="input"  placeholder="请输入充值金额" bindinput="moneyInput" />
        <view class="unit">元</view>
    </view>
    <view class="btnWrap">
        <view class="btn" bindtap="pay">支付</view>
    </view>
    <!-- 授权弹窗 -->
    <authDialog dialogVisible="{{authDialogVisible}}" bind:authSuccess="authSuccessHandle"></authDialog>
</view>
````

## File: pages/test/pay/pay.wxss
````
.payWrap {
    width: 100vw;
    height: 100vh;
}

.payWrap>.userInfo {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.payWrap>.userInfo>.headImg {
    width: 240rpx;
    height: 240rpx;
    border-radius: 50%;
}

.payWrap>.userInfo>.nickname {
    font-size: 56rpx;
    margin-top: 24rpx;
}

.payWrap>.price {
    font-size: 96rpx;
    font-weight: bold;
    margin: 136rpx auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

.payWrap>.price>.input {
    font-size: 26rpx;
    width: 309rpx;
    height: 80rpx;
    border: 1px solid #eaeaea;
    padding: 0 12rpx;
    margin-right: 20rpx;

}

.payWrap>.price>.unit {
    font-size: 56rpx;
    font-weight: normal;
}

.payWrap>.btnWrap {
    display: flex;
    justify-content: center;
    margin-top: 20%;
}

.payWrap>.btnWrap>.btn {
    width: 80%;
    height: 90rpx;
    background-color: rgba(19, 175, 18, 1);
    color: #FFFFFF;
    font-size: 36rpx;
    line-height: 90rpx;
    display: flex;
    justify-content: center;
    align-items: center;
}
````

## File: pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.js
````javascript
Component({
  properties: {
    award: {
      type: String,
      value: '',
    },
    name: {
      type: String,
      value: '',
    },
    img: {
      type: String,
      value: '',
    },
  },
  data: {
    isShow: false,
  },
  methods: {
    show() {
      this.setData({
        isShow: true,
      });
    },
    hide() {
      this.setData({
        isShow: false,
      });
    },
    stopPropagation() {},
  },
});
````

## File: pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.json
````json
{
  "component": true
}
````

## File: pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.scss
````scss
.container {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100;
  width: 100vw;
  height: 100vh;

  background-color: rgba($color: #000000, $alpha: 0.6);

  padding-top: 20px;
  display: grid;
  grid-template:
    '.' 1fr
    'title' min-content
    'popup-body' min-content
    'close-btn' min-content
    '.' 3fr
    / 1fr;
  place-items: center;

  .title {
    width: 239px;
    height: 104px;

    animation: popup 0.3s ease-in-out;

    @keyframes popup {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  }

  .popup-body {
    grid-area: popup-body;
    box-sizing: border-box;
    width: 74.6667vw;
    height: 98.6667vw;

    border-radius: 12px;
    overflow: hidden;

    position: relative;

    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;

    animation: popup 0.3s ease-in-out;

    @keyframes popup {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .bg {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;

      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top;
    }

    .award {
      width: 80%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      text-align: center;
      font-size: 20px;
      color: #333333;
    }

    .name {
      margin-top: 4px;
      width: 80%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;

      text-align: center;

      font-size: 24px;
      color: #333333;
    }

    .img-area {
      margin-top: 16px;

      width: 164px;
      height: 164px;
      background: #f2f2f2;
      border-radius: 2px;

      display: flex;
      align-items: center;
      justify-content: center;

      .img {
        width: 80%;
        height: 80%;
      }
    }

    .btn {
      margin-top: 24px;
      width: 220px;
      height: 52px;
      background: linear-gradient(180deg, #fd1d19, #fe9743 100%);
      border-radius: 30px;

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 20px;
      color: #ffffff;
    }
  }

  .close-btn {
    grid-area: close-btn;
    margin-top: 24px;
    width: 34px;
    height: 34px;
  }
}
````

## File: pages/winningRecord/components/congratulationWinningPopup/congratulationWinningPopup.wxml
````
<view
  class="container"
  wx:if="{{ isShow }}"
  bind:tap="hide"
>
  <image
    src="/assets/image/winningRecord/congratulation-winning.svg"
    class="title"
  ></image>
  <view
    class="popup-body"
    catch:tap="stopPropagation"
  >
    <image
      class="bg"
      src="/assets/image/winningRecord/popup-board.svg"
    ></image>
    <view class="award">{{ award }}</view>
    <view class="name">{{ name }}</view>
    <view class="img-area">
      <image
        class="img"
        src="{{ img }}"
        mode="aspectFit"
      ></image>
    </view>
    <view
      class="btn"
      bind:tap="hide"
    >
      我知道了
    </view>
  </view>
  <image
    class="close-btn"
    src="/assets/image/icon/close.svg"
  ></image>
</view>
````

## File: pages/winningRecord/components/notWonYetPopup/notWonYetPopup.js
````javascript
Component({
  data: {
    isShow: false,
  },
  methods: {
    show() {
      this.setData({
        isShow: true,
      });
    },
    hide() {
      this.setData({
        isShow: false,
      });
    },
    stopPropagation() {},
  },
});
````

## File: pages/winningRecord/components/notWonYetPopup/notWonYetPopup.json
````json
{
  "component": true
}
````

## File: pages/winningRecord/components/notWonYetPopup/notWonYetPopup.scss
````scss
.container {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100;
  width: 100vw;
  height: 100vh;

  background-color: rgba($color: #000000, $alpha: 0.6);

  padding-top: 20px;
  display: grid;
  grid-template:
    '.' 1fr
    'title' min-content
    'popup-body' min-content
    'close-btn' min-content
    '.' 3fr
    / 1fr;
  place-items: center;

  .title {
    width: 239px;
    height: 104px;

    animation: popup 0.3s ease-in-out;

    @keyframes popup {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  }

  .popup-body {
    grid-area: popup-body;
    box-sizing: border-box;
    width: 74.6667vw;
    height: 98.6667vw;

    border-radius: 12px;
    overflow: hidden;

    position: relative;

    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;

    animation: popup 0.3s ease-in-out;

    @keyframes popup {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .bg {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;

      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top;
    }

    .face {
      width: 140px;
      height: 140px;
    }

    .unfortunately {
      font-size: 20px;
      color: #6a0d0b;
    }

    .thank {
      margin-top: 10px;
      font-size: 16px;
      color: #6a0d0b;
    }

    .btn {
      margin-top: 62px;
      width: 220px;
      height: 52px;
      background: #c2c2c2;
      border-radius: 30px;

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 20px;
      color: #ffffff;
    }
  }

  .close-btn {
    grid-area: close-btn;
    margin-top: 24px;
    width: 34px;
    height: 34px;
  }
}
````

## File: pages/winningRecord/components/notWonYetPopup/notWonYetPopup.wxml
````
<view
  class="container"
  wx:if="{{ isShow }}"
  bind:tap="hide"
>
  <image
    src="/assets/image/winningRecord/not-win.svg"
    class="title"
  ></image>
  <view
    class="popup-body"
    catch:tap="stopPropagation"
  >
    <image
      class="bg"
      src="/assets/image/winningRecord/popup-board.svg"
    ></image>
    <image
      class="face"
      src="/assets/image/winningRecord/face.svg"
      mode="aspectFit"
    ></image>
    <view class="unfortunately">很遗憾，本轮并未获奖</view>
    <view class="thank">谢谢参与，等待下次抽奖吧～</view>
    <view
      class="btn"
      bind:tap="hide"
    >
      我知道了
    </view>
  </view>
  <image
    class="close-btn"
    src="/assets/image/icon/close.svg"
  ></image>
</view>
````

## File: pages/winningRecord/components/winnerListPopup/winnerListPopup.js
````javascript
Component({
  properties: {
    award: {
      type: String,
      value: '',
    },
    winnerList: {
      type: Array,
      value: [],
    },
  },
  data: {
    isShow: false,
  },
  methods: {
    show() {
      this.setData({
        isShow: true,
      });
    },
    hide() {
      this.setData({
        isShow: false,
      });
    },
    stopPropagation() {},
  },
});
````

## File: pages/winningRecord/components/winnerListPopup/winnerListPopup.json
````json
{
  "component": true
}
````

## File: pages/winningRecord/components/winnerListPopup/winnerListPopup.scss
````scss
.container {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100;
  width: 100vw;
  height: 100vh;

  background-color: rgba($color: #000000, $alpha: 0.6);

  padding-top: 20px;
  display: grid;
  grid-template:
    '.' 1fr
    'popup-body' min-content
    'close-btn' min-content
    '.' 3fr
    / 1fr;
  row-gap: 20px;
  place-items: center;

  .popup-body {
    grid-area: popup-body;
    width: calc(100% - 48px);

    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;

    padding-bottom: 20px;
    display: flex;
    flex-direction: column;

    animation: popup 0.3s ease-in-out;

    @keyframes popup {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .title {
      width: 100%;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 20px;
      color: #ff457a;
    }

    .content {
      width: 100%;
      max-height: 70vh;
      overflow-y: scroll;

      box-sizing: border-box;

      display: flex;
      flex-direction: column;
      align-items: center;

      .item {
        width: 100%;
        // XXX 直接使用height: 40px;会导致高度被压缩，原因未知
        min-height: 40px;

        background: #ffffff;

        &:nth-child(odd) {
          background: #ffecec;
        }

        display: flex;
        align-items: center;
        justify-content: center;
        column-gap: 8px;

        .avatar {
          width: 18px;
          height: 18px;
          border-radius: 50%;
        }

        .nickname {
          font-size: 14px;
          color: #333333;
        }
      }
    }
  }

  .close-btn {
    grid-area: close-btn;
    width: 34px;
    height: 34px;
  }
}
````

## File: pages/winningRecord/components/winnerListPopup/winnerListPopup.wxml
````
<view
  class="container"
  wx:if="{{ isShow }}"
  bind:tap="hide"
>
  <view
    class="popup-body"
    catch:tap="stopPropagation"
  >
    <view class="title">{{ award }}获奖名单</view>
    <view class="content">
      <view
        class="item"
        wx:for="{{ winnerList }}"
        wx:key="index"
      >
        <image
          class="avatar"
          src="{{ item.avatar }}"
          mode="aspectFill"
        ></image>
        <view class="name">{{ item.nickname }}</view>
      </view>
    </view>
  </view>
  <image
    class="close-btn"
    src="/assets/image/icon/close.svg"
  ></image>
</view>
````

## File: pages/winningRecord/winningRecord.js
````javascript
import { reqGetWinningRecord } from '../../api/comment/draw';
import { addDebugInfo, setLiveId } from '../../utils/storage';

Page({
  data: {
    activeIndex: 0,
    getWinnerRecordInterval: null,
    myPrizeList: [],
    recordList: [],
    winnerListPopupAward: '',
    winnerListPopupWinnerList: [],
    congratulationWinningPopupInfo: {
      award: '',
      name: '',
      img: '',
    },
  },
  onLoad(options) {
    addDebugInfo({
      title: 'winingRecord onLoad options',
      content: JSON.stringify(options),
    });
    if (options.liveId) {
      setLiveId(options.liveId);
    }

    this.getWinnerRecord(true);
    this.startGetWinnerRecordInterval();
  },
  onUnload() {
    this.stopGetWinnerRecordInterval();
  },
  onPullDownRefresh() {
    this.getWinnerRecord();
    setTimeout(() => {
      wx.stopPullDownRefresh();
    }, 500);
  },
  clickTab(e) {
    this.setData({
      activeIndex: Number(e.currentTarget.dataset.index),
    });
  },
  getWinnerNum(winner) {
    return Math.min(winner.length, 4);
  },
  showWinnerListPopup(e) {
    const { award, winnerList } = e.currentTarget.dataset;
    this.setData({
      winnerListPopupAward: award,
      winnerListPopupWinnerList: winnerList,
    });
    this.selectComponent('#winnerListPopup').show();
  },
  async getWinnerRecord(isFirstLoad = false) {
    const splid = wx.getStorageSync('liveId');
    const res = await reqGetWinningRecord(splid);
    const myPrizeList = res.data.myWinningRecordList.map((item, index) => ({
      id: item?.id.toString() || index.toString(),
      img: item.piclink || '',
      award: item.awardname || '',
      name: item.prize_name || '',
    }));

    const isShowCongratulationWinningPopup =
      this.checkAndShowCongratulationWinningPopup(myPrizeList);

    const isListLottery = res.data.isListLottery;
    if (isFirstLoad || isShowCongratulationWinningPopup) {
      wx.setStorageSync('newestLotteryId', res.data.newestLotteryId);
    }

    if (!isShowCongratulationWinningPopup && !isFirstLoad && !isListLottery) {
      this.checkAndShowNotWonPopup(res.data.newestLotteryId);
    }

    const recordList = res.data.winningRecordList.map((item) => ({
      id: item.cusaward_id.toString(),
      img: item.piclink || '',
      award: item.awardname || '',
      name: item.prize_name || '',
      winnerList: (item.winnerList || []).map((winner) => ({
        id: winner?.id,
        avatar: winner?.avator || '',
        nickname: winner?.wx_name || '',
      })),
    }));

    this.setData({
      myPrizeList,
      recordList,
    });
  },
  startGetWinnerRecordInterval() {
    this.getWinnerRecordInterval = setInterval(() => {
      this.getWinnerRecord();
    }, 5000);
  },
  stopGetWinnerRecordInterval() {
    clearInterval(this.getWinnerRecordInterval);
  },
  checkAndShowCongratulationWinningPopup(newMyPrizeList) {
    if (newMyPrizeList.length === 0) {
      wx.setStorageSync('newPrizeId', '');
      return false;
    }

    const newPrize = newMyPrizeList.find(
      (item) => !this.data.myPrizeList.some((prize) => prize.id === item.id),
    );

    if (!newPrize) return false;

    const localNewPrizeId = wx.getStorageSync('newPrizeId');
    if (localNewPrizeId && newPrize?.id === localNewPrizeId) return false;

    wx.setStorageSync('newPrizeId', newPrize.id);
    this.setData({
      congratulationWinningPopupInfo: {
        award: newPrize.award,
        name: newPrize.name,
        img: newPrize.img,
      },
    });
    this.selectComponent('#congratulationWinningPopup').show();

    return true;
  },
  checkAndShowNotWonPopup(newestLotteryId) {
    if (!newestLotteryId) return false;

    const localLotteryId = wx.getStorageSync('newestLotteryId');
    if (localLotteryId && newestLotteryId === localLotteryId) return false;

    wx.setStorageSync('newestLotteryId', newestLotteryId);
    this.selectComponent('#notWonYetPopup').show();
  },
  clickAdBtn() {
    wx.openEmbeddedMiniProgram({
      appId: 'wxece3a9a4c82f58c9',
      path: 'commercialize/pages/taoke-guide/index?scene=a90220ea475c4aada324ee25b2e60aca',
    });
  },
  toDebugPage() {
    wx.navigateTo({
      url: '/pages/debug/debug',
    });
  },
});
````

## File: pages/winningRecord/winningRecord.json
````json
{
  "navigationBarTitleText": "中奖记录",
  "disableScroll": true,
  "usingComponents": {
    "winner-list-popup": "./components/winnerListPopup/winnerListPopup",
    "congratulation-winning-popup": "./components/congratulationWinningPopup/congratulationWinningPopup",
    "not-won-yet-popup": "./components/notWonYetPopup/notWonYetPopup"
  },
  "enablePullDownRefresh": true
}
````

## File: pages/winningRecord/winningRecord.scss
````scss
.container {
  width: 100vw;
  height: 100vh;
  padding: 20px 16px;

  display: grid;
  grid-template-rows: min-content 1fr;
  row-gap: 12px;

  .bg {
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;

    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top;
  }

  .header {
    width: 100%;
    height: 48px;

    border-radius: 12px 12px 0 0;
    overflow: hidden;

    display: flex;
    align-items: center;
    justify-content: space-between;

    .header-item {
      width: 50%;
      height: 100%;

      background-color: #ec8585;

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 4.2667vw;
      color: #fff;

      &.active {
        background-color: #fff;
        color: #ff5d5d;
      }
    }
  }

  .my-prize {
    width: 100%;
    height: 100%;
    overflow: scroll;
    &::-webkit-scrollbar {
      display: none;
    }

    display: flex;
    flex-direction: column;
    align-items: center;
    row-gap: 12px;

    &.empty {
      background-color: #fff;
      border-radius: 20px;
      justify-content: center;
      .empty-img {
        width: calc(100% - 50px);
        height: 100%;
      }
    }

    .item {
      width: 100%;
      height: 80px;

      background: #ffffff;
      border-radius: 12px;

      padding: 8px;
      display: grid;
      grid-template-areas:
        'img-area award'
        'img-area name';
      grid-template-columns: min-content 1fr;
      grid-template-rows: min-content 1fr;
      gap: 6px;

      .img-area {
        grid-area: img-area;
        place-self: center;
        width: 70px;
        height: 70px;
        background: #f2f2f2;
        border-radius: 2px;

        display: flex;
        align-items: center;
        justify-content: center;

        image {
          width: calc(100% - 7px);
          height: calc(100% - 7px);
        }
      }

      .award {
        grid-area: award;
        margin-top: 10px;
        font-size: 16px;
      }

      .name {
        grid-area: name;
        align-self: flex-start;
        font-size: 16px;
        line-height: 1;
      }
    }
  }

  .winning-record {
    width: 100%;
    height: 100%;
    overflow: scroll;
    &::-webkit-scrollbar {
      display: none;
    }

    display: flex;
    flex-direction: column;
    align-items: center;
    row-gap: 12px;

    &.empty {
      background-color: #fff;
      border-radius: 20px;
      justify-content: center;
      .empty-img {
        width: 100%;
        height: 100%;
      }
    }

    .item {
      width: 100%;

      background: #ffffff;
      border-radius: 12px;

      padding: 8px;
      display: grid;
      grid-template:
        'img-area award-and-name award-and-name' min-content
        'img-area winner-list winner-list' 1fr
        'check-more check-more check-more' min-content
        / min-content 1fr 1fr;
      gap: 6px;

      .img-area {
        grid-area: img-area;
        place-self: center;
        width: 70px;
        height: 70px;
        background: #f2f2f2;
        border-radius: 2px;

        display: flex;
        align-items: center;
        justify-content: center;

        image {
          width: calc(100% - 7px);
          height: calc(100% - 7px);
        }
      }

      .award-and-name {
        grid-area: award-and-name;
        margin-top: 10px;
        width: calc(100% - 70px - 16px);

        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;

        font-size: 16px;
        color: #ff5d5d;
      }

      // 未抽奖提示
      .not-lottery {
        grid-area: winner-list;
        width: 100%;

        font-size: 12px;
        color: #ccc;
      }

      .winner-list {
        grid-area: winner-list;

        display: flex;
        flex-wrap: wrap;
        gap: 4px;

        .winner {
          &.winner-0 {
            grid-area: winner-0;
          }

          &.winner-1 {
            grid-area: winner-1;
          }

          &.winner-2 {
            grid-area: winner-2;
          }

          &.winner-3 {
            grid-area: winner-3;
          }
          width: calc(50% - 2px);
          display: flex;
          align-items: center;

          .avatar {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            overflow: hidden;
          }

          .nickname {
            margin-left: 8px;
            width: calc(100% - 26px);

            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            font-size: 16px;
            color: #333;
          }
        }
      }

      .check-more {
        grid-area: check-more;
        place-self: center;
        width: 100%;
        height: 30px;

        display: flex;
        align-items: center;
        justify-content: center;

        color: #b2b2b2;

        .icon {
          width: 12px;
          height: 12px;
        }

        .text {
          margin-right: 4px;
        }
      }
    }
  }
}
````

## File: pages/winningRecord/winningRecord.wxml
````
<view class="container">
  <image
    src="https://static.joymew.com/joymewMp/winningRecord/bg.jpg"
    class="bg"
  />
  <view
    class="header"
    bind:longpress="toDebugPage"
  >
    <view
      class="header-item {{ activeIndex === 0 ? 'active' : '' }}"
      data-index="0"
      bind:tap="clickTab"
    >
      我的奖品
    </view>
    <view
      class="header-item {{ activeIndex === 1 ? 'active' : '' }}"
      data-index="1"
      bind:tap="clickTab"
    >
      中奖名单
    </view>
  </view>
  <view
    wx:if="{{ activeIndex === 0 }}"
    class="my-prize {{ myPrizeList.length <= 0 ? 'empty' : '' }}"
  >
    <image
      wx:if="{{ myPrizeList.length <= 0 }}"
      src="https://static.joymew.com/joymewMp/winningRecord/empty-box.svg"
      class="empty-img"
      mode="aspectFit"
    />
    <view
      wx:for="{{ myPrizeList }}"
      wx:key="id"
      class="item"
    >
      <view class="img-area">
        <image
          src="{{ item.img }}"
          mode="aspectFit"
        />
      </view>
      <view class="award">奖项：{{ item.award }}</view>
      <view
        wx:if="{{ item.name }}"
        class="name"
      >
        奖品名称：{{ item.name }}
      </view>
    </view>
  </view>
  <view
    wx:if="{{ activeIndex === 1 }}"
    class="winning-record"
  >
    <image
      wx:if="{{ recordList.length <= 0 }}"
      src="https://static.joymew.com/joymewMp/winningRecord/empty-box.png"
      class="empty-img"
      mode="aspectFit"
    />
    <view
      wx:for="{{ recordList }}"
      wx:key="id"
      class="item"
    >
      <image
        src="{{ item.img }}"
        class="img-area"
        mode="aspectFit"
      />
      <view class="award-and-name">
        {{ item.award }}{{ item.name ? '：' : '' }}{{ item.name }}
      </view>
      <view
        class="not-lottery"
        wx:if="{{ item.winnerList.length <= 0 }}"
      >
        抽奖尚未开始
      </view>
      <view class="winner-list">
        <view
          class="winner {{ 'winner-' + winnerIndex }}"
          wx:for="{{ 4 }}"
          wx:for-item="winnerIndex"
          wx:key="winnerIndex"
        >
          <image
            wx:if="{{ item.winnerList[winnerIndex].avatar }}"
            src="{{ item.winnerList[winnerIndex].avatar }}"
            class="avatar"
            mode="aspectFill"
          />
          <view
            wx:if="{{ item.winnerList[winnerIndex].nickname }}"
            class="nickname"
            >{{ item.winnerList[winnerIndex].nickname }}</view
          >
        </view>
      </view>
      <view
        wx:if="{{ item.winnerList.length > 4 }}"
        class="check-more"
        data-winner-list="{{ item.winnerList }}"
        data-award="{{ item.award }}"
        bind:tap="showWinnerListPopup"
      >
        <image
          class="icon"
          src="/assets/image/icon/arrow-down.svg"
          mode="aspectFit"
        ></image>
        <view class="text">查看更多</view>
      </view>
    </view>
  </view>
  <winner-list-popup
    id="winnerListPopup"
    award="{{ winnerListPopupAward }}"
    winner-list="{{ winnerListPopupWinnerList }}"
  />
  <congratulation-winning-popup
    id="congratulationWinningPopup"
    award="{{ congratulationWinningPopupInfo.award }}"
    name="{{ congratulationWinningPopupInfo.name }}"
    img="{{ congratulationWinningPopupInfo.img }}"
  />
  <not-won-yet-popup id="notWonYetPopup" />
</view>
````

## File: pages/zfdm/zfdm.js
````javascript
import {
  zfdmRecharge,
  getZfdmInfo,
  startZfdm,
  getZfdmRankList,
  getZfdmMessageList,
} from '../../api/zfdm/zfdm';
import { wxPay } from '../../api/pay';
import { timeoutTask, showWxToast, getRandom } from '../../utils/index';
import defaultContent from '../../assets/constant/default';
const app = getApp();

let second = 0;
// let millisecond = 0;
let m1 = 0;
let m2 = 0;
let m3 = 0;
let m4 = 0;
let millisecondReal = 0;
let timeStr = '00:0000';
let tmpInterval; //用于倒计时
let tmpInterval2;
let inPay = false;
let isEndLoop = false;
let btnLock = false;
let innerAudioContextStart = null;
let innerAudioContextEnd = null;
Page({
  /**
     * 页面的初始数据
     */
  data: {
    userId: '',
    openId: '',
    avator: '',
    timestr: '00:0000',
    resultTime: '',
    koPercentVal: '', // 击败了多少人%
    koDis: '', // 距离目标还差多少秒
    koBonus: '', // 目标奖励金额
    koOtherName: '', // 击败别人的人或者击败我的人
    ruleBoxVisible: false,
    rankVisible: false,
    guessInfoId: '',// 参与id
    redpackageId: '',// 轮次id
    isFree: false, // 本次挑战是否免费
    raceTime: '', // 本次挑战的目标时间
    raceStatus: '2', // 0: 游戏中 1: 游戏结束 2: 游戏等待
    tipVisible: false,
    tipBoxType: 0, // 0:挑战失败 1:挑战成功 2:放弃挑战 3:别人的ko信息 4:我被ko的信息
    currentRank: 0, // 当前名次
    rankList: [], // 排行榜
    isOnTimer: false, // 是否挑战中
    needPrice: 0,
    messageQueue: [],
    cdTxt: 3,
  },

  /**
     * 生命周期函数--监听页面加载
     */
  onLoad: function(options) {
    console.log(options);
    isEndLoop = false;
    inPay = false;
    this.resetTimer();
    this.setData({
      userId: options.userId,
      openId: options.openId,
      avator: options.headImg,
    });
    this.initZfdmInfo();
    btnLock = false;
    innerAudioContextStart = wx.createInnerAudioContext({
      useWebAudioImplement: true,
    });
    innerAudioContextStart.src =
      'https://ustatic.hudongmiao.com/joymewMp/zfdm/zfdmStart.mp3';
    innerAudioContextEnd = wx.createInnerAudioContext({
      useWebAudioImplement: true,
    });
    innerAudioContextEnd.src =
      'https://ustatic.hudongmiao.com/joymewMp/zfdm/zfdmEnd.mp3';
  },
  onUnload: function() {
    this.resetTimer();
    isEndLoop = true;
    inPay = false;
    btnLock = false;
    innerAudioContextStart.destroy();
    innerAudioContextStart = null;
    innerAudioContextEnd.destroy();
    innerAudioContextEnd = null;
  },
  replay: function() {
    this.closeTipBox();
    this.start();
  },
  bgAidStart: function(type) {
    if (type === 'start') {
      innerAudioContextStart.play();
    } else if (type === 'end') {
      innerAudioContextEnd.play();
    }
    wx.vibrateLong();
  },
  handleBtnTap: function() {
    if (this.data.isOnTimer) {
      this.end();
    } else {
      this.start();
    }
  },
  start: function() {
    if (btnLock) {
      return;
    }
    this.bgAidStart('start');
    if (this.data.isFree) {
      tmpInterval = setInterval(this.timer, 10);
      this.setData({
        isOnTimer: true,
      });
    } else {
      inPay = true;
      zfdmRecharge({
        userId: this.data.userId,
        openId: this.data.openId,
      })
        .then(res => {
          console.log(res);
          return wxPay(res);
        })
        .then(res2 => {
          console.log(res2);
          return this.updateZfdmInfo();
        })
        .then(() => {
          inPay = false;
          tmpInterval = setInterval(this.timer, 10);
          this.setData({
            isOnTimer: true,
          });
        })
        .catch(err => {
          showWxToast('支付失败');
          inPay = false;
          console.log(err);
        });
    }
  },
  end: function() {
    if (btnLock) {
      return;
    }
    console.log(this.transformTimeStr());
    if (tmpInterval) {
      this.bgAidStart('end');
      clearInterval(tmpInterval);
      tmpInterval = null;
      this.startGame(this.data.isFree);
      this.setData({
        isOnTimer: false,
      });
    } else {
      showWxToast('请点击挑战');
    }
  },
  startGame: function(isFree) {
    btnLock = true;
    this.setData({
      resultTime: this.transformTimeStr(),
    });
    startZfdm({
      guessInfoId: isFree ? 'free_id' : this.data.guessInfoId,
      raceTime: this.data.resultTime,
    })
      .then(res => {
        console.log('开始游戏后的结果：', res);
        btnLock = false;
        if (isFree) {
          this.setData({
            isFree: false,
          });
        }
        if (res.data.code === '200' && res.data.myRank) {
          let tmpRank = parseInt(res.data.myRank.size, 10);
          let tmpTipBoxType = 0;
          if (tmpRank <= 8) {
            tmpTipBoxType = 1;
          } else {
            tmpTipBoxType = 0;
          }
          this.setData({
            tipVisible: true,
            tipBoxType: tmpTipBoxType,
            currentRank: tmpRank,
            koPercentVal: res.data.myRank.chaoYueVal,
            koDis: res.data.myRank.raceTime_val_distance,
            koBonus: res.data.myRank.red_bao_money,
          });
        }
      })
      .catch(err => {
        console.log(err);
        btnLock = false;
      });
  },
  // 时间转化
  transformTimeStr: function() {
    let tmpLastTime = '';
    let zPart = '';
    let xPart = '';
    const tmpTimeArr = this.data.timestr.split('');
    console.log(tmpTimeArr);
    if (tmpTimeArr[0] === '0') {
      zPart = tmpTimeArr[1];
    } else {
      zPart = tmpTimeArr[0] + tmpTimeArr[1];
    }
    for (let i = 6; i >= 3; i -= 1) {
      if (tmpTimeArr[i] !== '0') {
        break;
      } else {
        tmpTimeArr[i] = '';
      }
    }
    xPart = tmpTimeArr[3] + tmpTimeArr[4] + tmpTimeArr[5] + tmpTimeArr[6];

    if (xPart) {
      tmpLastTime = `${zPart}.${xPart}`;
    } else {
      tmpLastTime = zPart;
    }
    return tmpLastTime;
  },
  resetTimer: function() {
    if (tmpInterval) {
      clearInterval(tmpInterval);
      tmpInterval = null;
      this.setData({
        isOnTimer: false,
      });
    }
    if (tmpInterval2) {
      clearInterval(tmpInterval2);
      tmpInterval2 = null;
    }
    second = 0;
    // millisecond = 0;
    m1 = 0;
    m2 = 0;
    m3 = 0;
    m4 = 0;
    millisecondReal = 0;
    timeStr = '00:0000';
    this.setData({
      timestr: timeStr,
    });
  },
  timer: function() {
    if (millisecondReal >= 100) {
      // millisecond = 0;
      millisecondReal = 0;
      second += 1;
      if (second === 99) {
        this.end();
      }
    }
    millisecondReal = millisecondReal + 1;
    // millisecond = getRandom(0, 9999);
    m4 += 1;
    if (millisecondReal % 3 === 0) {
      m3 += 1;
    }
    if (millisecondReal % 6 === 0) {
      m2 += 1;
    }
    if (millisecondReal % 10 === 0) {
      m1 += 1;
    }
    if (m4 > 9) {
      m4 = 0;
    }
    if (m3 > 9) {
      m3 = 0;
    }
    if (m2 > 9) {
      m2 = 0;
    }
    if (m1 > 9) {
      m1 = 0;
    }
    // timeStr =
    //   this.getConvertSecond(second) +
    //   ':' +
    //   this.getConvertMilliSecond(millisecond);
    timeStr = this.getConvertSecond(second) + ':' + m1 + m2 + m3 + m4;
    this.setData({
      timestr: timeStr,
    });
  },
  getConvertSecond: function(second) {
    const secondStr = second.toString();
    let resultStr;
    if (secondStr.length === 1) {
      resultStr = '0' + secondStr;
    } else if (secondStr.length === 2) {
      resultStr = secondStr;
    } else {
      resultStr = '00';
    }
    return resultStr;
  },
  getConvertMilliSecond: function(millisecond) {
    const millisecondStr = millisecond.toString();
    let resultStr;
    if (millisecondStr.length === 1) {
      resultStr = '000' + millisecondStr;
    } else if (millisecondStr.length === 2) {
      resultStr = '00' + millisecondStr;
    } else if (millisecondStr.length === 3) {
      resultStr = '0' + millisecondStr;
    } else {
      resultStr = millisecondStr;
    }
    return resultStr;
  },
  getIt: function() {
    this.setData({
      ruleBoxVisible: false,
    });
  },
  openRuleBox: function() {
    this.setData({
      ruleBoxVisible: true,
    });
  },
  closeTipBox: function() {
    // 如果关闭的是ko信息弹窗则更新消息队列的索引
    if (this.data.tipBoxType === 3 || this.data.tipBoxType === 4) {
      app.updateZfdmIndex();
    }
    this.setData({
      tipVisible: false,
      tipBoxType: 0,
      currentRank: 0,
      resultTime: '',
      koPercentVal: '',
      koDis: '',
      koBonus: '',
      koOtherName: '',
    });
    this.resetTimer();
  },
  initZfdmInfo: function() {
    getZfdmInfo()
      .then(res => {
        console.log(res);
        this.setData({
          guessInfoId: res.data.guess_info_id,
          redpackageId: res.data.red_package_id,
          isFree: res.data.isUseFreeChance === '0',
          raceTime: res.data.raceTime,
          raceStatus: res.data.race_status,
          needPrice: res.data.race_one_money,
        });
        app.initZfdmId(res.data.red_package_id);
        if (this.data.raceStatus === '1') {
          this.getRankList();
        } else {
          this.loopGetZfdmInfo();
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  updateZfdmInfo: function() {
    return new Promise((resolve, reject) => {
      getZfdmInfo()
        .then(res => {
          console.log('更新guessInfoId', res);
          this.setData({
            guessInfoId: res.data.guess_info_id,
            redpackageId: res.data.red_package_id,
            isFree: res.data.isUseFreeChance === '0',
            raceTime: res.data.raceTime,
            raceStatus: res.data.race_status,
            needPrice: res.data.race_one_money,
          });
          resolve();
        })
        .catch(err => {
          console.log(err);
          reject(err);
        });
    });
  },
  loopGetZfdmInfo: function() {
    if (isEndLoop) {
      return;
    }
    getZfdmInfo(true)
      .then(res => {
        console.log(res);
        this.setData({
          raceStatus: res.data.race_status,
        });
        if (this.data.raceStatus === '1') {
          isEndLoop = true;
          this.getRankList();
        } else {
          timeoutTask(() => {
            this.loopGetZfdmInfo();
          }, 2000);
          timeoutTask(() => {
            this.updateMessageQueue();
          }, 4000);
        }
      })
      .catch(err => {
        console.log(err);
        isEndLoop = true;
      });
  },
  updateMessageQueue() {
    getZfdmMessageList(this.data.redpackageId)
      .then(res => {
        if (res && res.data) {
          this.setData({
            messageQueue: res.data.playList,
          });
          console.log('消息列表：', this.data.messageQueue);
          this.popupMessage();
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  popupMessage() {
    if (btnLock || tmpInterval || inPay) {
      // 操作中(支付中、秒表转动、查看结果)
      return;
    }
    if (this.data.tipVisible) {
      // 弹出中
      return;
    }
    const tmpQueue = this.data.messageQueue;
    const tmpCurrentMsg = tmpQueue[app.globalData.zfdmIndex];
    if (!tmpCurrentMsg) {
      // 消息队列中无消息
      return;
    }
    console.log('弹出消息');
    try {
      // 解析出消息对象
      const tmpMsgObj = JSON.parse(tmpCurrentMsg.element);
      // 判断是别人的ko信息还是我被ko的信息
      if (tmpMsgObj.jb_userId === this.data.userId) {
        // 弹出我被ko的消息
        this.setData({
          tipVisible: true,
          tipBoxType: 4,
          koOtherName: tmpMsgObj.my_name,
          koPercentVal: tmpMsgObj.chaoYueVal,
          koBonus: tmpMsgObj.rank_money,
        });
      } else {
        // 弹出别人的ko消息
        this.setData({
          tipVisible: true,
          tipBoxType: 3,
          koOtherName: tmpMsgObj.my_name,
          resultTime: tmpMsgObj.my_guess_money,
          koPercentVal: tmpMsgObj.chaoYueVal,
          koBonus: tmpMsgObj.rank_money,
        });
        // 执行倒计时逻辑
        if (!tmpInterval2) {
           let tmpCd = 3;
          this.setData({
            cdTxt: tmpCd,
          });
          console.log('开始计时', tmpCd);
          tmpInterval2 = setInterval(() => {
            if (tmpCd === 1) {
              clearInterval(tmpInterval2);
              tmpInterval2 = null;
              this.closeTipBox();
            } else {
              tmpCd -= 1;
            }
            this.setData({
              cdTxt: tmpCd,
            });
          }, 1000);
        }
      }
    } catch (err) {
      console.log(err);
    }
  },
  getRankList: function() {
    getZfdmRankList(this.data.redpackageId)
      .then(res => {
        console.log('排行榜：', res);
        // let tmpList = res.data.list;
        let tmpList = [];
        const tmpLen = res.data.list.length;
        if (tmpLen > 8) {
          tmpList = res.data.list.slice(0, 8);
        } else {
          tmpList = res.data.list;
          // 补齐
          for (let i = tmpLen; i < 8; i += 1) {
            tmpList.push({
              avator: defaultContent.defaultHeadImg,
              wx_name: 'Player',
              guess_money: 0,
              lottery_money: 0,
            });
          }
        }
        this.setData({
          rankList: tmpList,
        });
      })
      .catch(err => {
        console.log(err);
      });
  },
  handleBack: function() {
    this.setData({
      tipBoxType: 2,
    });
  },
});
````

## File: pages/zfdm/zfdm.json
````json
{
  "navigationBarTitleText": "争分夺秒",
  "disableScroll": true
}
````

## File: pages/zfdm/zfdm.wxml
````
<view class="zfdmContainer">
    <image src="https://static.hudongmiao.com/joymewMp/zfdm/gameTitle.png" class="titleImg"></image>
    <view class="ruleEntry" bindtap="openRuleBox">
        <view class="para">规则</view>
        <view class="para">介绍</view>
    </view>
    <view class="targetTime">本次挑战{{raceTime}}秒</view>
    <view class="timer">{{timestr}}</view>
    <view class="firstFreeTip" wx:if="{{isFree}}">首次挑战免费</view>
    <view class="challengeBtn" bindtap="handleBtnTap" wx:if="{{raceStatus === '0'}}">
        <image src="https://static.hudongmiao.com/joymewMp/zfdm/cBtnText1.png" class="cBtnText1" wx:if="{{!isOnTimer}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/zfdm/cBtnText2.png" class="cBtnText2" wx:if="{{isOnTimer}}"></image>
    </view>
    <view class="waitTip" wx:if="{{raceStatus === '2'}}">等待主持人开始游戏......</view>
    <!-- 规则 -->
    <view class="ruleWrap" wx:if="{{ruleBoxVisible}}">
        <view class="ruleBox">
            <view class="content">
                <view class="para">1.等待主持人设置一个数字</view>
                <view class="para">2.来宾在手机需要准确的点到设置的数字</view>
                <view class="para">3.每人有多次机会，最接近数字的前8名将会获得奖励</view>
                <view class="para">4.超过1次机会后每次需要支付游戏币，所支付的金额进入红包口袋</view>
                <view class="para">5.游戏时间为2分钟。</view>
            </view>
            <view class="getItBtn" bindtap="getIt">我知道了</view>
            <image src="https://static.hudongmiao.com/joymewMp/zfdm/closeBtn.png" class="closeBtn" bindtap="getIt"></image>
        </view>
    </view>
    <!-- 游戏过程中的我被ko的提示框 -->
    <view class="onTipPopup" wx:if="{{tipVisible && tipBoxType === 4}}">
        <view class="koBoxMe">
            <view class="koller">{{koOtherName}}</view>
            <view class="para1">超越了你的成绩</view>
            <view class="para2">
                击败了全场
                <view class="strong">{{koPercentVal}}</view>
                %的来宾
            </view>
            <view class="para3">
                将获得
                <view class="strong">{{koBonus}}</view>
                元红包
            </view>
        </view>
        <view class="replayBtn" bindtap="replay">拿下TA({{needPrice}}元)</view>
        <view class="confirmBtn" bindtap="closeTipBox">为爱放弃</view>
    </view>
    <!-- 游戏过程中的其他人的ko提示框 -->
    <view class="onTipPopup" wx:if="{{tipVisible && tipBoxType === 3}}">
        <view class="cd">{{cdTxt}}秒</view>
        <view class="koBox">
            <view class="boxHeader">
                <image src="https://static.hudongmiao.com/joymewMp/zfdm/otherKo1.png" class="gx"></image>
                <view class="nameBox">{{koOtherName}}</view>
            </view>
            <view class="boxInfo">
                <view class="p1">
                    他的成绩为
                    <view class="strong">{{resultTime}}</view>
                    秒
                </view>
                <view class="p2">
                    击败了全场
                    <view class="strong">{{koPercentVal}}%</view>
                    的来宾
                </view>
                <view class="p3">
                    将获得
                    <view class="strong">{{koBonus}}</view>
                    元红包
                </view>
            </view>
        </view>
        <view class="replayBtn" bindtap="replay">拿下TA({{needPrice}}元)</view>
        <view class="confirmBtn" bindtap="closeTipBox">关闭</view>
    </view>
    <!-- 游戏过程中的放弃挑战提示框 -->
    <view class="onTipPopup" wx:if="{{tipVisible && tipBoxType === 2}}">
        <view class="tipBox giveup">
            <image class="closeImg" src="https://static.joymew.com/joymewMp/authDialog/closeIcon.png" bindtap="closeTipBox"></image>
            <image src="https://static.hudongmiao.com/joymewMp/zfdm/giveupt3.png" class="t1"></image>
            <view class="cjWrap">
                <view class="cjItem">
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/giveupt2.png" class="keyImg"></image>
                    {{resultTime}}
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/giveupSecond.png" class="unit"></image>
                </view>
                <view class="cjItem">
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/giveupt1.png" class="keyImg2"></image>
                    {{koDis}}
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/giveupSecond.png" class="unit"></image>
                </view>
            </view>
        </view>
        <view class="replayBtn" bindtap="replay">为爱继续（{{needPrice}}元）</view>
        <view class="confirmBtn" bindtap="closeTipBox">为爱放弃</view>
    </view>
    <!-- 游戏过程中的挑战成功提示框 -->
    <view class="onTipPopup" wx:if="{{tipVisible && tipBoxType === 1}}">
        <view class="tipBox">
            <image src="{{avator}}" class="avator"></image>
            <view class="tInfo1">
                <view class="tI1Pra1">
                    击败了全场
                    <view class="strong">{{koPercentVal}}</view>
                    %的来宾
                </view>
                <view class="tI1Pra2">
                    还差
                    <view class="strong2">{{koDis}}</view>
                    秒将获得
                    <view class="strong">{{koBonus}}</view>
                    元红包
                </view>
            </view>
            <view class="tInfo2">
                <image src="https://static.hudongmiao.com/joymewMp/zfdm/scoreKey.png" class="keyImg"></image>
                {{resultTime}}
            </view>
            <view class="tInfo3">
                <view class="tI3Pra1">请实时注意当前排名变化</view>
                <view class="tI3Pra2">1-8名可获得游戏奖励</view>
            </view>
        </view>
        <view class="replayBtn" bindtap="replay">为爱继续挑战（{{needPrice}}元）</view>
        <view class="confirmBtn" bindtap="handleBack">为爱放弃</view>
    </view>
    <!-- 游戏过程中的挑战失败提示框 -->
    <view class="onTipPopup" wx:if="{{tipVisible && tipBoxType === 0}}">
        <view class="tipBox fail">
            <image src="{{avator}}" class="avator"></image>
            <view class="tInfo1 fail">
                <image src="https://static.hudongmiao.com/joymewMp/zfdm/onFailTip2.png" class="keyImg"></image>
                {{resultTime}}
            </view>
            <view class="tInfo2 fail">
                <image src="https://static.hudongmiao.com/joymewMp/zfdm/onFailTip3.png" class="keyImg"></image>
                {{currentRank}}
            </view>
            <view class="tInfo3">
                <view class="tI3Pra1">请实时注意当前排名变化</view>
                <view class="tI3Pra2">1-8名可获得游戏奖励</view>
            </view>
        </view>
        <view class="replayBtn" bindtap="replay">再来一次（{{needPrice}}元）</view>
        <view class="confirmBtn" bindtap="handleBack">返回</view>
    </view>
    <!-- 排行榜 -->
    <view class="rankWrap" wx:if="{{raceStatus === '1'}}">
        <view class="rankBox">
            <view class="rankItem {{(index === 0 || index === 1 || index === 2)?'topThree':''}}" wx:for="{{rankList}}" wx:key="index">
                <view class="rankNum" wx:if="{{index === 0}}">
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/firstMedal.png" class="medal"></image>
                </view>
                <view class="rankNum" wx:if="{{index === 1}}">
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/secondMedal.png" class="medal"></image>
                </view>
                <view class="rankNum" wx:if="{{index === 2}}">
                    <image src="https://static.hudongmiao.com/joymewMp/zfdm/thirdMedal.png" class="medal"></image>
                </view>
                <view class="rankNum" wx:if="{{index > 2}}">{{index + 1}}</view>
                <image src="{{item.avator}}" class="avator"></image>
                <view class="nickname">{{item.wx_name}}</view>
                <view class="cTime">{{item.guess_money}}秒</view>
                <view class="money">{{item.lottery_money}}元</view>
            </view>
        </view>
    </view>
</view>
````

## File: pages/zfdm/zfdm.wxss
````
.zfdmContainer {
  position: absolute;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/bg.png');
  background-size: 100% 100%;
}
.zfdmContainer > .titleImg {
  width: 562rpx;
  height: 378rpx;
}
.zfdmContainer > .ruleEntry {
  width: 108rpx;
  height: 83rpx;
  background-image: url('https://static.joymew.com/joymewMp/zfdm/ruleEntry.png');
  background-size: 100% 100%;
  position: absolute;
  right: 0;
  top: 124rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
.ruleEntry > .para {
  font-size: 24rpx;
  color: rgba(255, 255, 255, 0.5);
}
.zfdmContainer > .targetTime {
  width: 482rpx;
  height: 134rpx;
  background-image: url('https://static.joymew.com/joymewMp/zfdm/targetBox.png');
  background-size: 100% 100%;
  display: flex;
  justify-content: center;
  line-height: 122rpx;
  font-size: 42rpx;
  font-weight: 400;
  color: #d83607;
}
.zfdmContainer > .timer {
  width: 606rpx;
  height: 182rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/timeBg.png');
  background-size: 100% 100%;
  margin-top: 20rpx;
  font-size: 80rpx;
  font-weight: 500;
  color: #cf2322;
  letter-spacing: 35rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  padding-left: 30rpx;
}

.zfdmContainer > .firstFreeTip {
  margin-top: 20rpx;
  font-size: 32rpx;
  color: #ffffff;
}
.zfdmContainer > .waitTip {
  font-size: 32rpx;
  color: #ffffff;
  margin-top: 32rpx;
}
.zfdmContainer > .challengeBtn {
  width: 250rpx;
  height: 250rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/cBtnNew.png');
  background-size: 100% 100%;
}
.challengeBtn > .cBtnText1 {
  width: 102rpx;
  height: 98rpx;
}
.challengeBtn > .cBtnText2 {
  width: 102rpx;
  height: 50rpx;
}
.ruleWrap {
  position: absolute;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
}
.ruleWrap > .ruleBox {
  width: 624rpx;
  height: 796rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/ruleBox.png');
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}
.ruleWrap > .ruleBox > .content {
  margin-top: 148rpx;
}

.ruleWrap > .ruleBox > .content > .para {
  font-size: 28rpx;
  font-weight: 400;
  color: #333333;
  padding: 0 30rpx;
  margin: 15rpx 0;
}
.ruleWrap > .ruleBox > .getItBtn {
  width: 336rpx;
  height: 72rpx;
  background-color: #fde37a;
  border-radius: 36rpx;
  position: absolute;
  bottom: 62rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 36rpx;
  font-weight: 400;
  color: #e07717;
}
.ruleWrap > .ruleBox > .closeBtn {
  width: 68rpx;
  height: 70rpx;
  position: absolute;
  bottom: -114rpx;
}
.onTipPopup {
  position: absolute;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}
.onTipPopup > .tipBox {
  width: 710rpx;
  height: 860rpx;
  background-image: url('https://static.joymew.com/joymewMp/zfdm/challengeSuccessBg.png');
  background-size: 100% 100%;
  display: flex;
  align-items: center;
  flex-direction: column;
  position: relative;
  padding-top: 350rpx;
}
.tipBox.fail {
  width: 674rpx;
  height: 876rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/onFailTip1.png');
}
.tipBox > .avator {
  width: 88rpx;
  height: 88rpx;
  position: absolute;
  top: 36rpx;
  border-radius: 50%;
}
.tipBox > .tInfo1 {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  width: 505rpx;
}
.tipBox > .tInfo1 > .tI1Pra1 {
  font-size: 30rpx;
  font-weight: 400;
  color: #333333;
  display: flex;
  align-items: flex-end;
}
.tipBox > .tInfo1 > .tI1Pra1 > .strong {
  font-size: 46rpx;
  color: #fb4a40;
  line-height: 45rpx;
}
.tipBox > .tInfo1 > .tI1Pra2 {
  font-size: 30rpx;
  font-weight: 400;
  color: #333333;
  display: flex;
  align-items: flex-end;
  margin-top: 20rpx;
}
.tipBox > .tInfo1.fail {
  font-size: 63rpx;
  font-weight: 700;
  color: #5f4d8c;
  letter-spacing: 3rpx;
  justify-content: space-between;
  flex-direction: row;
  width: 520rpx;
}
.tipBox > .tInfo1.fail > .keyImg {
  width: 286rpx;
  height: 58rpx;
}
.tipBox > .tInfo1 > .tI1Pra2 > .strong2 {
  color: #fb4a40;
}
.tipBox > .tInfo1 > .tI1Pra2 > .strong {
  font-size: 46rpx;
  color: #fb4a40;
  line-height: 45rpx;
}
.tipBox > .tInfo2 {
  width: 512rpx;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 63rpx;
  font-weight: 700;
  color: #fb4a40;
  margin-top: 60rpx;
}
.tipBox > .tInfo2.fail {
  color: #5f4d8c;
  width: 520rpx;
}
.tipBox > .tInfo2 > .keyImg {
  width: 253rpx;
  height: 51rpx;
}

.tipBox > .tInfo3 {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 345rpx;
  font-size: 30rpx;
  font-weight: 500;
  color: #666666;
  letter-spacing: 2rpx;
  margin-top: 120rpx;
}
.tipBox > .tInfo3 > .tI3Pra1 {
  margin-bottom: 18rpx;
}

.tipBox.giveup {
  width: 622rpx;
  height: 458rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/giveupBox.png');
  padding-top: 75rpx;
}
.tipBox.giveup > .t1 {
  width: 472rpx;
  height: 42rpx;
}
.tipBox.giveup > .cjWrap {
  width: 521rpx;
  height: 224rpx;
  margin-top: 92rpx;
}
.tipBox.giveup > .cjWrap > .cjItem {
  width: 521rpx;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  font-size: 46rpx;
  font-weight: 700;
  color: #fb4a40;
  line-height: 37rpx;
}
.tipBox.giveup > .cjWrap > .cjItem:nth-child(2) {
  margin-top: 40rpx;
}
.tipBox.giveup > .cjWrap > .cjItem > .keyImg {
  width: 228rpx;
  height: 33rpx;
  margin-right: 10rpx;
}
.tipBox.giveup > .cjWrap > .cjItem > .keyImg2 {
  width: 264rpx;
  height: 33rpx;
  margin-right: 10rpx;
}
.tipBox.giveup > .cjWrap > .cjItem > .unit {
  width: 33rpx;
  height: 32rpx;
  margin-left: 10rpx;
}
.tipBox.giveup > .closeImg {
  width: 44rpx;
  height: 44rpx;
  position: absolute;
  top: -24rpx;
  left: 615rpx;
  z-index: 1;
}
.onTipPopup > .replayBtn {
  width: 670rpx;
  height: 104rpx;
  background: #fdf1ac;
  border-radius: 52rpx;
  margin-top: 50rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40rpx;
  font-weight: 700;
  color: #e07717;
  letter-spacing: 2rpx;
}
.onTipPopup > .confirmBtn {
  font-size: 32rpx;
  font-weight: 400;
  color: rgba(255, 255, 255, 0.4);
  margin-top: 30rpx;
  letter-spacing: 2rpx;
}
.onTipPopup > .koBox {
  width: 686rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 40rpx;
}
.onTipPopup > .cd {
  width: 94rpx;
  height: 46rpx;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 66px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 28rpx;
  font-weight: 400;
  color: #ffffff;
  position: absolute;
  right: 38rpx;
  top: 38rpx;
}
.koBox > .boxHeader {
  width: 439rpx;
  height: 439rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/otherKo2.png');
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.koBox > .boxHeader > .gx {
  width: 336rpx;
  height: 239rpx;
}
.koBox > .boxHeader > .nameBox {
  width: 520rpx;
  height: 143rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/otherKo3.png');
  background-size: 100% 100%;
  overflow: hidden;
  text-align: center;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 52rpx;
  font-weight: 500;
  color: #ffffff;
  line-height: 143rpx;
  padding: 0 20rpx;
}
.koBox > .boxInfo {
  width: 686rpx;
  font-size: 56rpx;
  font-weight: 400;
  color: #ffffff;
}
.koBox > .boxInfo > .p1 {
  width: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  margin-top: 20rpx;
}
.koBox > .boxInfo > .p1 > .strong {
  color: #fb4a40;
}
.koBox > .boxInfo > .p2 {
  width: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}
.koBox > .boxInfo > .p2 > .strong {
  color: #fb4a40;
}
.koBox > .boxInfo > .p3 {
  margin-top: 50rpx;
  width: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  line-height: 50rpx;
}
.koBox > .boxInfo > .p3 > .strong {
  font-size: 88rpx;
  color: #fb4a40;
}
.onTipPopup > .koBoxMe {
  width: 658rpx;
  height: 647rpx;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/challengeFailBg.png');
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 322rpx;
}
.koBoxMe > .koller {
  width: 605rpx;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 56rpx;
  font-weight: 700;
  color: #ffbe23;
  white-space: nowrap;
}
.koBoxMe > .para1 {
  font-size: 30rpx;
  font-weight: 400;
  color: #333333;
  margin-top: 25rpx;
}
.koBoxMe > .para2 {
  font-size: 30.16rpx;
  font-weight: 400;
  color: #333333;
  display: flex;
  align-items: flex-end;
}
.koBoxMe > .para2 > .strong {
  color: #fb4a40;
}
.koBoxMe > .para3 {
  font-size: 30rpx;
  font-weight: 400;
  color: #333333;
  display: flex;
  align-items: flex-end;
  margin-top: 15rpx;
}
.koBoxMe > .para3 > .strong {
  color: #fb4a40;
  font-size: 45rpx;
}
.rankWrap {
  position: absolute;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  background-image: url('https://static.hudongmiao.com/joymewMp/zfdm/rankBg.png');
  background-size: 100% 100%;
}
.rankWrap > .rankBox {
  width: 670rpx;
  height: 1175rpx;
  background: #fef1cf;
  border-radius: 56rpx;
  padding: 30rpx 0;
}
.rankBox > .rankItem {
  display: flex;
  align-items: center;
  width: 100%;
  position: relative;
  margin-bottom: 40rpx;
  padding-left: 5rpx;
}
.rankBox > .rankItem.topThree {
  margin-bottom: 10rpx;
}
.rankBox > .rankItem > .rankNum {
  font-size: 60rpx;
  font-weight: 400;
  color: #a47d18;
  width: 116rpx;
  text-align: center;
}
.rankNum > .medal {
  width: 116rpx;
  height: 132rpx;
}
.rankBox > .rankItem > .avator {
  width: 60rpx;
  height: 60rpx;
  border-radius: 50%;
  margin-left: 5rpx;
}
.rankBox > .rankItem > .nickname {
  width: 198rpx;
  font-size: 28rpx;
  font-weight: 400;
  text-align: left;
  color: #7a2309;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
  margin-left: 24rpx;
}
.rankBox > .rankItem > .cTime {
  color: #7d00fd;
  font-size: 28rpx;
  font-weight: 400;
  margin-left: 10rpx;
}
.rankBox > .rankItem > .money {
  font-size: 28rpx;
  font-weight: 400;
  color: #fd0000;
  position: absolute;
  right: 20rpx;
}
@media screen and (min-height: 720px) {
  .zfdmContainer > .targetTime {
    margin-top: 30rpx;
  }
  .zfdmContainer > .timer {
    margin-top: 40rpx;
  }
  .zfdmContainer > .firstFreeTip {
    margin-top: 40rpx;
  }
  .zfdmContainer > .challengeBtn {
    margin-top: 40rpx;
  }
}
````

## File: pages/zyz/zyz.js
````javascript
import { timeoutTask, showWxToast } from '../../utils/index';
import { getPoolMoney, getZyzInfo, getZyzRank, zyzRecharge, startZyz, sendPrizeInfo, sendBroadCast } from '../../api/zyz/zyz';
import { wxPay } from '../../api/pay';
import defaultContent from '../../assets/constant/default';

const zhufuList = [
    '美酒佳肴,不甚荣幸',
    '醉酒饱德，不胜感激',
    '小小红包,感谢招待',
    '感谢招待,祝愿安康',
];
// 礼物数组
const giftList = [
    {
        id: 1,
        gift: 'rocket1',
        name: '火箭小号',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket1.png',
        isChoosed: true
    }, {
        id: 2,
        gift: 'rocket2',
        name: '火箭中号',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket2.png',
        isChoosed: false
    }, {
        id: 3,
        gift: 'rocket3',
        name: '大号大号',
        imgUrl: 'https://static.hudongmiao.com/joymewMp/zyz/rocket3.png',
        isChoosed: false
    }
];

let tmpInterval = null; //用于倒计时
let tmpInterval2 = null; //用于轮询
let lock = false; //锁，用于确保 倒计时方法 一轮只调用一次
let lock2 = false;//锁，用于确保 执行动画的过程中不可以点按钮
let lock3 = false;//锁，用于确保 开始按钮不能连续点击
Page({
    data: {
        luckyMoney: 0,
        wheelRodateDeg: 0,
        isLuckyShow: false,
        luckyAni: '',
        gameStatus: 1, // 转一转状态(控制页面显示)
        prizeItemList: [],// 奖项列表(带汉字单位)
        prizeItemValList: [],// 奖项数值列表(不带汉字单位) 
        poolMoney: 0, //奖池金额
        countDownNum: 0,// 倒计时
        isEntry: false,// 充值入口
        topRankList: [],// 排行榜列表
        otherRankList: [],
        userId: '',
        openId: '',
        name: '',
        headImg: '',
        turnId: '', //一场 转一转的id 0代表要充值 否则代表这场 转一转的id
        giftList: giftList,
    },
    onLoad: function (options) {
        lock = false;
        lock2 = false;
        lock3 = false;
        tmpInterval = null;
        tmpInterval2 = null;
        this.setData({
            userId: options.userId,
            openId: options.openId,
            name: options.name,
            headImg: options.headImg,
            prizeItemList: options.zyzList.split(','),
            prizeItemValList: options.zyzList.replace(/[\u4e00-\u9fa5]/g, '').split(','),

        });
        this.requestPoolMoney();
    },
    onShow: function () {
        this.toGame();
    },
    onHide: function () {
        //清除定时器
        clearInterval(tmpInterval);
        clearInterval(tmpInterval2);
        tmpInterval = null;
        tmpInterval2 = null;
        lock = false;
    },
    onUnload: function () {
        //清除定时器
        clearInterval(tmpInterval);
        clearInterval(tmpInterval2);
        tmpInterval = null;
        tmpInterval2 = null;
    },
    showLucky() {
        this.setData({
            luckyAni: 'showLuckyAni',
            isLuckyShow: true,
        });
        // 4s后消失
        timeoutTask(() => {
            this.setData({
                luckyAni: 'hideLuckyAni',
            });
            timeoutTask(() => {
                this.setData({
                    isLuckyShow: false,
                });
            }, 100);
        }, 4000)
    },
    tapstartNyn() {
        getZyzInfo().then((res) => {
            console.log(res);
            this.setData({
                turnId: res.data.id
            });
            this.startGame();
        }).catch((err) => {
            console.log(err);
            showWxToast('网络异常');
        });
    },
    // 选择礼物
    chooseGift(e) {
        console.log(e)
        const choosedId = e.currentTarget.dataset.id;
        const tmpGiftList = this.data.giftList;
        tmpGiftList.forEach(item => {
            if (item.id === choosedId) {
                item.isChoosed = true;
            } else {
                item.isChoosed = false;
            }
        });
        this.setData({
            giftList: tmpGiftList
        });
    },
    // 转一转动画
    gameAniStart(endMoney) {
        let endIndex = this.findIndexByPrizeItem(endMoney);
        // 转盘当前选中项
        let nowIndex = 0;
        // 圈数(周期)
        let circle = 0;
        //转盘 加速阶段 缓冲阶段(确保<=5)
        //情况1：前三个周期->最后一个周期小于5   ani1 ani2
        //情况2:前三个周期->最后一个周期大于5   ani1 + endIndex-4
        let step1 = setInterval(() => {
            if (nowIndex === 9) {
                nowIndex = 0;
                this.setData({
                    wheelRodateDeg: (nowIndex * 36)
                });
                circle += 1;
            }
            if (circle === 3) {
                // 三圈后判断是否进入缓冲阶段
                if (endIndex < 4) {
                    clearInterval(step1);
                    let step2 = setInterval(() => {
                        if (nowIndex === endIndex) {
                            clearInterval(step2);
                            this.setData({
                                wheelRodateDeg: (nowIndex * 36)
                            });
                            timeoutTask(() => {
                                this.showLucky();
                            }, 500);
                        } else {
                            this.setData({
                                wheelRodateDeg: (nowIndex * 36)
                            })
                            if (nowIndex == 9) {
                                nowIndex = 0;
                            } else {
                                nowIndex += 1;
                            }
                        }
                    }, 500);
                } else {
                    //加速阶段停止位置 endIndex-4
                    if (nowIndex === (endIndex - 4)) {
                        clearInterval(step1);
                        let step2 = setInterval(() => {
                            if (nowIndex === endIndex) {
                                clearInterval(step2);
                                this.setData({
                                    wheelRodateDeg: (nowIndex * 36)
                                })
                                timeoutTask(() => {
                                    this.showLucky();
                                }, 500);
                            } else {
                                this.setData({
                                    wheelRodateDeg: (nowIndex * 36)
                                })
                                if (nowIndex == 9) {
                                    nowIndex = 0;
                                } else {
                                    nowIndex += 1;
                                }
                            }
                        }, 500)
                    } else {
                        this.setData({
                            wheelRodateDeg: (nowIndex * 36)
                        })
                        nowIndex += 1;
                    }
                }
            } else {
                this.setData({
                    wheelRodateDeg: (nowIndex * 36)
                });
                nowIndex += 1;
            }
        }, 100)

    },
    // 充钱玩转一转
    recharge() {
        if (!this.data.isEntry) {
            // 最后十五秒购买入口关闭
            showWxToast('购买入口关闭');
            return;
        }
        if (lock2) {
            return;
        }
        lock2 = true;
        zyzRecharge({
            userId: this.data.userId,
            openId: this.data.openId,
        }).then((res) => {
            console.log(res);
            return wxPay(res);
        }).then(() => {
            showWxToast('礼物发送成功!');
            this.sendGift(this.getChoosedGift());
            // startGame
            timeoutTask(() => {
                console.log('***2s后自动转一转***')
                this.tapstartNyn();
            }, 2000);

        }).catch((err) => {
            console.log(err);
            showWxToast('支付失败!');
            lock2 = false;
        });
    },
    getChoosedGift() {
        return this.data.giftList.find(item => {
            return item.isChoosed;
        });
    },
    sendGift(giftChoosed) {
        let tmpCode = '';
        if (giftChoosed.id == 1) {
            tmpCode = 5002;
        } else if (giftChoosed.id == 2) {
            tmpCode = 6002;
        } else if (giftChoosed.id == 3) {
            tmpCode = 7002;
        }
        const c = JSON.stringify({
            code: tmpCode,
            param: {
                headImg: this.data.headImg,
                nickname: this.data.name,
                wish: zhufuList[parseInt(Math.random() * 3)]
            }
        });
        sendBroadCast({
            c,
        });
    },
    // 转一转
    startGame() {
        startZyz({
            turnId: this.data.turnId,
        }).then((res) => {
            console.log('startNyn result:', res);
            //res.data.desc 奖项；endMoney中奖的金额；totalMoney 奖池金额
            //奖池金额刷新
            if (res.data.totalMoney.remainCoin) {
                this.setData({
                    poolMoney: res.data.totalMoney.remainCoin
                })
            }
            this.setData({
                luckyMoney: res.data.endMoney,
            });
            // 转一转动画开始
            this.gameAniStart(res.data.endMoney);

            // 4s动画停止后发送广播(必须要中奖的情况)
            if (parseInt(res.data.endMoney) > 0) {
                timeoutTask(() => {
                    this.sendBroad(res.data.endMoney, res.data.totalMoney.balance);
                }, 4000);
            }
            timeoutTask(() => {
                lock2 = false;
            }, 4000);
        }).catch((err) => {
            console.log(err);
            lock2 = false;
        });
    },
    // 点击进入 转一转
    toGame() {
        if (lock3) {
            return;
        }
        lock3 = true;
        this.requestGameInitInfo();
    },
    // 获取奖池金额
    requestPoolMoney() {
        getPoolMoney().then((res) => {
            console.log(res);
            this.setData({
                poolMoney: res.data.balance
            });
        }).catch((err) => {
            console.log(err);
        });
    },
    // 获取 转一转相关信息
    requestGameInitInfo() {
        getZyzInfo().then((res) => {
            console.log('***获取转一转基本信息***');
            console.log(res);
            //res.data.id 发送礼物 1转一转
            if (res.data.id == 0) {
                this.setData({
                    turnId: res.data.id
                })
            } else {
                this.setData({
                    turnId: res.data.id
                })
            }
            // 时间处理(用于倒计时) res.data.endTime
            if (res.data.endTime === '0') {
                //  转一转未开始的情况处理
                showWxToast(' 转一转尚未开始!');
            } else {
                let countTime = this.timeHandle(res.data.endTime);
                console.log('***接口返回endTime***');
                console.log(res.data.endTime);
                this.countDown(countTime);
                this.setData({
                    gameStatus: 2,
                });
                // 轮询获取充值和中奖列表
                if (!tmpInterval2) {
                    tmpInterval2 = setInterval(() => {
                        this.requestTipList();
                    }, 4000);
                }
            }
            lock3 = false;
        }).catch((err) => {
            console.log(err);
            lock3 = false;
        });
    },
    timeHandle(endTime) {
        //获取当前时间戳
        var nowTime = (new Date()).getTime();
        var subTime = parseInt((parseInt(endTime) - parseInt(nowTime)) / 1000);
        if (subTime < 0) {
            subTime = 0;
        }
        return subTime;
    },
    countDown(second) {
        if (lock == false && !tmpInterval) {
            lock = true;
            tmpInterval = setInterval(() => {
                if (second <= 1) {
                    this.setData({
                        isEntry: false,
                        countDownNum: second
                    })
                    this.requestRankList();
                } else {
                    second -= 1;
                    if (second <= 15) {
                        this.setData({
                            isEntry: false
                        })
                    } else {
                        this.setData({
                            isEntry: true
                        })
                    }
                    this.setData({
                        countDownNum: second
                    })
                }
            }, 1000)
        }
    },
    // 获取排行榜列表
    requestRankList() {
        getZyzRank().then((res) => {
            console.log(res);
            lock = false;
            let tmpTopRankArray = [];
            let tmpOtherRankArray = [];
            let count = 0;
            let tmpLen = res.data.list.length;
            // 限制中奖名单人数最多不超过10个
            if (tmpLen > 10) {
                tmpLen = 10;
            }
            while (count < tmpLen) {
                if (count < 3) {
                    tmpTopRankArray.push({
                        nickname: res.data.list[count].wx_name,
                        headimgurl: res.data.list[count].avator,
                        money: Math.floor(parseFloat(res.data.list[count].money))
                    });
                } else {
                    tmpOtherRankArray.push({
                        num: count < 0 ? `0${count + 1}` : (count + 1),
                        nickname: res.data.list[count].nickname,
                        headimgurl: res.data.list[count].headimgurl,
                        money: Math.floor(parseFloat(res.data.list[count].money))
                    });
                }
                count += 1;
            }
            if (tmpTopRankArray.length < 3) {
                const tmpLen2 = tmpTopRankArray.length;
                for (let i = tmpLen2; i < 3; i += 1) {
                    tmpTopRankArray.push({
                        nickname: 'Player',
                        headimgurl: defaultContent.defaultHeadImg,
                        money: 0,
                    });
                }
            }
            // 不足七个补齐
            if (tmpOtherRankArray.length < 7) {
                const tmpLen3 = tmpOtherRankArray.length;
                for (let i = tmpLen3; i < 7; i += 1) {
                    tmpOtherRankArray.push({
                        num: i + 3 < 0 ? `0${i + 4}` : (i + 4),
                        nickname: 'Player',
                        headimgurl: defaultContent.defaultHeadImg,
                        money: 0,
                    });
                }
            }

            console.log(tmpOtherRankArray);
            this.setData({
                topRankList: tmpTopRankArray,
                otherRankList: tmpOtherRankArray,
                gameStatus: 3,
            });
            // 停止轮询
            clearInterval(tmpInterval2);
            clearInterval(tmpInterval);
            tmpInterval = null;
            tmpInterval2 = null;
        }).catch((err) => {
            console.log(err);
        });
    },
    // 发广播
    sendBroad(golds, remainCoins) {
        sendPrizeInfo({
            gold: golds,
            remainCoin: remainCoins,
            turnId: this.data.turnId,
        }).then((res) => {
            console.log(res);
        }).catch((err) => {
            console.log(err);
            showWxToast('网络异常');
        });
    },
    // 根据奖项查找下标
    findIndexByPrizeItem(prizeItem) {
        let tmpLen = this.data.prizeItemValList.length;
        let tmpArr = this.data.prizeItemValList;
        let tmpIndex = -1;
        for (let i = 0; i < tmpLen; i += 1) {
            if (tmpArr[i] === prizeItem) {
                tmpIndex = i;
                break;
            }
        }
        return tmpIndex;
    },
    // 获取充值和中奖列表
    requestTipList() {
        getPoolMoney().then((res) => {
            console.log(res);
            const subTime = this.timeHandle(res.data.endTime);
            if (subTime <= 0) {
                //  转一转提前结束
                this.requestRankList();
            }
            this.setData({
                poolMoney: res.data.balance,
            })
        }).catch((err) => {
            console.log(err);
        })
    },
    toAgreement: function () {
        wx.navigateTo({
            url: '/pages/agreement/agreement'
        });
    },
});
````

## File: pages/zyz/zyz.json
````json
{
  "navigationBarTitleText": "转一转",
  "usingComponents": {
    "feedbackEntry": "../../components/feedbackEntry/feedbackEntry"
  },
  "disableScroll":true
}
````

## File: pages/zyz/zyz.wxml
````
<view class="zyzContainer">
    <view class="bgArea">
        <image src="https://static.hudongmiao.com/joymewMp/zyz/zyzBg2.png" class="bg" mode="widthFix" wx:if="{{gameStatus === 1 || gameStatus === 2}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/zyz/rankBg.png" class="bg" mode="widthFix" wx:if="{{gameStatus === 3}}"></image>
        <view class="shade" wx:if="{{gameStatus === 1 || gameStatus === 2}}"></view>
        <image src="https://static.hudongmiao.com/joymewMp/zyz/title.png" class="title" wx:if="{{gameStatus === 2}}"></image>
    </view>
    <!-- 等待界面 -->
    <view class="waitContainer" wx:if="{{gameStatus === 1}}">
        <!-- 奖池金额 -->
        <view class="totalMoney">
            奖池总金额: {{poolMoney}}元
            <image src="https://static.hudongmiao.com/joymewMp/zyz/coins.png" class="coinsImg"></image>
        </view>
        <view class="ruleBox">
            <image src="https://static.hudongmiao.com/joymewMp/zyz/ruleBox.png" class="ruleBoxImg" mode="widthFix"></image>
            <view class="ruleContent">
                <view class="para">1、主持人点击开始按钮， 转一转立即开始；</view>
                <view class="para">2、 转一转时长150秒，在倒计时结束前单个参与者可以不限次数参与 转一转；</view>
                <view class="para">3、参与者购买高级别弹幕后，系统将免费赠送机会；</view>
                <view class="para">4、所有奖项均为随机事件，参与者的消费将计入总奖池，中奖者的奖金将从奖池中扣除。</view>
            </view>
        </view>
        <view class="giftListWrap">
            <view class="giftItem {{item.isChoosed?'active':''}}" wx:for="{{giftList}}" wx:key="id" data-id="{{item.id}}" bindtap='chooseGift'>
                <view class="fudai"></view>
                <image src="{{item.imgUrl}}" class="giftImg g{{index+1}}"></image>
            </view>
        </view>
        <view class="startBtn" bindtap="toGame"></view>
    </view>
    <!--  转一转界面 -->
    <view class="gameContainer" wx:if="{{gameStatus === 2}}">
        <!-- 奖池金额 -->
        <view class="totalMoney">
            奖池总金额: {{poolMoney}}元
            <image src="https://static.hudongmiao.com/joymewMp/zyz/coins.png" class="coinsImg"></image>
        </view>
        <!-- 转盘区域 -->
        <view class="wheelArea">
            <image src="https://static.hudongmiao.com/joymewMp/zyz/wheelBorder.png" class="wheelBorderImg"></image>
            <image src="https://static.hudongmiao.com/joymewMp/zyz/wheel.png" class="wheelImg"></image>
            <image src="https://static.hudongmiao.com/joymewMp/zyz/wheelInner.png" class="wheelInnerImg" style="transform:{{'rotate('+wheelRodateDeg+'deg)'}}"></image>
            <image src="https://static.hudongmiao.com/joymewMp/zyz/wheelBtn.png" class="wheelBtn"></image>
            <view class="countdown">
                <view class="time">{{countDownNum}}</view>
                <view class="timeKey">倒计时</view>
            </view>
            <view class="prizeWrap">
                <view class="prizeItem" wx:for="{{prizeItemList}}" wx:key="index">
                    <view class="prizeName">{{item}}</view>
                    <image src="https://static.joymew.com/joymewMp/zyz/hb.png" class="hbImg" wx:if="{{index !== 3 && index !== 8}}"></image>
                </view>
            </view>
        </view>
        <!-- 选择发送礼物 -->
        <!-- <view class="tip">发送任意弹幕礼物，系统将免费赠送一次转盘抽奖机会</view> -->
        <view class="agreement" bindtap='toAgreement'>阅读并同意《充值服务协议》</view>
        <view class="giftListWrap">
            <view class="giftItem {{item.isChoosed?'active':''}}" wx:for="{{giftList}}" wx:key="id" data-id="{{item.id}}" bindtap='chooseGift'>
                <view class="fudai"></view>
                <image src="{{item.imgUrl}}" class="giftImg g{{index+1}}"></image>
            </view>
        </view>
        <view class="startBtn">
            <view class="text" bindtap="recharge">发送礼物</view>
        </view>
        <!-- 中奖结果 -->
        <view class="luckyWrap {{luckyAni}}" wx:if="{{isLuckyShow}}">
            <view class="tit">中奖啦</view>
            <view class="congragulations">
                恭喜你! 获得
                <text>{{luckyMoney}}</text>
                元红包!
            </view>
            <view class="wechatTip">微信已实时到账</view>
            <view class="money">{{luckyMoney}}元</view>
        </view>
    </view>
    <!--  转一转排行榜界面 -->
    <view class="rankContainer" wx:if="{{gameStatus === 3}}">
        <view class="firstLucky" wx:if="{{topRankList[0]}}">
            <view class="num">
                <view class="text">1</view>
            </view>
            <view class="headImgBox">
                <image src="{{topRankList[0].headimgurl}}" class="headImg"></image>
            </view>
            <view class="name">
                <view class="text">{{topRankList[0].nickname}}</view>
            </view>
            <view class="money">
                <view class="text">{{topRankList[0].money}}元</view>
            </view>
        </view>
        <view class="secondLucky" wx:if="{{topRankList[1]}}">
            <view class="num">
                <view class="text">2</view>
            </view>
            <view class="headImgBox">
                <image src="{{topRankList[1].headimgurl}}" class="headImg"></image>
            </view>
            <view class="name">
                <view class="text">{{topRankList[1].nickname}}</view>
            </view>
            <view class="money">
                <view class="text">{{topRankList[1].money}}元</view>
            </view>
        </view>
        <view class="thirdLucky" wx:if="{{topRankList[2]}}">
            <view class="num">
                <view class="text">3</view>
            </view>
            <view class="headImgBox">
                <image src="{{topRankList[2].headimgurl}}" class="headImg"></image>
            </view>
            <view class="name">
                <view class="text">{{topRankList[2].nickname}}</view>
            </view>
            <view class="money">
                <view class="text">{{topRankList[2].money}}元</view>
            </view>
        </view>
        <view class="otherWrap">
            <view class="otherLuckyList">
                <view class="item" wx:for="{{otherRankList}}" wx:key="index">
                    <view class="left">
                        <view class="num">{{ item.num }}</view>
                        <view class="headImgBox">
                            <image src="{{item.headimgurl}}" class="headImg"></image>
                        </view>
                        <view class="name">{{item.nickname}}</view>
                    </view>
                    <view class="right">{{item.money}}元</view>
                </view>
            </view>
        </view>
        <!-- 反馈入口 -->
        <feedbackEntry userId="{{userId}}"></feedbackEntry>
    </view>
</view>
````

## File: pages/zyz/zyz.wxss
````
.zyzContainer {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

/* 公共背景区域 */
.zyzContainer>.bgArea {
  width: 100%;
  position: absolute;
}

.zyzContainer>.bgArea>.bg {
  width: 105%;
  height: 100%;
  position: absolute;
  left: -2%;
}

.zyzContainer>.bgArea>.shade {
  width: 100vw;
  height: 100vh;
  opacity: 0.6;
  background-color: #000000;
  position: absolute;
  top: 0;
  left: 0;
}

.zyzContainer>.bgArea>.title {
  position: absolute;
  width: 101%;
  height: 185rpx;
  top: -10rpx;
  left: -3rpx;
}


/* 等待界面 */
.zyzContainer>.waitContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.zyzContainer>.waitContainer>.totalMoney {
  position: absolute;
  top: 0rpx;
  width: 526rpx;
  height: 70rpx;
  background: #AC0C00;
  box-shadow: 0rpx 3rpx 7rpx 0px #F6544A, 0px 1rpx 3rpx 0rpx rgba(0, 0, 0, 0.35);
  border-radius: 29rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 44rpx;
  color: #FCF5CD;
}

.zyzContainer>.waitContainer>.totalMoney>.coinsImg {
  width: 97rpx;
  height: 80rpx;
  position: absolute;
  left: -59rpx;
}

.zyzContainer>.waitContainer>.ruleBox {
  width: 880rpx;
  height: 740rpx;
  position: absolute;
  top: 186rpx;
  overflow: hidden;
  display: flex;
  justify-content: center;
}

.zyzContainer>.waitContainer>.ruleBox>.ruleBoxImg {
  width: 880rpx;
  top: -65rpx;
  position: absolute;
  left: 70rpx;
}

.zyzContainer>.waitContainer>.ruleBox>.ruleContent {
  font-size: 28rpx;
  font-weight: 400;
  color: #FFFFDA;
  position: absolute;
  width: 475rpx;
  top: 140rpx;
}

.zyzContainer>.waitContainer>.ruleBox>.ruleContent>.para {
  margin: 20rpx 0;
}

.zyzContainer>.waitContainer>.giftListWrap {
  display: flex;
  justify-content: space-around;
  position: absolute;
  top: 860rpx;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem {
  width: 196rpx;
  height: 230rpx;
  position: relative;
  display: flex;
  justify-content: center;
  opacity: 0.3;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem.active {
  opacity: 1;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem>.fudai {
  width: 100%;
  height: 100%;
  position: absolute;
  background-image: url('https://static.joymew.com/joymewMp/zyz/fd1.png');
  background-size: 100% 100%;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem>.giftImg {
  position: absolute;
  top: 61rpx;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem>.giftImg.g1 {
  width: 67rpx;
  height: 157rpx;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem>.giftImg.g2 {
  width: 55rpx;
  height: 159rpx;
}

.zyzContainer>.waitContainer>.giftListWrap>.giftItem>.giftImg.g3 {
  width: 63rpx;
  height: 160rpx;
}

.zyzContainer>.waitContainer>.startBtn {
  width: 390rpx;
  height: 114rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/startBtn.png');
  background-size: 100% 100%;
  position: absolute;
  bottom: 0rpx;
}

/*  转一转界面 */
.zyzContainer>.gameContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.zyzContainer>.gameContainer>.totalMoney {
  position: absolute;
  top: 32rpx;
  width: 526rpx;
  height: 70rpx;
  background: #AC0C00;
  box-shadow: 0rpx 3rpx 7rpx 0px #F6544A, 0px 1rpx 3rpx 0rpx rgba(0, 0, 0, 0.35);
  border-radius: 29rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 44rpx;
  color: #FCF5CD;
}

.zyzContainer>.gameContainer>.totalMoney>.coinsImg {
  width: 97rpx;
  height: 80rpx;
  position: absolute;
  left: -59rpx;
}

.zyzContainer>.gameContainer>.wheelArea {
  width: 681rpx;
  height: 681rpx;
  position: absolute;
  top: 121rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.gameContainer>.wheelArea>.wheelBorderImg {
  position: absolute;
  width: 100%;
  height: 100%;
}

.zyzContainer>.gameContainer>.wheelArea>.wheelImg {
  position: absolute;
  width: 612rpx;
  height: 612rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.wheelInnerImg {
  position: absolute;
  width: 611rpx;
  height: 611rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.wheelBtn {
  position: absolute;
  width: 248rpx;
  height: 248rpx;
  top: 230rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.countdown {
  width: 205rpx;
  height: 205rpx;
  position: absolute;
  top: 273rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.zyzContainer>.gameContainer>.wheelArea>.countdown>.time {
  font-size: 72rpx;
  font-weight: normal;
  color: #DCA96F;
  text-shadow: #5F191B 1rpx 0 0, #5F191B 0 1rpx 0, #5F191B -1rpx 0 0, #5F191B 0 -1rpx 0, #5F191B 2rpx 0 0, #5F191B 0 2rpx 0, #5F191B -2rpx 0 0, #5F191B 0 -2rpx 0;
}

.zyzContainer>.gameContainer>.wheelArea>.countdown>.timeKey {
  font-size: 48rpx;
  color: #DCA96F;
  margin-top: -14rpx;
  text-shadow: #5F191B 1rpx 0 0, #5F191B 0 1rpx 0, #5F191B -1rpx 0 0, #5F191B 0 -1rpx 0, #5F191B 2rpx 0 0, #5F191B 0 2rpx 0, #5F191B -2rpx 0 0, #5F191B 0 -2rpx 0;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap {
  position: absolute;
  width: 100%;
  height: 100%;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem {
  position: absolute;
  width: 169rpx;
  height: 194rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem>.prizeName {
  font-size: 38rpx;
  font-weight: normal;
  color: #2d0800;
  position: absolute;
  width: 120rpx;
  text-align: center;
  white-space: nowrap;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem>.hbImg {
  width: 90rpx;
  height: 109rpx;
  position: absolute;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(1) {
  left: 237rpx;
  top: 51rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(1)>.prizeName {
  left: -34rpx;
  top: 21rpx;
  transform: rotate(-20deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(1)>.hbImg {
  transform: rotate(-41deg);
  top: 77rpx;
  left: 10rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(2) {
  left: 360rpx;
  top: 51rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(2)>.prizeName {
  left: 7rpx;
  top: 22rpx;
  transform: rotate(11deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(2)>.hbImg {
  top: 80rpx;
  left: -11rpx;
  transform: rotate(-8deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(3) {
  left: 437rpx;
  top: 165rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(3)>.prizeName {
  left: 59rpx;
  top: 5rpx;
  transform: rotate(53deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(3)>.hbImg {
  transform: rotate(33deg);
  top: 13px;
  left: 0px;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(4) {
  left: 535rpx;
  top: 271rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(4)>.prizeName {
  left: -53rpx;
  top: 50rpx;
  transform: rotate(0deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(5) {
  left: 642rpx;
  top: 546rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(5)>.prizeName {
  left: -145rpx;
  top: -78rpx;
  transform: rotate(-58deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(5)>.hbImg {
  transform: rotate(-81deg);
  top: -80px;
  left: -108px;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(6) {
  left: 613rpx;
  top: 653rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(6)>.prizeName {
  left: -247rpx;
  top: -81rpx;
  transform: rotate(-22deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(6)>.hbImg {
  transform: rotate(-46deg);
  top: -184rpx;
  left: -262rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(7) {
  left: 405rpx;
  top: 534rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(7)>.prizeName {
  left: -209rpx;
  top: 30rpx;
  transform: rotate(20deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(7)>.hbImg {
  top: -68rpx;
  left: -168rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(8) {
  left: 176rpx;
  top: 398rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(8)>.prizeName {
  left: -106rpx;
  top: 69rpx;
  transform: rotate(57deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(8)>.hbImg {
  top: -5rpx;
  left: -25rpx;
  transform: rotate(36deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(9) {
  left: 273rpx;
  top: 376rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(9)>.prizeName {
  left: -216rpx;
  top: -66rpx;
  transform: rotate(0deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(10) {
  left: 237rpx;
  top: 238rpx;
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(10)>.prizeName {
  left: -162rpx;
  top: -70rpx;
  transform: rotate(-55deg);
}

.zyzContainer>.gameContainer>.wheelArea>.prizeWrap>.prizeItem:nth-child(10)>.hbImg {
  top: -51rpx;
  left: -81rpx;
  transform: rotate(-76deg);
}

.zyzContainer>.gameContainer>.tip {
  font-size: 24rpx;
  font-weight: normal;
  color: #D87446;
  position: absolute;
  top: 815rpx;
  letter-spacing: 2rpx;
}

.zyzContainer>.gameContainer>.agreement {
  font-size: 24rpx;
  font-weight: 400;
  color: #fff;
  position: absolute;
  bottom: 132rpx;
}

.zyzContainer>.gameContainer>.giftListWrap {
  display: flex;
  justify-content: space-around;
  position: absolute;
  top: 800rpx;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem {
  width: 196rpx;
  height: 230rpx;
  position: relative;
  display: flex;
  justify-content: center;
  opacity: 0.3;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem.active {
  opacity: 1;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem>.fudai {
  width: 100%;
  height: 100%;
  position: absolute;
  background-image: url('https://static.joymew.com/joymewMp/zyz/fd1.png');
  background-size: 100% 100%;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg {
  position: absolute;
  top: 61rpx;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g1 {
  width: 67rpx;
  height: 157rpx;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g2 {
  width: 55rpx;
  height: 159rpx;
}

.zyzContainer>.gameContainer>.giftListWrap>.giftItem>.giftImg.g3 {
  width: 63rpx;
  height: 160rpx;
}

.zyzContainer>.gameContainer>.startBtn {
  width: 390rpx;
  height: 114rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/startBtn2.png');
  background-size: 100% 100%;
  position: absolute;
  bottom: 0rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.gameContainer>.startBtn>.text {
  position: absolute;
  top: 19rpx;
  font-size: 48rpx;
  font-weight: 400;
  color: #C14532;
  background: linear-gradient(177deg, #FCD58E 0%, #F8A65D 99.31640625%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.zyzContainer>.gameContainer>.luckyWrap {
  width: 548rpx;
  height: 607rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: absolute;
  top: 176rpx;
  left: 85rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/prizeResultBox2.png');
  background-size: 100% 100%;
}

.zyzContainer>.gameContainer>.luckyWrap>.tit {
  font-size: 60rpx;
  font-weight: 400;
  color: #D5261D;
  -webkit-text-stroke: 1px #D32F10;
  text-stroke: 1px #D32F10;
  position: absolute;
  top: 85rpx;
}

.zyzContainer>.gameContainer>.luckyWrap>.congragulations {
  font-size: 30rpx;
  font-weight: 400;
  color: #5E493D;
  position: absolute;
  top: 188rpx;
}

.zyzContainer>.gameContainer>.luckyWrap>.congragulations>text {
  color: #D5261D;
  font-size: 48rpx;
}

.zyzContainer>.gameContainer>.luckyWrap>.wechatTip {
  font-size: 24rpx;
  font-weight: normal;
  color: #8C7E77;
  position: absolute;
  top: 251rpx;
}

.zyzContainer>.gameContainer>.luckyWrap>.money {
  font-size: 36rpx;
  font-weight: 400;
  color: #FBA140;
  position: absolute;
  bottom: 105rpx;
}

.showLuckyAni {
  animation: zoomIn 0.1s linear;
}

.hideLuckyAni {
  animation: zoomOut 0.1s linear;
}

@keyframes zoomIn {
  from {
    opacity: 0;
    -webkit-transform: scale3d(0.3, 0.3, 0.3);
    transform: scale3d(0.3, 0.3, 0.3);
  }

  50% {
    opacity: 1;
  }
}

@keyframes zoomOut {
  from {
    opacity: 1;
  }

  50% {
    opacity: 0;
    -webkit-transform: scale3d(0.3, 0.3, 0.3);
    transform: scale3d(0.3, 0.3, 0.3);
  }

  to {
    opacity: 0;
  }
}

/* 排行榜界面 */
.zyzContainer>.rankContainer {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.zyzContainer>.rankContainer>.firstLucky {
  display: flex;
  align-items: center;
  flex-direction: column;
  position: absolute;
  width: 221rpx;
  height: 272rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/moneyBg.png');
  background-size: 100% 100%;
  top: 324rpx;
}

.zyzContainer>.rankContainer>.firstLucky>.num {
  width: 120rpx;
  height: 72rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/nt.png');
  background-size: 100% 100%;
  top: -27rpx;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.firstLucky>.num>.text {
  font-size: 31rpx;
  font-weight: normal;
  color: #fded9e;
  -webkit-text-stroke: 2rpx #57161b;
  text-stroke: 2rpx #57161b;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.zyzContainer>.rankContainer>.firstLucky>.headImgBox {
  position: absolute;
  top: 38rpx;
  width: 78rpx;
  height: 78rpx;
  background: #e88f5d;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.firstLucky>.headImgBox>.headImg {
  border-radius: 50%;
  width: 72rpx;
  height: 72rpx;
}

.zyzContainer>.rankContainer>.firstLucky>.name {
  width: 164rpx;
  height: 43rpx;
  position: absolute;
  top: 125rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/nameBg.png');
  background-size: 100% 100%;
  background-position-x: 10rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.firstLucky>.name>.text {
  width: 124rpx;
  font-size: 24rpx;
  font-weight: normal;
  color: #FDE8E2;
  background: linear-gradient(0deg, #DCA96F 0%, #FFFFFF 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-align: center;
}

.zyzContainer>.rankContainer>.firstLucky>.money {
  position: absolute;
  top: 177rpx;
}

.zyzContainer>.rankContainer>.firstLucky>.money>.text {
  font-size: 42rpx;
  color: #fee4de;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}


.zyzContainer>.rankContainer>.secondLucky {
  display: flex;
  align-items: center;
  flex-direction: column;
  position: absolute;
  width: 221rpx;
  height: 272rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/moneyBg.png');
  background-size: 100% 100%;
  top: 355rpx;
  left: 30rpx;
}

.zyzContainer>.rankContainer>.secondLucky>.num {
  width: 59rpx;
  height: 66rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/secondMedal.png');
  background-size: 100% 100%;
  top: -27rpx;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.secondLucky>.num>.text {
  font-size: 31rpx;
  font-weight: normal;
  color: #fded9e;
  -webkit-text-stroke: 2rpx #57161b;
  text-stroke: 2rpx #57161b;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.zyzContainer>.rankContainer>.secondLucky>.headImgBox {
  position: absolute;
  top: 38rpx;
  width: 78rpx;
  height: 78rpx;
  background: #e88f5d;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.secondLucky>.headImgBox>.headImg {
  border-radius: 50%;
  width: 72rpx;
  height: 72rpx;
}

.zyzContainer>.rankContainer>.secondLucky>.name {
  width: 164rpx;
  height: 43rpx;
  position: absolute;
  top: 125rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/nameBg.png');
  background-size: 100% 100%;
  background-position-x: 10rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.secondLucky>.name>.text {
  width: 124rpx;
  font-size: 24rpx;
  font-weight: normal;
  color: #FDE8E2;
  background: linear-gradient(0deg, #DCA96F 0%, #FFFFFF 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-align: center;
}

.zyzContainer>.rankContainer>.secondLucky>.money {
  position: absolute;
  top: 177rpx;
}

.zyzContainer>.rankContainer>.secondLucky>.money>.text {
  font-size: 42rpx;
  color: #fee4de;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}


.zyzContainer>.rankContainer>.thirdLucky {
  display: flex;
  align-items: center;
  flex-direction: column;
  position: absolute;
  width: 221rpx;
  height: 272rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/moneyBg.png');
  background-size: 100% 100%;
  top: 355rpx;
  right: 30rpx;
}

.zyzContainer>.rankContainer>.thirdLucky>.num {
  width: 59rpx;
  height: 66rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/thirdMedal.png');
  background-size: 100% 100%;
  top: -27rpx;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.thirdLucky>.num>.text {
  font-size: 31rpx;
  font-weight: normal;
  color: #fded9e;
  -webkit-text-stroke: 2rpx #57161b;
  text-stroke: 2rpx #57161b;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.zyzContainer>.rankContainer>.thirdLucky>.headImgBox {
  position: absolute;
  top: 38rpx;
  width: 78rpx;
  height: 78rpx;
  background: #e88f5d;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.thirdLucky>.headImgBox>.headImg {
  border-radius: 50%;
  width: 72rpx;
  height: 72rpx;
}

.zyzContainer>.rankContainer>.thirdLucky>.name {
  width: 164rpx;
  height: 43rpx;
  position: absolute;
  top: 125rpx;
  background-image: url('https://static.joymew.com/joymewMp/zyz/nameBg.png');
  background-size: 100% 100%;
  background-position-x: 10rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.zyzContainer>.rankContainer>.thirdLucky>.name>.text {
  width: 124rpx;
  font-size: 24rpx;
  font-weight: normal;
  color: #FDE8E2;
  background: linear-gradient(0deg, #DCA96F 0%, #FFFFFF 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-align: center;
}

.zyzContainer>.rankContainer>.thirdLucky>.money {
  position: absolute;
  top: 177rpx;
}

.zyzContainer>.rankContainer>.thirdLucky>.money>.text {
  font-size: 42rpx;
  color: #fee4de;
  background: linear-gradient(0deg, #db9f69 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.zyzContainer>.rankContainer .otherWrap {
  position: absolute;
  width: 100%;
  height: 600rpx;
  overflow-y: scroll;
  top: 641rpx;
  padding-bottom: 40rpx;
}

.zyzContainer>.rankContainer .otherLuckyList {
  position: absolute;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.zyzContainer>.rankContainer .otherLuckyList>.item {
  width: 660rpx;
  height: 90rpx;
  background: #E8CDBB;
  border-radius: 12rpx;
  display: flex;
  justify-content: space-between;
  padding: 0 40rpx;
  margin: 6rpx 0;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.left {
  display: flex;
  align-items: center;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.left>.num {
  font-size: 36rpx;
  font-weight: bold;
  color: #FCE67D;
  -webkit-text-stroke: 2rpx #62030F;
  text-stroke: 2rpx #62030F;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.left>.headImgBox {
  width: 51rpx;
  height: 50rpx;
  border-radius: 12rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #E69269;
  margin-left: 11rpx;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.left>.headImgBox>.headImg {
  width: 51rpx;
  height: 50rpx;
  border-radius: 12rpx;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.left>.name {
  width: 180rpx;
  font-size: 30rpx;
  font-weight: bold;
  color: #FFFFFF;
  -webkit-text-stroke: 2rpx #62030F;
  text-stroke: 2rpx #62030F;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  margin-left: 16rpx;
}

.zyzContainer>.rankContainer .otherLuckyList>.item>.right {
  width: 100rpx;
  font-size: 33rpx;
  font-weight: bold;
  color: #9D0A20;
  display: flex;
  align-items: center;
}

@media screen and (min-height: 720px) {
  .zyzContainer>.gameContainer>.agreement {
    font-size: 24rpx;
    font-weight: 400;
    color: #fff;
    position: absolute;
    bottom: 240rpx;
  }
  .zyzContainer>.waitContainer>.ruleBox {
    top: 250rpx;
  }

  .zyzContainer>.waitContainer>.giftListWrap {
    top: 967rpx;
  }

  .zyzContainer>.waitContainer>.startBtn {
    bottom: 91rpx;
  }

  .zyzContainer>.gameContainer>.totalMoney {
    top: 53rpx;
  }

  .zyzContainer>.gameContainer>.wheelArea {
    top: 158rpx;
  }

  .zyzContainer>.gameContainer>.tip {
    top: 852rpx;
  }

  .zyzContainer>.gameContainer>.giftListWrap {
    top: 931rpx;
  }

  .zyzContainer>.gameContainer>.startBtn {
    bottom: 91rpx;
  }

}
````

## File: utils/browseRecord.js
````javascript
import { saveBrowseRecord } from '../api/index/index';
import { getLiveId, getToken } from './storage'
/**
 * 需求：创建出"酒店浏览记录保存"接口所需要的对象
 *
 * splid可提前赋值
 *
 */

export default {
  browseRecord: {}, // 临时用 即时销毁
  data() {
    return {
      stay_time: '',
      start_time: '',
      page_id: '',
      page_name: '',
      page_type: '',
      splid: '',
      start_time_timestamp: '',
    };
  },
  init(pageType) {
    this.browseRecord[pageType] = this.data();
    this.browseRecord[pageType].splid = getLiveId();
  },
  enterPage(pageType) {
    this.init(pageType);
    this.browseRecord[pageType].start_time = this.getCurrentDate();
    this.browseRecord[pageType].start_time_timestamp = this.getCurrentTimestamp();
  },
  leavePage({ pageId = '', pageType, pageName }) {
    const leaveTimetamp = this.getCurrentTimestamp();
    this.browseRecord[pageType].page_id = pageId.toString();
    this.browseRecord[pageType].page_name = pageName;
    this.browseRecord[pageType].page_type = pageType.toString();
    this.browseRecord[pageType].stay_time = Math.floor((leaveTimetamp - this.browseRecord[pageType].start_time_timestamp) / 1000).toString();
    const resultObj = {
      ...this.browseRecord[pageType],
      token: getToken(),
    };
    this.browseRecord[pageType] = {};
    console.log('浏览记录:', resultObj);
    saveBrowseRecord(resultObj).then((res) => {
      console.log(res);
    }).catch((err) => {
      console.log(err);
    });
  },
  getCurrentDate() {
    const d = new Date();
    const year = d.getFullYear();
    let month = d.getMonth();
    month = month + 1 > 12 ? 1 : month + 1;
    month = month > 9 ? month : `0${month.toString()}`;
    const day = d.getDate();
    let hour = d.getHours();
    hour = hour > 9 ? hour : `0${hour.toString()}`;
    let minute = d.getMinutes();
    minute = minute > 9 ? minute : `0${minute.toString()}`;
    const second = d.getSeconds();
    return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
  },
  getCurrentTimestamp() {
    return new Date().getTime();
  },
};
````

## File: utils/date.js
````javascript
/** 
 * 日期比较大小 
 * compareDateString大于dateString，返回1； 
 * 等于返回0； 
 * compareDateString小于dateString，返回-1 
 * @param {日期字符串} dateString
 * @param {比较的日期} compareDateString  
 */
// export function dateCompare(dateString, compareDateString) {
//     var dateTime = dateParse(dateString).getTime();
//     var compareDateTime = dateParse(compareDateString).getTime();
//     if (compareDateTime > dateTime) {
//       return true;
//     } else if (compareDateTime == dateTime) {
//       return false;
//     } else {
//       return false;
//     }
//   };
export function dateCompare(dateString) {
  const dateTime = dateParse(dateString).getTime();

  // 减去24小时
  const compareDateTime = new Date().getTime() - 24 * 60 * 60 * 1000;
  if (compareDateTime > dateTime) {
    return true;
  } if (compareDateTime === dateTime) {
    return false;
  }
  return false;
}

/**
 * 将日期字符串转换为Date
 * @param {日期字符串} dateString 
 */
export function dateParse(dateString) {
  var SEPARATOR_BAR = "-";
  var SEPARATOR_SLASH = "/";
  var SEPARATOR_DOT = ".";
  var dateArray;
  if (dateString.indexOf(SEPARATOR_BAR) > -1) {
    dateArray = dateString.split(SEPARATOR_BAR);
  } else if (dateString.indexOf(SEPARATOR_SLASH) > -1) {
    dateArray = dateString.split(SEPARATOR_SLASH);
  } else {
    dateArray = dateString.split(SEPARATOR_DOT);
  }
  return new Date(dateArray[0], dateArray[1] - 1, dateArray[2]);
};

// 获取当前时间戳
export function getCurrentTimestamp() {
  return new Date().getTime();
}

// 获取当前年月日时分秒
export function getCurrentDate() {
  let d = new Date()
  let year = d.getFullYear()
  let month = d.getMonth()
  month = month + 1 > 12 ? 1 : month + 1
  month = month > 9 ? month : '0' + month.toString()
  let day = d.getDate()
  let hour = d.getHours()
  hour = hour > 9 ? hour : '0' + hour.toString()
  let minute = d.getMinutes()
  minute = minute > 9 ? minute : '0' + minute.toString()
  let second = d.getSeconds()
  return `${year}-${month}-${day} ${hour}:${minute}:${second}`
}
````

## File: components/privacyAuthorize/privacyAuthorize.js
````javascript
import { getUserInfo } from "../../utils/storage";
const PRIVACYNAME = "《嗨猫互动小程序隐私保护指引》";

Component({
  properties: {
    needAutoShow: {
      // 用于父组件控制初始化隐私弹窗显示
      value: false,
      type: Boolean,
      observer(newVal) {
        if (newVal) {
          this.showPrivacyAuthorize();
        }
      },
    },
  },
  data: {
    mpName: "嗨喵婚礼堂",
    privacyAuthorizeVisible: false,
    privacyContractName: "",
    checkAll: false,
    checkList: [
      { name: "《嗨喵婚礼堂小程序隐私政策》", checked: false },
      { name: "《嗨喵用户服务协议》", checked: false },
      { name: "《向第三方提供个人信息情况的说明》", checked: false },
      { name: "《儿童个人信息处理规则》", checked: false },
    ],
  },
  lifetimes: {
    async attached() {
      try {
        this.watchNeedPrivacyAuthEvent();
        const needAuthorization = await this.getPrivacyAuthInfo();
        this._needPrivacyAuth = needAuthorization; // 标记微信侧是否需要隐私授权
        if(this._needPrivacyAuth) {
          console.log("***微信侧需要隐私授权***");
          // 通知父组件微信侧没有用户授权记录
          this.triggerEvent("noUserAgreePrivacyInWx");
        }
      } catch (err) {
        console.log(err);
      }
    },
    detached() {},
  },
  methods: {
    // 打开隐私协议具体内容
    onPrivacyContractOpen() {
      wx.openPrivacyContract({
        success: () => {}, // 打开成功
        fail: () => {}, // 打开失败
        complete: () => {},
      });
    },
    // 同意授权
    onAgree() {
      if (!this.data.checkAll) {
        wx.showToast({
          title: "请勾选全部协议",
          icon: "none",
        });
        return;
      }
      if (this.privacyAuthResolve) {
        this.privacyAuthResolve({
          event: "agree",
          buttonId: "agree-btn",
        });
      }
      this.triggerEvent("agreePrivacy", true);
      this.setData({
        privacyAuthorizeVisible: false,
      });
    },
    // 拒绝授权
    onDisagree() {
      wx.showModal({
        title: "温馨提示",
        content:
          "您需同意《嗨喵隐私政策》，方可继续使用嗨喵小程序，如果不同意将直接退出登录",
        showCancel: true,
        cancelText: "不同意",
        confirmText: "同意",
        success: (res) => {
          if (res.cancel) {
            // 撤销：关闭弹窗、抛出事件、清空缓存、退出小程序
            if (this.privacyAuthResolve) {
              this.privacyAuthResolve({
                event: "disagree",
              });
            }
            this.triggerEvent("agreePrivacy", false);
            this.setData({
              privacyAuthorizeVisible: false,
            });
            try {
              wx.clearStorageSync();
            } catch (e) {}
            if (wx.exitMiniProgram) {
              wx.exitMiniProgram();
            }
          } else {
            this.onAgree();
          }
        },
      });
    },
    // 监听"需要隐私授权"事件
    watchNeedPrivacyAuthEvent() {
      wx.onNeedPrivacyAuthorization((resolve) => {
        // 打开隐私授权弹窗
        this.setData({
          privacyAuthorizeVisible: true,
        });
        // 暂存resolve(授权上报函数)
        this.privacyAuthResolve = resolve;
      });
    },
    // 查询隐私名称、是否需要隐私授权
    getPrivacyAuthInfo() {
      return new Promise((resolve, reject) => {
        wx.getPrivacySetting({
          success: (res) => {
            console.log(
              "是否需要授权：",
              res.needAuthorization,
              "隐私协议的名称为：",
              res.privacyContractName
            );
            if (res.needAuthorization) {
              this.setData({
                privacyContractName: res.privacyContractName || PRIVACYNAME,
              });
              resolve(res.needAuthorization);
            }
          },
          fail: (err) => {
            console.log(err);
            reject(err);
          },
        });
      });
    },
    // 新增：统一判断是否弹窗
    showPrivacyAuthorize() {
      if (this._needPrivacyAuth) {
        // 进入此分支表明：微信侧需要用户隐私授权 会触发 watchNeedPrivacyAuthEvent中的wx.onNeedPrivacyAuthorization回调
        wx.requirePrivacyAuthorize({});
      } else {
        this.setData({
          privacyAuthorizeVisible: true,
        });
      }
    },
    hasUserInfo() {
      const stUserInfo = getUserInfo();
      return stUserInfo && stUserInfo.nickName && stUserInfo.avatarUrl;
    },
    onCheckAll() {
      const newCheckAll = !this.data.checkAll;
      this.setData({
        checkAll: newCheckAll,
        checkList: this.data.checkList.map((item) => ({
          ...item,
          checked: newCheckAll,
        })),
      });
    },
    onCheckItem(e) {
      const idx = e.currentTarget.dataset.index;
      const checkList = this.data.checkList.slice();
      checkList[idx].checked = !checkList[idx].checked;
      const checkAll = checkList.every((item) => item.checked);
      this.setData({
        checkList,
        checkAll,
      });
    },
    toOuterLink(e) {
      const linkUrl = `https://ustatic.hudongmiao.com/joymewMp/agreement/${e.currentTarget.dataset.type}.html`;
      console.log("跳转链接", linkUrl);
      wx.navigateTo({
        url: `/pages/agreement/agreement?outerUrl=${linkUrl}`,
      });
    },
  },
});
````

## File: components/privacyAuthorize/privacyAuthorize.wxml
````
<!-- 隐私授权弹窗 -->
<view class="privacyAuthorize" wx:if="{{privacyAuthorizeVisible}}">
  <view class="shade"></view>
  <view class="box">
    <!-- <view class="platformInfo">
    <image src="https://static.hudongmiao.com/joymewMp/defaultHeadImg2.png" class="avatar" />
    嗨喵婚礼堂
   </view>
    <view class="content">在你使用【嗨喵婚礼堂】服务之前，请仔细阅读<text class="link" bindtap="onPrivacyContractOpen">{{privacyContractName}}</text>。如你同意{{privacyContractName}}，请点击"同意"开始使用【嗨喵婚礼堂】</view>
    <view class="btnGroup">
      <button class="btn refuseBtn" bindtap="onDisagree">拒绝</button>
      <button id="agree-btn" open-type="agreePrivacyAuthorization" bindagreeprivacyauthorization="onAgree" class="btn agreeBtn">同意</button>
    </view> -->
    <view class="title">温馨提示</view>
    <view class="content">
      <view class="para content-font-big welcome">尊敬的用户，欢迎使用{{mpName}}小程序!</view>
      <view class="para content-font-small read-tip">
        为了更好地保障您的个人信息权益，我们依据相关法律法规制定了
        <text class="outer-link" bindtap="toOuterLink" data-type="privacy">《{{mpName}}小程序隐私政策》</text>
        <text class="outer-link" bindtap="toOuterLink" data-type="service">《嗨喵用户服务协议》</text>
        <text class="outer-link" bindtap="toOuterLink" data-type="privideInfo">《向第三方提供个人信息情况的说明》</text>和
        <text class="outer-link" bindtap="toOuterLink" data-type="handleChildInfo">《儿童个人信息处理规则》</text>，以帮助您了解我们对您的个人信息的处理情况以及您享有的相关权利。请您在使用我们的产品前，审慎阅读并充分理解相关条款。
      </view>
      <view class="check-list_wrap content-font-mid">
        <view class="check-item" bindtap="onCheckAll">
          <view class="checkbox-icon">
            <image wx:if="{{checkAll}}" src="https://ustatic.hudongmiao.com/joymewMp/checked.png" mode="aspectFit" />
            <view wx:else class="unchecked"></view>
          </view>
          <text>一键勾选点击同意以下所有条款</text>
        </view>
        <view wx:for="{{checkList}}" wx:key="name" class="check-item" bindtap="onCheckItem" data-index="{{index}}">
          <view class="checkbox-icon">
            <image wx:if="{{item.checked}}" src="https://ustatic.hudongmiao.com/joymewMp/checked.png" mode="aspectFit" />
            <view wx:else class="unchecked"></view>
          </view>
          <text>{{item.name}}</text>
        </view>
        <view class="check-tip content-font-small">
          <view class="para">本人勾选以上规则并点击“同意”</view>
          <view class="para">即表示本人已充分理解并同意其全部内容</view>
        </view>
      </view>
      <view class="bottom">
        <button class="btn refuse" bindtap="onDisagree">不同意</button>
        <button id="agree-btn" open-type="agreePrivacyAuthorization" bindagreeprivacyauthorization="onAgree" class="btn agree">同意</button>
      </view>
    </view>
  </view>
</view>
````

## File: components/privacyAuthorize/privacyAuthorize.wxss
````
.privacyAuthorize {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 99999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.shade {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
}

/* .box {
  width: 480rpx;
  min-height: 450rpx;
  position: relative;
  background-color: #ffffff;
  border-radius: 20rpx;
  padding: 20rpx;
}

.box .platformInfo {
  display: flex;
  align-items: center;
  font-size: 32rpx;
  color: #000000;
}

.box .platformInfo .avatar {
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  margin-right: 20rpx;
}

.box .content {
  margin-top: 20rpx;
  font-size: 28rpx;
  color: #000000;
  line-height: 45rpx;
}
.box .content .link {
  color: rgba(10,142,238, 1);
}

.box .btnGroup {
  display: flex;
  margin-top: 40rpx;
  gap: 20rpx;
}

.box .btnGroup .btn {
  width: 200rpx;
  height: 80rpx;
  font-size: 28rpx;
  border-radius: 20rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}
.box .btnGroup .btn::after {
  border: none;
}
.box .btnGroup .refuseBtn {
  background-color: rgba(242,242,242,1);
  color: rgba(83,190,107,1);
}

.box .btnGroup .agreeBtn {
  background-color: rgba(83,190,107,1);
  color: #ffffff;
} */

.box {
  width: 640rpx;
  height: 858rpx;
  background: #FFFFFF;
  box-shadow: 0rpx 7rpx 19rpx 0rpx rgba(0, 0, 0, 0.3);
  border-radius: 41rpx 41rpx 41rpx 41rpx;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
  padding: 35rpx 37rpx 0 62rpx;
}

.title {
  font-size: 34rpx;
  font-weight: 500;
  color: #000000;
  text-align: center;
  margin-bottom: 28rpx;
}

/* 内容区域的样式 */
.content {
  color: #424242;
  margin-top: 28rpx;
}

.content .content-font-small {
  font-size: 22rpx;
  line-height: 34rpx;
}

.content .content-font-mid {
  font-size: 24rpx;
  line-height: 37rpx;
}

.content .content-font-big {
  font-size: 26rpx;
  line-height: 37rpx;
}

.content .welcome {
  margin-bottom: 13rpx;
}

.content .read-tip {
  margin-bottom: 32rpx;
}

.content .outer-link {
  color: rgba(10, 142, 238, 1);
  font-weight: 500;
}

/* 协议勾选模块 */
.content .check-list_wrap {}

.content .check-list_wrap .check-item {
  display: flex;
  align-items: center;
  margin-bottom: 9rpx;
}

.content .check-list_wrap .checkbox-icon {
  width: 24rpx;
  height: 24rpx;
  margin-right: 6rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

.content .check-list_wrap .checkbox-icon image {
  width: 100%;
  height: 100%;
}

.content .check-list_wrap .checkbox-icon .unchecked {
  width: 100%;
  height: 100%;
  border: 2rpx solid #424242;
  border-radius: 50%;
}

.content .check-list_wrap .check-item text {}

.content .check-list_wrap .check-tip {
  margin-top: 28rpx;
  color: #F78E00;
  text-align: center;
}

.content .bottom {
  display: flex;
  align-items: center;
  margin-top: 35rpx;
}

.content .bottom .btn {
  width: 213rpx;
  height: 75rpx;
  border-radius: 37rpx 37rpx 37rpx 37rpx;
  font-size: 34rpx;
  font-weight: 500;
  text-align: center;
  line-height: 75rpx;
}

.content .bottom .btn.refuse {
  border: 2rpx solid #F78E00;
  color: #F78E00;
  margin-right: 45rpx;
  background: unset;
}

.content .bottom .btn.agree {
  background: #F78E00;
  color: #FFFFFF;
}
````

## File: components/sign/sign.wxml
````
<view class="signNew">
    <image src='https://static.joymew.com/joymewMp/joymewIndex/weddingSignBg2022.png' class="bg" wx:if="{{sceneType === '0'}}"></image>
    <image src="https://static.hudongmiao.com/joymewMp/joymewIndex/ballon2.png" class="ballon2" wx:if="{{sceneType === '0'}}"></image>
    <image src="https://static.hudongmiao.com/joymewMp/joymewIndex/ballon3.png" class="ballon3" wx:if="{{sceneType === '0'}}"></image>
    <image src="https://static.hudongmiao.com/joymewMp/joymewIndex/wel2022.png" class="welWedding" wx:if="{{sceneType === '0'}}"></image>
    <view class="annualBgBox" wx:if="{{sceneType === '1'}}">
        <image src='https://static.hudongmiao.com/joymewMp/joymewIndex/bg-annualMeeting01.png' class="annualBg" mode="widthFix"></image>
    </view>
    <image src='https://static.hudongmiao.com/joymewMp/joymewIndex/signTitle-annualMeeting03.png' class="annualSignTitle" wx:if="{{sceneType === '1'}}" mode="widthFix"></image>
    <view class="annualTitle" wx:if="{{sceneType === '1'}}">{{activityTitle}}</view>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/birthBg3.png' class="bg" wx:if="{{sceneType === '2'}}"></image>
    <view class="bbyBg" wx:if="{{sceneType === '21'}}"></view>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/bbyDeco02.png' class="bbyDeco02" wx:if="{{sceneType === '21'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/bbyDeco01.png' class="bbyDeco01" wx:if="{{sceneType === '21'}}"></image>
    <view class="syBgBox" wx:if="{{sceneType === '22'}}">
        <image src='https://static.joymew.com/joymewMp/joymewIndex/syMobileBg4.png' class="syBg" mode="widthFix"></image>
    </view>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/lantern.png' class="topLantern" wx:if="{{sceneType === '22'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/decoration.png' class="bottomDecoration" wx:if="{{sceneType === '22'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/crlMobileBg2.png' class="bg" wx:if="{{sceneType === '23'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/crlBottomCloud.png' class="crlBottomCloud" wx:if="{{sceneType === '23'}}"></image>
    <image src='https://static.hudongmiao.com/joymewMp/bly/blyBg.png' class="bg" wx:if="{{sceneType === '24'}}"></image>
    <image src='https://static.hudongmiao.com/joymewMp/myyBg.png' class="bg" wx:if="{{sceneType === '25'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/bydlBg.png' class="bg" wx:if="{{sceneType === '41'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/bydlDeco.png' class="cloud" wx:if="{{sceneType === '41'}}"></image>
    <view class="xsyBgBox" wx:if="{{sceneType === '42'}}">
        <image src='https://static.joymew.com/joymewMp/joymewIndex/xsyBg.png' class="xsyBg" mode="widthFix"></image>
    </view>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/xsyDeco.png' class="lantern" wx:if="{{sceneType === '42'}}"></image>
    <view class="jbtmBgBox" wx:if="{{sceneType === '43'}}">
        <image src='https://static.joymew.com/joymewMp/joymewIndex/jbtmBg.png' class="jbtmBg" mode="widthFix"></image>
    </view>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/jbtmCloud.png' class="jbtmCloud" wx:if="{{sceneType === '43'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/txhBg.png' class="bg" wx:if="{{sceneType === '51'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/qqyBg.png' class="bg" wx:if="{{sceneType === '52'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/hxBg.png' class="bg" wx:if="{{sceneType === '53'}}"></image>
    <image src='https://static.joymew.com/joymewMp/joymewIndex/wlBg.png' class="bg" wx:if="{{sceneType === '55'}}"></image>
    <view class="signBox signBox{{sceneType}}">
        <image src="https://static.hudongmiao.com/joymewMp/joymewIndex/qima.gif" class="qima" wx:if="{{sceneType === '0'}}"></image>
        <image src="https://static.hudongmiao.com/joymewMp/joymewIndex/ballon1.png" class="ballon1" wx:if="{{sceneType === '0'}}"></image>
        <view class="benifit" wx:if="{{sceneType === '0'}}">一起看美照、送祝福、玩游戏吧～</view>
        <!-- <view class="fItem">
            <text class="key key{{sceneType}}">姓名：</text>
            <input bindblur="userNameBlur" name="userName" placeholder='请输入您的姓名' maxlength="12" value="{{userName}}" placeholder-class="phcolor{{sceneType}}" class="ipt{{sceneType}}"></input>
        </view> -->
        <view class="fItem" wx:if="{{miaoShopId}}">
            <text class="key key{{sceneType}}">性别：</text>
            <view class="sexGroup">
                <view class="sexItem sexItem{{sceneType}}" bindtap="chooseGender" data-gender='0'>
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/male.png' class="sexIcon"></image>
                    男
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/tickedIcon.png' class="tickedIcon" wx:if="{{gender === '0'}}"></image>
                </view>
                <view class="sexItem sexItem{{sceneType}}" bindtap="chooseGender" data-gender='1'>
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/female.png' class="sexIcon"></image>
                    女
                    <image src='https://static.joymew.com/joymewMpTql/signWedding/tickedIcon.png' class="tickedIcon" wx:if="{{gender === '1'}}"></image>
                </view>
            </view>
        </view>
        <view class="fItem" wx:if="{{!isExamine}}">
            <text class="key key{{sceneType}}">祝福语：</text>
            <input bindblur="wishesBlur" name="wishes" placeholder='祝福语' maxlength="20" value="{{wish}}" placeholder-class="phcolor{{sceneType}}" class="iptPad ipt{{sceneType}}"></input>
            <view class="refreshBtn refreshBtn{{sceneType}}" bindtap="refreshWish"></view>
        </view>
        <!-- 婚礼版独有 -->
        <view class="fItem" wx:if="{{!miaoShopId && sceneType === '0'}}">
            <text class="key key0">亲友团：</text>
            <view class="chooseGroup">
                <view class="chooseItem {{ role === '1'?'active':'' }}" catchtap="chooseRelatives" data-role="1">
                    <text>男方</text>
                </view>
                <view class="chooseItem {{ role === '2'?'active':'' }}" catchtap="chooseRelatives" data-role="2">
                    <text>女方</text>
                </view>
                <view class="chooseItem {{ role === ''?'active':'' }}" catchtap="chooseRelatives" data-role="">
                    <text>不选</text>
                </view>
            </view>
        </view>
        <view class="fItem" wx:if="{{!isExamine && isForcePhone}}">
            <text class="key key{{sceneType}}">手机号：</text>
            <view class="getPhoneIpt getPhoneIpt{{sceneType}}" wx:if="{{!needInputPhone}}">
                {{phone ? phone: '获取手机号'}}
                <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class="getPhoneBtn" wx:if="{{!phone}}">
                    获取手机号
                </button>
            </view>
            <input bindblur="phoneBlur" name="phone" placeholder='请输入手机号' maxlength="11" value="{{phone}}" placeholder-class="phcolor{{sceneType}}" class="iptPad ipt{{sceneType}}" wx:else focus="{{phoneInputFocus}}" type="number"></input>
            <view class="phoneIconBox phoneIconBox{{sceneType}}"></view>
        </view>
        <!-- <view class="fItem" wx:if="{{miaoShopId}}">
            <text class="key key{{sceneType}}">生日：</text>
            <picker mode="date" bindchange="handleBirthDateChange" value="{{birthDate}}">
                <view class="birthDate">
                    <view class="val">{{birthDate === '' ? '请选择' : birthDate}}</view>
                    <image src='https://static.joymew.com/joymewMp/joymewIndex/downArrow.png' class="downArrow"></image>
                </view>
            </picker>
        </view> -->
        <view class="signBtn signBtn{{sceneType}}" catchtap="sign">
            <text wx:if="{{sceneType !== '1'}}">点击进入</text>
        </view>
    </view>
</view>
````

## File: components/sign/sign.wxss
````
.signNew {
  width: 100vw;
  height: 100vh;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  perspective: 4000rpx;
}
.annualBgBox {
  width: 100%;
  height: 100%;
  position: absolute;
  overflow: hidden;
}
.annualBg {
  width: 750rpx;
  position: absolute;
  top: -10rpx;
  left: 0;
}
.annualSignTitle {
  position: relative;
  width: 320rpx;
  margin-top: 80rpx;
}
.annualTitle {
  position: relative;
  color: transparent;
  background-image: linear-gradient(45deg, #e4af57, #fce688);
  font-size: 60rpx;
  padding: 0 20rpx;
  -webkit-background-clip: text;
}
.bg {
  width: 100%;
  height: 100%;
}
.bbyBg {
  width: 100%;
  height: 100%;
  position: absolute;
  background-color: #e4c4c4;
}
.bbyDeco02 {
  width: 750rpx;
  height: 340rpx;
  position: absolute;
  top: 0;
}

.bbyDeco01 {
  width: 750rpx;
  height: 941rpx;
  position: absolute;
  top: 29rpx;
}
.syBgBox {
  width: 100%;
  height: 100%;
  position: absolute;
  overflow: hidden;
}
.syBg {
  width: 750rpx;
  position: absolute;
  top: -180rpx;
  left: 0;
}
.topLantern {
  width: 750rpx;
  height: 278rpx;
  position: absolute;
  top: 0;
}

.bottomDecoration {
  width: 750rpx;
  height: 70rpx;
  position: absolute;
  bottom: 0;
}
.crlBottomCloud {
  width: 750rpx;
  height: 198rpx;
  position: absolute;
  bottom: 0;
}
.cloud {
  width: 750rpx;
  height: 253rpx;
  position: absolute;
  bottom: 0;
}
.xsyBgBox {
  width: 100%;
  height: 100%;
  position: absolute;
  overflow: hidden;
}
.xsyBg {
  width: 835rpx;
  position: absolute;
  top: -10rpx;
  left: -12rpx;
}
.lantern {
  width: 750rpx;
  height: 151rpx;
  position: absolute;
  top: 0;
}
.jbtmBgBox {
  width: 100%;
  height: 100%;
  position: absolute;
  overflow: hidden;
}
.jbtmBg {
  width: 940rpx;
  position: absolute;
  top: -50rpx;
  left: -65rpx;
}
.jbtmCloud {
  width: 750rpx;
  height: 158rpx;
  position: absolute;
  bottom: -30rpx;
}
.signBox {
  width: 620rpx;
  background-size: 100% 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: absolute;
  bottom: 40rpx;
  padding-top: 40rpx;
  padding-bottom: 40rpx;
}
/* differance */
.signBox0 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/box-04.png');
  width: 678rpx;
}
.signBox1 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/boxQy01.png');
}
.signBox2 {
  background-color: #dbfafe;
}
.signBox21,
.signBox24,
.signBox25 {
  background-color: #f9eded;
}
.signBox22 {
  background-color: #cf1820;
}
.signBox23 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/signBoxCrl.png');
}
.signBox41 {
  background: #d0efff;
}
.signBox42 {
  background: #fef188;
}
.signBox43 {
  background: #ffffd8;
}
.signBox51 {
  background: #2c3032;
}
.signBox52 {
  background: #ff9484;
}
.signBox53,.signBox55 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/signBoxBgHX.png');
}
.benifit {
  font-size: 32rpx;
  font-weight: 400;
  color: #7a61e6;
  margin-top: 20rpx;
  margin-bottom: 30rpx;
}
.fItem {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 620rpx;
  padding: 0 40rpx;
  margin-bottom: 40rpx;
  position: relative;
}
.signBox0 .fItem {
  align-items: unset;
  flex-direction: column;
}
.key {
  font-size: 32rpx;
  font-weight: 600;
}
/* differance */
.key0 {
  color: #ee8b6b;
  margin-bottom: 20rpx;
  font-size: 28rpx;
}
.key2,
.key21,
.key23,
.key24,
.key25,
.key41,
.key42,
.key43,
.key52 {
  color: #333333;
}
.key1 {
  color: #facd7f;
}
.key22,
.key51,
.key53,
.key55 {
  color: #ffffff;
}
input {
  width: 412rpx;
  height: 56rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  border-top: none;
  border-left: none;
  border-right: none;
  outline: none;
}
/* differance */
.ipt0 {
  color: #333333;
  border-bottom: 2rpx solid #e8757e;
  width: 540rpx;
  font-size: 40rpx;
}
.ipt1,
.ipt53,
.ipt55 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.ipt2,
.ipt21,
.ipt24,
.ipt25 {
  color: #333333;
  border-bottom: 1rpx solid rgba(51, 51, 51, 0.6);
}
.ipt22 {
  color: #ffffff;
  border-bottom: 1rpx solid #cc8c8c;
}
.ipt23 {
  color: #333333;
  border-bottom: 1rpx solid #54d5e9;
}
.ipt41 {
  color: #333333;
  border-bottom: 1rpx solid #efd1ee;
}
.ipt42 {
  color: #333333;
  border-bottom: 1rpx solid #e20013;
}
.ipt43 {
  color: #333333;
  border-bottom: 1rpx solid #ea002a;
}
.ipt51 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.ipt52 {
  color: #333333;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.phcolor0 {
  color: #000000;
}
.phcolor1,
.phcolor22,
.phcolor51 {
  color: #ffffff;
}
.phcolor2,
.phcolor23,
.phcolor25,
.phcolor41,
.phcolor42,
.phcolor43,
.phcolor52 {
  color: #333333;
}
.iptPad {
  padding-right: 70rpx;
}
.refreshBtn {
  width: 28rpx;
  height: 28rpx;
  background-size: 100% 100%;
  position: absolute;
  right: 35rpx;
  bottom: 17rpx;
}
.qima {
  width: 260rpx;
  height: 220rpx;
  position: absolute;
  top: -220rpx;
}
.welWedding {
  width: 660rpx;
  height: 336rpx;
  position: absolute;
  top: 30rpx;
  animation-name: pulse;
  animation-duration: 1s;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}
.ballon1 {
  width: 68rpx;
  height: 164rpx;
  position: absolute;
  bottom: -10rpx;
  right: -34rpx;
  animation-name: swing;
  animation-duration: 2s;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
  transform-origin: bottom center;
}
.ballon2 {
  width: 136rpx;
  height: 132rpx;
  position: absolute;
  right: 37rpx;
  top: 350rpx;
  animation-name: ballonAni;
  animation-duration: 10s;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}
.ballon3 {
  width: 148rpx;
  height: 160rpx;
  position: absolute;
  left: 37rpx;
  top: 350rpx;
  animation-name: ballonAni;
  animation-duration: 10s;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}
/* differance */
.refreshBtn0 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/refreshIconPink.png');
  right: 42rpx;
}
.refreshBtn1,
.refreshBtn2,
.refreshBtn21,
.refreshBtn22,
.refreshBtn23,
.refreshBtn24,
.refreshBtn25,
.refreshBtn41,
.refreshBtn42,
.refreshBtn43,
.refreshBtn51 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/txhReloadIcon.png');
}
.refreshBtn52 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/qqyReloadIcon.png');
}
.refreshBtn53,
.refreshBtn55 {
  background-image: url('https://static.joymew.com/joymewMp/joymewIndex/bbyReloadIcon.png');
}
.phoneIconBox {
  width: 24rpx;
  height: 32rpx;
  position: absolute;
  right: 57rpx;
  bottom: 17rpx;
  background-size: 100% 100%;
}
/* differance */
.phoneIconBox0 {
  background-image: url('https://static.joymew.com/joymewMpTql/signWedding/phoneIcon.png');
}
.phoneIconBox1,
.phoneIconBox2,
.phoneIconBox21,
.phoneIconBox22,
.phoneIconBox23,
.phoneIconBox24,
.phoneIconBox25,
.phoneIconBox41,
.phoneIconBox42,
.phoneIconBox43,
.phoneIconBox51,
.phoneIconBox52,
.phoneIconBox53 {
  background-image: url('https://static.joymew.com/joymewMpTql/signTXH/phoneIcon.png');
}
.chooseGroup {
  width: 540rpx;
  height: 56rpx;
  box-sizing: border-box;
  display: flex;
  justify-content: space-around;
}
.chooseGroup > .chooseItem {
  width: 170rpx;
  height: 56rpx;
  background: rgba(122, 97, 230, 0.4);
  border-radius: 28rpx;
  font-size: 28rpx;
  font-weight: 400;
  text-align: center;
  line-height: 56rpx;
  color: #ffffff;
}
.chooseGroup > .chooseItem.active {
  background: #7a61e6;
}
.deskNum {
  width: 204rpx;
  height: 40rpx;
  background: #ffffff;
  border-radius: 4rpx;
  position: absolute;
  left: 165rpx;
}
.deskNum > .downArrow {
  width: 22rpx;
  height: 12rpx;
  position: absolute;
  right: 12rpx;
  bottom: 12rpx;
  transition: all 0.1s linear;
}
.deskNum > .val {
  width: 80%;
  height: 100%;
  position: absolute;
  font-size: 24rpx;
  font-weight: 400;
  color: #666666;
  line-height: 40rpx;
  padding-left: 10rpx;
}
.sexGroup {
  width: 412rpx;
  height: 59rpx;
  display: flex;
  justify-content: space-around;
}
.sexGroup > .sexItem {
  display: flex;
  align-items: center;
  position: relative;
  font-size: 32rpx;
  font-weight: 400;
  text-align: center;
}
/* differance */
.sexItem0,
.sexItem2,
.sexItem21,
.sexItem23,
.sexItem24,
.sexItem25,
.sexItem41,
.sexItem42,
.sexItem43,
.sexItem52 {
  color: #333333;
}
.sexItem1,
.sexItem22,
.sexItem51,
.sexItem53 {
  color: #ffffff;
}
.sexGroup .sexItem > .sexIcon {
  width: 59rpx;
  height: 59rpx;
  display: flex;
  align-items: center;
  margin-right: 17rpx;
}
.sexGroup .sexItem > .tickedIcon {
  position: absolute;
  width: 20rpx;
  height: 20rpx;
  top: 38rpx;
  left: 40rpx;
}
.getPhoneIpt {
  position: relative;
  z-index: 1;
  width: 412rpx;
  height: 56rpx;
  box-sizing: border-box;
  font-size: 32rpx;
  font-weight: normal;
  border-bottom: 2rpx solid #666666;
  padding-right: 68rpx;
}
/* differance */
.getPhoneIpt0 {
  width: 540rpx;
  border-bottom: 2rpx solid #e8757e;
  font-size: 40rpx;
}
.getPhoneIpt2,
.getPhoneIpt21 {
  color: #333333;
}
.getPhoneIpt1 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.getPhoneIpt22 {
  color: #ffffff;
  border-bottom: 1rpx solid #cc8c8c;
}
.getPhoneIpt23 {
  color: #333333;
  border-bottom: 1rpx solid #54d5e9;
}
.getPhoneIpt24,
.getPhoneIpt25 {
  color: #333333;
  border-bottom: 1rpx solid rgba(51, 51, 51, 0.6);
}
.getPhoneIpt41 {
  color: #333333;
  border-bottom: 1rpx solid #efd1ee;
}
.getPhoneIpt42 {
  color: #333333;
  border-bottom: 1rpx solid #e20013;
}
.getPhoneIpt43 {
  color: #333333;
  border-bottom: 1rpx solid #ea002a;
}
.getPhoneIpt51,
.getPhoneIpt53 {
  color: #ffffff;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.getPhoneIpt52 {
  color: #333333;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.6);
}
.getPhoneIpt > .getPhoneBtn {
  width: 100%;
  height: 100%;
  opacity: 0;
  background-color: transparent;
  position: absolute;
  right: 0;
  top: 0;
}
.birthDate {
  width: 412rpx;
  height: 56rpx;
  background: #ffffff;
  border-radius: 4rpx;
  position: absolute;
  right: 55rpx;
  top: -8rpx;
}
.birthDate > .downArrow {
  width: 27rpx;
  height: 14rpx;
  position: absolute;
  right: 15rpx;
  bottom: 21rpx;
  transition: all 0.1s linear;
}
.birthDate > .val {
  width: 80%;
  height: 100%;
  position: absolute;
  font-size: 32rpx;
  font-weight: 400;
  color: #666666;
  line-height: 56rpx;
  padding-left: 18rpx;
}
.signBtn {
  width: 380rpx;
  height: 72rpx;
  border-radius: 36rpx;
  font-size: 32rpx;
  font-weight: 500;
  margin-top: 8rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}
/* differance */
.signBtn0 {
  background: linear-gradient(180deg, #e87080 0%, #ee8b6b 100%);
  color: #ffffff;
}
.signBtn1 {
  background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/signBtnQy01.png');
  background-size: 100% 100%;
}
.signBtn2,
.signBtn21,
.signBtn24,
.signBtn25 {
  background: #fab0ce;
  color: #ffffff;
}
.signBtn22 {
  background: #fddd97;
  color: #ffffff;
}
.signBtn23,
.signBtn41 {
  background: #54d5e9;
  color: #ffffff;
}
.signBtn42 {
  background: #e20013;
  color: #ffffff;
}
.signBtn43 {
  background: #ea002a;
  color: #ffffff;
}
.signBtn51 {
  background: #beb161;
  color: #ffffff;
}
.signBtn52 {
  background: #ef2152;
  color: #ffffff;
}
.signBtn53, .signBtn55 {
  background: #b3e0ee;
  color: #ffffff;
}

@keyframes pulse {
  from {
    -webkit-transform: scale3d(1, 1, 1);
    transform: scale3d(1, 1, 1);
  }

  50% {
    -webkit-transform: scale3d(1.05, 1.05, 1.05);
    transform: scale3d(1.05, 1.05, 1.05);
  }

  to {
    -webkit-transform: scale3d(1, 1, 1);
    transform: scale3d(1, 1, 1);
  }
}
@keyframes swing {
  20% {
    -webkit-transform: rotate3d(0, 0, 1, 15deg);
    transform: rotate3d(0, 0, 1, 15deg);
  }

  40% {
    -webkit-transform: rotate3d(0, 0, 1, -10deg);
    transform: rotate3d(0, 0, 1, -10deg);
  }

  60% {
    -webkit-transform: rotate3d(0, 0, 1, 5deg);
    transform: rotate3d(0, 0, 1, 5deg);
  }

  80% {
    -webkit-transform: rotate3d(0, 0, 1, -5deg);
    transform: rotate3d(0, 0, 1, -5deg);
  }

  to {
    -webkit-transform: rotate3d(0, 0, 1, 0deg);
    transform: rotate3d(0, 0, 1, 0deg);
  }
}

@keyframes ballonAni {
  from {
    transform: translateZ(1000rpx);
    opacity: 1;
  }
  to {
    transform: translateZ(-5000rpx);
    opacity: 0;
  }
}
````

## File: pages/index/index.js
````javascript
import {
  getMsgInfo,
  sendChatMessage,
  securityMsgCheck,
} from '../../api/index/index';
import { getCurrentDate } from '../../utils/date';
import { getRandom, showWxToast } from '../../utils/index';
import { getUserInfo } from '../../utils/storage';

const WISH = [
  '十年修得同船渡，百年修得共枕眠！',
  '衷心的祝福你们：相互珍惜，同心永结！',
  '祝福你们永远互敬互爱，甜美幸福！',
  '比翼齐飞，事业更昌盛！',
  '美满良缘，白首成约！',
  '愿你们相亲相爱，永结同心！',
  '和和美美，白头偕老！',
  '恭喜你大婚达成，祝福你们盟结良缘！',
  '愿你们一直带着这喜悦和幸福走进人生的新篇章！',
  '祝你们山盟永在、海誓长存！',
  '祝天天恩恩爱爱！新婚快乐！',
  '露出幸福真面目，只缘身在祝福中。',
  '祝你们新婚快乐、永远幸福！',
  '婚姻永美满，幸福在人间！恭喜恭喜！',
  '同心结已成，愿爱永同行！',
  '祝你们百年恩爱结连理，一生幸福永同心！',
  '百年好合！新婚愉快，甜甜蜜蜜！早生贵子！',
  '祝你们相亲相爱一百年不动摇！',
  '海枯石烂同心永结，地阔天高比翼齐飞！',
  '珠联壁合洞房春暖，花好月圆鱼水情深！',
  '新婚快乐！我们一起摇红包、做game、中大奖、沾喜气，嗨起来！',
];
const QUICKWISH = [
  '恭喜找到自己的长征伴侣。',
  '结完婚，生完孩子，赶紧回来开黑！',
  '请喝趴我',
  '来了来了，干饭人，干酒人',
  '大家说说，新郎有我帅吗',
  '哥们,加油,以后工资上交,出门交代',
  '兄弟，早生贵子，百年好合，早生贵子',
  '要狠狠的幸福到白头^o^',
  '娶老婆咯！心里美滋滋',
  '我给你俩幸福加点糖',
  '你我共富贵！多生孩子多种树！',
  '哦耶，我不管我最帅！',
  '新娘太美了',
  '新婚快乐',
  '新郎今天有点帅',
  '恭喜你找到了今生唯一灵魂之伴侣。',
  '主持人今天很帅，但是和我兄弟新郎比，还差一点点',
  '新郎今天太帅了，发个大红包吧',
  '大家吃好喝好玩好，待会还有抢红包',
  '喝完喜酒，晚上麻将三缺一，来的扣666',
  '看你们大婚了，我也想找个对象',
  '明年这时候是不是该喝孩子的满月酒啦',
  '一切都是最好的安排！祝新婚快乐，一生欢喜！',
  '一生一世两情相悦，三世尘缘四世同喜，五谷丰登六六顺',
  '中国首富祝你们婚快乐永结同心',
  '大小姐一定要开心幸福啊 来自你最牢靠的粉丝后援团',
  '祝各位吃好喝好!',
  '天生才子佳人配，只羡鸳鸯不羡仙。',
  '奥利给 我最美我最帅 我是人间小可爱',
  '今晚大奖花落谁家🌸 🌸',
  '郎才女貌，瓜瓞延绵',
  '主持人帅的滑丝',
  '美满良缘，白首成约！',
  '比翼齐飞，事业更昌盛！',
  '和和美美，白头偕老！',
  '嗨起来，艾瑞巴蒂',
  '珠连壁合，天作之美',
  '欢庆此日结佳偶，且喜今朝庆良缘',
  '露出幸福真面目，只缘身在祝福中。',
  '幸福一对，幸福一生。',
  '㊗️新婚快乐，百年好合，早生贵子',
  '早生三胞胎',
  '幸福永远哈',
  '新郎今天也太帅了，新娘也超级漂亮',
  '祝二位新人永结同心',
  '火箭🚀 🚀🚀🚀 ,走一个',
  '💗💗💗！幸福呦',
  'everybaby  high 起来！',
];
Page({
  data: {
    autoFocus: false,
    sendDanmuVisible: false,
    message: '',
    quickWishes: [],
    defaultWishes: [],
    chatList: [],
    chatTop: 0,
    scrollTop: 0,
  },
  onLoad: function() {
    this.initWishes();
    this.requestMsgInfo();
  },
  sendDanmu() {
    securityMsgCheck(this.data.message)
      .then(res => {
        const tmpResult = JSON.parse(res.data.msg_sec_check);
        console.log(tmpResult);
        if (tmpResult.result.suggest === 'pass') {
          sendChatMessage(this.data.message).then(res => {
            console.log(res);
            const { nickName, avatarUrl } = getUserInfo();
            const tmpChatList = this.data.chatList;
            tmpChatList.push({
              miaoContent: this.data.message,
              sendTime: getCurrentDate(),
              miaoName: nickName,
              miaoTxUrl: avatarUrl,
            });
            this.setData({
              chatList: tmpChatList,
              message: '',
              sendDanmuVisible: false,
              scrollTop: tmpChatList.length * 200,
            });
          });
        } else {
          showWxToast('内容非法!');
        }
      })
      .catch(err => {
        console.log(err);
      });
  },
  initWishes() {
    // WISH
    const tmpWishLen = WISH.length;
    const tmpWish = [];
    for (let i = 0; i < 5; i += 1) {
      tmpWish.push(WISH[getRandom(0, tmpWishLen)]);
    }
    const tmpQuickWishLen = QUICKWISH.length;
    const tmpQuickWish = [];
    for (let i = 0; i < 3; i += 1) {
      tmpQuickWish.push(QUICKWISH[getRandom(0, tmpQuickWishLen)]);
    }
    this.setData({
      defaultWishes: tmpWish,
      quickWishes: tmpQuickWish,
    });
  },
  handleInput(e) {
    console.log(e.detail.value);
    this.setData({
      message: e.detail.value,
    });
  },
  chooseDefaultWish(e) {
    console.log(e.currentTarget.dataset.index);
    this.setData({
      message: this.data.defaultWishes[e.currentTarget.dataset.index],
      autoFocus: true,
    });
  },
  showSendDanmu() {
    this.setData({
      sendDanmuVisible: true,
      autoFocus: true,
    });
  },
  closeSendDanmu() {
    this.setData({
      sendDanmuVisible: false,
    });
  },
  requestMsgInfo() {
    getMsgInfo().then(res => {
      if (
        res &&
        res.data &&
        res.data.chat_list &&
        res.data.chat_list.length > 0
      ) {
        const list = res.data.chat_list
          .filter(item => !item.miaoLiwuId)
        console.log(list);
        this.setData({
          chatList: list,
          scrollTop: list.length * 200,
        });
      }
    });
  },
  chooseQuickWish(e) {
    console.log(e.currentTarget.dataset.index);
    let tmpQuickWish = this.data.quickWishes;
    sendChatMessage(tmpQuickWish[e.currentTarget.dataset.index]).then(res => {
      console.log(res);
      const { nickName, avatarUrl } = getUserInfo();
      const tmpChatList = this.data.chatList;
      tmpChatList.push({
        miaoContent: tmpQuickWish[e.currentTarget.dataset.index],
        sendTime: getCurrentDate(),
        miaoName: nickName,
        miaoTxUrl: avatarUrl,
      });
      tmpQuickWish.splice(e.currentTarget.dataset.index, 1);
      this.setData({
        chatList: tmpChatList,
        quickWishes: tmpQuickWish,
        scrollTop: tmpChatList.length * 200,
      });
    });
  },
});
````

## File: pages/index/index.wxml
````
<view class="index-wrap">
    <view class="bg"></view>
    <view class="chatArea">
        <view class="weddingChatList">
            <scroll-view class="newsContainer" scroll-y="true" style="height:502rpx" scrollTop="{{scrollTop}}">
                <view class="messageItem" wx:for="{{chatList}}" wx:key="index">
                    <view class="top">
                        <image class="headImg" src="{{item.miaoTxUrl}}"></image>
                        <view class="nickname">{{item.miaoName}}</view>
                    </view>
                    <view class="content">
                        <view class="common">{{item.miaoContent}}</view>
                    </view>
                    <view class="bottom">
                        <view class="date">{{item.sentTime}}</view>
                    </view>
                </view>
            </scroll-view>
        </view>
    </view>
    <view class="bottomArea">
        <view class="wedding">
            <view class="quickWish">
                <view class="quickWishCt">
                    <view class="item" wx:for="{{quickWishes}}" wx:key="index" bindtap="chooseQuickWish"
                        data-index="{{index}}">
                        <view class="itemCt">
                            {{item}}
                        </view>
                    </view>
                </view>
            </view>
            <view class="bottomMain {{sendDanmuVisible ? 'show' : ''}}">
                <view class="bottomEmptyArea" bindtap="closeSendDanmu" wx:if="{{sendDanmuVisible}}"></view>
                <view class="default" wx:if="{{sendDanmuVisible}}">
                    <view class="defaultCt">
                        <view class="item" wx:for="{{defaultWishes}}" data-index="{{index}}" wx:key="index"
                            bindtap="chooseDefaultWish">
                            <view class="itemCt">{{item}}</view>
                        </view>
                    </view>
                </view>
                <view class="iptArea">
                    <image src="/assets/image/hd2/messageIcon.png" class="msgIcon"></image>
                    <view class="inputBoxVitual" wx:if="{{!sendDanmuVisible}}" bindtap="showSendDanmu">送上祝福...</view>
                    <input class="inputBox" placeholder="送上祝福..." bindinput="handleInput" value="{{message}}"
                        wx:if="{{sendDanmuVisible}}" focus="{{autoFocus}}" placeholder-style="font-size:16px" disabled/>
                    <view class="sendBtn {{message ? 'active' : ''}}" wx:if="{{sendDanmuVisible}}" bindtap="sendDanmu">
                        发送</view>
                </view>
            </view>
        </view>
    </view>
</view>
````

## File: pages/index/index.wxss
````
view {
    box-sizing: border-box;
}
.index-wrap {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}
.bg {
    background-image: url('https://ustatic.hudongmiao.com/h5/bg.png');
    background-size: 100% 100%;
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: 50%;
    z-index: 0;
}

.chatArea {
    position: absolute;
    width: 530rpx;
    height: 502rpx;
    bottom: 290rpx;
    color: #fff;
    z-index: 0;
}
.chatArea .weddingChatList {
    position: absolute;
    width: 100%;
    height: 100%;
    padding-left: 20rpx;
}
.messageItem {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 0px 32rpx 32rpx 32rpx;
    color: #ffffff;
    padding: 20rpx 18rpx;
    position: relative;
    width: 490rpx;
    margin: 18rpx 0;
}
.messageItem .top {
    display: flex;
    align-items: center;
}
.messageItem .top .headImg{
    width: 40rpx;
    height: 40rpx;
    border-radius: 50%;
}
.messageItem .top .nickname{
    font-size: 20rpx;
    font-weight: 300;
    color: #ffffff;
    margin-left: 10rpx;
}
.messageItem .content {
    font-size: 28rpx;
    margin-top: 18rpx;
}
.messageItem .content .common {
    margin-top: 23rpx;
}
.messageItem .bottom {
    justify-content: space-between;
    margin-top: 23rpx;
    display: flex;
    align-items: center;
}
.messageItem .bottom .date{
    font-size: 20rpx;
    font-weight: 400;
    color: rgba(255, 255, 255, 0.4);
}

.bottomArea {
    width: 100%;
    height: 140rpx;
    position: absolute;
    bottom: 0;
    z-index: 2;
}
.bottomArea .wedding .quickWish{
    height: 69rpx;
    width: 100%;
    position: absolute;
    left: 0;
    top: -69rpx;
    border-radius: 24rpx 24rpx 0 0;
    overflow-x: scroll;
}
.bottomArea .wedding .quickWish .quickWishCt {
    white-space: nowrap;
}
.bottomArea .wedding .quickWish .quickWishCt .item{
    font-size: 20rpx;
    color: #ffffff;
    align-items: center;
    margin: 0px 20rpx;
    display: inline-block;
    background: linear-gradient(135deg, #ee9bff, #5560f5);
    border-radius: 27rpx;
    padding: 4rpx;
}
.bottomArea .wedding .quickWish .quickWishCt .item .itemCt{
    border-radius: 27rpx;
    background: linear-gradient(135deg, #183a6a, #1351a3);
    padding: 4rpx 12rpx;
}
.bottomArea .wedding .bottomMain{
    width: 100%;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.bottomArea .wedding .bottomMain .bottomEmptyArea {
    position: absolute;
    width: 100vw;
    height: 100vh;
    top: -100vh;
}
.bottomArea .wedding .bottomMain.show {
    flex-direction: column;
    justify-content: center;
    background: linear-gradient(135deg, #183a6a, #1351a3);
    height: 260rpx;
    position: absolute;
    bottom: 0;
    border-top-left-radius: 20rpx;
    border-top-right-radius: 20rpx;
}
.bottomArea .wedding .bottomMain .iptArea {
    width: 292rpx;
    height: 72rpx;
    background: rgba(0, 0, 0, 0.19);
    border-radius: 36rpx;
    padding-left: 24rpx;
    padding-right: 14rpx;
    position: relative;
    display: flex;
    align-items: center;
}
.bottomArea .wedding .bottomMain .iptArea::after {
    content: '';
    display: block;
    width: 2rpx;
    height: 32rpx;
    background-color: rgba(251, 213, 111, 0.3);
    position: absolute;
    left: 68rpx;
}
.bottomArea .wedding .bottomMain .iptArea .msgIcon{
    width: 36rpx;
    height: 36rpx;
}
.bottomArea .wedding .bottomMain .iptArea .inputBox{
    width: 212rpx;
    height: 72rpx;
    background-color: transparent;
    border-radius: 36rpx;
    border: none;
    font-size: 20rpx;
    padding: 0 10rpx 0 10rpx;
    color: #fff;
    position: absolute;
    left: 80rpx;
    outline: none;
    box-sizing: border-box;
}
.bottomArea .wedding .bottomMain .iptArea .inputBoxVitual{
    width: 212rpx;
    height: 72rpx;
    background-color: transparent;
    border-radius: 36rpx;
    border: none;
    font-size: 20rpx;
    padding: 0 10rpx 0 10rpx;
    color: #fff;
    position: absolute;
    left: 80rpx;
    outline: none;
    box-sizing: border-box;
    display: flex;
    align-items: center;
}
.bottomArea .wedding .bottomMain .iptArea .sendBtn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100rpx;
    height: 45rpx;
    font-size: 24rpx;
    color: rgba(255, 255, 255, 0.6);
    background-color: rgba(0, 0, 0, 0.6);
    position: absolute;
    right: 10rpx;
    border-radius: 34rpx;
}
.bottomArea .wedding .bottomMain .iptArea .sendBtn.active {
    background-color: #e4156a;
    color: #fff;
}
.bottomArea .wedding .bottomMain .default {
    height: 90rpx;
    width: 100%;
    border-radius: 24rpx 24rpx 0 0;
}
.bottomArea .wedding .bottomMain .default .defaultCt{
    white-space: nowrap;
    overflow-x: scroll;
}
.bottomArea .wedding .bottomMain .default .item{
    font-size: 20rpx;
    color: #ffffff;
    align-items: center;
    margin: 0rpx 20rpx;
    display: inline-block;
    background: linear-gradient(135deg, #ee9bff, #5560f5);
    border-radius: 27rpx;
    padding: 4rpx;
}
.bottomArea .wedding .bottomMain .default .item .itemCt{
    border-radius: 27rpx;
    background: linear-gradient(135deg, #183a6a, #1351a3);
    padding: 4rpx 12rpx;
}
/* bottomMain active状态下的子元素样式 */
.bottomArea .wedding .bottomMain.show .iptArea {
    width: 700rpx;
}
.bottomArea .wedding .bottomMain.show .iptArea::after {
    display: none;
}
.bottomArea .wedding .bottomMain.show .iptArea .msgIcon{
   display: none;
}
.bottomArea .wedding .bottomMain.show .iptArea .inputBox{
    width: 563rpx;
    left: 28rpx;
 }
````

## File: pages/joymewIndex/joymewIndex.json
````json
{
    "navigationBarTitleText": " 嗨喵悦动",
    "usingComponents": {
        "signNew": "../../components/sign/sign",
        "signYj": "../../components/signYj/signYj",
        "signLz": "../../components/signLz/signLz",
        "signCustom": "../../components/signCustom/signCustom"
    },
    "disableScroll": true,
    "navigationStyle": "custom"
}
````

## File: pages/live/live.js
````javascript
import { getToken, getLiveId } from '../../utils/storage';
import { getCurrentTimestamp } from '../../utils/date';
import { getOrigin, removeOrigin, getIsHlt } from '../../utils/storage';
import { PAGE_HOST } from '../../assets/constant/host';

const app = getApp();

Page({
  data: {
    h5Url: '',
    activityTitle: '欢迎进入 嗨喵悦动',
    liveId: '',
  },
  onLoad: function(options) {
    this.setData({
      h5Url: app.globalData.h5Url,
      activityTitle: app.globalData.activityTitle,
      liveId: getLiveId(),
    });
    console.log('***h5Url***');
    console.log(this.data.h5Url);
    console.log('***activityTitle***');
    console.log(this.data.activityTitle);
  },
  onShow: function() {
    if (app.globalData.isH5NeedRefresh) {
      console.log('***h5 needRefresh***');
      app.globalData.isH5NeedRefresh = false;
      this.updateH5Url();
      removeOrigin();
      this.setData({
        h5Url: app.globalData.h5Url,
        activityTitle: app.globalData.activityTitle,
        liveId: getLiveId(),
      });
      console.log('***h5Url***');
      console.log(this.data.h5Url);
      console.log('***activityTitle***');
      console.log(this.data.activityTitle);
    }
  },
  updateH5Url() {
    const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
    let variableUrl = '';
    const tmpIsHlt = getIsHlt();
    if (app.globalData.userPhone) {
      variableUrl += `&userPhone=${app.globalData.userPhone}`;
    }
    if (tmpIsHlt) {
      variableUrl += `&isHlt=${tmpIsHlt}`;
    }
    const tmpOrigin = getOrigin();
    switch (tmpOrigin) {
      case 'sendGift':
        variableUrl += '&origin=sendGift';
        break;
      case 'purchaseEnterEffect':
        variableUrl += '&origin=purchaseEnterEffect';
        break;
      case 'sendBapin':
        variableUrl += '&origin=sendBapin';
        break;
      case 'sendPhoto':
        variableUrl += '&origin=sendPhoto';
        break;
      case 'sendDanmu':
        variableUrl += '&origin=sendDanmu';
        break;
      case 'sendDanmuHby':
        variableUrl += '&origin=sendDanmuHby';
        break;
      case 'editInfo':
        variableUrl += '&origin=editInfo';
        break;
      case 'sendDiamondHb':
        variableUrl += '&origin=sendDiamondHb';
        break;
      default:
        variableUrl = '';
    }

    if (variableUrl) {
      app.setH5Url(staicUrl + variableUrl);
      console.log(staicUrl + variableUrl);
    } else {
      app.setH5Url(staicUrl);
      console.log(staicUrl);
    }
  },
  onShareAppMessage: function() {
    return {
      title: this.data.activityTitle,
      path: '/pages/joymewIndex/joymewIndex?liveId=' + this.data.liveId,
    };
  },
});
````

## File: pages/live/live.json
````json
{
  "navigationBarTitleText": " 嗨喵悦动",
  "backgroundColor": "#305068",
  "disableScroll": true,
  "navigationStyle": "custom"
}
````

## File: pages/live/live.wxml
````
<web-view wx:if="{{h5Url}}" src="{{h5Url}}"></web-view>
````

## File: pages/pay/pay.js
````javascript
import {
  diamondRecharge,
  sendGift,
  sendGiftBroadCast,
  sendGiftGameRecharge,
  sendSuperDanmuRecharge,
} from '../../api/recharge/recharge';
import { wxPay } from '../../api/pay';
import { timeoutTask, showWxToast } from '../../utils/index';
import { setOrigin } from '../../utils/storage';
const app = getApp();

Page({
  /**
     * 页面的初始数据
     */
  data: {
    total: 0,
    userId: '',
    openId: '',
    origin: '',
    recommendGiftId: '',
    is_half_gift: '',
    giftconst: '',
    giftText: '',
  },

  /**
     * 生命周期函数--监听页面加载
     */
  onLoad: function(options) {
    console.log(options);
    if (options.total) {
      this.setData({
        total: options.total,
      });
    }
    if (options.userId) {
      this.setData({
        userId: options.userId,
      });
    }
    if (options.openId) {
      this.setData({
        openId: options.openId,
      });
    }
    if (options.origin) {
      this.setData({
        origin: options.origin,
      });
    }
    if (this.data.origin === 'sendRecommendGift') {
      this.setData({
        recommendGiftId: options.giftId,
        is_half_gift: options.is_half_gift,
      });
      this.sendRecommendGift();
    } else if (this.data.origin === 'sendGiftGame') {
      this.setData({
        giftconst: options.giftconst,
      });
      if (this.data.giftconst === 'text') {
        this.setData({
          giftText: options.content,
        });
      }
      this.sendGiftGame();
    } else if (this.data.origin === 'sendSuperDanmu') {
      this.setData({
        giftconst: options.giftconst,
        giftText: options.content,
      });
      this.sendSuperDanmu();
    } else {
      this.rechargeDiamonds();
    }
  },
  //充值完直接发礼物
  sendRecommendGift: function() {
    diamondRecharge({
      total: this.data.total,
      userId: this.data.userId,
      openId: this.data.openId,
    })
      .then(res => {
        console.log(res);
        return wxPay(res);
      })
      .then(() => {
        return sendGift({
          giftId: this.data.recommendGiftId,
          is_half_gift: this.data.is_half_gift,
        });
      })
      .then(res2 => {
        console.log(res2);
        if (res2.data.code === 200) {
          showWxToast('喵钻不足!发送失败!');
          timeoutTask(() => {
            wx.navigateBack();
          }, 500);
          return;
        }
        showWxToast('发送成功');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
        return sendGiftBroadCast({
          giftId: this.data.recommendGiftId,
        });
      })
      .catch(err => {
        console.log(err);
        showWxToast('发送失败');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      });
  },
  //充值喵钻
  rechargeDiamonds: function() {
    diamondRecharge({
      total: this.data.total,
      userId: this.data.userId,
      openId: this.data.openId,
    })
      .then(res => {
        console.log(res);
        return wxPay(res);
      })
      .then(() => {
        showWxToast('充值成功');
        app.globalData.isH5NeedRefresh = true;
        if (this.data.origin) {
          setOrigin(this.data.origin);
        }
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      })
      .catch(err => {
        console.log(err);
        showWxToast('充值失败');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      });
  },
  // 送祝福游戏充值并发礼物
  sendGiftGame: function() {
    sendGiftGameRecharge({
      giftconst: this.data.giftconst,
      openid: this.data.openId,
      userId: this.data.userId,
      content: this.data.giftText,
    })
      .then(res => {
        console.log(res);
        return wxPay(res);
      })
      .then(() => {
        showWxToast('发送成功');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      })
      .catch(err => {
        console.log(err);
        showWxToast('发送失败');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      });
  },
  // 充值并发送全屏特效
  sendSuperDanmu: function() {
    sendSuperDanmuRecharge({
      giftconst: this.data.giftconst,
      openid: this.data.openId,
      userId: this.data.userId,
      content: this.data.giftText,
    })
      .then(res => {
        console.log(res);
        return wxPay(res);
      })
      .then(() => {
        showWxToast('发送成功');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      })
      .catch(err => {
        console.log(err);
        showWxToast('发送失败');
        timeoutTask(() => {
          wx.navigateBack();
        }, 500);
      });
  },
});
````

## File: pages/pay/pay.json
````json
{
  "navigationBarTitleText": "支付",
  "disableScroll": true
}
````

## File: utils/index.js
````javascript
let wxToastLock = false;
let wxLoadingLock = false;
export function timeoutTask(task, time) {
  let tmpTimeout = setTimeout(() => {
    task();
    clearTimeout(tmpTimeout);
  }, time);
}
export function isNumber(val) {
  const regPos = /^\d+(\.\d+)?$/; //非负浮点数

  const regNeg = /^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/; //负浮点数

  let flag = false;

  if (regPos.test(val) || regNeg.test(val)) {
    flag = true;
  }
  return flag;
}
// 获取随机值  min<= num < max
export const getRandom = (min, max) =>
  Math.floor(Math.random() * (max - min)) + min;

export const showWxToast = pTip => {
  if (!wxToastLock && !wxLoadingLock) {
    wxToastLock = true;
    wx.showToast({
      title: pTip,
      icon: 'none',
    });
    timeoutTask(() => {
      hideWxToast();
    }, 1500);
  } else if (!wxToastLock && wxLoadingLock) {
    hideWxLoading();
    showWxToast(pTip);
  } else if (wxToastLock && !wxLoadingLock) {
    hideWxToast();
    showWxToast(pTip);
  } else {
    console.log('两个锁都是锁住状态 showWxToast');
  }
};

export const showWxLoading = pTip => {
  if (!wxToastLock && !wxLoadingLock) {
    wxLoadingLock = true;
    wx.showLoading({
      title: pTip,
      mask: true,
    });
  } else if (!wxToastLock && wxLoadingLock) {
    hideWxLoading();
    showWxLoading(pTip);
  } else if (wxToastLock && !wxLoadingLock) {
    hideWxToast();
    showWxLoading(pTip);
  } else {
    console.log('两个锁都是锁住状态 showWxLoading');
  }
};

export const hideWxLoading = () => {
  if (wxLoadingLock) {
    wx.hideLoading();
    wxLoadingLock = false;
  } else {
    console.log('特殊情况hideWxLoading');
  }
};
const hideWxToast = () => {
  if (wxToastLock) {
    wx.hideToast();
    wxToastLock = false;
  } else {
    console.log('特殊情况hideWxToast');
  }
};

export const converNumToText = numStr => {
  let text = '';
  switch (numStr) {
    case '1':
      text = '一';
      break;
    case '2':
      text = '二';
      break;
    case '3':
      text = '三';
      break;
    case '4':
      text = '四';
      break;
    case '5':
      text = '五';
      break;
    case '6':
      text = '六';
      break;
    case '7':
      text = '七';
      break;
    case '8':
      text = '八';
      break;
    case '9':
      text = '九';
      break;
    case '10':
      text = '十';
      break;
    case '11':
      text = '十一';
      break;
    case '12':
      text = '十二';
      break;
    case '13':
      text = '十三';
      break;
    case '14':
      text = '十四';
      break;
    case '15':
      text = '十五';
      break;
    case '16':
      text = '十六';
      break;
    case '17':
      text = '十七';
      break;
    case '18':
      text = '十八';
      break;
    case '19':
      text = '十九';
      break;
    case '20':
      text = '二十';
      break;
    default:
      text = '';
  }
  return text;
};


// 获取当前年月日
export const getCurrentDate = (dateType) => {
  let tmpResultDate;
  const date = new Date();
  if(dateType === 'date') {
    const year = date.getFullYear();
    const tmpMonth = date.getMonth() + 1;
    const month = tmpMonth < 10 ? "0" + tmpMonth : tmpMonth;
    const day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
    const hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
    const minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
    const second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
    tmpResultDate = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
  } else if(dateType === 'timestamp') {
    tmpResultDate = date.getTime();
  }
  return tmpResultDate;
}


// 生成随机id(随机字母加当前时间戳构成)
export const generateRandomId = (pLen) => {
  let tmpId = '';
  const charStr = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz';
  const tmpLen1 = charStr.length;
  const tmplen2 = pLen || 6; // 生成的id字母部分的长度，默认长度为6
  for (let i = 0; i < tmplen2; i += 1) {
    tmpId += charStr.charAt(Math.floor(Math.random() * tmpLen1));
  }
  tmpId += new Date().getTime();
  return tmpId;
};
````

## File: utils/qiniu/index.js
````javascript
import { $request } from '../request';
import { generateRandomId } from '../index';

const qiniuUploader = require("./qiniuUploader");

function getQiniuToken() {
    return $request('host/getQnToken','POST', {
        cancelLoading: true
    })
}
// 初始化七牛云相关配置
function initQiniu(myToken) {
    var options = {
        // bucket所在区域，这里是华北区。ECN, SCN, NCN, NA, ASG，分别对应七牛云的：华东，华南，华北，北美，新加坡 5 个区域
        region: 'ECN',

        // 获取uptoken方法三选一即可，执行优先级为：uptoken > uptokenURL > uptokenFunc。三选一，剩下两个置空。推荐使用uptokenURL，详情请见 README.md
        // 由其他程序生成七牛云uptoken，然后直接写入uptoken
        uptoken: myToken,
        // 从指定 url 通过 HTTP GET 获取 uptoken，返回的格式必须是 json 且包含 uptoken 字段，例如： {"uptoken": "0MLvWPnyy..."}
        uptokenURL: '',
        // uptokenFunc 这个属性的值可以是一个用来生成uptoken的函数，详情请见 README.md
        uptokenFunc: function () { 
        	// do something
        },
        // bucket 外链域名，下载资源时用到。如果设置，会在 success callback 的 res 参数加上可以直接使用的 fileURL 字段。否则需要自己拼接
        domain: 'https://ustatic.hudongmiao.com/',
        // qiniuShouldUseQiniuFileName 如果是 true，则文件的 key 由 qiniu 服务器分配（全局去重）。如果是 false，则文件的 key 使用微信自动生成的 filename。出于初代sdk用户升级后兼容问题的考虑，默认是 false。
        // 微信自动生成的 filename较长，导致fileURL较长。推荐使用{qiniuShouldUseQiniuFileName: true} + "通过fileURL下载文件时，自定义下载名" 的组合方式。
        // 自定义上传key 需要两个条件：1. 此处shouldUseQiniuFileName值为false。 2. 通过修改qiniuUploader.upload方法传入的options参数，可以进行自定义key。（请不要直接在sdk中修改options参数，修改方法请见demo的index.js）
        // 通过fileURL下载文件时，文件自定义下载名，请参考：七牛云“对象存储 > 产品手册 > 下载资源 > 下载设置 > 自定义资源下载名”（https://developer.qiniu.com/kodo/manual/1659/download-setting）。本sdk在README.md的"常见问题"板块中，有"通过fileURL下载文件时，自定义下载名"使用样例。
        shouldUseQiniuFileName: false
    };
    // 将七牛云相关配置初始化进本sdk
    qiniuUploader.init(options);
}

function getTodayStr() {
    const today = new Date();
    const add0 = (item) => {
      return item > 9 ? item : `0${item}`;
    };
    return `${today.getFullYear()}${add0(today.getMonth() + 1)}${add0(today.getDate())}`;
}

function qiniuUpload(filePath) {
    const todayStr = getTodayStr();
    const key = `mpAvatar/${todayStr}/${generateRandomId(12)}/${generateRandomId()}`;
    return new Promise((resolve, reject) => {
        qiniuUploader.upload(filePath, (res) => {
            resolve(res);
        }, (err) => {
            reject(err);
        },{
            key,
            region: 'ECN'
        });
    });
}

function qiniuUploadFiles(fileArr) {
  return new Promise(function(resolve, reject){
    const asyncTask = [];
  
    fileArr.forEach((fileItem) => {
      asyncTask.push(qiniuUpload(fileItem));
    });
    wx.showLoading({
      mask: true,
      title: '上传中，请稍等~'
    })
    Promise.all(asyncTask).then((res) => {
      wx.hideLoading();
      console.log(res);
      resolve(res);
    }).catch((err) => {
      wx.hideLoading();
      console.log(err);
      reject(err);
    })
  });
}
export default {
    getQiniuToken,
    initQiniu,
    qiniuUpload,
    qiniuUploadFiles,
}
````

## File: api/pay.js
````javascript
// 微信支付
export function wxPay(param) {
    return new Promise((resolve, reject) => {
        wx.requestPayment({
            'timeStamp': param.obj.timeStamp,
            'nonceStr': param.obj.nonceStr,
            'package': param.obj.package,
            'signType': 'MD5',
            'paySign': param.obj.paySign,
            'success': function (res) {
                console.log(res);
                resolve(res)
            },
            'fail': function (res) {
                reject(res)
            }
        })
    });
}

/**
 * 微信支付
 */
export function reqWxPay(param) {
  return new Promise((resolve, reject) => {
    wx.requestPayment({
      timeStamp: param.obj.timeStamp,
      nonceStr: param.obj.nonceStr,
      package: param.obj.package,
      signType: "MD5",
      paySign: param.obj.paySign,
      success: (res) => {
        console.log(res);
        resolve(res);
      },
      fail: (res) => {
        reject(res);
      },
    });
  });
}

/**
 * 喵钻充值
 */
export async function reqDiamondRecharge({ total, userId, openId }) {
  const res = await request(
    "hmWxmoney/chongzhiMiao",
    "POST",
    {
      total,
      userId,
      openid: openId,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}

/**
 * 送礼物游戏支付并发送
 * @param {String} content 礼物文字内容,如果是礼物不带文字则传空字符串
 */
export async function reqSendGiftGameRecharge({
  giftconst,
  openid,
  userId,
  content,
  splid,
}) {
  const res = await request(
    "hmWxmoney/sendWishPay",
    "POST",
    {
      giftconst,
      openid,
      userId,
      content,
      splid,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}

/**
 * 全屏特效支付并发送
 * @param {String} content 礼物文字内容,如果是礼物不带文字则传空字符串
 */
export async function reqSendSuperDanmuRecharge({
  giftconst,
  openid,
  userId,
  content,
  splid,
}) {
  const res = await request(
    "hmWxmoney/sendSuperGift",
    "POST",
    {
      giftconst,
      openid,
      userId,
      content,
      splid,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}

/**
 * 点歌支付并发送
 */
export async function reqSendMusicGiftRecharge({
  giftconst,
  openid,
  userId,
  guanxi,
  splid,
}) {
  const res = await request(
    "hmWxmoney/sendMusicGift",
    "POST",
    {
      giftconst,
      openid,
      userId,
      guanxi,
      splid,
      wx_pay_kind: "music",
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}

/**
 * 充钱发普通礼物
 * @description 发礼物、霸屏、照片、火箭弹幕的通用接口
 * @param {string} giftId
 * @param {string} openId
 * @param {string} userId
 * @param {string} giftText
 * @param {string} giftImage
 */
export async function reqRechargeAndSendGift({
  giftId,
  openId,
  userId,
  giftText,
  giftImage,
}) {
  const res = await request(
    "hmWxmoney/sendPuTongGift",
    "GET",
    {
      splid: wx.getStorageSync('liveId'),
      giftconst: giftId,
      openid: openId,
      userId,
      content: giftText,
      tpUrl: giftImage,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}

/**
 * 充钱发嘉年华礼物
 * @param {string} giftId
 * @param {string} openId
 * @param {string} userId
 */
export async function reqRechargeAndSenCarnivalGift({
  giftId,
  openId,
  userId,
}) {
  const res = await request(
    "hmWxmoney/sendCarnivalGift",
    "POST",
    {
      splid: wx.getStorageSync('liveId'),
      giftconst: giftId,
      openid: openId,
      userId,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}


/**
 * 加分宝道具支付
 */
export async function reqRechargeAndBuyAddScoreTool({
  giftId,
  openId,
  userId,
  wxPayKind,
}) {
  const res = await request(
    "hmWxmoney/addScoreTool",
    "POST",
    {
      splid: wx.getStorageSync('liveId'),
      giftconst: giftId,
      openid: openId,
      userId,
      wx_pay_kind: wxPayKind,
    },
    {
      needAppId: true,
    }
  );
  return reqWxPay(res);
}
````

## File: pages/joymewIndex/joymewIndex.wxss
````
.joymewIndex {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.joymewIndex>.bg {
    width: 750rpx;
    height: 1624rpx;
    background: radial-gradient(circle, #E94D67, #A81E24);
    position: absolute;
}

.joymewIndex>.title2Img {
    width: 501rpx;
    height: 387rpx;
    position: absolute;
    top: -39rpx;
    left: 129rpx;
}

.joymewIndex>.loveImg {
    width: 65rpx;
    height: 60rpx;
    position: absolute;
    left: 37rpx;
    top: 98rpx;
}

.joymewIndex>.love2Img {
    width: 51rpx;
    height: 46rpx;
    position: absolute;
    left: 89rpx;
    top: 21rpx;
}

.joymewIndex>.love3Img {
    width: 60rpx;
    height: 51rpx;
    position: absolute;
    top: 106rpx;
    right: 60rpx;
}

.joymewIndex>.pearImg {
    position: absolute;
    width: 188rpx;
    height: 189rpx;
    top: -60rpx;
    right: -19rpx;
}

.joymewIndex>.ribbonImg {
    width: 203rpx;
    height: 164rpx;
    position: absolute;
    top: 250rpx;
    left: -81rpx;
}

.joymewIndex>.ribbonImg2 {
    width: 180rpx;
    height: 145rpx;
    position: absolute;
    top: 218rpx;
    right: -79rpx;
}

.joymewIndex>.pearImg2 {
    position: absolute;
    width: 188rpx;
    height: 189rpx;
    top: 120rpx;
    right: -93rpx;
}

.joymewIndex>.weddingTitle {
    width: 705rpx;
    height: 319rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/box2-01.png');
    background-size: 100% 100%;
    position: absolute;
    top: 345rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.joymewIndex>.weddingTitle>.happyImg {
    width: 183rpx;
    height: 147rpx;
    position: absolute;
    left: 28rpx;
    top: -60rpx;
}

.joymewIndex>.weddingTitle>.title {
    font-size: 48rpx;
    font-weight: 400;
    color: #848484;
    background: linear-gradient(43deg, #FAE4A7 3.1494140625%, #F4CA71 29.0771484375%, #FADC9D 76.3671875%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: absolute;
    bottom: 66rpx;
    width: 100%;
    text-align: center;
    overflow: hidden;
    white-space: nowrap;
}

.joymewIndex>.weddingTitle>.welcome {
    font-size: 24rpx;
    font-weight: 400;
    color: #848484;
    position: absolute;
    top: 46rpx;
    background: linear-gradient(43deg, #FAE4A7 3.1494140625%, #F4CA71 29.0771484375%, #FADC9D 76.3671875%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 7rpx;
}

.joymewIndex>.weddingTitle>.engWelcome1 {
    font-size: 27rpx;
    font-family: zihun160hao;
    color: #848484;
    position: absolute;
    top: 99rpx;
    background: linear-gradient(43deg, #FAE4A7 3.1494140625%, #F4CA71 29.0771484375%, #FADC9D 76.3671875%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.joymewIndex>.weddingTitle>.engWelcome2 {
    font-size: 35rpx;
    font-weight: normal;
    color: #848484;
    position: absolute;
    top: 127rpx;
    background: linear-gradient(43deg, #FAE4A7 3.1494140625%, #F4CA71 29.0771484375%, #FADC9D 76.3671875%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.joymewIndex>.signTitleImg {
    width: 274rpx;
    height: 65rpx;
    position: absolute;
    top: 700rpx;
}

.joymewIndex>.signBox {
    width: 783rpx;
    height: 671rpx;
    position: absolute;
    top: 720rpx;
    background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/box-01.png');
    background-size: 100% 100%;
    left: 16rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.joymewIndex>.love4Img {
    position: absolute;
    width: 726rpx;
    height: 574rpx;
    bottom: -34rpx;
}

.joymewIndex>.signBox>.userName {
    position: absolute;
    top: 160rpx;
    width: 73%;
    left: 11%
}

.joymewIndex>.signBox .lineImg {
    /* width: 416rpx; */
    width: 100%;
    height: 3rpx;
    position: absolute;
    bottom: 0;
}

.joymewIndex>.signBox>.wishes {
    position: absolute;
    top: 281rpx;
    width: 73%;
    left: 11%;
    display: flex;
    align-items: center;
}

.joymewIndex>.signBox>.wishes>input {
    width: 66%;
    height: 91rpx;
    padding: 22rpx 0rpx;
    box-sizing: border-box;
    font-size: 32rpx;
    font-weight: normal;
    color: #FFFFFF;
    border: none;
    outline: none;
    margin-left: 7%;
}

.joymewIndex>.signBox>.wishes>.refreshBtn {
    width: 123rpx;
    height: 44rpx;
    background: rgba(255, 255, 255, 0.14);
    border: 0rpx solid #FFC6AB;
    border-radius: 16rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    right: 3%;
}

.joymewIndex>.signBox>.wishes>.refreshBtn>.refreshIcon {
    width: 30rpx;
    height: 30rpx;
}

.joymewIndex>.signBox>.wishes>.refreshBtn>text {
    font-size: 24rpx;
    font-weight: normal;
    color: #FACD7F;
    margin-left: 7rpx;
}

.joymewIndex>.signBox>.userName>.iptWrap {
    display: flex;
    align-items: center;
    width: 100%;
}

.joymewIndex>.signBox>.userName>.iptWrap>text {
    font-size: 36rpx;
    font-weight: normal;
    color: #FFFFFF;
    margin-left: 7%;
    margin-right: 4%;
}

.joymewIndex>.signBox>.userName>.iptWrap>input {
    /* width: 416rpx; */
    width: 60%;
    height: 91rpx;
    padding: 22rpx 0rpx;
    box-sizing: border-box;
    font-size: 30rpx;
    font-weight: normal;
    color: #FFFFFF;
    border: none;
    outline: none;
}

.joymewIndex>.signBox>.chooseGroup {
    width: 52%;
    display: flex;
    justify-content: space-around;
    position: absolute;
    top: 420rpx;
    left: 15%;
}

.joymewIndex>.signBox>.chooseGroup>.chooseItem {
    width: 225rpx;
    height: 63rpx;
}

.joymewIndex>.signBox>.chooseGroup>.chooseItem {
    background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/round.png');
    background-size: 100% 100%;
    width: 34rpx;
    height: 34rpx;
    position: relative;
}

.joymewIndex>.signBox>.chooseGroup>.chooseItem>text {
    font-size: 28rpx;
    font-weight: normal;
    color: #FFFFFF;
    position: absolute;
    display: block;
    white-space: nowrap;
    left: 48rpx;
    top: -3rpx;
}

.joymewIndex>.signBox>.chooseGroup>.chooseItem.active {
    background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/roundActive.png');
    background-size: 100% 100%;
    width: 34rpx;
    height: 34rpx;
}

.joymewIndex>.signBox>.signBtn {
    background-image: url('https://static.hudongmiao.com/joymewMp/joymewIndex/btn.png');
    background-size: 100% 100%;
    width: 445rpx;
    height: 87rpx;
    position: absolute;
    top: 500rpx;
}

.joymewIndex>.signBox>.authBtn {
    width: 445rpx;
    height: 87rpx;
    position: absolute;
    top: 500rpx;
    opacity: 0;
}

@media screen and (max-height: 720px) {
    .joymewIndex>.title2Img {
        top: -94rpx;
    }

    .joymewIndex>.weddingTitle {
        top: 241rpx;
    }

    .joymewIndex>.signTitleImg {
        top: 584rpx;
    }

    .joymewIndex>.signBox {
        top: 584rpx;
        background-size: 100% 90%;
        background-repeat: no-repeat;
    }

    .joymewIndex>.signBox>.userName {
        top: 120rpx;
    }

    .joymewIndex>.signBox>.wishes {
        top: 234rpx;
    }

    .joymewIndex>.signBox>.chooseGroup {
        top: 387rpx;
    }

    .joymewIndex>.signBox>.signBtn {
        top: 467rpx;
    }

    .joymewIndex>.signBox>.authBtn {
        top: 467rpx;
    }
}
````

## File: utils/request.js
````javascript
import { API_HOST, PAGE_HOST } from '../assets/constant/host.js';
import { getToken, clearStorage } from './storage.js';
import { showWxToast, showWxLoading, hideWxLoading } from './index.js';

const APPID = 'wxcf421d0df719398e';
export function request(url, method = 'GET', data) {
  return new Promise((resolve, reject) => {
    const tmpToken = getToken();
    if (!data.cancelLoading) {
      showWxLoading('请求中');
    }
    wx.request({
      url: API_HOST + url,
      method,
      data,
      header: {
        token: tmpToken,
        appId: APPID,
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      success: res => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        if (res.statusCode === 200) {
          if (res.data.success) {
            resolve(res.data);
          } else {
            if (res.data.message === '401') {
              showWxToast('登录已过期,请重新授权登录!');
              clearStorage();
              reject('401');
            } else {
              resolve(res.data);
            }
          }
        } else {
          showWxToast('网络异常');
          reject('网络异常');
        }
      },
      fail: err => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        showWxToast('网络异常');
        reject('网络异常');
      },
    });
  });
}

export function requestUpload(url, path) {
  return new Promise((resolve, reject) => {
    const tmpToken = getToken();
    wx.uploadFile({
      url: 'https://www.hudongmiao.com/' + url,
      filePath: path,
      name: 'file',
      header: {
        token: tmpToken,
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      formData: {
        prefix: 'wechat-complaints',
      },
      success: function(res) {
        resolve(res);
      },
      fail: function(err) {
        reject(err);
      },
    });
  });
}

export function $request(url, method = 'GET', data) {
  return new Promise((resolve, reject) => {
    const tmpToken = getToken();
    if (!data.cancelLoading) {
      showWxLoading('请求中');
    }
    wx.request({
      url: 'https://www.hudongmiao.com/' + url,
      method,
      data,
      header: {
        token: tmpToken,
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      success: res => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        if (res.statusCode === 200) {
          if (res.data.success) {
            resolve(res.data);
          } else {
            if (res.data.message === '401') {
              showWxToast('登录已过期,请重新授权登录!');
              clearStorage();
              reject('401');
            } else {
              resolve(res.data);
            }
          }
        } else {
          showWxToast('网络异常');
          reject('网络异常');
        }
      },
      fail: err => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        showWxToast('网络异常');
        reject('网络异常');
      },
    });
  });
}

export function requestH5(url, method = 'GET', data) {
  return new Promise((resolve, reject) => {
    const tmpToken = getToken();
    if (!data.cancelLoading) {
      showWxLoading('请求中');
    }
    wx.request({
      url: PAGE_HOST + url,
      method,
      data,
      header: {
        token: tmpToken,
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      success: res => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        if (res.statusCode === 200) {
          if (res.data.success) {
            resolve(res.data);
          } else {
            if (res.data.message === '401') {
              showWxToast('登录已过期,请重新授权登录!');
              clearStorage();
              reject('401');
            } else {
              resolve(res.data);
            }
          }
        } else {
          showWxToast('网络异常');
          reject('网络异常');
        }
      },
      fail: err => {
        if (!data.cancelLoading) {
          hideWxLoading();
        }
        showWxToast('网络异常');
        reject('网络异常');
      },
    });
  });
}
````

## File: utils/storage.js
````javascript
export function setToken(token) {
  wx.setStorageSync('token', token);
}
export function getToken() {
  return wx.getStorageSync('token');
}
export function setLiveId(liveId) {
  wx.setStorageSync('liveId', liveId);
}
export function getLiveId() {
  return wx.getStorageSync('liveId');
}
export function clearStorage() {
  //  wx.removeStorageSync('liveId');
  wx.removeStorageSync('token');
  wx.removeStorageSync('nickName');
  wx.removeStorageSync('avatarUrl');
}
export function setUseTipFlag() {
  wx.setStorageSync('useTipFlag', 1);
}
export function getUseTipFlag() {
  return wx.getStorageSync('useTipFlag');
}
export function setIsHlt(val) {
  wx.setStorageSync('isHlt', val);
}
export function getIsHlt() {
  return wx.getStorageSync('isHlt');
}
export function setAdPopFlag() {
  wx.setStorageSync('adPopFlag', 1);
}
export function getAdPopFlag() {
  return wx.getStorageSync('adPopFlag');
}
export function setUserInfo(paramObj) {
  wx.setStorageSync('nickName', paramObj.nickName);
  wx.setStorageSync('avatarUrl', paramObj.avatarUrl);
}
export function getUserInfo() {
  return {
    nickName: wx.getStorageSync('nickName'),
    avatarUrl: wx.getStorageSync('avatarUrl'),
  };
}
export function setOrigin(origin) {
  wx.setStorageSync('origin', origin);
}
export function getOrigin() {
  return wx.getStorageSync('origin');
}
export function removeOrigin() {
  wx.removeStorageSync('origin');
}
export function setUserPhone(userPhone) {
  wx.setStorageSync('userPhone', userPhone);
}
export function getUserPhone() {
  return wx.getStorageSync('userPhone');
}

export const addDebugInfo = ({ title, content, style = '' }) => {
  const debugInfo = JSON.parse(wx.getStorageSync('debugInfo') || '[]');
  debugInfo.push({
    time: new Date().toLocaleString(),
    title,
    content,
    style,
  });
  wx.setStorageSync('debugInfo', JSON.stringify(debugInfo));
};
````

## File: pages/joymewIndex/joymewIndex.wxml
````
<view class="joymewIndex">
    <!-- 签到模块 -->
    <!-- 云境定制签到 -->
    <signYj sceneType="{{sceneType}}" activityTitle="{{activityTitle}}" userNameProp="{{userName}}" isExamine="{{isExamine}}" wishProp="{{wish}}" wxGetPhoneButtonVisible="{{wxGetPhoneButtonVisible}}" bind:refreshWishEvent="refreshWish" bind:signEvent="sign" bind:needAuthEvent="showAuth" wx:if="{{isHlt === '39'}}"></signYj>
    <!-- 公司婚礼堂定制签到 -->
    <signLz sceneType="{{sceneType}}" activityTitle="{{activityTitle}}" userNameProp="{{userName}}" isExamine="{{isExamine}}" wishProp="{{wish}}" wxGetPhoneButtonVisible="{{wxGetPhoneButtonVisible}}" bind:refreshWishEvent="refreshWish" bind:signEvent="sign" bind:needAuthEvent="showAuth" wx:elif="{{isHlt === '38' || isHlt === '41'}}"></signLz>
    <!-- 自定义签到 -->
    <signCustom id="signCustom" sceneType="{{sceneType}}" activityTitle="{{activityTitle}}" userNameProp="{{userName}}" isExamine="{{isExamine}}" wishProp="{{wish}}" wxGetPhoneButtonVisible="{{wxGetPhoneButtonVisible}}" isForcePhone="{{isForcePhone}}" miaoShopId="{{miaoShopId}}" customSignBg="{{customSignBg}}" bind:refreshWishEvent="refreshWish" bind:signEvent="sign" wx:elif="{{!isHlt && customSignBg}}"></signCustom>
    <!-- 正常的签到 -->
    <signNew sceneType="{{sceneType}}" activityTitle="{{activityTitle}}" userNameProp="{{userName}}" isExamine="{{isExamine}}" wishProp="{{wish}}" wxGetPhoneButtonVisible="{{wxGetPhoneButtonVisible}}" isForcePhone="{{isForcePhone}}" miaoShopId="{{miaoShopId}}" bind:refreshWishEvent="refreshWish" bind:signEvent="sign" bind:needAuthEvent="showAuth" wx:else></signNew>
    <!-- 授权登录弹窗 -->
    <authDialog dialogVisible="{{needAuth}}" isJoymewIndex="{{isToH5AuthLogic}}" hasAgree="{{hasAgreePrivacy}}" bind:authSuccess="handleAuthSuccess" bind:authFail="handleAuthFail" bind:showPrivacy="handleShowPrivacy"></authDialog>
    <!-- 隐私授权弹窗 -->
    <privacyAuthorize
      needAutoShow="{{shouldShowPrivacy}}"
      bind:agreePrivacy="handleAgreePrivacy"
      bind:noUserAgreePrivacyInWx="handleNoUserAgreePrivacyInWx">
    </privacyAuthorize>
</view>
````

## File: app.js
````javascript
import { checkSystemUpdate, getSystemInfo } from './api/system.js';
import { setUserInfo, getUserInfo, setUserPhone, getUserPhone } from './utils/storage.js';

App({
  onLaunch: function() {
    //检查小程序更新
    checkSystemUpdate();
    // 初始化系统相关信息
    this.initSystemInfo();
  },
  onHide: function() {},
  globalData: {
    // 授权登录后获取的用户基本信息
    userInfo: {
      // 测试用待修改
      // nickName: '汪元会',
      // avatarUrl: 'https://thirdwx.qlogo.cn/mmopen/vi_32/sw36m5OS67agMibBw1ulocBjr5Hmv0zOkylyq7HrG3UD2ERQ2ux9IrMT1v7AxTrCgFmMnnb9QKPFtLyR80picBFA/132',
      nickName: '',
      avatarUrl: '',
    },
    activityTitle: '', // 活动标题
    h5Url: '', // live h5地址
    isH5NeedRefresh: false, // live h5是否需要刷新
    nynRechargeIndex: 0, //索引 扭一扭充值列表的索引
    nynLuckyIndex: 0, //索引 扭一扭中奖列表的索引
    zfdmIndex: 0, // 索引 争分夺秒消息队列的索引
    zfdmId: '', // 争分夺秒轮次id
    sceneType: '0', // 活动版本
    nynList: [],
    gameInfo_luckyWheelPrizeItemList: [], // 幸运转盘奖品列表
    userPhone: '',
    bottomLift: 0, // 底部安全距离
    statusBarHeight: 0, // 状态栏高度
    titleBarHeight: 0, // 自定义顶部导航栏高度
    // 测试用待修改
    // nynList: [{code:"0",desc:"谢谢参与"},{code:"4",desc:"18元"},{code:"5",desc:"58.8元"},{code:"6",desc:"88.8元"},{code:"7",desc:"28.8元"},{code:"8",desc:"68.8元"},{code:"9",desc:"38.8元"},{code:"10",desc:"谢谢参与"}],
  },
  setUserInfo(paramObj) {
    if (paramObj) {
      this.globalData.userInfo.nickName = paramObj.nickName;
      this.globalData.userInfo.avatarUrl = paramObj.avatarUrl;
      setUserInfo({
        nickName: paramObj.nickName,
        avatarUrl: paramObj.avatarUrl,
      });
    } else {
      const stUserInfo = getUserInfo();
      this.globalData.userInfo.nickName = stUserInfo.nickName;
      this.globalData.userInfo.avatarUrl = stUserInfo.avatarUrl;
    }
  },
  setH5Url(url) {
    this.globalData.h5Url = url;
  },
  setUserPhone(phone) {
    if(phone) {
      this.globalData.userPhone = phone;
      setUserPhone(phone);
    } else {
      const stUserPhone = getUserPhone();
      this.globalData.userPhone = stUserPhone || '';
    }
  },
  updateNynRechargeIndex() {
    this.globalData.nynRechargeIndex += 1;
  },
  updateNynLuckyIndex() {
    this.globalData.nynLuckyIndex += 1;
  },
  initZfdmId(id) {
    if (!this.globalData.zfdmId) {
      // 首次玩
      this.globalData.zfdmId = id;
    } else if (this.globalData.zfdmId !== id) {
      // 新的一轮索引需要重置
      this.globalData.zfdmId = id;
      this.resetZfdmIndex();
    }
  },
  updateZfdmIndex() {
    this.globalData.zfdmIndex += 1;
  },
  resetZfdmIndex() {
    this.globalData.zfdmIndex = 0;
  },
  initSystemInfo() {
    getSystemInfo().then((res) => {
      this.globalData.bottomLift = res.screenHeight - res.safeArea.bottom;
      this.globalData.statusBarHeight = res.statusBarHeight;
      this.globalData.titleBarHeight = res.model.indexOf('iPhone') !== -1 ? 44 : 48;
      console.log('系统相关信息:', {
        bottomLift: this.globalData.bottomLift,
        statusBarHeight: this.globalData.statusBarHeight,
        titleBarHeight: this.globalData.titleBarHeight,
      });
    }).catch((err) => {
      console.log(err);
    })
  },
});
````

## File: app.json
````json
{
  "pages": [
    "pages/joymewIndex/joymewIndex",
    "pages/index/index",
    "pages/live/live",
    "pages/test/pay/pay",
    "pages/nyn/nyn",
    "pages/zyz/zyz",
    "pages/kbx/kbx",
    "pages/test/login/login",
    "pages/recharge/recharge",
    "pages/recharge2/recharge2",
    "pages/hbkdRecharge/hbkdRecharge",
    "pages/test/index/index",
    "pages/pay/pay",
    "pages/agreement/agreement",
    "pages/feedback/feedback",
    "pages/photoWall/photoWall",
    "pages/hbWall/hbWall",
    "pages/photographerWall/photographerWall",
    "pages/hotelReserve/hotelReserve",
    "pages/hotelReserve/hotelDetail/hotelDetail",
    "pages/hotelReserve/packageDetail/packageDetail",
    "pages/hotelReserve/menuDetail/menuDetail",
    "pages/hotelReserve/couponDetail/couponDetail",
    "pages/hotelReserve/msWeddingDressDetail/msWeddingDressDetail",
    "pages/guessHb/guessHb",
    "pages/zfdm/zfdm",
    "pages/ad/ad",
    "pages/estimate/estimate",
    "pages/estimate/draw/draw",
    "pages/estimate/draw/drawPage/drawPage",
    "pages/estimate/review/review",
    "pages/estimate/host/host",
    "pages/estimate/hotel/hotel",
    "pages/hotelReserve/myPreferential/myPreferential",
    "pages/hotelReserve/preferentialDetail/preferentialDetail",
    "pages/winningRecord/winningRecord",
    "pages/debug/debug",
    "pages/joymewIndexDz/joymewIndexDz",
    "pages/luckyWheel/luckyWheel"
  ],
  "subpackages": [
    {
      "root": "packageA",
      "name": "packageA",
      "pages": [
        "pages/hbkdRecharge/hbkdRecharge"
      ]
    },
    {
      "root": "packageB",
      "name": "packageB",
      "pages": [
        "pages/photoWallIndex/photoWallIndex",
        "pages/photoWallUpload/photoWallUpload"
      ]
    }
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": " 嗨喵悦动",
    "navigationBarTextStyle": "black",
    "onReachBottomDistance": 100
  },
  "permission": {
    "scope.userLocation": {
      "desc": " 嗨喵悦动请求获得您的地理位置"
    }
  },
  "usingComponents": {
    "authDialog": "/components/authDialog/authDialog",
    "image-cropper": "/components/image-cropper/image-cropper",
    "privacyAuthorize": "/components/privacyAuthorize/privacyAuthorize"
  },
  "sitemapLocation": "sitemap.json",
  "__usePrivacyCheck__": true
}
````

## File: pages/joymewIndex/joymewIndex.js
````javascript
import {
  getSignInState,
  signIn,
  getLiveInfo,
  getLiveIdByUserId,
  saveSignInfo,
} from "../../api/index/index";
import {
  getToken,
  setLiveId,
  getLiveId,
  setUseTipFlag,
  getUseTipFlag,
  getUserInfo,
  clearStorage,
  setToken,
  setUserInfo,
  setIsHlt,
  getIsHlt,
} from "../../utils/storage";
import { getCurrentTimestamp, dateCompare } from "../../utils/date";
import defaultContent from "../../assets/constant/default";
import { getRandom, showWxToast, timeoutTask } from "../../utils/index";
import { getSubscribeMessage } from "../../api/system";
import { PAGE_HOST } from "../../assets/constant/host";

const AUTOSHOW_PRIVACY_ACCOUNT = "15633333333";
const app = getApp();
// 观察者模式 监听活动信息是否获取到
const Observer = {};

// 作为应付审核的liveId token
const LIVEID = "afb94fa7142f43adb3c5dc8bc61d2d9b";
const DEFAULTAVATOR =
  "https://static.joymew.com/joymewScreen/defaultHeadImg2.png";
const EXAMINETOKEN =
  "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHQiOjE3MTMyNjAzMjkyNTYsInVpZCI6ImY4OGVlMjU2YTdkMzQzNzc5MDYxYzVhYWVjY2NiOWFiIiwiaWF0IjoxNzEyOTA5ODcxNDAwfQ.W33qKSRQdsBKAeCqh1LmO9tXBNlNGKF-u5MQjHjqv_w";

Page({
  data: {
    sceneType: "", // 场景类型 0: 婚礼版 1:企业版 2:生日版
    role: "", // 亲友类型 1:男方亲友 2:女方亲友 ''：不选
    userName: "", // 姓名
    wish: "", // 祝福语
    userPhone: "", // 手机号
    deskNum: "", // 桌号
    birthDate: "",
    gender: "0",
    activityTitle: "",
    liveId: "",
    needAuth: false, // 是否需要授权登录
    isOverdate: false, // 活动是否过期
    isValid: true, // 活动是否有效
    customSignWishList: [], // 自定义签到语列表
    isForcePhone: false, // 企业版是否强制获取手机号
    isExamine: false, // 是否是isExamine live
    isContantQrcode: false, // 是否是固定二维码 live
    userIdParam: "", // 二维码中携带的userId参数
    miaoShopId: "", // 是否是婚礼堂 取值5(婚礼堂)、''(非婚礼堂的普通用户)
    isHlt: "", // 定位具体的某个婚礼堂 取值39(云境)、x(xxx婚礼堂)、common ''(非婚礼堂的普通用户)
    needH5Auth: false, // 是否需要H5授权(新用户需要启用H5授权获取头像昵称)
    customSignBg: "", // 自定义签到背景
    isToH5AuthLogic: true, // 是否需要手动上传头像昵称完成授权 默认H5授权自动获取头像昵称
    wxGetPhoneButtonVisible: false,
    shouldShowPrivacy: false,
    locationValStrCache: "", // 新增缓存字段
    hasAgreePrivacy: true, // 用户是否同意隐私协议
  },
  onLoad: function (options) {
    console.log("options:", options);
    let that = this;
    let tmpLiveId = "";
    let stLiveId = getLiveId(); // 缓存中的liveId
    // 观察者模式 监听活动信息是否获取到
    Object.defineProperty(Observer, "liveInfoGetted", {
      configurable: true,
      enumerable: true,
      get() {
        return false;
      },
      set(val) {
        if (val) {
          console.log("***liveInfoGetted***");
          // 活动信息获取到后 执行主逻辑
          that.mainLogic();
        }
      },
    });
    // 获取liveId
    if (options.q) {
      // 扫码进入
      this.decodeQrcodeParam(decodeURIComponent(options.q));
    } else if (options.liveId) {
      if (!this.validateExamineLive(options.liveId)) {
        this.setExamine();
        return;
      }
      // 分享带参进入
      tmpLiveId = options.liveId;
      this.setData({
        liveId: tmpLiveId,
      });
    } else if (stLiveId) {
      if (!this.validateExamineLive(stLiveId)) {
        this.setExamine();
        return;
      }
      // 直接进入
      this.setData({
        liveId: stLiveId,
      });
    } else {
      this.setExamine();
    }
    if (!this.data.isContantQrcode) {
      setLiveId(this.data.liveId);
    }
  },

  onShow: function () {
    if (this.data.isContantQrcode) {
      // 通过userId换取liveId后再获取活动信息
      this.getLiveInfoIndirect();
    } else {
      this.getLiveInfoDirect();
    }
  },
  onShareAppMessage: function () {
    let tmpShareObj;
    if (this.data.sceneType === "0") {
      tmpShareObj = {
        title: this.data.activityTitle,
        path: "/pages/joymewIndex/joymewIndex?liveId=" + this.data.liveId,
        imageUrl: "/assets/image/shareCard.png",
      };
    } else if (this.data.sceneType === "1") {
      tmpShareObj = {
        title: this.data.activityTitle,
        path: "/pages/joymewIndex/joymewIndex?liveId=" + this.data.liveId,
        imageUrl: "/assets/image/shareCard-annualMeeting01.png",
      };
    } else if (this.data.sceneType === "2") {
      tmpShareObj = {
        title: this.data.activityTitle,
        path: "/pages/joymewIndex/joymewIndex?liveId=" + this.data.liveId,
        imageUrl: "/assets/image/birthBg02.png",
      };
    } else {
      tmpShareObj = {
        title: this.data.activityTitle,
        path: "/pages/joymewIndex/joymewIndex?liveId=" + this.data.liveId,
      };
    }
    console.log("***onShareAppMessage***");
    console.log(tmpShareObj);
    return tmpShareObj;
  },
  mainLogic() {
    console.log("***执行主逻辑***");
    const stToken = getToken();
    const stUserInfo = getUserInfo();
    if (
      !stToken ||
      !stUserInfo.nickName ||
      !stUserInfo.avatarUrl ||
      (stUserInfo.avatarUrl === DEFAULTAVATOR && this.data.liveId !== LIVEID)
    ) {
      this.setData({
        needAuth: true,
      });
      return;
    }
    // 初始化用户信息
    app.setUserInfo();
    this.setData({
      userName: app.globalData.userInfo.nickName,
    });
    // 判断是否签到
    getSignInState()
      .then((res) => {
        console.log("***签到状态***");
        console.log(res);
        if (res.data.isNeddReload === "1") {
          throw "401";
        }
        if (this.data.isOverdate) {
          showWxToast("活动已结束!");
          if (this.data.isHlt) {
            app.setUserPhone(this.data.userPhone);
            timeoutTask(() => {
              wx.navigateTo({
                url: "/pages/hotelReserve/hotelReserve",
              });
            }, 1500);
          }
          return;
        }
        const isSign = res.data.qian_dao_le_me;
        this._isSign = isSign;
        this.judgeShowPrivacyPopup();
        if (isSign) {
          // 如果是isExamine，不自动跳转
          if (!this.data.isExamine) {
            this.toLive();
          }
          // 否则什么都不做，等用户手动点击签到
        }
      })
      .catch((err) => {
        console.log(err);
        // token过期需要授权登录
        this.setData({
          needAuth: true,
        });
      });
  },

  // 判断是否签到--->签到逻辑
  sign(e) {
    console.log(e);
    this.setData({
      userName: e.detail.userName,
      wish: e.detail.wish,
      role: e.detail.role || "",
      userPhone: e.detail.userPhone || "",
      deskNum: e.detail.deskNum || "",
      birthDate: e.detail.birthDate || "",
      gender: e.detail.gender || "",
    });
    if (this.data.isOverdate) {
      showWxToast("活动已结束!");
      if (this.data.isHlt) {
        app.setUserPhone(this.data.userPhone);
        timeoutTask(() => {
          wx.navigateTo({
            url: "/pages/hotelReserve/hotelReserve",
          });
        }, 1500);
      }
      return;
    }
    if (!this.data.isValid) {
      showWxToast("活动信息错误，请重新进入!");
      return;
    }
    getSubscribeMessage()
      .then((res) => {
        console.log(res);
        if (this.data.needH5Auth) {
          this.signLogicNeedH5Auth();
        } else {
          this.signLogic();
        }
      })
      .catch((err) => {
        console.log(err);
        if (this.data.needH5Auth) {
          this.signLogicNeedH5Auth();
        } else {
          this.signLogic();
        }
      });
  },
  // 跳转live页面
  toLive() {
    console.log("***toLive方法内部***");
    if (this.data.isExamine) {
      wx.navigateTo({
        url: "/pages/index/index",
      });
      return;
    }
    console.log("***needH5Auth***");
    console.log(this.data.needH5Auth);
    if (this.data.needH5Auth) {
      app.setH5Url(
        `https://shm.hudongmiao.com/hmScanReportController/method1?token=${getToken()}`
      );
    } else {
      app.setUserPhone(this.data.userPhone);
      // h5是否提示过的标识 缓存中有值说明提示过 没有值说明没有提示过
      const useTipFlag = getUseTipFlag();
      const tmpIsHlt = getIsHlt();
      const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
      let variableUrl = "";
      if (!useTipFlag) {
        variableUrl += "&useTipFlag=1";
      }
      if (tmpIsHlt) {
        variableUrl += `&isHlt=${tmpIsHlt}`;
      }
      if (app.globalData.userPhone) {
        variableUrl += `&userPhone=${app.globalData.userPhone}`;
      }
      if (variableUrl) {
        app.setH5Url(staicUrl + variableUrl);
        // 缓存中标记已经提示过
        setUseTipFlag();
      } else {
        app.setH5Url(staicUrl);
      }
    }
    wx.redirectTo({
      url: "/pages/live/live",
    });
  },
  // 刷新祝福语
  refreshWish() {
    // 设置自定义签到语
    let customSignLen = this.data.customSignWishList.length;
    if (customSignLen > 0) {
      this.setData({
        wish: this.data.customSignWishList[getRandom(0, customSignLen)],
      });
      return;
    }
    // 设置默认祝福语
    if (this.data.sceneType === "0") {
      this.setData({
        wish: defaultContent.wishesWedding[getRandom(0, 20)],
      });
    } else if (this.data.sceneType === "1") {
      this.setData({
        wish: defaultContent.wishesAnnualMeeting[getRandom(0, 20)],
      });
    } else if (this.data.sceneType === "2") {
      this.setData({
        wish: defaultContent.wishesBirth[getRandom(0, 14)],
      });
    } else if (this.data.sceneType === "21") {
      this.setData({
        wish: defaultContent.wishesBBY[getRandom(0, 10)],
      });
    } else if (this.data.sceneType === "22") {
      this.setData({
        wish: defaultContent.wishesSY[getRandom(0, 8)],
      });
    } else if (this.data.sceneType === "23") {
      this.setData({
        wish: defaultContent.wishesCRL[getRandom(0, 9)],
      });
    } else if (this.data.sceneType === "24") {
      this.setData({
        wish: defaultContent.wishesBLY[getRandom(0, 6)],
      });
    } else if (this.data.sceneType === "25") {
      this.setData({
        wish: defaultContent.wishesMYY[getRandom(0, 8)],
      });
    } else if (this.data.sceneType === "41") {
      this.setData({
        wish: defaultContent.wishesBYDL[getRandom(0, 31)],
      });
    } else if (this.data.sceneType === "42") {
      this.setData({
        wish: defaultContent.wishesXSY[getRandom(0, 25)],
      });
    } else if (this.data.sceneType === "43") {
      this.setData({
        wish: defaultContent.wishesJBTM[getRandom(0, 24)],
      });
    } else if (this.data.sceneType === "51") {
      this.setData({
        wish: defaultContent.wishesTXH[getRandom(0, 50)],
      });
    } else if (this.data.sceneType === "52") {
      this.setData({
        wish: defaultContent.wishesQQY[getRandom(0, 8)],
      });
    } else if (this.data.sceneType === "53") {
      this.setData({
        wish: defaultContent.wishesHX[getRandom(0, 7)],
      });
    } else if (this.data.sceneType === "55") {
      this.setData({
        wish: defaultContent.wishesWL[getRandom(0, 20)],
      });
    }
  },
  // 授权登录成功后的回调
  handleAuthSuccess(e) {
    // 用户名赋值
    console.log("***handleAuthSuccess方法内部***");
    this.setData({
      userName: app.globalData.userInfo.nickName,
      needAuth: false,
    });
    if (e.detail === "needH5Auth") {
      this.setData({
        needH5Auth: true,
      });
    }
    // 获取签到状态
    getSignInState()
      .then((res) => {
        console.log("***handleAuthSuccess 获取签到状态***");
        console.log(res);
        if (this.data.isOverdate) {
          showWxToast("活动已结束!");
          if (this.data.isHlt) {
            app.setUserPhone(this.data.userPhone);
            timeoutTask(() => {
              wx.navigateTo({
                url: "/pages/hotelReserve/hotelReserve",
              });
            }, 1500);
            return;
          }
        }
        const isSign = res.data.qian_dao_le_me;
        this._isSign = isSign;
        this.judgeShowPrivacyPopup();

        if (isSign) {
          // 如果是isExamine，不自动跳转
          if (!this.data.isExamine) {
            this.toLive();
          }
          // 否则什么都不做，等用户手动点击签到
        }
      })
      .catch((err) => {
        console.log(err);
        // token过期需要重新授权登录
        if (err === "401") {
          this.setData({
            needAuth: true,
          });
        }
      });
  },
  // 授权登录失败的回调
  handleAuthFail() {
    clearStorage();
    this.setData({
      needAuth: false,
    });
  },
  validateExamineLive(pLiveId) {
    let tFlag = true;
    if (pLiveId === LIVEID) {
      tFlag = false;
    }
    return tFlag;
  },
  setExamine() {
    setLiveId(LIVEID);
    setToken(EXAMINETOKEN);
    setUserInfo({
      nickName: "默认用户",
      avatarUrl: DEFAULTAVATOR,
    });
    this.setData({
      liveId: LIVEID,
      isExamine: true,
    });
  },
  // 设置自定义签到背景
  // rawBg字符串必须要要有http才算有效值
  setCustomBg(rawBg) {
    if (rawBg && rawBg.indexOf("http") > -1) {
      this.setData({
        customSignBg: rawBg,
      });
    }
  },
  getLiveInfoDirect() {
    getLiveInfo().then((res) => {
      console.log("*****getLiveInfo回调******");
      console.log(res);
      if (res && res.data && res.data.splid) {
        // 设置自定义背景
        this.setCustomBg(res.data.splid.qd_back);
        this.setData({
          activityTitle: res.data.splid.theme,
          sceneType: res.data.splid.scenario,
        });
        app.globalData.sceneType = this.data.sceneType;
        app.globalData.activityTitle = this.data.activityTitle;
        // 设置扭一扭奖项列表
        const tmpNynPrizeArray = [];
        const tmpNynList = res.data.nynList.split(",");
        for (let i = 0; i < tmpNynList.length; i++) {
          if (tmpNynList[i] === "0") {
            tmpNynPrizeArray.push({
              desc: "谢谢参与",
              endIndex: i,
            });
          } else if (tmpNynList[i] !== "-1") {
            tmpNynPrizeArray.push({
              desc: tmpNynList[i] + "元",
              endIndex: i,
            });
          }
        }
        app.globalData.nynList = tmpNynPrizeArray;
        // 设置幸运小转盘奖项列表
        app.globalData.gameInfo_luckyWheelPrizeItemList = res.data.luckySmallList.split(',');
        // 打印幸运小转盘奖项列表
        console.log("***幸运小转盘奖项列表***");
        console.log(app.globalData.gameInfo_luckyWheelPrizeItemList);
        if (res.data.signWish && res.data.signWish.length > 0) {
          let tmpSignWishList = res.data.signWish.map((item) => {
            return item.bless_str;
          });
          this.setData({
            customSignWishList: tmpSignWishList,
          });
        }
        // 设置默认祝福语
        this.refreshWish();
        // 是否强制获取手机号
        this.setData({
          isForcePhone: res.data.splid.forcephone === "1",
        });
        if (res.data.siyiInfo) {
          // 判断是否是婚礼堂用户
          if (res.data.siyiInfo.high_privilege === 5) {
            this.setData({
              miaoShopId: "5",
            });
            // 婚礼堂用户再区分：云境或其他酒店用户
            if (res.data.siyiInfo.tql_store_id === "39") {
              // 云境
              setIsHlt("39");
              this.setData({
                isHlt: "39",
                emceePhone: res.data.siyiInfo.phonenumber || "",
              });
            } else if (res.data.siyiInfo.tql_store_id) {
              // 其他酒店用户
              setIsHlt(res.data.siyiInfo.tql_store_id);
              this.setData({
                isHlt: res.data.siyiInfo.tql_store_id,
              });
            } else {
              // 特殊情况 无酒店id
              setIsHlt("common");
              this.setData({
                isHlt: "",
              });
            }
          } else {
            this.setData({
              miaoShopId: "",
              isHlt: "",
            });
            setIsHlt("common");
          }
          // 是否展示微信获取手机号组件
          this.setData({
            wxGetPhoneButtonVisible: res.data.siyiInfo.isOpenWxPhone === "1",
          });
        }

        // 活动是否过期
        if (
          dateCompare(res.data.splid.using_date) ||
          res.data.splid.is_end_wedding === "1"
        ) {
          showWxToast("活动已结束!");
          this.setData({
            isOverdate: true,
          });
        }
        // 是否手动设置头像昵称授权(地理位置限定或签到白名单功能)
        this.setIsToH5AuthLogic(res.data.splid.location_val);
        // 设置hasAgreePrivacy
        this.setHasAgreePrivacy();

        // 通知活动信息已经获取到可以执行主逻辑了
        Observer.liveInfoGetted = true;
      } else {
        showWxToast("活动信息获取错误，请重新进入!");
        this.setData({
          isValid: false,
        });
      }
    });
  },
  setHasAgreePrivacy() {
    console.log("***setHasAgreePrivacy方法内部***");
    // 如果微信侧没有用户授权记录，则也不需要模拟这一过程
    if (this.noUserAgreePrivacyInWx) {
      return;
    }
    // 当满足：特定账号并且 需要手动上传头像昵称的情况下则给它变为false
    if (
      this.data.emceePhone === AUTOSHOW_PRIVACY_ACCOUNT &&
      !this.data.isToH5AuthLogic
    ) {
      this.setData({
        hasAgreePrivacy: false,
      });
    }
  },
  handleNoUserAgreePrivacyInWx() {
    console.log("***handleNoUserAgreePrivacyInWx方法内部***");
    this.noUserAgreePrivacyInWx = true;
    this.setData({
      hasAgreePrivacy: true, // 不需要模拟微信侧没有用户授权记录的情况
    });
  },
  handleAgreePrivacy(e) {
    console.log("***handleAgreePrivacy方法内部***");
    console.log(e);
    this.setData({
      hasAgreePrivacy: e.detail,
    });
    if (!e.detail) {
      this.setData({
        shouldShowPrivacy: false,
      });
    }
  },
  getLiveInfoIndirect() {
    getLiveIdByUserId(this.data.userIdParam)
      .then((res) => {
        this.setData({
          liveId: res.data.splid,
        });
        setLiveId(res.data.splid);
      })
      .then(() => {
        this.getLiveInfoDirect();
      })
      .catch((err) => {
        console.log(err);
      });
  },
  decodeQrcodeParam(qrcodeParamStr) {
    const paramKey = qrcodeParamStr.split("?")[1].split("=")[0];
    const paramVal = qrcodeParamStr.split("?")[1].split("=")[1];
    if (!paramKey || !paramVal) {
      showWxToast("微信版本过低!");
      return;
    }
    if (paramKey === "userId") {
      this.setData({
        isContantQrcode: true,
        userIdParam: paramVal,
      });
      return;
    }
    if (!this.validateExamineLive(paramVal)) {
      this.setExamine();
    }
    this.setData({
      liveId: paramVal,
    });
  },
  // 需要H5授权的签到逻辑(需要H5授权说明一定没有签到过)
  signLogicNeedH5Auth() {
    app.setUserPhone(this.data.userPhone);
    // h5是否提示过的标识 缓存中有值说明提示过 没有值说明没有提示过
    const useTipFlag = getUseTipFlag();
    const tmpIsHlt = getIsHlt();
    const staicUrl = `${PAGE_HOST}?liveId=${getLiveId()}&token=${getToken()}&time=${getCurrentTimestamp()}`;
    let variableUrl = "";
    if (!useTipFlag) {
      variableUrl += "&useTipFlag=1";
    }
    if (tmpIsHlt) {
      variableUrl += `&isHlt=${tmpIsHlt}`;
    }
    if (app.globalData.userPhone) {
      variableUrl += `&userPhone=${app.globalData.userPhone}`;
    }
    if (variableUrl) {
      app.setH5Url(staicUrl + variableUrl);
      // 缓存中标记已经提示过
      setUseTipFlag();
    } else {
      app.setH5Url(staicUrl);
    }
    saveSignInfo({
      bless_str: this.data.wish,
      phonenumber:
        this.data.isForcePhone || this.data.miaoShopId
          ? this.data.userPhone
          : "",
      type: this.data.role,
      birthDate: this.data.birthDate,
      gender: this.data.gender,
      table_number: this.data.deskNum,
      redirect_url: app.globalData.h5Url,
    })
      .then(() => {
        // 后台完成签到
        this.toLive();
      })
      .catch((err) => {
        console.log(err);
        // token过期需要重新授权登录
        if (err === "401") {
          this.setData({
            needAuth: true,
          });
        }
      });
  },
  signLogic() {
    console.log("祝福语:", this.data.wish);
    console.log("姓名:", this.data.userName);
    console.log("亲友:", this.data.role);
    console.log(
      "手机号:",
      this.data.isForcePhone || this.data.miaoShopId ? this.data.userPhone : ""
    );
    console.log("桌号:", this.data.deskNum);
    console.log("生日:", this.data.birthDate);
    console.log("性别:", this.data.gender);
    getSignInState()
      .then((res) => {
        console.log("***sign 获取签到状态***");
        console.log(res);
        return res.data.qian_dao_le_me;
      })
      .then((res2) => {
        console.log(res2);
        if (!res2) {
          // 需要签到
          return signIn({
            wish: this.data.wish,
            name: this.data.userName,
            role: this.data.role,
            userPhone:
              this.data.isForcePhone || this.data.miaoShopId
                ? this.data.userPhone
                : "",
            deskNum: this.data.deskNum,
            birthDate: this.data.birthDate,
            gender: this.data.gender,
          });
        } else {
          // 不需要签到
          this.toLive();
        }
      })
      .then((res3) => {
        console.log(res3);
        if (res3?.data?.checkPhoneStatus === "no_pass") {
          showWxToast("抱歉，您无法签到!");
          return;
        }

        if (res3 && res3.success) {
          console.log("***签到接口返回***");
          console.log(res3);
          this.toLive();
        }
      })
      .catch((err) => {
        console.log(err);
        // token过期需要重新授权登录
        if (err === "401") {
          this.setData({
            needAuth: true,
          });
        }
      });
  },
  setIsToH5AuthLogic(locationValStr) {
    if (!locationValStr || locationValStr === "0") {
      return;
    }
    try {
      const locationValObj = JSON.parse(locationValStr);
      if (locationValObj.needFormAuth === "1") {
        // 需要用户手动上传头像、昵称
        this.setData({
          isToH5AuthLogic: false,
        });
      }
    } catch (err) {
      console.log(err);
    }
  },
  handleShowPrivacy() {
    this.setData({
      shouldShowPrivacy: true,
    });
  },
  judgeShowPrivacyPopup() {
    const isFormCustomAvatarNickname = !this.data.isToH5AuthLogic; // 是否是表单自定义头像昵称
    const isTargetAccount = this.data.emceePhone === AUTOSHOW_PRIVACY_ACCOUNT; // 是否是特定账号
    const isSign = this._isSign; // 是否已经签到
    const isExamine = this.data.isExamine; // 是否是审核版
    const hasUserInfo =
      app.globalData.userInfo && app.globalData.userInfo.nickName; // 是否有用户信息
    if (
      !isFormCustomAvatarNickname &&
      isTargetAccount &&
      !isSign &&
      !isExamine &&
      !hasUserInfo
    ) {
      // 特定账号情况下才能自动弹出隐私协议
      this.setData({
        shouldShowPrivacy: true,
      });
    }
  },
});
````
